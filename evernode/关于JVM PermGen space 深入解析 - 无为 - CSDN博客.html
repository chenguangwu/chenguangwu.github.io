<html>
<head>
  <title>关于JVM PermGen space 深入解析 - 无为 - CSDN博客</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3113"/>
<h1>关于JVM PermGen space 深入解析 - 无为 - CSDN博客</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/11/26 15:53</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://blog.csdn.net/zhongji/article/details/6325209"><i>https://blog.csdn.net/zhongji/article/details/6325209</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;"><div style="outline:0px;box-sizing:border-box;"><div style="box-sizing:inherit;outline:0px;font-family:&quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:1.57143;background-color:rgb(245, 246, 247);color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><div style="outline:0px;box-sizing:border-box;"><span style="box-sizing:inherit;outline:0px;"><div style="box-sizing:inherit;outline:0px;background:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.05) 0px 2px 4px 0px;">
	<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;border-bottom:1px solid rgb(224, 224, 224);padding-top:16px;z-index:9;background-color:rgb(255, 255, 255);">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;margin-bottom:8px;">
				<span style="color:rgb(134, 202, 94);padding:0px;margin:0px;outline:0px;box-sizing:inherit;margin-right:8px;text-align:center;border-radius:50%;width:26px;height:26px;font-size:12px;line-height:26px;display:inline-block;border:1px solid rgb(231, 244, 223);margin-top:4px;float:left;">转</span>				<h1 style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:24px;word-wrap:break-word;">关于JVM PermGen space 深入解析</h1>
			</div>
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;padding-bottom:14px;position:relative;">
				<div style="color:rgb(133, 133, 133);width:88%;height:54px;box-sizing:inherit;outline:0px;padding:0px;margin:0px;overflow:hidden;">
																				<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;">2011年04月15日 11:38:00</span>
					<a href="https://me.csdn.net/zhongji" style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;text-decoration:none;cursor:pointer;color:rgb(120, 165, 241);margin-right:14px;" target="_blank">zhongji</a>
						<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;">阅读数：1227</span>
						
														<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;margin-bottom:8px;font-size:12px;">
								<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;color:rgb(77, 77, 77);">标签：</span>
																<a href="http://so.csdn.net/so/search/s.do?q=jvm&amp;t=blog" style="text-align:center;margin:0px;outline:0px;box-sizing:inherit;display:inline-block;line-height:21px;border-radius:100px;color:rgb(77, 77, 77);padding:0px 8px;margin-bottom:4px;border:1px solid rgb(204, 204, 204);word-wrap:break-word;min-width:24px;height:21px;text-decoration:none;cursor:pointer;margin-right:8px;" target="_blank">jvm																</a><a href="http://so.csdn.net/so/search/s.do?q=generation&amp;t=blog" style="text-align:center;margin:0px;outline:0px;box-sizing:inherit;display:inline-block;line-height:21px;border-radius:100px;color:rgb(77, 77, 77);padding:0px 8px;margin-bottom:4px;border:1px solid rgb(204, 204, 204);word-wrap:break-word;min-width:24px;height:21px;text-decoration:none;cursor:pointer;margin-right:8px;" target="_blank">generation																</a><a href="http://so.csdn.net/so/search/s.do?q=tomcat&amp;t=blog" style="text-align:center;margin:0px;outline:0px;box-sizing:inherit;display:inline-block;line-height:21px;border-radius:100px;color:rgb(77, 77, 77);padding:0px 8px;margin-bottom:4px;border:1px solid rgb(204, 204, 204);word-wrap:break-word;min-width:24px;height:21px;text-decoration:none;cursor:pointer;margin-right:8px;" target="_blank">tomcat																</a><a href="http://so.csdn.net/so/search/s.do?q=outofmemoryerror&amp;t=blog" style="text-align:center;margin:0px;outline:0px;box-sizing:inherit;display:inline-block;line-height:21px;border-radius:100px;color:rgb(77, 77, 77);padding:0px 8px;margin-bottom:4px;border:1px solid rgb(204, 204, 204);word-wrap:break-word;min-width:24px;height:21px;text-decoration:none;cursor:pointer;margin-right:8px;" target="_blank">outofmemoryerror																</a><a href="http://so.csdn.net/so/search/s.do?q=spring&amp;t=blog" style="text-align:center;margin:0px;outline:0px;box-sizing:inherit;display:inline-block;line-height:21px;border-radius:100px;color:rgb(77, 77, 77);padding:0px 8px;margin-bottom:4px;border:1px solid rgb(204, 204, 204);word-wrap:break-word;min-width:24px;height:21px;text-decoration:none;cursor:pointer;margin-right:8px;" target="_blank">spring																</a><a href="http://so.csdn.net/so/search/s.do?q=class&amp;t=blog" style="text-align:center;margin:0px;outline:0px;box-sizing:inherit;display:inline-block;line-height:21px;border-radius:100px;color:rgb(77, 77, 77);padding:0px 8px;margin-bottom:4px;border:1px solid rgb(204, 204, 204);word-wrap:break-word;min-width:24px;height:21px;text-decoration:none;cursor:pointer;margin-right:8px;" target="_blank">class																</a>
							<span style="top:0px;padding:0px;margin:0px;outline:0px;box-sizing:inherit;cursor:pointer;background-color:rgb(255, 255, 255);font-size:12px;right:101px;width:45px;display:inline-block;line-height:20px;letter-spacing:0px;color:rgb(51, 153, 234);margin-right:0px;">更多</span></span>
																					<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:12px;margin-top:6px;margin-bottom:0px;">
								<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;color:rgb(77, 77, 77);">个人分类：</span>
																<a href="https://blog.csdn.net/zhongji/article/category/310264" style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;text-decoration:none;cursor:pointer;display:inline-block;margin-right:24px;color:rgb(121, 165, 229);word-wrap:break-word;" target="_blank">Java语言																</a>
							</div>
																								</div>
				<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;position:absolute;top:0px;right:0px;">
														</div>
			</div>
		</div>
	</div>
	<div style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;display:block;position:relative;padding-top:16px;">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;word-wrap:break-word;">
								            
						<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;word-wrap:break-word;">
                <p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">PermGen space的全称是Permanent Generation space,是指内存的永久保存区域OutOfMemoryError: PermGen space从表面上看就是内存益出，解决方法也一定是加大内存。说说为什么会内存益出：这一部分用于存放Class和Meta的信息,Class在被 Load的时候被放入PermGen space区域，它和和存放Instance的Heap区域不同,GC(Garbage Collection)不会在主程序运行期对PermGen space进行清理，所以如果你的APP会LOAD很多CLASS的话,就很可能出现PermGen space错误。这种错误常见在web服务器对JSP进行pre compile的时候。 如果你的WEB APP下都用了大量的第三方jar, 其大小 超过了jvm默认的大小(4M)那么就会产生此错误信息了。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>解决方法： 手动设置MaxPermSize大小 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>改正方法：-Xms256m -Xmx256m -XX:MaxNewSize=256m -XX:MaxPermSize=256m <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>修改TOMCAT_HOME/bin/catalina.sh <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>JAVA_OPTS=&quot;-server -XX:PermSize=64M -XX:MaxPermSize=128m <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>建议：将相同的第三方jar文件移置到tomcat/shared/lib目录下，这样可以达到减少jar 文档重复占用内存的目的。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>Sun文档是这样解释的： <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>java.lang.OutOfMemoryError: PermGen space <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>The detail message PermGen space indicates that the permanent generation is full. The permanent generation is the area of the heap where class and method objects are stored. If an application loads a very large number of classes, then the size of the permanent generation might need to be increased using the -XX:MaxPermSize option. <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>Interned java.lang.String objects are also stored in the permanent generation. The java.lang.String class maintains a pool of strings. When the intern method is invoked, the method checks the pool to see if an equal string is already in the pool. If there is, then the intern method returns it; otherwise it adds the string to the pool. In more precise terms, the java.lang.String.intern method is used to obtain the canonical representation of the string; the result is a reference to the same class instance that would be returned if that string appeared as a literal. If an application interns a huge number of strings, the permanent generation might need to be increased from its default setting. <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>When this kind of error occurs, the text String.intern or ClassLoader.defineClass might appear near the top of the stack trace that is printed. <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>The jmap -permgen command prints statistics for the objects in the permanent generation, including information about internalized String instances. See 2.6.4 Getting Information on the Permanent Generation. <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>下面是某人遇到的问题： <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>SUN JDK+Tomcat 5.5.20运行服务的时候遇到问题，服务器跑几天后就会挂掉，并报java.lang.OutOfMemoryError: PermGen space异常。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>发现很多人把问题归因于： spring,hibernate,tomcat，因为他们动态产生类,导致JVM中的permanent heap溢出 。然后解决方法众说纷纭，有人说升级 tomcat版本到最新甚至干脆不用tomcat。还有人怀疑spring的问题，在spring论坛上讨论很激烈，因为spring在AOP时使用CBLIB会动态产生很多类。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>但问题是为什么这些王牌的开源会出现同一个问题呢，那么是不是更基础的原因呢？tomcat在Q&amp;A很隐晦的回答了这一点。（Why does the memory usage increase when I redeploy a web application? Because the Classloader (and the Class objects it loaded) cannot be recycled. They are stored in the permanent heap generation by the JVM, and when you redepoy a new class loader is created, which loads another copy of all these classes. This can cause OufOfMemoryErrors eventually. ） <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>于是有人对更基础的JVM做了检查，发现了问题的关键。原来SUN 的JVM把内存分了不同的区，其中一个就是permanent区用来存放用得非常多的类和类描述。本来SUN设计的时候认为这个区域在JVM启动的时候就固定了，但他没有想到现在动态会用得这么广泛。而且这个区域有特殊的垃圾收回机制，现在的问题是动态加载类到这个区域后，gc根本没办法回收！ <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>对这个bug最彻底的解决办法就是不要用SUN的JDK，而改用BEA的 JRokit. <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>在tomcat中redeploy时出现outofmemory的错误. <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>可以有以下几个方面的原因: <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>１,使用了proxool,因为proxool内部包含了一个老版本的cglib. <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>2, log4j,最好不用,只用common-logging <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>3, 老版本的cglib,快点更新到最新版。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>４，更新到最新的hibernate3.2 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>3、 这里以tomcat环境为例，其它WEB服务器如jboss,weblogic等是同一个道理。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>二、java.lang.OutOfMemoryError: Java heap space <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>Heap size 设置 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>JVM堆的设置是指java程序运行过程中JVM可以调配使用的内存空间的设置.JVM在启动的时候会自动设置Heap size的值， <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>其初始空间(即-Xms)是物理内存的1/64，最大空间(-Xmx)是物理内存的1/4。可以利用JVM提供的-Xmn -Xms -Xmx等选项可 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>进行设置。Heap size 的大小是Young Generation 和Tenured Generaion 之和。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>提示：在JVM中如果98％的时间是用于GC且可用的Heap size 不足2％的时候将抛出此异常信息。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>提示：Heap Size 最大不要超过可用物理内存的80％，一般的要将-Xms和-Xmx选项设置为相同，而-Xmn为1/4的-Xmx值。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>解决方法：手动设置Heap size <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>修改TOMCAT_HOME/bin/catalina.sh <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>在“echo &quot;Using CATALINA_BASE:   $CATALINA_BASE&quot;”上面加入以下行： <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>JAVA_OPTS=&quot;-server -Xms800m -Xmx800m   -XX:MaxNewSize=256m&quot; <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>三、实例，以下给出1G内存环境下java jvm 的参数设置参考： <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>JAVA_OPTS=&quot;-server -Xms800m -Xmx800m  -XX:PermSize=64M -XX:MaxNewSize=256m -XX:MaxPermSize=128m -Djava.awt.headless=true &quot; <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>针对Tomcat，如果Tomcat下面有多个应用，尽可能的把lib下共用的jar文件放到Tomcat的lib下，发布速度和运行速度上也有所提升。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>题外话：经常看到网友抱怨tomcat的性能不如...，不稳定等，其实根据笔者几年的经验，从&quot;互联星空“到现在的房产门户网，我们 均使用tomcat作为WEB服务器，每天访问量百万多，tomcat仍然运行良好。建议大家有问题多从自己程序入手，多看看java的DOC文档。 <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>参考文档：http://blogs.sun.com/jonthecollector/entry/presenting_the_permanent_generation <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>文章出处：http://blog.csdn.net/xiaojianpitt/archive/2008/11/11/3276790.aspx </p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;"> </p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">转自：<a href="http://bittercoffee.iteye.com/blog/607026" rel="nofollow" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;" target="_blank">http://bittercoffee.iteye.com/blog/607026</a></p>            </div>
                <span style="display:block;height:0px;visibility:hidden;clear:both;"></span></div>
									
					
					</div>
	
</div></span></div></div></div></div>
</div>
</span>
</div></body></html> 