<html>
<head>
  <title>Redis高级应用 – 赵伊凡's Blog</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="8422"/>
<h1>Redis高级应用 – 赵伊凡's Blog</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/3/23 18:26</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://irfen.me/redis-advanced-usage/"><i>http://irfen.me/redis-advanced-usage/</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="font-family:sans-serif;line-height:1.15;text-size-adjust:100%;box-sizing:border-box;"><div style="box-sizing:inherit;color:rgb(51, 51, 51);font-size:0.9375rem;font-weight:400;line-height:1.66;background:rgb(255, 255, 255);font-family:&quot;PingFang TC&quot;, &quot;Helvetica Neue&quot;, Helvetica, STHeitiTC-Light, Arial, sans-serif;letter-spacing:0px;"><div style="box-sizing:inherit;word-wrap:break-word;letter-spacing:0px;"><div style="box-sizing:inherit;background-color:rgb(255, 255, 255);letter-spacing:0px;"><div style="box-sizing:inherit;letter-spacing:0px;"><div style="box-sizing:inherit;letter-spacing:0px;"><div style="box-sizing:inherit;letter-spacing:0px;"><span style="box-sizing:inherit;letter-spacing:0px;"><div style="box-sizing:inherit;letter-spacing:0px;">
		<div style="box-sizing:inherit;display:block;padding:1em 0px;margin-left:auto;margin-right:auto;padding-top:0px;letter-spacing:0px;">
		<div style="box-sizing:inherit;color:rgb(118, 118, 118);font-size:0.6875rem;font-weight:800;padding-bottom:0.25em;text-transform:uppercase;letter-spacing:0px;"><span style="box-sizing:inherit;letter-spacing:0px;"><span style="box-sizing:inherit;clip:rect(1px 1px 1px 1px);height:1px;overflow:hidden;width:1px;position:absolute;word-wrap:normal;letter-spacing:0px;">发布于</span><a href="http://irfen.me/redis-advanced-usage/" rel="bookmark" style="box-sizing:inherit;background-color:transparent;color:rgb(118, 118, 118);text-decoration:none;box-shadow:rgb(255, 255, 255) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;"><span style="box-sizing:inherit;letter-spacing:0px;">2018年3月19日</span></a></span><span style="box-sizing:inherit;display:inline;letter-spacing:0px;"> 由<span style="box-sizing:inherit;letter-spacing:0px;"><a href="http://irfen.me/author/irfenvip-qq-com/" style="box-sizing:inherit;background-color:transparent;color:rgb(118, 118, 118);text-decoration:none;box-shadow:rgb(255, 255, 255) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">赵 伊凡</a></span></span></div><h1 style="box-sizing:inherit;margin:0px 0px 0.75em;clear:both;line-height:1.4;padding:1.5em 0px 0px;font-weight:700;font-size:1.625rem;margin-bottom:0.25em;padding-top:0px;letter-spacing:0px;">Redis高级应用</h1>	</div>

	
	<div style="box-sizing:inherit;margin-left:auto;margin-right:auto;letter-spacing:0px;"><span style="letter-spacing:0px;display:table;table-layout:fixed;"></span>
		<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">记得应该是4年前，开始接触<span style="box-sizing:inherit;letter-spacing:0px;"><a href="http://irfen.me/tag/redis" style="box-sizing:inherit;background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;box-shadow:rgb(15, 15, 15) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;" target="_blank" title="redis">redis</a></span>，那时候刚好需要一个高性能的kv存储，经过对比和分析选择了redis作为当时的存储应用。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">具体的一些知识，大家可以参阅我<span style="box-sizing:inherit;letter-spacing:0px;"><a href="http://irfen.me/" style="box-sizing:inherit;background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;box-shadow:rgb(15, 15, 15) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;" target="_blank" title="博客">博客</a></span>的历史文章，直接搜索redis应该可以获取很多结果，当然导航部分也有redis的系列专题。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">其实这几年redis改变很多，优化了很多，所以本文和大家分享一些redis相对更进阶一些的部分内容和用法。</p>
<h1 style="box-sizing:inherit;font-size:1.5rem;margin:0px 0px 0.75em;clear:both;line-height:1.4;padding:1.5em 0px 0px;font-weight:700;letter-spacing:0px;">1、redis的数据结构</h1>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">一般都会被首先问到redis都有哪些数据结构，多数真的有看过的人，都可以答出来redis有5种常用数据结构，分别是字符串、哈希、list、set、sortedset（zset）。这是基础的回答，如果你要展现你了解的更多的话，你还应该说出，redis还支持geo、HyperLogLog以及pub/sub。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">这时候你应该知道这些数据结构的用处都有哪些，基础的字符串、哈希、set就不说了。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">这里介绍一下list、zset、geo、HyperLogLog、pub/sub。</p>
<h2 style="box-sizing:inherit;clear:both;line-height:1.4;margin:0px 0px 0.75em;padding:1.5em 0px 0px;color:rgb(102, 102, 102);font-size:1.25rem;font-weight:700;letter-spacing:0px;">1.1、list</h2>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">list就是列表存储结构，除了可以直接作为列表的存储来使用，其实list还可以作为一个队列使用，另外，list还支持阻塞的方式从一端取值，来达到阻塞队列的使用。</p>
<h2 style="box-sizing:inherit;clear:both;line-height:1.4;margin:0px 0px 0.75em;padding:1.5em 0px 0px;color:rgb(102, 102, 102);font-size:1.25rem;font-weight:700;letter-spacing:0px;">1.2、zset</h2>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">zset具有根据score来排序存储数据的作用，所以用处就很多了。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">比如可以每次更新数据，都不删除旧数据，而是把新数据存储下来，使用当前时间戳作为score的值，在取值的时候直接取最新的值作为当前值返回。这样可以在需要的时候找到这个值的历史记录。（当然可以根据实际情况，只保存zset中最新的n个值，可以通过异步线程来触发这个操作）</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">另外，zset还有个很有用的用处，就是作为排行榜使用。比如投票，以投票id作为key，被投票人id作为value，票数作为score。再每次某个被投票人获得票之后，增长某个被投票人id对应的score即可，再展现排行榜的时候，按照score大小排序获取需要展示的名词区间就可以了。</p>
<h2 style="box-sizing:inherit;clear:both;line-height:1.4;margin:0px 0px 0.75em;padding:1.5em 0px 0px;color:rgb(102, 102, 102);font-size:1.25rem;font-weight:700;letter-spacing:0px;">1.3、geo</h2>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">这个其实没有什么特别要说的，做地理位置的计算很方便。</p>
<h2 style="box-sizing:inherit;clear:both;line-height:1.4;margin:0px 0px 0.75em;padding:1.5em 0px 0px;color:rgb(102, 102, 102);font-size:1.25rem;font-weight:700;letter-spacing:0px;">1.4、HyperLogLog</h2>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">这是个神奇的数据结构。其实这个数据结构我在之前的文章也介绍过，大家有兴趣可以点击<a href="http://irfen.me/redis-hyperloglog-intro/" style="box-sizing:inherit;background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;box-shadow:rgb(15, 15, 15) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">这里</a>去详细了解一下。这个数据结构是基于基数统计的方法来实现的，可以比较准确的估算出数据的数量，但是没有办法知道里面具体的内容。它有一个很大的优点就是占用的内存量非常低，多低呢，不管里面存的什么，一个键的值都只会占用12k的内存。</p>
<h2 style="box-sizing:inherit;clear:both;line-height:1.4;margin:0px 0px 0.75em;padding:1.5em 0px 0px;color:rgb(102, 102, 102);font-size:1.25rem;font-weight:700;letter-spacing:0px;">1.5、pub/sub</h2>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">这实际上不算数据结构了，这只是redis提供的一个功能而已。我们上面提到了列表，可以用作队列来做生产消费。那如果想要生产一份数据，多个客户端消费呢，这时候就到pub/sub上场的时候了。但是它也会有一个问题，如果生产者发送了一个消息，消费者的客户端没有在线，那么就算这个客户端再上线了也不会收到以前的消息了。</p>
<h1 style="box-sizing:inherit;font-size:1.5rem;margin:0px 0px 0.75em;clear:both;line-height:1.4;padding:1.5em 0px 0px;font-weight:700;letter-spacing:0px;">2、失效时间问题</h1>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">由于redis存储使用的是内存储存，内存肯定是要比硬盘存储的成本高很多的了，所以一般我们会把redis作为缓存使用。这样就需要对数据做失效处理。有时候，我们会把一部分kv存储并做失效处理，而很有可能一些key的失效时间比较集中（一般我们都会设置一个固定的缓存失效时间），这样在失效的时候很有可能会产生瞬时的redis卡顿。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">怎么避免产生这种情况呢，最好的办法就是对失效时间做个随机数增加的处理。这样就可以避免一些数据再同一时刻失效了。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">其实这种解决问题的思路同样适用于其他应用场景上。比如我们之前有一个<span style="box-sizing:inherit;letter-spacing:0px;"><a href="http://irfen.me/tag/%e5%89%8d%e7%ab%af" style="box-sizing:inherit;background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;box-shadow:rgb(15, 15, 15) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;" target="_blank" title="前端">前端</a></span>页面，需要再指定的时刻去获取一个结果页面自动展示给用户看，这个结果页面比如1点可以获取到。那么如果前端就根据服务器返回时间计算之后就在1点准时获取的话，那么服务器就会在1点的瞬时获取大量请求，就会产生风险。其实对于这种实时性没有那么强的需求，可以做一个随机数的增加，让所有用户平均分配在一个允许的时间范围内请求就好了。</p>
<h1 style="box-sizing:inherit;font-size:1.5rem;margin:0px 0px 0.75em;clear:both;line-height:1.4;padding:1.5em 0px 0px;font-weight:700;letter-spacing:0px;">3、分布式锁</h1>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">第一部分说了那么多数据结构的问题，其实最常用的主要还是字符串类型的结构。而这其中很常用的一个场景就是分布式锁。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">先说说为什么需要分布式锁，首先锁的使用肯定是为了锁定资源，这里就不多说了。由于现在我们都是使用的分布式应用，如果只是在某一个应用中对某个资源进行加锁（本地锁，比如jdk的锁），那么只是在这个服务器上加锁生效，但是其他服务器上仍然是未加锁状态。所以我们需要使用分布式锁来处理这个问题。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">使用分布式锁有一个点一定需要注意，就是一定要设置失效时间，这样假如由于某些原因锁没有释放，不至于导致这个资源被彻底锁定无法使用。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">一般我们会使用setnx来做加锁，这个命令在key已经存在的时候，设置失败，只有在key不存在的时候才能设置成功，从而达到加锁的目的。另外失效时间通过expire命令来实现。那么问题来了，如果再setnx设置成功了之后，expire设置失败了怎么办，这样在出现没有解锁的时候这个锁就无法被释放了。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">在以前的版本的确会出现这个问题，但是在2.6.12版本之后，redis拓展了set函数的参数。可以通过set函数来同时达到nx和expire的功能。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">参数是这样的：<br style="box-sizing:inherit;letter-spacing:0px;"/>
<strong style="box-sizing:inherit;font-weight:700;letter-spacing:0px;">SET key value [EX seconds] [PX milliseconds] [NX|XX]</strong></p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">EX表示过期时间单位是秒，PX表示毫秒，NX表示不存在设置，XX表示存在才设置。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">下面举几个例子。</p>

		<div style="border-color:rgb(153, 153, 153);text-align:left;text-size-adjust:none;top:auto;height:auto;line-height:15px !important;width:100%;padding:0px;margin:0px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;font-weight:500;font-size:12px !important;box-sizing:border-box;margin-bottom:12px;margin-top:12px;background:rgb(253, 253, 253);text-shadow:none;border-style:solid;border-width:1px;direction:ltr;position:relative;overflow:hidden;letter-spacing:0px;left:auto;">
		
			
			
			<div style="box-sizing:inherit;background:0px center;border:0px;text-align:left;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;padding:0px;margin:0px;height:auto;"></div>
			<div style="overflow:hidden;background:0px center;position:relative;box-sizing:inherit;text-align:left;border:0px;width:100%;margin:0px;padding:0px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;z-index:1;">
				<table style="margin-right:0px;box-sizing:inherit;font-style:inherit;font-variant:inherit;font-weight:inherit;width:auto;font-size:12px;border-spacing:0px;background:none;border:none;margin-bottom:0px;margin:0px;margin-top:0px;border-collapse:collapse;table-layout:auto;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;padding:0px;">
					<tbody style="box-sizing:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;"><tr style="box-sizing:inherit;border-bottom:1px solid rgb(238, 238, 238);background:0px center;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;padding:0px;border:none;vertical-align:top;margin:0px;">
				<td style="border:none;padding-left:0px;box-sizing:inherit;border-bottom:1px solid rgb(170, 170, 170);font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;margin:0px;padding:0px;vertical-align:top;background:rgb(223, 239, 255);color:rgb(84, 153, 222);">
					<div style="white-space:nowrap;background:0px center;padding:0px;margin:0px;text-align:left;border:0px;font-size:12px !important;box-sizing:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;line-height:15px !important;"><div style="height:inherit;box-sizing:inherit;border:0px;background:0px center;padding:0px 5px;margin:0px;text-align:center;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;">1</div><div style="height:inherit;box-sizing:inherit;font-size:inherit;padding:0px 5px;text-align:center;margin:0px;border:0px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;line-height:inherit;font-weight:inherit;color:rgb(49, 124, 197);background:rgb(200, 225, 250);">2</div><div style="height:inherit;box-sizing:inherit;border:0px;background:0px center;padding:0px 5px;margin:0px;text-align:center;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;">3</div><div style="height:inherit;box-sizing:inherit;font-size:inherit;padding:0px 5px;text-align:center;margin:0px;border:0px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;line-height:inherit;font-weight:inherit;color:rgb(49, 124, 197);background:rgb(200, 225, 250);">4</div><div style="height:inherit;box-sizing:inherit;border:0px;background:0px center;padding:0px 5px;margin:0px;text-align:center;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;">5</div><div style="height:inherit;box-sizing:inherit;font-size:inherit;padding:0px 5px;text-align:center;margin:0px;border:0px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;line-height:inherit;font-weight:inherit;color:rgb(49, 124, 197);background:rgb(200, 225, 250);">6</div></div>
				</td>
						<td style="border:none;padding-right:0px;box-sizing:inherit;border-bottom:1px solid rgb(170, 170, 170);width:100%;background:0px center;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;margin:0px;padding:0px;vertical-align:top;"><div style="tab-size:4;background:none;padding:0px;margin:0px;text-align:left;color:rgb(0, 0, 0);white-space:pre;overflow:visible;border:none;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;box-sizing:inherit;font-size:12px !important;line-height:15px !important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;"><div style="height:inherit;box-sizing:inherit;margin:0px;text-align:left;border:0px;background:0px center;padding:0px 5px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;"><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(255, 128, 0);">#不存在才设置，有效期600s</span></div><div style="height:inherit;box-sizing:inherit;margin:0px;text-align:left;border:0px;padding:0px 5px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;background:rgb(247, 247, 247);font-size:inherit;line-height:inherit;font-weight:inherit;"><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">set </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">key </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">value </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(128, 0, 128);">EX</span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 111, 224);"> </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(206, 0, 0);">600</span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 111, 224);"> </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">NX</span></div><div style="height:inherit;box-sizing:inherit;margin:0px;text-align:left;border:0px;background:0px center;padding:0px 5px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;"><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">set </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">key </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">value </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 0, 0);">PX</span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 111, 224);"> </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(206, 0, 0);">600000</span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 111, 224);"> </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 45, 122);">NX</span></div><div style="height:inherit;box-sizing:inherit;margin:0px;text-align:left;border:0px;padding:0px 5px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;background:rgb(247, 247, 247);font-size:inherit;line-height:inherit;font-weight:inherit;"><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(255, 128, 0);">#存在才设置（覆盖），有效期600s</span></div><div style="height:inherit;box-sizing:inherit;margin:0px;text-align:left;border:0px;background:0px center;padding:0px 5px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;"><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">set </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">key </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">value </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(128, 0, 128);">EX</span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 111, 224);"> </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(206, 0, 0);">600</span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 111, 224);"> </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">XX</span></div><div style="height:inherit;box-sizing:inherit;margin:0px;text-align:left;border:0px;padding:0px 5px;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;background:rgb(247, 247, 247);font-size:inherit;line-height:inherit;font-weight:inherit;"><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">set </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">key </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 78, 208);">value </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 0, 0);">PX</span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 111, 224);"> </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(206, 0, 0);">600000</span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 111, 224);"> </span><span style="box-sizing:inherit;height:inherit;font-family:Monaco, MonacoRegular, &quot;Courier New&quot;, monospace;letter-spacing:0px;font-size:inherit;line-height:inherit;font-weight:inherit;color:rgb(0, 45, 122);">XX</span></div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>

<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">有了现在的set参数的拓展，我们就不用担心两个命令第一个成功第二个失败导致问题了。</p>
<h1 style="box-sizing:inherit;font-size:1.5rem;margin:0px 0px 0.75em;clear:both;line-height:1.4;padding:1.5em 0px 0px;font-weight:700;letter-spacing:0px;">4、其他</h1>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">另外我们还需要了解pipeline、主从同步机制、集群的相关信息。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">我们在使用redis的时候，实际上有很大一部分是网络IO的性能损耗（其实公司内网的网络IO损耗也不会很大），pipeline的作用就是把多个命令通过一次网络IO发过去执行。由于是多个命令一次发送，所以这些命令有一个要求就是不能有依赖关系。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">新上节点的同步机制其实是两段同步，第一次同步会先进行全量同步但是再同步的过程中肯定还是会有数据的变化在产生的，所以在全量同步结束之后，还需要做一次这段时间数据变化的增量同步来达到数据同步。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">集群其实有两种方式，一种是以twemproxy为代表的Sentinal模式，一种是redis3.0提供的Cluster模式，两种模式各有优劣。Sentinal在于高可用，Cluster模式在于拓展。详细的对比大家有兴趣可以详细研究一下。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">到此简单介绍了下redis的一些进阶使用，希望可以帮到大家更好的学习redis。</p>
<p style="box-sizing:inherit;margin:0px 0px 1.5em;padding:0px;letter-spacing:0px;">本文原创于<span style="box-sizing:inherit;letter-spacing:0px;"><a href="http://irfen.me/" style="box-sizing:inherit;background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;box-shadow:rgb(15, 15, 15) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;" target="_blank" title="赵伊凡BLOG">赵伊凡BLOG</a></span>，<span style="box-sizing:inherit;letter-spacing:0px;"><a href="http://irfen.me/category/%e8%bd%ac%e8%bd%bd" style="box-sizing:inherit;background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;box-shadow:rgb(15, 15, 15) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;" target="_blank" title="转载">转载</a></span>请注明出处。</p>
<p style="margin:10px 0;padding:5px 10px;box-sizing:inherit;letter-spacing:0px;background:none repeat scroll 0 0 #FFFEDF;border:1px solid #FFDF7B;line-height:24px;font-size:13px;"><strong style="box-sizing:inherit;font-weight:700;letter-spacing:0px;">©原创文章，转载请注明来源：</strong> <a href="http://irfen.me/" style="box-sizing:inherit;background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;box-shadow:rgb(15, 15, 15) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">赵伊凡's Blog</a><br style="box-sizing:inherit;letter-spacing:0px;"/><strong style="box-sizing:inherit;font-weight:700;letter-spacing:0px;">©本文链接地址:</strong> <a href="http://irfen.me/redis-advanced-usage/" style="box-sizing:inherit;background-color:transparent;color:rgb(34, 34, 34);text-decoration:none;box-shadow:rgb(15, 15, 15) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">Redis高级应用</a></p>
	<span style="letter-spacing:0px;display:table;table-layout:fixed;clear:both;"></span></div>

			<div style="box-sizing:inherit;display:table;border-bottom:1px solid rgb(238, 238, 238);border-top:1px solid rgb(238, 238, 238);margin-top:2em;padding:2em 0px;width:100%;letter-spacing:0px;"><span style="letter-spacing:0px;display:table;table-layout:fixed;"></span><span style="box-sizing:inherit;display:table-cell;vertical-align:middle;width:100%;letter-spacing:0px;"><span style="box-sizing:inherit;display:block;font-size:0.6875rem;font-weight:800;padding-left:2.5em;position:relative;text-transform:uppercase;letter-spacing:0px;"><span style="position:absolute;width:1em;box-sizing:inherit;vertical-align:middle;height:1em;fill:currentcolor;display:inline-block;overflow:hidden;top:2px;margin-right:0.5em;left:0px;color:rgb(118, 118, 118);letter-spacing:0px;"> <span style="box-sizing:inherit;letter-spacing:0px;"></span> </span><span style="box-sizing:inherit;clip:rect(1px 1px 1px 1px);height:1px;overflow:hidden;width:1px;position:absolute;word-wrap:normal;letter-spacing:0px;">分类</span><a href="http://irfen.me/category/redis%e5%ad%a6%e4%b9%a0%e4%b8%93%e9%a2%98/" rel="category tag" style="box-sizing:inherit;background-color:transparent;color:rgb(51, 51, 51);text-decoration:none;box-shadow:rgb(255, 255, 255) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">Redis学习专题</a>、<a href="http://irfen.me/category/tech/" rel="category tag" style="box-sizing:inherit;background-color:transparent;color:rgb(51, 51, 51);text-decoration:none;box-shadow:rgb(255, 255, 255) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">技术</a></span><span style="box-sizing:inherit;display:block;font-size:0.6875rem;font-weight:800;padding-left:2.5em;position:relative;text-transform:uppercase;margin-top:1em;letter-spacing:0px;"><span style="position:absolute;width:1em;box-sizing:inherit;vertical-align:middle;height:1em;fill:currentcolor;display:inline-block;overflow:hidden;top:2px;margin-right:0.5em;left:0px;color:rgb(118, 118, 118);letter-spacing:0px;"> <span style="box-sizing:inherit;letter-spacing:0px;"></span> </span><span style="box-sizing:inherit;clip:rect(1px 1px 1px 1px);height:1px;overflow:hidden;width:1px;position:absolute;word-wrap:normal;letter-spacing:0px;">标签</span><a href="http://irfen.me/tag/redis/" rel="tag" style="box-sizing:inherit;background-color:transparent;color:rgb(51, 51, 51);text-decoration:none;box-shadow:rgb(255, 255, 255) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">redis</a>、<a href="http://irfen.me/tag/%e5%b9%b6%e5%8f%91/" rel="tag" style="box-sizing:inherit;background-color:transparent;color:rgb(51, 51, 51);text-decoration:none;box-shadow:rgb(255, 255, 255) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">并发</a>、<a href="http://irfen.me/tag/%e6%80%a7%e8%83%bd/" rel="tag" style="box-sizing:inherit;background-color:transparent;color:rgb(51, 51, 51);text-decoration:none;box-shadow:rgb(255, 255, 255) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">性能</a>、<a href="http://irfen.me/tag/%e6%95%b0%e6%8d%ae%e5%ba%93/" rel="tag" style="box-sizing:inherit;background-color:transparent;color:rgb(51, 51, 51);text-decoration:none;box-shadow:rgb(255, 255, 255) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">数据库</a>、<a href="http://irfen.me/tag/%e7%bc%93%e5%ad%98/" rel="tag" style="box-sizing:inherit;background-color:transparent;color:rgb(51, 51, 51);text-decoration:none;box-shadow:rgb(255, 255, 255) 0px -1px 0px inset;transition:color 80ms ease-in, box-shadow 130ms ease-in-out, -webkit-box-shadow 130ms ease-in-out;letter-spacing:0px;">缓存</a></span></span><span style="letter-spacing:0px;display:table;table-layout:fixed;clear:both;"></span></div> 	
</div></span></div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 