<html>
<head>
  <title>POI SXSSFWorkbook 读取模板 存在公式解决</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4183"/>
<h1>POI SXSSFWorkbook 读取模板 存在公式解决</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/9/19 8:47</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://www.mamicode.com/info-detail-2285699.html"><i>http://www.mamicode.com/info-detail-2285699.html</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="font-family:Arial, Helvetica, sans-serif;background-color:rgb(255, 255, 255);font-size:12px;color:rgb(63, 63, 63);text-decoration:none;"><div style="font-family:Arial, Helvetica, sans-serif;background-color:rgb(255, 255, 255);font-size:12px;color:rgb(63, 63, 63);text-decoration:none;"><div style="font-family:Arial, Helvetica, sans-serif;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;text-align:center;"><div style="font-family:Arial, Helvetica, sans-serif;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;"><div style="font-family:Arial, Helvetica, sans-serif;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;">
                <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;margin-top:20px;margin-bottom:20px;"><ins style="font-family:Arial, Helvetica, sans-serif;padding:0px;display:block;text-align:center;height:173px;"><ins style="font-family:Arial, Helvetica, sans-serif;padding:0;display:inline-table;border:none;height:173px;margin:0;position:relative;visibility:visible;width:691px;background-color:transparent;"><ins style="font-family:Arial, Helvetica, sans-serif;padding:0;display:block;border:none;height:173px;margin:0;position:relative;visibility:visible;width:691px;background-color:transparent;"><div style="font-family:Arial, Helvetica, sans-serif;padding:0px;left:0;position:absolute;top:0;width:691px;height:173px;"></div></ins></ins></ins></div>
                <div style="font-family:Arial, Helvetica, sans-serif;text-decoration:none;padding:15px 0px;font-size:16px;color:rgb(2, 62, 154);text-align:center;border-bottom:1px dotted rgb(218, 218, 218);font-weight:bold;word-wrap:break-word;">
                    <h1 style="font-family:Arial, Helvetica, sans-serif;padding:15px 0px;color:rgb(2, 62, 154);font-size:16px;font-weight:bold;word-wrap:break-word;">POI SXSSFWorkbook 读取模板    存在公式解决</h1>
                </div>
                <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;text-align:center;margin:20px 0px;">
                    时间：<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;">2018-05-07 13:27:11</span>
                         阅读：<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;">317</span>
                         评论：<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;">0</span>
                         收藏：<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;">0</span>
                         <a style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);cursor:pointer;">[点我收藏+]</a>
                </div>
                <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;margin-top:10px;margin-bottom:10px;"><a href="https://juejin.im/welcome?utm_source=mami&amp;utm_medium=banner&amp;utm_content=huoyue&amp;utm_campaign=q3_website" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;" target="_blank"><img src="POI SXSSFWorkbook 读取模板 存在公式解决_files/690_173.png" type="image/png" data-filename="690_173.png" border="0" height="173" style="font-family:Arial, Helvetica, sans-serif;padding:0px;" width="690"/></a></div>
                <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(63, 63, 63);text-decoration:none;font-size:12px;text-align:left;margin:20px 0px;line-height:30px;word-wrap:break-word;">
                    <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;"><p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(63, 63, 63);text-decoration:none;font-size:14px;line-height:30px;max-width:680px;">标签：<a href="http://www.mamicode.com/so/1/length" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="length">length</a>   <a href="http://www.mamicode.com/so/1/rem" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="rem">rem</a>   <a href="http://www.mamicode.com/so/1/package" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="package">package</a>   <a href="http://www.mamicode.com/so/1/tac" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="tac">tac</a>   <a href="http://www.mamicode.com/so/1/catch" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="catch">catch</a>   <a href="http://www.mamicode.com/so/1/mil" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="mil">mil</a>   <a href="http://www.mamicode.com/so/1/ports" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="ports">ports</a>   <a href="http://www.mamicode.com/so/1/shm" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="shm">shm</a>   <a href="http://www.mamicode.com/so/1/mode" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="mode">mode</a>   </p><div style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(63, 63, 63);text-decoration:none;font-size:14px;line-height:30px;max-width:680px;">
<pre style="font-family:Arial, Helvetica, sans-serif;padding:5px;background-color:rgb(246, 246, 246);border:1px dotted rgb(170, 170, 170);white-space:pre-wrap;word-wrap:break-word;max-width:680px;"><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">package</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> com.baoqilai.base.service.export;

</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> java.io.File;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> java.io.FileInputStream;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> java.util.HashMap;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> java.util.Iterator;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> java.util.List;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> java.util.Map;

</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> org.apache.poi.ss.usermodel.Cell;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> org.apache.poi.ss.usermodel.CellStyle;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> org.apache.poi.ss.usermodel.DataFormat;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> org.apache.poi.ss.usermodel.Row;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> org.apache.poi.ss.usermodel.Sheet;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> org.apache.poi.xssf.streaming.SXSSFSheet;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> org.apache.poi.xssf.streaming.SXSSFWorkbook;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> org.apache.poi.xssf.usermodel.XSSFWorkbook;

</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> com.baoqilai.ddg.util.ExcelUtil;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> com.baoqilai.scp.exception.BaseException;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> com.baoqilai.scp.service.export.ExcelExportService;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">import</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> com.baoqilai.scp.service.export.ExcelExportStragy;
</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">/**</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">
 * 模板导出
 * </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#808080;">@author</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;"> lly
 *
 </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">*/</span>
<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">public</span> <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">class</span> TemplateExportServiceImpl <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">implements</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> ExcelExportService {

    </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">/**</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">
     * 模板地址
     </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">*/</span>
    <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">protected</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> String tempAddress;
    </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">/**</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">
     * 模板结果集
     </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">*/</span>
    <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">protected</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> String[] result;
    
    
    </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">public</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> TemplateExportServiceImpl(String tempAddress, String[] result) {
        </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">super</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">();
        </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">this</span>.tempAddress =<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> tempAddress;
        </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">this</span>.result =<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> result;
    }


    @Override
    </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">public</span> SXSSFWorkbook export(List&lt;Map&lt;String, Object&gt;&gt; data) <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">throws</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> BaseException {
        </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">long</span> stime =<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> System.currentTimeMillis();
        </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">try</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> {
            File fi </span>= <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">new</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> File(tempAddress);
            FileInputStream is </span>= <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">new</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> FileInputStream(fi);
            XSSFWorkbook wb </span>= <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">new</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> XSSFWorkbook(is);
            </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">//</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">获取模板中最后一行，用于判断是否存在公式</span>
            <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">int</span> lastRowNum = wb.getSheetAt(0<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">).getLastRowNum();
            Sheet sheet0 </span>= wb.getSheetAt(0<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">);
            Row baseRow0</span>=sheet0.getRow(2<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">);
            lastRowNum </span>= wb.getSheetAt(0<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">).getLastRowNum();

            Map</span>&lt;Integer, String&gt; gsMap=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">new</span> HashMap&lt;&gt;<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">();
            
            </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">for</span> (Iterator&lt;Cell&gt; it =<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> baseRow0.cellIterator(); it.hasNext();) {
                Cell baseCell </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> it.next();
                </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">if</span> (baseCell.getCellType() ==<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> Cell.CELL_TYPE_FORMULA) {
                    String cellFormula </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> baseCell.getCellFormula();
                    gsMap.put(baseCell.getColumnIndex(), cellFormula);
                }
            }
            sheet0.removeRow(baseRow0); </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">//</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">取到公式后进行删除</span>
<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">            
            SXSSFWorkbook workbook </span>= <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">new</span> SXSSFWorkbook(wb, 500<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">);
            Sheet sheet </span>= workbook.getSheetAt(0<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">);
            
            CellStyle contextstyle </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> workbook.createCellStyle();
            DataFormat df </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> workbook.createDataFormat();
            contextstyle.setDataFormat(df.getFormat(</span>&quot;#,##0.00&quot;<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">));

            </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">final</span> <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">int</span> startRow =<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> lastRowNum;
            </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">for</span> (<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">int</span> i = startRow; i &lt; data.size() + startRow; i++<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">) {
                </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">int</span> rowNum = i -<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> startRow;
                Row row </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> sheet.getRow(i);
                </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">if</span> (row == <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">null</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">) {
                    row </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> sheet.createRow(i);
                }
                Map</span>&lt;String, Object&gt; dataMap =<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> data.get(rowNum);

                String[] columNames </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> result;
                dataMap.put(</span>&quot;serialNum&quot;, rowNum + 1<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">);

                </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">for</span> (<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">int</span> j = 0; j &lt; columNames.length; j++<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">) {
                    Cell cell </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> row.getCell(j);
                    </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">if</span> (cell == <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">null</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">) {
                        cell </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> row.createCell(j);
                    }
                    System.out.println(cell.getColumnIndex());
                    Object val </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> dataMap.get(columNames[j]);
                    ExcelUtil.setCellValue(cell, val, contextstyle);
                    </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">if</span>(gsMap.get(cell.getColumnIndex())!=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">null</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">){
                        String cellFormula </span>=<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">gsMap.get(cell.getColumnIndex());
                        String s </span>= cellFormula.replaceAll(&quot;(\\w)\\d&quot;, &quot;$1&quot; + (i + 1<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">));
                        cell.setCellFormula(s);
                        cell.setCellType(Cell.CELL_TYPE_FORMULA);
                    }
                }
                dataMap.clear();
                </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">//</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;"> 清空内存中缓存的行数</span>
                <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">if</span> (i % 500 == 0<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">) {
                    ((SXSSFSheet) sheet).flushRows();
                }
            }
            </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">//</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;"> 数据清理</span>
<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">            data.clear();
            data </span>= <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">null</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">;
            workbook.setForceFormulaRecalculation(</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">true</span>);<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">//</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#008000;">计算公式</span>
            <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">long</span> etime =<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> System.currentTimeMillis();
            System.out.println(</span>&quot;处理写入模板数据用时：&quot; + (etime - stime) / 1000<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">);
            </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">return</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> workbook;
        } </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">catch</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> (Exception e) {
            e.printStackTrace();
        }
        </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">return</span> <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">null</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">;
    }


    @Override
    </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">public</span> SXSSFWorkbook exportByStragegy(List&lt;Map&lt;String, Object&gt;&gt;<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> data, ExcelExportStragy stragegy)
            </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">throws</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> BaseException {
        </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">long</span> stime =<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> System.currentTimeMillis();
        
        </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">long</span> etime =<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;"> System.currentTimeMillis();
        System.out.println(</span>&quot;处理写入模板数据用时：&quot; + (etime - stime) / 1000<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">);
        </span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">return</span> <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#0000ff;">null</span><span style="font-family:Arial, Helvetica, sans-serif;padding:0px;max-width:680px;color:#000000;">;
    }

    

}</span></pre>
</div>
<p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(63, 63, 63);text-decoration:none;font-size:14px;line-height:30px;max-width:680px;"> </p><p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(63, 63, 63);text-decoration:none;font-size:14px;line-height:30px;max-width:680px;"><a href="http://www.mamicode.com/info-detail-2285699.html" style="font-family:Arial, Helvetica, sans-serif;padding:0px;text-decoration:none;color:#ffffff;max-width:680px;" target="_blank" title="POI SXSSFWorkbook 读取模板 存在公式解决,mamicode.com">POI SXSSFWorkbook 读取模板    存在公式解决</a></p><p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(63, 63, 63);text-decoration:none;font-size:14px;line-height:30px;max-width:680px;">标签：<a href="http://www.mamicode.com/so/1/length" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="length">length</a>   <a href="http://www.mamicode.com/so/1/rem" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="rem">rem</a>   <a href="http://www.mamicode.com/so/1/package" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="package">package</a>   <a href="http://www.mamicode.com/so/1/tac" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="tac">tac</a>   <a href="http://www.mamicode.com/so/1/catch" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="catch">catch</a>   <a href="http://www.mamicode.com/so/1/mil" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="mil">mil</a>   <a href="http://www.mamicode.com/so/1/ports" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="ports">ports</a>   <a href="http://www.mamicode.com/so/1/shm" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="shm">shm</a>   <a href="http://www.mamicode.com/so/1/mode" style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(51, 51, 51);text-decoration:none;max-width:680px;" title="mode">mode</a>   </p><p style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(63, 63, 63);text-decoration:none;font-size:14px;line-height:30px;max-width:680px;">原文地址：https://www.cnblogs.com/lanliying/p/9001786.html</p></span>
                </div>
                <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;">
                    <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;">
                        <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;overflow:auto;text-align:center;padding-right:2px;">
                            <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;width:60px;margin-left:20px;float:right;cursor:pointer;">
                                <div style="font-family:Arial, Helvetica, sans-serif;text-decoration:none;padding:10px 0px 6px;font-size:22px;color:rgb(16, 101, 231);font-weight:bold;width:60px;border:1px solid rgb(225, 225, 225);">
                                    踩</div>
                                <div style="font-family:Arial, Helvetica, sans-serif;font-size:12px;text-decoration:none;padding:5px 0px;color:rgb(16, 101, 231);font-weight:bold;width:60px;border-left:1px solid rgb(225, 225, 225);border-bottom:1px solid rgb(225, 225, 225);border-right:1px solid rgb(225, 225, 225);">
                                    (<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;">0</span>)</div>
                            </div>
                            <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;width:60px;float:right;cursor:pointer;">
                                <div style="font-family:Arial, Helvetica, sans-serif;text-decoration:none;padding:10px 0px 6px;font-size:22px;color:rgb(218, 70, 49);font-weight:bold;width:60px;border:1px solid rgb(225, 225, 225);">
                                    赞</div>
                                <div style="font-family:Arial, Helvetica, sans-serif;font-size:12px;text-decoration:none;padding:5px 0px;color:rgb(218, 70, 49);font-weight:bold;width:60px;border-left:1px solid rgb(225, 225, 225);border-bottom:1px solid rgb(225, 225, 225);border-right:1px solid rgb(225, 225, 225);">
                                    (<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;">0</span>)</div>
                            </div>
                        </div>
                        <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;text-align:right;margin-top:10px;">
                            <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;width:100%;padding-left:10px;padding-right:10px;">
                                <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-weight:bold;color:rgb(218, 70, 49);"></span>  <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-weight:bold;color:rgb(16, 101, 231);"></span>  <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-weight:bold;color:rgb(218, 70, 49);">
                                </span>
                            </div>
                        </div>
                    </div>
                    <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;text-align:right;margin-top:10px;">
                        <span style="font-family:Arial, Helvetica, sans-serif;padding:4px 8px;color:red;font-size:14px;font-weight:bold;border:1px solid rgb(225, 225, 225);cursor:pointer;">举报</span>
                    </div>
                    <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;margin-top:20px;">    <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;float:left;">                        <ins style="font-family:Arial, Helvetica, sans-serif;padding:0px;display:inline-block;width:336px;height:280px;"><ins style="font-family:Arial, Helvetica, sans-serif;padding:0;display:inline-table;border:none;height:280px;margin:0;position:relative;visibility:visible;width:336px;background-color:transparent;"><ins style="font-family:Arial, Helvetica, sans-serif;padding:0;display:block;border:none;height:280px;margin:0;position:relative;visibility:visible;width:336px;background-color:transparent;"><div style="font-family:Arial, Helvetica, sans-serif;padding:0px;left:0;position:absolute;top:0;width:336px;height:280px;"></div></ins></ins></ins>            </div>    <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;float:right;">                        <ins style="font-family:Arial, Helvetica, sans-serif;padding:0px;display:inline-block;width:336px;height:280px;"><ins style="font-family:Arial, Helvetica, sans-serif;padding:0;display:inline-table;border:none;height:280px;margin:0;position:relative;visibility:visible;width:336px;background-color:transparent;"><ins style="font-family:Arial, Helvetica, sans-serif;padding:0;display:block;border:none;height:280px;margin:0;position:relative;visibility:visible;width:336px;background-color:transparent;"><div style="font-family:Arial, Helvetica, sans-serif;padding:0px;left:0;position:absolute;top:0;width:336px;height:280px;"></div></ins></ins></ins>            </div>    <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;clear:both;">    </div></div>
                    <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;text-align:left;margin-top:20px;">
                        <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;height:33px;border-bottom:1px solid rgb(225, 225, 225);">
                            <span style="border-left:1px solid rgb(225, 225, 225);font-family:Arial, Helvetica, sans-serif;float:left;text-align:center;display:block;padding:5px 20px 4px;border-top:1px solid rgb(225, 225, 225);border-right:1px solid rgb(225, 225, 225);font-size:18px;font-weight:bold;color:rgb(93, 93, 93);">评论</span> <span style="font-family:Arial, Helvetica, sans-serif;padding:10px 0px 2px 5px;float:left;text-align:center;display:block;">一句话评论（<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-weight:bold;color:rgb(218, 70, 49);">0</span>）</span>
                        </div>
                        <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;padding-top:20px;">
                            
                            <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;text-align:center;margin-top:20px;">
                                <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;">共<span style="font-family:Arial, Helvetica, sans-serif;padding:0px;color:rgb(218, 70, 49);font-weight:bold;">0</span>条  </span>
                            </div>
                        </div>
                        <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;margin-top:20px;">
                            <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;">
                            <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;text-align:left;padding-top:20px;">
                                <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;background-color:rgb(249, 249, 249);">
                                </div>
                                <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;">
                                    
                                </div>
                            </div>
                            <div style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-size:12px;color:rgb(63, 63, 63);text-decoration:none;text-align:right;padding-top:10px;">
                                <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;font-weight:bold;color:rgb(218, 70, 49);">登录后才能评论！</span>
                                <span style="font-family:Arial, Helvetica, sans-serif;padding:0px;"></span>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div></div></div></div></div></div><br/></div></span>
</div></body></html> 