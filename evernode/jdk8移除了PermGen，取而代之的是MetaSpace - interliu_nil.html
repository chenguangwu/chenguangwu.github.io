<html>
<head>
  <title>jdk8移除了PermGen，取而代之的是MetaSpace - interliu_nil的博客 - CSDN博客</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3112"/>
<h1>jdk8移除了PermGen，取而代之的是MetaSpace - interliu_nil的博客 - CSDN博客</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/11/26 16:23</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://blog.csdn.net/interliu_nil/article/details/53033743?utm_source=blogxgwz8"><i>https://blog.csdn.net/interliu_nil/article/details/53033743?utm_source=blogxgwz8</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;"><div style="outline:0px;box-sizing:border-box;"><div style="box-sizing:inherit;outline:0px;font-family:&quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:1.57143;background-color:rgb(245, 246, 247);color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><div style="outline:0px;box-sizing:border-box;"><span style="box-sizing:inherit;outline:0px;"><div style="box-sizing:inherit;outline:0px;background:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.05) 0px 2px 4px 0px;">
	<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;border-bottom:1px solid rgb(224, 224, 224);padding-top:16px;z-index:9;background-color:rgb(255, 255, 255);">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;margin-bottom:8px;">
				<span style="color:rgb(134, 202, 94);padding:0px;margin:0px;outline:0px;box-sizing:inherit;margin-right:8px;text-align:center;border-radius:50%;width:26px;height:26px;font-size:12px;line-height:26px;display:inline-block;border:1px solid rgb(231, 244, 223);margin-top:4px;float:left;">转</span>				<h1 style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:24px;word-wrap:break-word;">jdk8移除了PermGen，取而代之的是MetaSpace</h1>
			</div>
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;padding-bottom:14px;position:relative;">
				<div style="color:rgb(133, 133, 133);width:88%;height:24px;box-sizing:inherit;outline:0px;padding:0px;margin:0px;overflow:hidden;">
																				<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;">2016年11月04日 13:12:12</span>
					<a href="https://me.csdn.net/interliu_nil" style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;text-decoration:none;cursor:pointer;color:rgb(120, 165, 241);margin-right:14px;" target="_blank">interliulao</a>
						<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;">阅读数：197</span><span style="right:101px;margin-right:0px;color:rgb(51, 153, 234);letter-spacing:0px;line-height:20px;cursor:pointer;background-color:rgb(255, 255, 255);top:0px;font-size:12px;width:45px;display:inline-block;box-sizing:inherit;outline:0px;margin:0px;padding:0px;position:static;">更多</span>
						
																					<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:12px;margin-top:6px;margin-bottom:0px;">
								<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;color:rgb(77, 77, 77);">个人分类：</span>
																<a href="https://blog.csdn.net/interliu_nil/article/category/6503543" style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;text-decoration:none;cursor:pointer;display:inline-block;margin-right:24px;color:rgb(121, 165, 229);word-wrap:break-word;" target="_blank">java内存																</a>
							</div>
																								</div>
				<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;position:absolute;top:0px;right:0px;">
														</div>
			</div>
		</div>
	</div>
	<div style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;display:block;position:relative;padding-top:16px;">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;word-wrap:break-word;">
								            
						<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;word-wrap:break-word;">
                
<div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-wrap:break-word;">
<div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-wrap:break-word;font-family:'microsoft yahei';">
<h1 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:28px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:36px;"><a name="t0" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a>
<a name="t0" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>jdk8移除了PermGen，取而代之的是MetaSpace</h1>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t1" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t1" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>元空间（Metaspace）：</h2>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">一种新的内存空间的诞生。JDK8 HotSpot JVM 使用本地内存来存储类元数据信息并称之为：元空间（Metaspace）；这与<a href="http://lib.csdn.net/base/oracle" rel="nofollow" style="word-wrap:break-word;color:rgb(223,52,52);outline:0px;box-sizing:border-box;text-decoration:none;margin:0px;padding:0px;cursor:pointer;font-weight:bold;" target="_blank" title="Oracle知识库">Oracle</a> JRockit
 和IBM JVM’s很相似。这将是一个好消息：意味着不会再有<a href="http://lib.csdn.net/base/javaee" rel="nofollow" style="word-wrap:break-word;color:rgb(223,52,52);outline:0px;box-sizing:border-box;text-decoration:none;margin:0px;padding:0px;cursor:pointer;font-weight:bold;" target="_blank" title="Java EE知识库">Java</a>.lang.OutOfMemoryError: PermGen问题，也不再需要你进行调优及监控内存空间的使用，但是新特性不能消除类和类加载器导致的内存泄漏。你需要使用不同的方法以及遵守新的命名约定来追踪这些问题。</p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t2" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t2" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>PermGen 空间的状况</h2>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">这部分内存空间将全部移除。</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">JVM的参数：PermSize 和 MaxPermSize 会被忽略并给出警告（如果在启用时设置了这两个参数）。</p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t3" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a>
<a name="t3" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>Metaspace 内存分配模型</h2>
<h3 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:22px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:30px;"><a name="t4" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a>
<a name="t4" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>（最大区别）大部分类元数据都在本地内存中分配。</h3>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">用于描述类元数据的“klasses”已经被移除。</p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t5" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t5" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>Metaspace 容量</h2>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">默认情况下，类元数据只受可用的本地内存限制（容量取决于是32位或是64位<a href="http://lib.csdn.net/base/operatingsystem" rel="nofollow" style="word-wrap:break-word;color:rgb(223,52,52);outline:0px;box-sizing:border-box;text-decoration:none;margin:0px;padding:0px;cursor:pointer;font-weight:bold;" target="_blank" title="操作系统知识库">操作系统</a>的可用虚拟内存大小）。</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">新参数（MaxMetaspaceSize）用于限制本地内存分配给类元数据的大小。如果没有指定这个参数，元空间会在运行时根据需要动态调整。</p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t6" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t6" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>Metaspace 垃圾回收</h2>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">对于僵死的类及类加载器的垃圾回收将在元数据使用达到“MaxMetaspaceSize”参数的设定值时进行。</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">适时地监控和调整元空间对于减小垃圾回收频率和减少延时是很有必要的。持续的元空间垃圾回收说明，可能存在类、类加载器导致的内存泄漏或是大小设置不合适。</p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t7" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t7" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>Java 堆内存的影响</h2>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">一些杂项数据已经移到Java堆空间中。升级到JDK8之后，会发现Java堆 空间有所增长。</p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t8" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t8" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>Metaspace 监控</h2>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">元空间的使用情况可以从HotSpot1.8的详细GC日志输出中得到。</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">Jstat 和 JVisualVM两个工具，在我们使用b75版本进行测试时，已经更新了，但是还是能看到老的PermGen空间的出现。</p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t9" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t9" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>参数设置</h2>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">默认情况下，元空间的大小仅受本地内存限制，但可以通过以下参数来指定元空间的大小：</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">-XX:MetaspaceSize，初始空间大小，达到该值就会触发垃圾收集进行类型卸载，同时GC会对该值进行调整：如果释放了大量的空间，就适当降低该值；如果释放了很少的空间，那么在不超过MaxMetaspaceSize时，适当提高该值。</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">-XX:MaxMetaspaceSize，最大空间，默认是没有限制的。</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">除了上面两个指定大小的选项以外，还有两个与 GC 相关的属性： <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>
-XX:MinMetaspaceFreeRatio，在GC之后，最小的Metaspace剩余空间容量的百分比，减少为分配空间所导致的垃圾收集</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">-XX:MaxMetaspaceFreeRatio，在GC之后，最大的Metaspace剩余空间容量的百分比，减少为释放空间所导致的垃圾收集</p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t10" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t10" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>更新原因</h2>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">　　1、字符串存在永久代中，容易出现性能问题和内存溢出。</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">　　2、类及方法的信息等比较难确定其大小，因此对于永久代的大小指定比较困难，太小容易出现永久代溢出，太大则容易导致老年代溢出。</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">　　3、永久代会为 GC 带来不必要的复杂度，并且回收效率偏低。</p>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">　　4、Oracle 可能会将HotSpot 与 JRockit 合二为一。</p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t11" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t11" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>补充</h2>
<p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;overflow-x:auto;word-wrap:break-word;">jvm内存区域详解参考如下： <br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/><a href="http://www.cnblogs.com/dolphin0520/p/3613043.html" rel="nofollow" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;box-sizing:border-box;text-decoration:none;margin:0px;padding:0px;cursor:pointer;" target="_blank">http://www.cnblogs.com/dolphin0520/p/3613043.html</a></p>
<h2 style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 16px;font-size:24px;color:rgb(79, 79, 79);word-wrap:break-word;font-weight:100;line-height:32px;"><a name="t12" style="outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-wrap:break-word;"></a><a name="t12" style="word-wrap:break-word;color:rgb(51,102,153);outline:0px;margin:0px;padding:0px;cursor:pointer;box-sizing:border-box;text-decoration:none;" target="_blank"></a>get these!</h2>
</div>
</div>
            </div>
                <span style="display:block;height:0px;visibility:hidden;clear:both;"> </span></div>
									
					
					</div>
	
</div></span></div></div></div></div>
</div>
</span>
</div></body></html> 