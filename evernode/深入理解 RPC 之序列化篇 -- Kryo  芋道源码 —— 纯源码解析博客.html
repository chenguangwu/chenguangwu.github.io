<html>
<head>
  <title>深入理解 RPC 之序列化篇 -- Kryo | 芋道源码 —— 纯源码解析博客</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="10004"/>
<h1>深入理解 RPC 之序列化篇 -- Kryo | 芋道源码 —— 纯源码解析博客</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/5/28 18:40</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//"><i>http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;position: relative;"><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline;"><div style="font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;vertical-align:baseline;background:rgb(221, 221, 221);outline:0px;line-height:1.5;font-family:微软雅黑;font-weight:inherit;font-style:inherit;color:rgb(129, 124, 124);"><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline;overflow:hidden;"><div style="font-size:100%;background:rgb(250, 250, 250);font-weight:inherit;font-style:inherit;font-family:inherit;outline:0px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.8;transition:margin 0.5s ease-out;"><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;"><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;margin:0px;padding:0px;zoom:1;border-bottom:1px solid rgb(219, 219, 219);"><span style="display:table;"></span><h1 style="font-family:inherit;font-size:170%;padding:0.2em 3%;outline:0px;font-style:inherit;vertical-align:baseline;border:0px;font-weight:inherit;margin:0px;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.5;-webkit-font-smoothing:antialiased;word-wrap:break-word;word-break:normal;border-left:5px solid rgb(46, 104, 170);"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="深入理解 RPC 之序列化篇 -- Kryo">深入理解 RPC 之序列化篇 -- Kryo</a></h1><p style="font-style:inherit;float:right;margin:0px;padding:0.3em 4% 0.3em 0px;border:0px;outline:0px;font-weight:inherit;border-bottom:1px solid rgb(219, 219, 219);font-family:inherit;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;text-align:right;"></p><p style="outline:0px;float:right;padding-top:0.5em;font-size:0.8em;margin:0px;padding:0px;border:0px;margin-right:1em;font-weight:inherit;font-style:inherit;font-family:inherit;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;text-align:center;"><span style="font-size:130%;font-weight:inherit;font-style:inherit;font-family:inherit;text-align:center;-webkit-font-smoothing:antialiased;"></span>总阅读量:<span style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">3</span>次</p><span style="display:table;clear:both;"></span></div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;padding:1.5em 4%;"><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">摘要: 原创出处 <a href="https://www.cnkirito.moe/rpc-serialize-1/" rel="external nofollow noopener noreferrer" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" target="_blank">https://www.cnkirito.moe/rpc-serialize-1/</a> 「老徐」欢迎转载，保留摘要，谢谢！</p><ul style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;border:0px;outline:0px;font-weight:inherit;margin:0px;font-family:inherit;vertical-align:baseline;list-style:none;padding:0px;font-size:105%;padding-left:2em;"><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style:disc;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);">序列化概述</a></li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style:disc;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);">JDK序列化</a></li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style:disc;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);">Kryo入门</a></li></ul><hr style="-webkit-margin-before:0px;-webkit-margin-after:0px;margin:0px;padding:0px;border:1px solid rgb(219, 219, 219);"/><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;"><img src="深入理解 RPC 之序列化篇 -- Kryo  芋道源码 —— 纯源码解析博客_files/Image.jpg" type="image/jpeg" data-filename="Image.jpg" height="366" style="font-family:inherit;padding-top:0.5em;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;margin:auto;font-size:100%;vertical-align:middle;-webkit-margin-before:0px;-webkit-margin-after:0px;max-width:100%;display:block;height:auto;" width="875"/></p><blockquote style="font-size:110%;margin:0.65em 0px 0.65em 4%;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;padding:0px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;border-left:0.2em solid rgb(46, 104, 170);padding-left:1%;line-height:1.5;"><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">关注<strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">微信公众号：【芋道源码】</strong>有福利：</p><ol style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;border:0px;outline:0px;font-weight:inherit;margin:0px;font-family:inherit;vertical-align:baseline;list-style:none;padding:0px;font-size:105%;padding-left:2em;"><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">RocketMQ / MyCAT / Sharding-JDBC <strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">所有</strong>源码分析文章列表</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">RocketMQ / MyCAT / Sharding-JDBC <strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">中文注释源码 GitHub 地址</strong></li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">您对于源码的疑问每条留言<strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">都</strong>将得到<strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">认真</strong>回复。<strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">甚至不知道如何读源码也可以请教噢</strong>。</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;"><strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">新的</strong>源码解析文章<strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">实时</strong>收到通知。<strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">每周更新一篇左右</strong>。</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;"><strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">认真的</strong>源码交流微信群。</li></ol></blockquote><hr style="-webkit-margin-before:0px;-webkit-margin-after:0px;margin:0px;padding:0px;border:1px solid rgb(219, 219, 219);"/><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">一年前，笔者刚刚接触RPC框架，从单体式应用向分布式应用的变革无疑是让人兴奋的，同时也对RPC背后到底做了哪些工作产生了兴趣，但其底层的设计对新手而言并不是很友好，其涉及的一些常用技术点都有一定的门槛。如传输层常常使用的netty，之前完全没听过，想要学习它，需要掌握前置知识点nio；协议层，包括了很多自定义的协议，而每个RPC框架的实现都有差异；代理层的动态代理技术，如jdk动态代理，虽然实战经验不多，但至少还算会用，而cglib则又有一个盲区；序列化层倒还算是众多层次中相对简单的一环，但RPC为了追求可扩展性，性能等诸多因素，通常会支持多种序列化方式以供使用者插拔使用，一些常用的序列化方案hessian，kryo，Protobuf又得熟知…</p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">这个系列打算就RPC框架涉及到的一些知识点进行探讨，本篇先从序列化层的一种选择–kryo开始进行介绍。</p><h2 style="font-size:180%;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;padding:0.3em 0px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.2em;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#序列化概述" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="序列化概述"></a>序列化概述</h2><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">大白话介绍下RPC中序列化的概念，可以简单理解为对象–&gt;字节的过程，同理，反序列化则是相反的过程。为什么需要序列化？因为网络传输只认字节。所以互信的过程依赖于序列化。有人会问，FastJson转换成字符串算不算序列化？对象持久化到数据库算不算序列化？没必要较真，广义上理解即可。</p><h2 style="font-size:180%;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;padding:0.3em 0px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.2em;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#JDK序列化" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="JDK序列化"></a>JDK序列化</h2><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">可能你没用过kryo，没用过hessian，但你一定用过jdk序列化。我最早接触jdk序列化，是在大二的JAVA大作业中，《XX管理系统》需要把对象保存到文件中（那时还没学数据库），jdk原生支持的序列化方式用起来也很方便。</p><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">class Student implements Serializable{</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">   private String name;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">}</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">class Main{</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">   public static void main(String[] args) throws Exception{</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">      // create a Student</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">      Student st = new Student(&quot;kirito&quot;);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">     // serialize the st to student.db file</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">     ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;student.db&quot;));</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">     oos.writeObject(st);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">     oos.close();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">     // deserialize the object from student.db</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">     ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;student.db&quot;));</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">     Student kirito = (Student) ois.readObject();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">     ois.close();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    // assert</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    assert &quot;kirito&quot;.equals(kirito.getName());</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">   }</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">}</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">Student实体类需要实现Serializable接口，以告知其可被序列化。</p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">序列化协议的选择通常有下列一些常用的指标：</p><ol style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;border:0px;outline:0px;font-weight:inherit;margin:0px;font-family:inherit;vertical-align:baseline;list-style:none;padding:0px;font-size:105%;padding-left:2em;"><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">通用性。是否只能用于java间序列化/反序列化，是否跨语言，跨平台。</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">性能。分为空间开销和时间开销。序列化后的数据一般用于存储或网络传输，其大小是很重要的一个参数；解析的时间也影响了序列化协议的选择，如今的系统都在追求极致的性能。</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">可扩展性。系统升级不可避免，某一实体的属性变更，会不会导致反序列化异常，也应该纳入序列化协议的考量范围。</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">易用性。API使用是否复杂，会影响开发效率。</li></ol><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">容易用的模型通常性能不好，性能好的模型通常用起来都比较麻烦。显然，JDK序列化属于前者。我们不过多介绍它，直接引入今天的主角kryo作为它的替代品。</p><h2 style="font-size:180%;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;padding:0.3em 0px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.2em;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#Kryo入门" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="Kryo入门"></a>Kryo入门</h2><h3 style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0.3em 0px;font-size:140%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#引入依赖" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="引入依赖"></a>引入依赖</h3><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">&lt;dependency&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    &lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    &lt;artifactId&gt;kryo&lt;/artifactId&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    &lt;version&gt;4.0.1&lt;/version&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">&lt;/dependency&gt;</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">由于其底层依赖于ASM技术，与Spring等框架可能会发生ASM依赖的版本冲突（文档中表示这个冲突还挺容易出现）所以提供了另外一个依赖以供解决此问题</p><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">&lt;dependency&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    &lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    &lt;artifactId&gt;kryo-shaded&lt;/artifactId&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    &lt;version&gt;4.0.1&lt;/version&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">&lt;/dependency&gt;</div></pre></td></tr></tbody></table></div><h3 style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0.3em 0px;font-size:140%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#快速入门" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="快速入门"></a>快速入门</h3><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">class Student implements Serializable{</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">   private String name;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">}</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">public class Main {</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    public static void main(String[] args) throws Exception{</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        Kryo kryo = new Kryo();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        Output output = new Output(new FileOutputStream(&quot;student.db&quot;));</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        Student kirito = new Student(&quot;kirito&quot;);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        kryo.writeObject(output, kirito);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        output.close();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        Input input = new Input(new FileInputStream(&quot;student.db&quot;));</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        Student kiritoBak = kryo.readObject(input, Student.class);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        input.close();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        assert &quot;kirito&quot;.equals(kiritoBak.getName());</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    }</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">}</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">不需要注释也能理解它的执行流程，和jdk序列化差距并不是很大。</p><h3 style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0.3em 0px;font-size:140%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#三种读写方式" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="三种读写方式"></a>三种读写方式</h3><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">Kryo共支持三种读写方式</p><ol style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;border:0px;outline:0px;font-weight:inherit;margin:0px;font-family:inherit;vertical-align:baseline;list-style:none;padding:0px;font-size:105%;padding-left:2em;"><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">如果知道class字节码，并且对象不为空</li></ol><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">kryo.writeObject(output, someObject);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">// ...</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">SomeClass someObject = kryo.readObject(input, SomeClass.class);</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">快速入门中的序列化/反序列化的方式便是这一种。而Kryo考虑到someObject可能为null，也会导致返回的结果为null，所以提供了第二套读写方式。</p><ol style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;border:0px;outline:0px;font-weight:inherit;margin:0px;font-family:inherit;vertical-align:baseline;list-style:none;padding:0px;font-size:105%;padding-left:2em;"><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">如果知道class字节码，并且对象可能为空</li></ol><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">kryo.writeObjectOrNull(output, someObject);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">// ...</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">SomeClass someObject = kryo.readObjectOrNull(input, SomeClass.class);</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">但这两种方法似乎都不能满足我们的需求，在RPC调用中，序列化和反序列化分布在不同的端点，对象的类型确定，我们不想依赖于手动指定参数，最好是…emmmmm…将字节码的信息直接存放到序列化结果中，在反序列化时自行读取字节码信息。Kryo考虑到了这一点，于是提供了第三种方式。</p><ol style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;border:0px;outline:0px;font-weight:inherit;margin:0px;font-family:inherit;vertical-align:baseline;list-style:none;padding:0px;font-size:105%;padding-left:2em;"><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style-type:decimal;">如果实现类的字节码未知，并且对象可能为null</li></ol><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">kryo.writeClassAndObject(output, object);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">// ...</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">Object object = kryo.readClassAndObject(input);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">if (object instanceof SomeClass) {</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">   // ...</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">}</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">我们牺牲了一些空间一些性能去存放字节码信息，但这种方式是我们在RPC中应当使用的方式。</p><h3 style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0.3em 0px;font-size:140%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#我们关心的问题" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="我们关心的问题"></a>我们关心的问题</h3><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">继续介绍Kryo特性之前，不妨让我们先思考一下，一个序列化工具或者一个序列化协议，应当需要考虑哪些问题。比如，支持哪些类型的序列化？循环引用会不会出现问题？在某个类增删字段之后反序列化会报错吗？等等等等….</p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">带着我们考虑到的这些疑惑，以及我们暂时没考虑到的，但Kryo帮我们考虑到的，来看看Kryo到底支持哪些特性。</p><h3 style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0.3em 0px;font-size:140%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#支持的序列化类型" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="支持的序列化类型"></a>支持的序列化类型</h3><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-after:0px;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;width:100%;"><thead style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><th style="border:0px;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:middle;padding:0px;text-align:left;-webkit-margin-after:0px;-webkit-margin-before:0px;font-weight:700;border-bottom:3px solid rgb(219, 219, 219);padding-bottom:0.5em;">boolean</th><th style="border:0px;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:middle;padding:0px;text-align:left;-webkit-margin-after:0px;-webkit-margin-before:0px;font-weight:700;border-bottom:3px solid rgb(219, 219, 219);padding-bottom:0.5em;">Boolean</th><th style="border:0px;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:middle;padding:0px;text-align:left;-webkit-margin-after:0px;-webkit-margin-before:0px;font-weight:700;border-bottom:3px solid rgb(219, 219, 219);padding-bottom:0.5em;">byte</th><th style="border:0px;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:middle;padding:0px;text-align:left;-webkit-margin-after:0px;-webkit-margin-before:0px;font-weight:700;border-bottom:3px solid rgb(219, 219, 219);padding-bottom:0.5em;">Byte</th><th style="border:0px;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:middle;padding:0px;text-align:left;-webkit-margin-after:0px;-webkit-margin-before:0px;font-weight:700;border-bottom:3px solid rgb(219, 219, 219);padding-bottom:0.5em;">char</th></tr></thead><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Character</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">short</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Short</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">int</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Integer</td></tr><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">long</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Long</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">float</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Float</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">double</td></tr><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Double</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">byte[]</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">String</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">BigInteger</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">BigDecimal</td></tr><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Collection</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Date</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Collections.emptyList</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Collections.singleton</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Map</td></tr><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">StringBuilder</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">TreeMap</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Collections.emptyMap</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Collections.emptySet</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">KryoSerializable</td></tr><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">StringBuffer</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Class</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Collections.singletonList</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Collections.singletonMap</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Currency</td></tr><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Calendar</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">TimeZone</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">Enum</td><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;border:0px;text-align:left;font-weight:400;-webkit-margin-before:0px;padding:10px 0px;border-bottom:1px solid rgb(219, 219, 219);">EnumSet</td></tr></tbody></table><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">表格中支持的类型一览无余，这都是其默认支持的。</p><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">Kryo kryo = new Kryo();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">kryo.addDefaultSerializer(SomeClass.class, SomeSerializer.class);</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">这样的方式，也可以为一个Kryo实例扩展序列化器。</p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">总体而言，Kryo支持以下的类型：</p><ul style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;border:0px;outline:0px;font-weight:inherit;margin:0px;font-family:inherit;vertical-align:baseline;list-style:none;padding:0px;font-size:105%;padding-left:2em;"><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style:disc;">枚举</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style:disc;">集合、数组</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style:disc;">子类/多态</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style:disc;">循环引用</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style:disc;">内部类</li><li style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;list-style:disc;">泛型</li></ul><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">但需要注意的是，<strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">Kryo不支持Bean中增删字段</strong>。如果使用Kryo序列化了一个类，存入了Redis，对类进行了修改，会导致反序列化的异常。</p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">另外需要注意的一点是使用反射创建的一些类序列化的支持。如使用Arrays.asList();创建的List对象，会引起序列化异常。</p><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">Exception in thread &quot;main&quot; com.esotericsoftware.kryo.KryoException: Class cannot be created (missing no-arg constructor): java.util.Arrays$ArrayList</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">但new ArrayList()创建的List对象则不会，使用时需要注意，可以使用第三方库对Kryo进行序列化类型的扩展。如<a href="https://github.com/magro/kryo-serializers%E6%89%80%E6%8F%90%E4%BE%9B%E7%9A%84%E3%80%82" rel="external nofollow noopener noreferrer" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" target="_blank">https://github.com/magro/kryo-serializers所提供的。</a></p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;"><strong style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;font-weight:700;">不支持包含无参构造器类的反序列化</strong>，尝试反序列化一个不包含无参构造器的类将会得到以下的异常：</p><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">Exception in thread &quot;main&quot; com.esotericsoftware.kryo.KryoException: Class cannot be created (missing no-arg constructor): moe.cnkirito.Xxx</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">保证每个类具有无参构造器是应当遵守的编程规范，但实际开发中一些第三库的相关类不包含无参构造，的确是有点麻烦。</p><h3 style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0.3em 0px;font-size:140%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#线程安全" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="线程安全"></a>线程安全</h3><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">Kryo是线程不安全的，意味着每当需要序列化和反序列化时都需要实例化一次，或者借助ThreadLocal来维护以保证其线程安全。</p><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">private static final ThreadLocal&lt;Kryo&gt; kryos = new ThreadLocal&lt;Kryo&gt;() {</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">	protected Kryo initialValue() {</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">		Kryo kryo = new Kryo();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">		// configure kryo instance, customize settings</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">		return kryo;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">	};</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">};</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"></div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">// Somewhere else, use Kryo</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">Kryo k = kryos.get();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">...</div></pre></td></tr></tbody></table></div><h3 style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0.3em 0px;font-size:140%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#Kryo相关配置参数详解" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="Kryo相关配置参数详解"></a>Kryo相关配置参数详解</h3><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">每个Kryo实例都可以拥有两个配置参数，这值得被拉出来单独聊一聊。</p><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">kryo.setRegistrationRequired(false);//关闭注册行为</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">kryo.setReferences(true);//支持循环引用</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">Kryo支持对注册行为，如<code style="font-size:90%;margin:0px 2px;border:1px solid rgb(214, 214, 214);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;padding:0px 5px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(238, 238, 238);color:rgb(116, 112, 112);white-space:nowrap;text-shadow:rgb(255, 255, 255) 0px 1px;">kryo.register(SomeClazz.class);</code>,这会赋予该Class一个从0开始的编号，但Kryo使用注册行为最大的问题在于，其不保证同一个Class每一次注册的号码想用，这与注册的顺序有关，也就意味着在不同的机器、同一个机器重启前后都有可能拥有不同的编号，这会导致序列化产生问题，所以在分布式项目中，一般关闭注册行为。</p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">第二个注意点在于循环引用，Kryo为了追求高性能，可以关闭循环引用的支持。不过我并不认为关闭它是一件好的选择，大多数情况下，请保持<code style="font-size:90%;margin:0px 2px;border:1px solid rgb(214, 214, 214);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;padding:0px 5px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(238, 238, 238);color:rgb(116, 112, 112);white-space:nowrap;text-shadow:rgb(255, 255, 255) 0px 1px;">kryo.setReferences(true)</code>。</p><h3 style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0.3em 0px;font-size:140%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#常用Kryo工具类" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="常用Kryo工具类"></a>常用Kryo工具类</h3><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);margin:0.5em 0px;padding:1em 2%;overflow:auto;color:rgb(197, 200, 198);line-height:1.5;font-size:100%;"><table style="font-family:inherit;font-size:100%;font-style:inherit;font-variant:inherit;-webkit-margin-after:0px;padding:0px;outline:0px;font-weight:inherit;vertical-align:middle;-webkit-margin-before:0px;border:0px;border-spacing:0px;border-collapse:collapse;margin:0px;width:auto;"><tbody style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><tr style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"><td style="vertical-align:middle;margin:0px;outline:0px;font-style:inherit;font-family:inherit;font-size:100%;-webkit-margin-after:0px;-webkit-margin-before:0px;text-align:left;font-weight:400;border-bottom:1px solid rgb(219, 219, 219);border:0px;padding:0px;"><pre style="font-size:100%;line-height:1.5;color:rgb(197, 200, 198);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;overflow:auto;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(29, 31, 33);padding:0px;border:0px;margin:0px;"><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">public class KryoSerializer {</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    public byte[] serialize(Object obj) {</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        Kryo kryo = kryoLocal.get();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        Output output = new Output(byteArrayOutputStream);//&lt;1&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        kryo.writeClassAndObject(output, obj);//&lt;2&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        output.close();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        return byteArrayOutputStream.toByteArray();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    }</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"></div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    public &lt;T&gt; T deserialize(byte[] bytes) {</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        Kryo kryo = kryoLocal.get();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes);</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        Input input = new Input(byteArrayInputStream);// &lt;1&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        input.close();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        return (T) kryo.readClassAndObject(input);//&lt;2&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    }</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"></div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    private static final ThreadLocal&lt;Kryo&gt; kryoLocal = new ThreadLocal&lt;Kryo&gt;() {//&lt;3&gt;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        @Override</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        protected Kryo initialValue() {</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">            Kryo kryo = new Kryo();</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">            kryo.setReferences(true);//默认值为true,强调作用</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">            kryo.setRegistrationRequired(false);//默认值为false,强调作用</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">            return kryo;</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">        }</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">    };</div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;"></div><div style="font-style:inherit;-webkit-margin-after:0px;-webkit-margin-before:0px;outline:0px;font-weight:inherit;padding:0px;font-family:inherit;font-size:100%;vertical-align:baseline;border:0px;margin:0px;">}</div></pre></td></tr></tbody></table></div><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;"><code style="font-size:90%;margin:0px 2px;border:1px solid rgb(214, 214, 214);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;padding:0px 5px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(238, 238, 238);color:rgb(116, 112, 112);white-space:nowrap;text-shadow:rgb(255, 255, 255) 0px 1px;">&lt;1&gt;</code> Kryo的Input和Output接收一个InputStream和OutputStream，Kryo通常完成字节数组和对象的转换，所以常用的输入输出流实现为ByteArrayInputStream/ByteArrayOutputStream。</p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;"><code style="font-size:90%;margin:0px 2px;border:1px solid rgb(214, 214, 214);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;padding:0px 5px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(238, 238, 238);color:rgb(116, 112, 112);white-space:nowrap;text-shadow:rgb(255, 255, 255) 0px 1px;">&lt;2&gt;</code> writeClassAndObject和readClassAndObject配对使用在分布式场景下是最常见的，序列化时将字节码存入序列化结果中，便可以在反序列化时不必要传入字节码信息。</p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;"><code style="font-size:90%;margin:0px 2px;border:1px solid rgb(214, 214, 214);outline:0px;font-weight:inherit;font-style:inherit;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;padding:0px 5px;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;background:rgb(238, 238, 238);color:rgb(116, 112, 112);white-space:nowrap;text-shadow:rgb(255, 255, 255) 0px 1px;">&lt;3&gt;</code> 使用ThreadLocal维护Kryo实例，这样减少了每次使用都实例化一次Kryo的开销又可以保证其线程安全。</p><h3 style="font-family:inherit;margin:0.5em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0.3em 0px;font-size:140%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#参考文章" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="参考文章"></a>参考文章</h3><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;"><a href="https://github.com/EsotericSoftware/kryo" rel="external nofollow noopener noreferrer" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" target="_blank">https://github.com/EsotericSoftware/kryo</a></p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;"><a href="http://www.cnblogs.com/hntyzgn/p/7122709.html" rel="external nofollow noopener noreferrer" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" target="_blank">Kryo 使用指南</a></p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;"><a href="https://kb.cnblogs.com/page/515982/" rel="external nofollow noopener noreferrer" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" target="_blank">序列化与反序列化</a></p><hr style="-webkit-margin-before:0px;-webkit-margin-after:0px;margin:0px;padding:0px;border:1px solid rgb(219, 219, 219);"/><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">更多的序列化方案，和RPC其他层次中会涉及到的技术，在后续的文章中进行逐步介绍。</p><h1 style="font-family:inherit;margin:0.5em 0px;outline:0px;font-style:inherit;vertical-align:baseline;border:0px;font-weight:inherit;padding:0.3em 0px;-webkit-margin-before:0px;-webkit-margin-after:0px;font-size:180%;line-height:1.2em;color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#666-彩蛋" style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-after:0px;-webkit-margin-before:0px;text-decoration:none;color:rgb(44, 166, 203);" title="666. 彩蛋"></a>666. 彩蛋</h1><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;">如果你对 RPC 并发感兴趣，欢迎加入我的知识一起交流。</p><p style="font-family:inherit;margin:0.7em 0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:105%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;line-height:1.7;"><img src="深入理解 RPC 之序列化篇 -- Kryo  芋道源码 —— 纯源码解析博客_files/Image.png" type="image/png" data-filename="Image.png" height="492" style="font-family:inherit;padding-top:0.5em;padding:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;margin:auto;font-size:100%;vertical-align:middle;-webkit-margin-before:0px;-webkit-margin-after:0px;max-width:100%;display:block;height:auto;" width="875"/></p></div><div style="-webkit-margin-before:0px;-webkit-margin-after:0px;margin-top:3em;margin-bottom:3em;zoom:1;background:rgb(250, 250, 250);padding:0px 4%;margin:0px;border-top:1px solid rgb(219, 219, 219);"><span style="display:table;"></span><div style="font-style:inherit;width:100%;padding:0px;border:0px;outline:0px;font-weight:inherit;margin:0px;font-family:inherit;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;float:right;"><div style="font-family:inherit;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;padding:0px;font-size:100%;vertical-align:baseline;-webkit-margin-before:0px;-webkit-margin-after:0px;zoom:1;"><span style="font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;display:table;"></span><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#textlogo" style="color:rgb(44, 166, 203);margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline;padding:0px;-webkit-margin-before:0px;-webkit-margin-after:0px;text-decoration:none;float:right;height:3em;position:relative;width:3em;display:block;" title="Top"><span style="font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;color:rgb(44, 166, 203);-webkit-font-smoothing:antialiased;width:1.5em;height:1.5em;position:absolute;margin-top:-0.75em;margin-left:-0.75em;top:50%;left:50%;text-align:center;"></span></a><a href="https://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.iocoder.cn%2FRPC%2Flaoxu%2Frpc-serialize-1%2F" style="color:rgb(44, 166, 203);margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline;padding:0px;-webkit-margin-before:0px;-webkit-margin-after:0px;text-decoration:none;float:right;height:3em;position:relative;width:3em;display:block;" target="_blank" title="Facebook"><span style="font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;color:rgb(44, 166, 203);-webkit-font-smoothing:antialiased;width:1.5em;height:1.5em;position:absolute;margin-top:-0.75em;margin-left:-0.75em;top:50%;left:50%;text-align:center;"></span></a><a href="http://www.iocoder.cn/RPC/laoxu/rpc-serialize-1//#qrcode" style="color:rgb(44, 166, 203);margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline;padding:0px;-webkit-margin-before:0px;-webkit-margin-after:0px;text-decoration:none;float:right;height:3em;position:relative;width:3em;display:block;" title="QRcode"><span style="font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;color:rgb(44, 166, 203);-webkit-font-smoothing:antialiased;width:1.5em;height:1.5em;position:absolute;margin-top:-0.75em;margin-left:-0.75em;top:50%;left:50%;text-align:center;"></span></a><a href="https://twitter.com/intent/tweet?url=http%3A%2F%2Fwww.iocoder.cn%2FRPC%2Flaoxu%2Frpc-serialize-1%2F" style="color:rgb(44, 166, 203);margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline;padding:0px;-webkit-margin-before:0px;-webkit-margin-after:0px;text-decoration:none;float:right;height:3em;position:relative;width:3em;display:block;" target="_blank" title="Twitter"><span style="font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;color:rgb(44, 166, 203);-webkit-font-smoothing:antialiased;width:1.5em;height:1.5em;position:absolute;margin-top:-0.75em;margin-left:-0.75em;top:50%;left:50%;text-align:center;"></span></a><a href="http://service.weibo.com/share/share.php?title=%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20RPC%20%E4%B9%8B%E5%BA%8F%E5%88%97%E5%8C%96%E7%AF%87%20--%20Kryo%20|%20%E8%8A%8B%E9%81%93%E6%BA%90%E7%A0%81%20%E2%80%94%E2%80%94%20%E7%BA%AF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E5%8D%9A%E5%AE%A2&amp;url=http%3A%2F%2Fwww.iocoder.cn%2FRPC%2Flaoxu%2Frpc-serialize-1%2F&amp;ralateUid=null&amp;searchPic=true&amp;style=number" style="color:rgb(44, 166, 203);margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;vertical-align:baseline;padding:0px;-webkit-margin-before:0px;-webkit-margin-after:0px;text-decoration:none;float:right;height:3em;position:relative;width:3em;display:block;" target="_blank" title="Weibo"><span style="font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;color:rgb(44, 166, 203);-webkit-font-smoothing:antialiased;width:1.5em;height:1.5em;position:absolute;margin-top:-0.75em;margin-left:-0.75em;top:50%;left:50%;text-align:center;"></span></a><span style="vertical-align:baseline;margin:0px;border:0px;outline:0px;font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;padding:0px;-webkit-margin-before:0px;-webkit-margin-after:0px;float:right;height:3em;position:relative;margin-right:0.5em;color:rgb(214, 214, 214);width:1em;" title="Share to"><span style="font-weight:inherit;font-style:inherit;font-family:inherit;font-size:1em;color:rgb(214, 214, 214);-webkit-font-smoothing:antialiased;width:1.5em;height:1.5em;position:absolute;margin-top:-0.75em;margin-left:-0.75em;top:50%;left:50%;"></span></span><span style="font-weight:inherit;font-style:inherit;font-family:inherit;font-size:100%;display:table;clear:both;"></span></div></div><span style="display:table;clear:both;"></span></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 