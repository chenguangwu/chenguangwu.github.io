<html>
<head>
  <title>Protobuf有没有比JSON快5倍？用代码来击破pb性能神话</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="7148"/>
<h1>Protobuf有没有比JSON快5倍？用代码来击破pb性能神话</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/3/31 15:29</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://mp.weixin.qq.com/s/W9jC0W_b7xSWjqfFv7N5Bg"><i>http://mp.weixin.qq.com/s/W9jC0W_b7xSWjqfFv7N5Bg</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="text-size-adjust:100%;line-height:1.6;"><div style="background-color:rgb(255, 255, 255);font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;line-height:inherit;"><div><div style="background-color:rgb(255, 255, 255);font-size:16px;word-wrap:break-word;"><div><div style="background-color:rgb(255, 255, 255);"><span style="position:absolute;left:0px;width:100%;height:1px;border-top:1px solid rgb(229, 229, 229);transform-origin:0px 0px 0px;transform:scaleY(0.5);top:auto;bottom:-2px;"> </span>
                    <h2 style="margin:0px;padding:0px;font-weight:400;font-size:24px;margin-bottom:14px;line-height:1.4;padding-bottom:10px;border-bottom:1px solid rgb(231, 231, 235);">
                        Protobuf有没有比JSON快5倍？用代码来击破pb性能神话 
                    </h2>
                    <div style="margin:0px;padding:0px;margin-bottom:18px;line-height:20px;font-size:0px;position:relative;z-index:1;">
                                                <span style="font-size:15px;margin:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;padding:1px 0.5em;border:1px solid rgb(158, 158, 158);color:rgb(140, 140, 140);border-radius:20% 50%;line-height:1.1;max-width:none;">原创</span>
                        						                        <em style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;color:rgb(140, 140, 140);max-width:none;font-style:normal;">2017-03-31</em>

                                                <em style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;color:rgb(140, 140, 140);max-width:none;font-style:normal;">陶文</em>
                                                <a href="http://mp.weixin.qq.com/s/W9jC0W_b7xSWjqfFv7N5Bg##" style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;max-width:none;display:inline-block;">高可用架构</a>
                        

                        
                    </div>
                    
                    
                    
                    
                                                            
                                                            
                    
                    <div style="margin:0px;padding:0px;overflow:hidden;color:rgb(62, 62, 62);min-height:350px;position:relative;">
                        
                       
                        

                        
                        
                        <p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(136, 136, 136);">导读：Google 的 Protocol Buffers 在数据编码的效率上似乎被神化了，一直流传性能是 JSON 等本文格式 5 倍以上，本文通过代码测试来比较 JSON 与 PB 具体的性能差别到底是多少。作者陶文，转载请注明来自高可用架构「ArchNotes」</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><blockquote style="padding:0px;margin:0px;padding-left:10px;border-left:3px solid rgb(219, 219, 219);max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640.webp" type="image/webp" data-filename="640.webp" height="107" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;float:left;width:auto !important;visibility:visible !important;" width="109"/><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;">陶文，技术极简主义者。认为好的技术是应该是对开发者友好的。一直致力于用技术改进研发效率和开发者体验。jsoniter [4] 作者，jsoniter 就来自于要不要用 Thrift 替代 JSON 的思考。我认为通过引入 IDL 和高效率的编解码库，可以让 HTTP + JSON 这样对开发者体验有好处的技术长久地生存下去。</span></p></blockquote><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">拿 JSON 衬托 Protobuf 的文章真的太多了，经常可以看到文章中写道：“快来用 Protobuf 吧，JSON 太慢啦”。但是 Protobuf 真的有那么牛么？我想从 JSON 切换到 Protobuf 怎么也得快一倍吧，要不然对不起付出的切换成本？</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">然而，DSL-JSON 居然声称在 Java 语言里， JSON 可以和那些二进制的编解码格式性能不相上下 [1]！</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">这太让人惊讶了！虽然你可能会说，咱们能不用苹果和梨来做比较了么，两个东西根本用途完全不一样，用 Protobuf 是冲着跨语言无歧义的 IDL 的去的，才不仅仅是因为性能！这个我同意，但是仍然有那么多人盲目相信 Protobuf 一定会快很多，因此我觉得还是有必要通过本文彻底终结一下这个关于速度的传说。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">DSL-JSON 的博客里只给了他们的测试结论，但是没有给出任何原因，以及优化的细节。这很难让人信服数据是真实的。你要说 JSON 比二进制格式更快，真的是很<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">反直觉</strong>的事情。稍微琢磨一下这个问题，就可以列出好几个 Protobuf 应该更快的理由：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">更容容易绑定值到对象的字段上。JSON 的字段是用字符串指定的，相比之下字符串比对应该比基于数字的字段 tag 更耗时。</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">JSON 是文本的格式，整数和浮点数应该更占空间而且更费时。</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 在正文前有一个大小或者长度的标记，而 JSON 必须全文扫描无法跳过不需要的字段。</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">但是仅凭这几点是不是就可以盖棺定论了呢？未必，也有相反的观点：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">如果字段大部分是字符串，<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">占到决定性因素的因素可能是字符串拷贝的速度，而不是解析的速度</strong>。在这个评测 [2] 中，我们看到不少库的性能是非常接近的。这是因为测试数据中大部分是由字符串构成的。</p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">影响解析速度的决定性因素是分支的数量</strong>。因为分支的存在，解析仍然是一个本质上串行的过程。虽然 Protobuf 里没有 [] 或者 {}，但是仍然有类似的分支代码的存在。如果没有这些分支的存在，解析不过就是一个 memcpy 的操作而已。只有 Parabix 这样的技术才有革命性的意义，而 Protobuf 相比 JSON 只是改良而非革命。</p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">也许 Protobuf 是一个理论上更快的格式，但是实现它的库并不一定就更快。这取决于优化做得好不好，如果有不必要的内存分配或者重复读取，实际的速度未必就快。</p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">有多个 benchmark 都把 DSL-JSON 列到前三名里，有时甚至比其他的二进制编码更快。经过我仔细分析，<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">原因出在了这些 benchmark 对于测试数据的构成选择上</strong>。因为构造测试数据很麻烦，所以一般评测只会对相同的测试数据，去测不同的库的实现。这样就使得结果是严重倾向于某种类型输入的。比如 <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:#607fa6;">[3]</span> 选择的测试数据的结构是这样的</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [1].webp" type="image/webp" data-filename="640.webp" height="941" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">无论怎么去构造 small/medium/large 的输入，benchmark 仍然是存在特定倾向性的。而且这种倾向性是不明确的。比如 medium 的输入，到底说明了什么？medium 对于不同的人来说，可能意味着完全不同的东西。所以，在这里我想改变一下游戏的规则。不去选择一个所谓的最现实的配比，而是构造一些</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">极端的情况</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">。这样，我们可以一目了然的知道，JSON 的强项和弱点都是什么。通过把这些缺陷放大出来，我们也就可以对最坏的情况有一个清晰的预期。具体在你的场景下性能差距是怎样的一个区间内，也可以大概预估出来。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">好了，废话不多说了。JMH 撸起来。benchmark 的对象有以下几个：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Jackson：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/FasterXML/jackson-databind</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;"> </a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Java 程序里用的最多的 JSON 解析器。benchmark 中开启了 AfterBurner 的加速特性。</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">DSL-JSON：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/ngs-doo/dsl-json</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;"> </a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">世界上最快的 Java JSON 实现</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Jsoniter： </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">http://jsoniter.com/index.cn.html</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:11pt;">  </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">我抄袭 DSL-JSON 写的实现。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">特别申明：我是 Jsoniter 的作者。这里提到的所有关于Jsoniter 的评测数据都不应该被盲目相信</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">。大部分的性能优化技巧是从 DSL-JSON 中直接抄来的。</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Fastjson：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/alibaba/fastjson</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 在中国很流行的 JSON 解析器</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/google/protobuf</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;"> </a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">在 RPC （远程方法调用）里非常流行的二进制编解码格式</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Thrift：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://thrift.apache.org</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;"> </a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">另外一个很流行的 RPC 编解码格式。这里 benchmark 的是 TCompactProtocol</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Decode Integer</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">先从一个简单的场景入手。毫无疑问，Protobuf 非常擅长于处理整数</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [2].webp" type="image/webp" data-filename="640.webp" height="106" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_int</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;max-width:100%;box-sizing:border-box;word-wrap:break-word;word-break:break-all;border:1px solid rgb(221, 221, 221);border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">8.20</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">22124.431</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">6.6</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">27232.761</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">6.45</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">28131.009</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:rgb(204, 204, 204);border-left-color:rgb(204, 204, 204);word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">4.48</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">40472.032</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">86555.965</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">181357.349</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">从结果上看，似乎优势非常明显。但是因为只有 1 个整数字段，所以可能整数解析的成本没有占到大头。所以，我们把测试调整对象调整为 10 个整数字段。再比比看</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [3].webp" type="image/webp" data-filename="640.webp" height="362" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_10_int_fields</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;max-width:100%;box-sizing:border-box;word-wrap:break-word;word-break:break-all;border:1px solid rgb(221, 221, 221);border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">8.51</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">71067.990</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.98</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">202921.616</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.22</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">187654.012</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.43</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">422839.151</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.4</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">432494.654</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">604894.752</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">这下优势就非常明显了。毫无疑问，</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 解析整数的速度是非常快的，能够达到 Jackson 的 8 倍</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">DSL-JSON 比 Jackson 快很多，它的优化代码在这里</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></a></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/ngs-doo/dsl-json/blob/master/library/src/main/java/com/dslplatform/json/NumberConverter.java</a></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [4].webp" type="image/webp" data-filename="640.webp" height="454" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">整数是直接从输入的字节里计算出来的，公式是 value = (value &lt;&lt; 3) + (value &lt;&lt; 1) + ind; 相比读出字符串，然后调用 Integer.valueOf ，这个实现只遍历了一遍输入，同时也避免了内存分配。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Jsoniter</a> 在这个基础上做了循环展开</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [5].webp" type="image/webp" data-filename="640.webp" height="459" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Encode Integer</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">编码方面情况如何呢？和编码一样的测试数据，测试结果如下：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.9</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">121027.285</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.17</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2128221.323</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.02</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">173912.732</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.18</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">161038.645</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.81</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">431348.853</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">351430.048</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">不知道为啥，Thrift 的序列化特别慢。而且别的 benchmark 里 Thrift 的序列化都是算慢的。我猜测应该是实现里有不够优化的地方吧，格式应该没问题。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">整数编码方面，Protobuf 是 Jackson 的 3 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">但是和 DSL-JSON 比起来，好像没有快很多。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">这是因为 DSL-JSON 使用了自己的优化方式，和 JDK 的官方实现不一样</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/ngs-doo/dsl-json/blob/master/library/src/main/java/com/dslplatform/json/NumberConverter.java</a></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [6].webp" type="image/webp" data-filename="640.webp" height="1077" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">这段代码的意思是比较令人费解的。不知道哪里就做了数字到字符串的转换了。过程是这样的，假设输入了19823，会被分解为 19 和 823 两部分。然后有一个 `DIGITS` 的查找表，根据这个表把 19 翻译为 &quot;19&quot;，把 823 翻译为 &quot;823&quot;。其中 &quot;823&quot; 并不是三个byte分开来存的，而是把 bit 放到了一个integer里，然后在 writeBuf 的时候通过位移把对应的三个byte解开的<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [7].webp" type="image/webp" data-filename="640.webp" height="175" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">这个实现比 JDK 自带的 Integer.toString 更快。因为查找表预先计算好了，节省了运行时的计算成本。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Decode Double</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">解析 JSON 的 Double 就更慢了。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [8].webp" type="image/webp" data-filename="640.webp" height="309" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_10_double_fields</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:initial;border-left-color:rgb(204, 204, 204);word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:initial;border-left-color:rgb(204, 204, 204);word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:rgb(204, 204, 204);border-left-color:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">13.75</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">92447.958</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">7.30</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">174052.307</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">4.2</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">302453.323</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter (base64)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.25</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">390812.895</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.53</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">502287.602</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.2</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1055454.855</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1271311.735</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 解析 double 是 Jackson 的 13 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">毫无疑问，JSON 真的不适合存浮点数。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">DSL-Json 中对 Double 也是做了特别优化的 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/ngs-doo/dsl-json/blob/master/library/src/main/java/com/dslplatform/json/NumberConverter.java</a></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [9].webp" type="image/webp" data-filename="640.webp" height="787" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">浮点数被去掉了点，存成了 long 类型，然后再除以对应的 10 的倍数。如果输入是 3.1415，则会变成 31415/10000。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Encode Double</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">把 double 编码为文本格式就更困难了。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">12.71</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">143346.157</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.87</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2093533.015</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter (6 digits)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">6.5</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">280252.226</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter (base64)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">6.68</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">272843.205</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.23</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1483965.621</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.06</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1722392.219</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1822478.053</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">解码 double 的时候，Protobuf 是 Jackson 的 13 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">如果你愿意牺牲精度的话，</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 可以选择只保留 6 位小数。在这个取舍下，可以好一些，但是 Protobuf 仍然是 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 的两倍。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">保留 6 位小数的代码是这样写的。把 double 的处理变成了长整数的处理。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [10].webp" type="image/webp" data-filename="640.webp" height="651" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">到目前来看，我们可以说 JSON 不是为数字设计的。如果你使用的是 Jackson，切换到 Protobuf 的话可以把数字的处理速度提高 10 倍。然而 DSL-Json 做的优化可以把这个性能差距大幅缩小，解码在 3x ~ 4x 之间，编码在 1.3x ~ 2x 之间（前提是牺牲 double 的编码精度）。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">因为 JSON 处理 double 非常慢。所以 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 提供了一种把 double 的 IEEE 754 的二进制表示（64个bit）用 base64 编码之后保存的方案。如果希望提高速度，但是又要保持精度，可以使用 </span>Base64FloatSupport.enableEncodersAndDecoders();</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [11].webp" type="image/webp" data-filename="640.webp" height="620" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">对于 0.123456789 就变成了 &quot;OWNfmt03P78&quot;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Decode Object</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">我们已经看到了 JSON 在处理数字方面的笨拙丑态了。在处理对象绑定方面，是不是也一样不堪？前面的 benchmark 结果那么差和按字段做绑定是不是有关系？毕竟我们有 10 个字段要处理那。这就来看看在处理字段方面的效率问题。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">为了让比较起来公平一些，我们使用很短的 ascii 编码的字符串作为字段的值。这样字符串拷贝的成本大家都差不到哪里去。所以性能上要有差距，必然是和按字段绑定值有关系。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [12].webp" type="image/webp" data-filename="640.webp" height="110" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_1_string_field</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.52</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">68666.658</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.74</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">63139.324</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">5.78</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">29887.361</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">5.32</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">32458.030</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.71</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">101107.721</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">172747.146</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">如果只有一个字段，Protobuf 是 Jackson 的 2.5 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">但是比 DSL-JSON 要慢。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">我们再把同样的实验重复几次，分别对应 5 个字段，10个字段的情况。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [13].webp" type="image/webp" data-filename="640.webp" height="200" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_5_string_fields</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.3</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">276972.857</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.44</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">250016.572</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.5</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">143807.401</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.41</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">149261.728</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.39</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">259296.397</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">359868.351</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">在有 5 个字段的情况下，Protobuf 仅仅是 Jackson 的 1.3x 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">如果你认为 JSON 对象绑定很慢，而且会决定 JSON 解析的整体性能。对不起，你错了。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [14].webp" type="image/webp" data-filename="640.webp" height="310" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_10_string_fields</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;max-width:100%;box-sizing:border-box;word-wrap:break-word;word-break:break-all;border:1px solid rgb(221, 221, 221);border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.22</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">462167.920</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.12</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">503725.605</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.04</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">277531.128</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.84</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">307569.103</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.18</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">477492.445</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">564942.726</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">把字段数量加到了 10 个之后，Protobuf 仅仅是 Jackson 的 1.22 倍了。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">看到这里，你应该懂了吧。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 在处理字段绑定的时候，用的是 switch case：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [15].webp" type="image/webp" data-filename="640.webp" height="954" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">这个实现比 Hashmap 来说，仅仅是稍微略快而已。DSL-JSON 的实现是先 hash，然后也是类似的分发的方式：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [16].webp" type="image/webp" data-filename="640.webp" height="739" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">使用的 hash 算法是 FNV-1a。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [17].webp" type="image/webp" data-filename="640.webp" height="196" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">是 hash 就会碰撞，所以用起来需要小心。如果输入很有可能包含未知的字段，则需要放弃速度选择匹配之后再查一下字段是不是严格相等的。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;">Jsoniter</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 有一个解码模式 </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">DYNAMIC_MODE_AND_MATCH_FIELD_STRICTLY，它可以产生下面这样的严格匹配的代码：<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [18].webp" type="image/webp" data-filename="640.webp" height="743" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">即便是严格匹配，速度上也是有保证的。DSL-JSON 也有选项，可以在 hash 匹配之后额外加一次字符串 equals 检查。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;max-width:100%;box-sizing:border-box;word-wrap:break-word;word-break:break-all;border:1px solid rgb(221, 221, 221);border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter (hash mode)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.13</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">274949.346</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter (strict mode)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.95</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">300524.989</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON (hash mode)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.91</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">305812.208</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON (strict mode)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:rgb(204, 204, 204);border-left-color:rgb(204, 204, 204);word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.71</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:rgb(204, 204, 204);border-left-color:rgb(204, 204, 204);word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">343203.344</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:rgb(204, 204, 204);border-left-color:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:rgb(204, 204, 204);border-left-color:rgb(204, 204, 204);word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:rgb(204, 204, 204);border-left-color:rgb(204, 204, 204);word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">585421.314</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">关于对象绑定来说，只要字段名不长，基于数字的 tag 分发并不会比 JSON 具有明显优势，即便是相比最慢的 Jackson 来说也是如此。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Encode Object</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">废话不多说了，直接比较一下三种字段数量情况下，编码的速度</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:11pt;">只有 1 个字段</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:11pt;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.22</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">57502.775</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.86</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">137094.627</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.06</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">57081.756</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.46</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">47890.664</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.92</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">127421.715</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">117604.479</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">有 5 个字段 </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.68</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">127933.179</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.46</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">467818.566</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.54</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">84702.001</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.68</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">80211.517</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.98</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">219373.346</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">214802.686</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">有 10 个字段</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.72</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">194371.476</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.38</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">888230.783</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.59</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">129305.086</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.56</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">130379.967</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.06</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">315267.365</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">334297.953</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">对象编码方面，Protobuf 是 Jackson 的 1.7 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">但是速度其实比 DSL-Json 还要慢。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">优化对象编码的方式是，一次性尽可能多的把控制类的字节写出去。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [19].webp" type="image/webp" data-filename="640.webp" height="477" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">可以看到我们把 &quot;field1&quot;: 作为一个整体写出去了。如果我们知道字段是非空的，则可以进一步的把字符串的双引号也一起合并写出去。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [20].webp" type="image/webp" data-filename="640.webp" height="393" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;white-space:normal;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">从对象的编解码的 benchmark 结果可以看出，Protobuf 在这个方面仅仅比 Jackson 略微强一些，而比 DSL-Json 要慢。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Decode Integer List</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 对于整数列表有特别的支持，可以打包存储</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [21].webp" type="image/webp" data-filename="640.webp" height="151" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;white-space:normal;width:auto !important;visibility:visible !important;" width="640"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">设置 [packed=true]<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [22].webp" type="image/webp" data-filename="640.webp" height="105" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_int_list</a></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.92</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">249888.105</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.63</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">201439.691</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.97</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">245837.298</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.97</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">370897.998</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.89</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">820099.921</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">730450.607</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">对于整数列表的解码，Protobuf 是 Jackson 的 3 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">然而比 DSL-Json 的优势并不明显。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">在 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 里，解码的循环被展开了：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [23].webp" type="image/webp" data-filename="640.webp" height="1204" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">对于成员比较少的情况，这样搞可以避免数组的扩容带来的内存拷贝。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Encode Integer List</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 在编码数组的时候应该有优势，不用写那么多逗号出来嘛。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;max-width:100%;box-sizing:border-box;word-wrap:break-word;word-break:break-all;border:1px solid rgb(221, 221, 221);border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:initial;border-left-color:rgb(204, 204, 204);word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.35</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">159337.360</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.45</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">472555.572</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.9</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">112770.811</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;word-break:break-all;padding:0px 4px;border-top-color:rgb(204, 204, 204);border-left-color:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.19</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">97998.250</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.66</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">323194.122</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">214409.223</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 在编码整数列表的时候，仅仅是 Jackson 的 1.35 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">虽然 Protobuf 在处理对象的整数字段的时候优势明显，但是在处理整数的列表时却不是如此。在这个方面，DSL-Json 没有特殊的优化，性能的提高纯粹只是因为单个数字的编码速度提高了。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Decode Object List</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">列表经常用做对象的容器。测试这种两种容器组合嵌套的场景，也很有代表意义。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [24].webp" type="image/webp" data-filename="640.webp" height="167" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_object_list</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.26</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1118704.310</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.3</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1078278.555</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.91</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">483304.365</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.22</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">635179.183</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.12</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1260390.104</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1407116.476</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 处理对象列表是 Jackson 的 1.3 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">但是不及 DSL-JSON。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Encode Object List</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;max-width:100%;box-sizing:border-box;word-wrap:break-word;word-break:break-all;border:1px solid rgb(221, 221, 221);border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.22</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">328219.768</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.38</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1885052.964</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.63</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">200420.923</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.87</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">187964.594</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.85</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">857771.520</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">727582.950</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 处理对象列表的编码速度是 Jackson 的 2 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">但是 DSL-JSON 仍然比 Protobuf 更快。似乎 Protobuf 在处理列表的编码解码方面优势不明显。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Decode Double Array</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Java 的数组有点特殊，</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:11pt;">double[]</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 是比 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:11pt;">List&lt;Double&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 更高效的。使用 double 数组来代表时间点上的值或者坐标是非常常见的做法。然而，Protobuf 的 Java  库没有提供 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:11pt;">double[]</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 的支持，repeated 总是使用 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:11pt;">List&lt;Double&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">。我们可以预期 JSON 库在这里有一定的优势。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [25].webp" type="image/webp" data-filename="640.webp" height="106" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_double_array</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">5.18</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">207503.316</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">6.12</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">175678.703</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">4.83</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">222818.772</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter (base64)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.63</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">296262.142</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.8</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">383549.289</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.58</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1866460.535</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1075423.265</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 在处理 double 数组方面，Jackson 与之的差距被缩小为 5 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 与 DSL-JSON 相比，优势已经不明显了。所以如果你有很多的 double 数值需要处理，这些数值必须是在对象的字段上，才会引起性能的巨大差别，对于数组里的 double，优势差距被缩小。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">在 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 里，处理数组的循环也是被展开的。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [26].webp" type="image/webp" data-filename="640.webp" height="1030" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">这避免了数组扩容的开销。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Encode Double Array</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">再来看看 double 数组的编码</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">15.63</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">107760.788</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.54</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3125678.472</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter (6 digits)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">6.74</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">249945.866</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter (base64)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">7.11</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">236991.658</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.14</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1478332.248</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.08</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1562377.465</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1684935.837</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 可以飞快地对 double 数组进行编码，是 Jackson 的 15 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">在牺牲精度的情况下，Protobuf 只是 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 的 2.3 倍。所以，再次证明了，JSON 处理 double 非常慢。如果用 base64 编码 double，则可以保持精度，速度和牺牲精度时一样。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Decode String</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">JSON 字符串包含了转义字符的支持。Protobuf 解码字符串仅仅是一个内存拷贝。理应更快才对。被测试的字符串长度是 160 个字节的 ascii。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [27].webp" type="image/webp" data-filename="640.webp" height="152" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;white-space:normal;width:auto !important;visibility:visible !important;" width="640"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="background-position:initial;margin:0px;color:rgb(112, 177, 231);outline:none;background-clip:initial;background-origin:initial;background-attachment:initial;background-image:initial;padding:0px;background-size:initial;background-repeat:initial;text-decoration:none;word-wrap:break-word;box-sizing:border-box;max-width:100%;cursor:pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_long_string</a><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.85</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">173680.548</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.29</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">140635.170</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.4</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">134067.924</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.27</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">141419.108</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.14</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">281061.212</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">321406.155</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 解码长字符串是 Jackson 的 1.85 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">然而，DSL-Json 比 Protobuf 更快。这就有点奇怪了，JSON 的处理负担更重，为什么会更快呢？</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">先尝试捷径</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">DSL-JSON 给 ascii 实现了一个捷径：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/ngs-doo/dsl-json/blob/master/library/src/main/java/com/dslplatform/json/JsonReader.java</a></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [28].webp" type="image/webp" data-filename="640.webp" height="415" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">这个捷径里规避了处理转义字符和utf8字符串的成本。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">JVM 的动态编译做了特殊优化</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">在 JDK9 之前，java.lang.String 都是基于 `char[]` 的。而输入都是 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:11pt;">byte[]</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 并且是 utf-8 编码的。所以这使得，我们不能直接用 memcpy 的方式来处理字符串的解码问题。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">但是在 JDK9 里，java.lang.String 已经改成了基于`byte[]`的了。从 JDK9 的源代码里可以看出：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [29].webp" type="image/webp" data-filename="640.webp" height="567" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;">点击图片可以放大浏览</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);font-size:14px;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">使用这个虽然被废弃，但是还没有被删除的构造函数，我们可以使用 Arrays.copyOfRange 来直接构造 java.lang.String 了。然而，在测试之后，发现这个实现方式并没有比 DSL-JSON 的实现更快。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">似乎 JVM 的 Hotspot 动态编译时对这段循环的代码做了模式匹配，识别出了更高效的实现方式。即便是在 JDK9 使用 +UseCompactStrings 的前提下，理论上来说本应该更慢的 byte[] =&gt; char[] =&gt; byte[] 并没有使得这段代码变慢，DSL-JSON 的实现还是最快的。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">如果输入大部分是字符串，这个优化就变得至关重要了。Java 里的解析艺术，还不如说是字节拷贝的艺术。JVM 的 java.lang.String 设计实在是太愚蠢了。在现代一点的语言中，比如 Go，字符串都是基于 utf-8 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:11pt;">byte[]</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 的。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">Encode String</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">类似的问题，因为需要把 char[] 转换为 byte[]，所以没法直接内存拷贝。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.96</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">262077.921</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.99</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">252140.935</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.5</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">166381.978</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.38</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">181008.120</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.74</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">339919.707</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">250431.354</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 在编码长字符串时，比 Jackson 略微快一点点。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">一切都归咎于 char[]。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">跳过数据结构</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">JSON 是一个没有 header 的格式。因为没有 header，JSON 需要扫描每个字节才可以定位到所需的字段上。中间可能要扫过很多不需要处理的字段。 </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [30].webp" type="image/webp" data-filename="640.webp" height="333" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">消息用 PbTestWriteObject 来编码，然后用 PbTestReadObject 来解码。field1 和 field2 的内容应该被跳过。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/skip_multi_levels</a></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">库</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">相比 Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">ns/op</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">5.05</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">152194.483</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Thrift</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">5.43</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">141467.209</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.75</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">204704.100</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">DSL-JSON</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.51</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">305784.845</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Fastjson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.4</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1949277.734</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">768840.597</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Protobuf 在跳过数据结构方面，是 Jackson 的 5 倍。</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">但是如果跳过长的字符串，JSON 的成本是和字符串长度线性相关的，而 Protobuf 则是一个常量操作。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18pt !important;">总结</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">最后，我们把所有的战果汇总到一起。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;border-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></span></span></p><table cellpadding="0" cellspacing="0" style="max-width:100%;font-size:inherit;font-style:inherit;font-variant:inherit;margin:0px;padding:0px;font-weight:inherit;margin-bottom:10px;border-collapse:collapse;display:table;width:100%;box-sizing:border-box;word-wrap:break-word;" width="-59"><thead style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"></thead><tbody style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="margin:0px;padding:0px 4px;word-break:break-all;border:1px solid rgb(221, 221, 221);max-width:100%;box-sizing:border-box;word-wrap:break-word;border-color:initial;min-width:50px;line-height:16px;">场景</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf V.S. Jackson</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Protobuf V.S. Jsoniter</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:initial;word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Jsoniter V.S Jackson</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Decode Integer</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">8.51</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.64</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.22</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Encode Integer</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.9</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.44</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.02</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Decode Double</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">13.75</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.27</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">4.2</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Encode Double</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">12.71</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.96 (只保留小数点后6位)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">6.5</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Decode Object</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.22</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.6</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.04</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Encode Object</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.72</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.67</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.59</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Decode Integer List</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.92</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.98</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.97</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Encode Integer List</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.35</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.71</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.9</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Decode Object List</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.26</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.43</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.91</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Encode Object List</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.22</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.61</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.63</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Decode Double Array</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">5.18</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.47</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">4.83</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Encode Double Array</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">15.63</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.32 (只保留小数点后6位)</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">6.74</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Decode String</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.85</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.77</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">2.4</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Encode String</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.96</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">0.63</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.5</td></tr><tr style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:initial;padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">Skip Structure</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">5.05</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">1.35</td><td height="22" style="border:1px solid rgb(221, 221, 221);margin:0px;min-width:50px;border-bottom-color:initial;border-right-color:initial;border-left-color:rgb(204, 204, 204);padding:0px 4px;border-top-color:rgb(204, 204, 204);word-break:break-all;word-wrap:break-word;box-sizing:border-box;max-width:100%;line-height:16px;">3.75</td></tr></tbody></table><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="width:613px;margin:0px;border-color:transparent;border-style:solid;border-width:1px;display:block;padding:0px;min-height:60px;word-wrap:break-word;box-sizing:border-box;max-width:100%;text-align:inherit;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [31].webp" type="image/webp" data-filename="640.webp" height="406" style="border-width:0px;margin:0px;width:610px !important;cursor:pointer;border-color:initial;height:auto !important;padding:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;visibility:visible !important;" width="610"/></span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">编解码数字的时候，JSON 仍然是非常慢的。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter</a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> 把这个差距从 10 倍缩小到了 3 倍多一些。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">JSON 最差的情况是下面几种：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">跳过非常长的字符串：和字符串长度线性相关。</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">解码 double 字段：Protobuf 优势明显，是 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter </a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">的 3.27 倍，是 Jackson 的 13.75 倍。</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">编码 double 字段：如果不能接受只保留 6 位小数，Protobuf 是 Jackson 的 12.71 倍。如果接受精度损失，Protobuf 是 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter </a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">的 1.96 倍。</span></p></li></ul><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding-left:2em;list-style-position:initial;list-style-image:initial;outline:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">解码整数：Protobuf 是 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(112, 177, 231);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;background:transparent;outline:none;cursor:pointer !important;">Jsoniter </a></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">的 2.64 倍，是 Jackson 的 8.51 倍。</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;display:block;"><span style="width:613px;margin:0px;text-align:inherit;border-color:transparent;border-style:solid;display:block;padding:0px;min-height:60px;border-width:1px;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:11pt;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [32].webp" type="image/webp" data-filename="640.webp" height="527" style="border-width:0px;margin:0px;width:610px !important;cursor:pointer;border-color:initial;height:auto !important;padding:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;visibility:visible !important;" width="610"/></span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">如果你的生产环境中的 JSON 没有那么多的 double 字段，都是字符串占大头，那么基本上来说替换成 Protobuf 也就是仅仅比 <a style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Jsoniter</a> 提高一点点，肯定在 2 倍之内。如果不幸的话，没准 Protobuf 还要更慢一点。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">相关链接</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><ol style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:decimal;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(0, 82, 255);text-decoration:underline;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(0, 82, 255);">https://blog.dsl-platform.com/improving-java-json-speed/</span></a><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(0, 82, 255);"> </span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(0, 82, 255);text-decoration:underline;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(0, 82, 255);">https://github.com/fabienrenaud/java-json-benchmark</span></a><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(0, 82, 255);"> </span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(0, 82, 255);text-decoration:underline;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(0, 82, 255);">https://github.com/eishay/jvm-serializers/wiki</span></a></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a style="margin:0px;padding:0px;color:rgb(0, 82, 255);text-decoration:underline;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(0, 82, 255);">http://jsoniter.com/index.cn.html</span></a></p></li></ol><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;background-color:rgb(255, 255, 255);text-align:center;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:20px;">推荐阅读</span></strong></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;background-color:rgb(255, 255, 255);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding-left:30px;background-color:rgb(255, 255, 255);"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548459&amp;idx=1&amp;sn=8c7b328b79b4ea34ce5c2f6234972818&amp;chksm=813a7e33b64df725a7eb72088b6e22734af859e70a5b6f864ffef41b54c07ebfe3bbf7646eba&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(0, 82, 255);text-decoration:underline;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(0, 82, 255);">模块化还是微服务 - 为什么说大部分团队微服务化都走入了陷阱</span></a></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548455&amp;idx=1&amp;sn=cf94a1414e51441ca9a89d45ddf6856a&amp;chksm=813a7e3fb64df72956c9a3af10572314d7e8abbbc8a0a0d21d1db2a4a10d03c4d916ca7be4a5&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(0, 82, 255);text-decoration:underline;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(0, 82, 255);">容器与持久化存储:容器的开源分布式存储方案选型</span></a></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548432&amp;idx=1&amp;sn=ac120e1ffca7c2007c0bc5df51e03d7b&amp;chksm=813a7e08b64df71ec7b8b6afc2a36a8ff1d780db54a395b58a9f18f084080c09de514e999834&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(0, 82, 255);text-decoration:underline;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(0, 82, 255);">Redis架构之防雪崩设计：网站不宕机背后的兵法</span></a><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p></li></ul><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;background-color:rgb(255, 255, 255);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(136, 136, 136);font-size:14px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;background-color:rgb(255, 255, 255);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(136, 136, 136);font-size:14px;">本文作者陶文，转载请注明出处，技术原创及架构实践文章，欢迎通过公众号菜单「联系我们」进行投稿。</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;background-color:rgb(255, 255, 255);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(136, 136, 136);font-size:14px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:25.6px;text-align:center;background-color:rgb(255, 255, 255);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:18px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;">高可用架构</strong></span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:25.6px;text-align:center;background-color:rgb(255, 255, 255);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:18px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;">改变互联网的构建方式</strong></span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:25.6px;text-align:center;background-color:rgb(255, 255, 255);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:18px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><img src="Protobuf有没有比JSON快5倍？用代码来击破pb性能神话_files/640 [33].webp" type="image/webp" data-filename="640.webp" height="200" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;visibility:visible !important;width:200px !important;" width="auto"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:14px;">长按二维码 关注「高可用架构」公众号</span></p>
                    </div>
                    
                    
                    
                                        
                    

                    
                                        
                                        
                                        <div style="margin:0px;padding:0px;overflow:hidden;padding-top:15px;line-height:32px;">
                                                                    

                        

                        

                    </div>



                                    </div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 