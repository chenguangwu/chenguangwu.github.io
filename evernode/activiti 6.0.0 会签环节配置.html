<html>
<head>
  <title>activiti 6.0.0 会签环节配置</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5040"/>
<h1>activiti 6.0.0 会签环节配置</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/1/25 9:12</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://www.jianshu.com/p/6d76e57c7598"><i>https://www.jianshu.com/p/6d76e57c7598</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="font-family:sans-serif;text-size-adjust:100%;box-sizing:border-box;font-size:10px;-webkit-tap-highlight-color:transparent;"><div style="box-sizing:border-box;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:17px;line-height:1.42857;background-color:rgb(255, 255, 255);min-width:768px;color:rgb(51, 51, 51);"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;">
        <h1 style="font-size:34px;margin:20px 0px 0px;box-sizing:border-box;font-family:-apple-system, &quot;SF UI Display&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-weight:700;line-height:1.3;color:inherit;word-break:break-word;margin-top:20px;margin-bottom:10px;">activiti 6.0.0 会签环节配置</h1>

        
        <div style="box-sizing:border-box;margin:30px 0px 40px;">
          <a href="https://www.jianshu.com/u/17573cb623bd" style="background-color:transparent;box-sizing:border-box;color:rgb(51, 51, 51);text-decoration:none;cursor:pointer;width:48px;height:48px;display:inline-block;vertical-align:middle;">
            <img src="activiti 6.0.0 会签环节配置_files/96.png" type="image/png" data-filename="96.png" alt="96" height="46" style="border:1px solid rgb(221, 221, 221);box-sizing:border-box;vertical-align:middle;width:100%;height:100%;border-radius:50%;" width="46"/>
</a>          <div style="box-sizing:border-box;vertical-align:middle;display:inline-block;margin-left:8px;">
            <span style="box-sizing:border-box;margin-right:3px;font-size:16px;vertical-align:middle;"><a href="https://www.jianshu.com/u/17573cb623bd" style="background-color:transparent;box-sizing:border-box;color:rgb(51, 51, 51);text-decoration:none;cursor:pointer;">闲看热闹的</a></span>
            
            <a style="background-color:rgb(66, 192, 46);box-sizing:border-box;color:rgb(255, 255, 255);text-decoration:none;display:inline-block;margin-bottom:0px;font-weight:400;text-align:center;vertical-align:middle;touch-action:manipulation;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;padding:0px 7px 0px 5px;font-size:12px;line-height:normal;border-radius:40px;user-select:none;border-color:rgb(66, 192, 46);"><i style="box-sizing:border-box;font-size:inherit;font-style:normal;-webkit-font-smoothing:antialiased;font-family:iconfont;font-weight:400;"><span style="font-size:inherit;font-style:normal;font-family:iconfont;font-weight:400;"></span></i><span style="box-sizing:border-box;margin-left:2px;display:inline;">关注</span></a>
            
            <div style="box-sizing:border-box;margin-top:5px;font-size:12px;color:rgb(150, 150, 150);">
              
                <span style="box-sizing:border-box;padding-right:5px;" title="">2018.04.13 09:50*</span>
              <span style="box-sizing:border-box;padding-right:5px;">字数 190</span>
            <span style="box-sizing:border-box;padding-right:5px;">阅读 393</span><span style="box-sizing:border-box;padding-right:5px;">评论 0</span><span style="box-sizing:border-box;padding-right:5px;">喜欢 1</span></div>
          </div>
          
        </div>


        
        <div style="box-sizing:border-box;color:rgb(47, 47, 47);font-size:16px;font-weight:400;line-height:1.7;word-break:break-word;">
          <div style="box-sizing:border-box;">
            <p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">开发环境：</p>
<ul style="box-sizing:border-box;word-break:break-word;padding:0px;margin:-5px 0px 20px 20px;margin-top:0px;margin-bottom:10px;padding-left:0px;">
<li style="box-sizing:border-box;line-height:30px;">jdk8</li>
<li style="box-sizing:border-box;line-height:30px;">activiti 6.0.0</li>
<li style="box-sizing:border-box;line-height:30px;">spring boot 1.5.10 (2.0.x版本不兼容 activiti 6.0.0,无法启动）</li>
</ul>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:24px;margin:0px 0px 15px;text-rendering:optimizelegibility;margin-top:20px;margin-bottom:10px;">1. 流程结点关键配置</h2>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;">...
<span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">userTask</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">id</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;task2&quot;</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">name</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;审批2 ${user}&quot;</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">activiti:assignee</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;${user}&quot;</span>&gt;</span>
  <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">extensionElements</span>&gt;</span>
    <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:taskListener</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">event</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;create&quot;</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">delegateExpression</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;${createTaskListener}&quot;</span>&gt;</span>
      <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:field</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">name</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;msg&quot;</span>&gt;</span>
        <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:string</span>&gt;</span>&lt;![CDATA[创建 Task]]&gt;<span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:string</span>&gt;</span>
      <span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:field</span>&gt;</span>
    <span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:taskListener</span>&gt;</span>
    <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:taskListener</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">event</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;create&quot;</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">delegateExpression</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;${completeTaskListener}&quot;</span>&gt;</span>
      <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:field</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">name</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;msg&quot;</span>&gt;</span>
        <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:string</span>&gt;</span>&lt;![CDATA[完成 Task]]&gt;<span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:string</span>&gt;</span>
      <span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:field</span>&gt;</span>
    <span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">activiti:taskListener</span>&gt;</span>
    <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">modeler:activiti-idm-initiator</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">xmlns:modeler</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;http://activiti.com/modeler&quot;</span>&gt;</span>&lt;![CDATA[true]]&gt;<span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">modeler:activiti-idm-initiator</span>&gt;</span>
  <span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">extensionElements</span>&gt;</span>
  <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">multiInstanceLoopCharacteristics</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">isSequential</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;false&quot;</span>
    <span style="box-sizing:border-box;color:rgb(209, 154, 102);">activiti:collection</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;${userService.getUsers()}&quot;</span>
    <span style="box-sizing:border-box;color:rgb(209, 154, 102);">activiti:elementVariable</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;user&quot;</span>&gt;</span>
  <span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">multiInstanceLoopCharacteristics</span>&gt;</span>
<span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">userTask</span>&gt;</span>
...
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">相关参数说明如下：</p>
<ul style="box-sizing:border-box;word-break:break-word;padding:0px;margin:-5px 0px 20px 20px;margin-top:0px;margin-bottom:10px;padding-left:0px;">
<li style="box-sizing:border-box;line-height:30px;">
<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">activiti:collection=&quot;${userService.getUsers()}&quot;</code> 为使用启动时传入的服务获取会签用户集合</li>
<li style="box-sizing:border-box;line-height:30px;">
<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">activiti:elementVariable=&quot;user&quot;</code>为集合中的用户定义的变量，代表单个用户</li>
<li style="box-sizing:border-box;line-height:30px;">
<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">isSequential=&quot;false&quot;</code>  取值为 true 时为顺签，false 时为并签</li>
<li style="box-sizing:border-box;line-height:30px;">
<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">&lt;userTask id=&quot;task2&quot; name=&quot;审批2 ${user}&quot; activiti:assignee=&quot;${user}&quot;&gt;</code>配置中的<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">activiti:assignee=&quot;${user}&quot;</code>为引用集合中的用户定义的变量，使用集合中用户设置处理人</li>
</ul>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:24px;margin:0px 0px 15px;text-rendering:optimizelegibility;margin-top:20px;margin-bottom:10px;">2. 流程启动代码处理</h2>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;"><span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// 构造参数</span>
<span style="box-sizing:border-box;color:rgb(230, 192, 123);">Map</span>&lt;<span style="box-sizing:border-box;color:rgb(230, 192, 123);">String</span>, <span style="box-sizing:border-box;color:rgb(230, 192, 123);">Object</span>&gt; startVars = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> HashMap&lt;&gt;();
startVars.put(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;completeTaskListener&quot;</span>, completeTaskListener);
<span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// 设置启动任务创建监听</span>
startVars.put(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;createTaskListener&quot;</span>, createTaskListener);
<span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// 添加服务 ，userService 为注入的服务，用于返回用户信息</span>
startVars.put(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;userService&quot;</span>, userService);
startVars.put(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;pass&quot;</span>, <span style="box-sizing:border-box;color:rgb(86, 182, 194);">true</span>);

<span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// 使用流程KEY进行启动</span>
ProcessInstance pi = runtimeService.startProcessInstanceByKey(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;p4&quot;</span>, startVars);
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">UserService</p>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;">@Service
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">public</span> <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">class</span> <span style="box-sizing:border-box;color:rgb(230, 192, 123);">UserService</span> <span style="box-sizing:border-box;color:rgb(198, 120, 221);">implements</span> <span style="box-sizing:border-box;color:rgb(230, 192, 123);">Serializable</span> </span>{

    <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">/**
     * 获取环节单一审批人，生产使用应该从数据库配置表中获取
     * <span style="box-sizing:border-box;color:rgb(198, 120, 221);">@param</span> taskKey
     * <span style="box-sizing:border-box;color:rgb(198, 120, 221);">@return</span>
     */</span>
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">public</span> String getUser(String taskKey) {
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span> (taskKey.equals(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;task1&quot;</span>)) {
            <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> <span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;u2&quot;</span>;
        } <span style="box-sizing:border-box;color:rgb(198, 120, 221);">else</span> <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span> (taskKey.equals(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;task2&quot;</span>)) {
            <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> <span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;u3&quot;</span>;
        }
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> <span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;u1&quot;</span>;
    }

    <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">/**
     * 获取集合用户，生产使用应该从数据库配置表中获取
     * <span style="box-sizing:border-box;color:rgb(198, 120, 221);">@return</span>
     */</span>
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">public</span> <span style="box-sizing:border-box;color:rgb(198, 120, 221);">List</span>&lt;String&gt; getUsers() {
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">List</span>&lt;String&gt; listUser = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> ArrayList&lt;&gt;();
        listUser.add(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;manager1&quot;</span>);
        listUser.add(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;manager2&quot;</span>);
        listUser.add(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;manager3&quot;</span>);
        listUser.add(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;manager4&quot;</span>);
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> listUser;
    }
}
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">getUsers()</code>方法用于获取集合用户，提供给会签任务分配用户使用</p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">未完待续...</p>

          </div>
        </div>
    </div></div></div></div></div></div><br/></div></span>
</div></body></html> 