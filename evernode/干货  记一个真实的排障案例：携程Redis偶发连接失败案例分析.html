<html>
<head>
  <title>干货 | 记一个真实的排障案例：携程Redis偶发连接失败案例分析</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3300"/>
<h1>干货 | 记一个真实的排障案例：携程Redis偶发连接失败案例分析</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/10/18 8:30</i></td></tr>
<tr><td><b>标签：</b></td><td><i>微信</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&mid=2697267597&idx=2&sn=1cf5839e7129a13217bd7099d36c9bf8&chksm=8376f6b9b4017faff21cfbb7466f0883e7ed9a866af6d5a1353ddaedd7b5b7670840a0e29f18&mpshare=1&scene=1&srcid=1018Zf8RtllqaPaZkz5T6uhS#rd"><i>http://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697267597&amp;idx=2&amp;sn=1cf5839e7129a13217bd7099d36c9bf8&amp;chksm=8376f6b9b4017faff21cfbb7466f0883e7ed9a866af6d5a1353ddaedd7b5b7670840a0e29f18&amp;mpshare=1&amp;scene=1&amp;srcid=1018Zf8RtllqaPaZkz5T6uhS#rd</i></a></td></tr>
</table>
</div>
<br/>

<div><span style="margin:0px;"><div style="padding:8px 0px;margin:8px auto;max-width:700px;"> <div style="padding:20px 16px 12px;margin:0;background-color:#fff"><div style="margin:0;padding:0"><div style="margin:0;padding:0"><h2 style="font-weight:400;margin:0;padding:0;font-size:22px;line-height:1.4;margin-bottom:14px"> 干货 | 记一个真实的排障案例：携程Redis偶发连接失败案例分析 </h2><div style="margin:0;padding:0;margin-bottom:22px;line-height:20px;font-size:0;word-wrap:break-word;word-break:break-all"><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);margin-right:0;color:rgba(0,0,0,0.3)">原创：</span><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"> 张延俊/寿向晨 </span><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);position:relative"><a style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)"> 携程技术中心 </a></span><em style="padding:0;font-style:normal;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"></em></div><div style="margin:0;padding:0;overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-right:1em;padding-left:1em;display:inline-block;text-align:center"><span style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding:0.3em 0.5em;display:inline-block;border-radius:0.5em;font-size:14px;text-shadow:rgb(204,204,204) 4px 3px;color:rgb(32,119,218)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">作者简介</strong></p></span> </div><div style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:-1em;padding:20px 10px 10px;border-width:1px;border-style:solid;border-color:rgb(192,200,209);background-color:rgb(239,239,239);text-align:center"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;text-align:left;font-size:14px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;white-space:normal;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:14px;color:rgb(0,0,0)">张延俊，携程技术保障中心资深DBA，参与携程MySQL与Redis的运维工作。在数据库HA，自动化运维建设，数据库架构和疑难问题分析排查方面有浓厚的兴趣。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;white-space:normal;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:14px;color:rgb(0,0,0)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;white-space:normal;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:14px;color:rgb(0,0,0)">寿向晨，携程技术保障中心高级DBA，参与携程Redis及DB的运维工作。在自动化运维，流程化及监控排障等方面有较多的实践经验，喜欢深入分析问题，提高团队运维效率。</span></p></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">Redis是使用非常广泛的开源缓存数据库，在携程几乎所有业务线都有使用。本文来源于线上真实案例，记录了一次偶发Redis访问错误的排障过程，从网络和内核深入解析此次报错的前因后果，希望对各位有所帮助。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:100%"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline-block;vertical-align:top;border-radius:3px 3px 0 0;margin-right:3px;background-color:rgb(32,119,218);color:rgb(255,255,255);font-size:18px;padding-left:6px;padding-right:6px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">一、问题描述</span></strong></span></p></div><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640.png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:inline-block;vertical-align:bottom;width:0.8em"/></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">生产环境有一个Redis会偶尔发生连接失败的报错。报错的时间点，客户端IP并没有特别明显的规律。以下是客户端报错信息。过一会儿，报错会自动恢复。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left;margin-left:0;margin-right:0"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;letter-spacing:normal"></span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px">CRedis.Client.RExceptions.ExcuteCommandException:Unable to Connect redis server: ---&gt; CRedis.Third.Redis.RedisException: </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;background-color:rgb(255,251,0)">Unable to Connect redis server:</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px">在 CRedis.Third.Redis.RedisNativeClient.CreateConnectionError()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px">在 CRedis.Third.Redis.RedisNativeClient.SendExpectData(Byte[][]cmdWithBinaryArgs)</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px">在CRedis.Client.Entities.RedisServer.&lt;&gt;c__DisplayClassd`1.&lt;Get&gt;b__c(RedisClientclien)</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px">在 CRedis.Client.Logic.ClientPool.ExcuteAction[T](Func`2 action,String methodName)</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px">在 CRedis.Client.Logic.ClientPool.Excute[T](Func`2 action, StringmethodName)</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">从报错的信息来看，应该是连接不上Redis所致。Redis的版本是2.8.19。虽然版本有点老，但基本运行稳定。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">线上环境只有这个集群有偶尔报错。这个集群的一个比较明显的特征是客户端服务器比较多，有上百台。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:100%"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline-block;vertical-align:top;border-radius:3px 3px 0 0;margin-right:3px;background-color:rgb(32,119,218);color:rgb(255,255,255);font-size:18px;padding-left:6px;padding-right:6px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">二、问题分析</span></strong></span></p></div><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640 [1].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:inline-block;vertical-align:bottom;width:0.8em"/></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">从报错的信息来看，是客户端连接不到服务端。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">一个常见的原因是端口耗尽，于是我们对网络连接进行排查，在出问题的点上，TCP连接数远没有达到端口耗尽的场景。因此这个不是Redis连接不上的根因。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">另外一种常见的场景是，在服务端有慢查询，导致Redis服务阻塞。在Redis服务端，我们把运行超过10毫秒的语句进行抓取，也没有抓到运行慢的语句。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">从服务端部署的监控来看，出问题的点上，连接数有一个突然飙升，从3500个链接突然飙升至4100个链接。如下图显示。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:center"><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640.jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">                            </span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">同时间，服务器端显示Redis服务端有丢包现象。345539 – 344683 = 856个包。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white">Sat Apr  710:41:40 CST 2018</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white">   1699 outgoing packets dropped</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white">   9</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white;color:rgb(0,0,0)">2 dropped because of missing route</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;text-indent:25px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white;color:rgb(0,0,0)">344683 SYNs to LISTEN sockets dropped</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;text-indent:25px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white;color:rgb(0,0,0)">344683 times the listen queue of a socket overflowed</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white;color:rgb(0,0,0)"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white;color:rgb(0,0,0)">Sat Apr  710:41:41 CST 2018</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white;color:rgb(0,0,0)">   1699 outgoing packets dropped</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white;color:rgb(0,0,0)">   92 dropped because of missing route</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0);font-size:11px;font-family:微软雅黑,sans-serif;background:white">   345539 SYNs to LISTEN sockets dropped</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal;text-autospace:none"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif;background:white;color:rgb(0,0,0)">   345539 times the listenqueue of a socket overflowed</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">客户端报错的原因基本确定，是因为建连速度太快，导致服务端backlog队列溢出，连接被server端reset。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:100%"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline-block;vertical-align:top;border-radius:3px 3px 0 0;margin-right:3px;background-color:rgb(32,119,218);color:rgb(255,255,255);font-size:18px;padding-left:6px;padding-right:6px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">三、</span><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;white-space:normal">关于backlogoverflow</strong></span></p></div><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640 [2].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:inline-block;vertical-align:bottom;width:0.8em"/></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">在高并发的短连接服务中，这是一种很常见的tcp报错类型。一个正常的tcp建连过程如下：</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">1、client发送一个(SYN)给server；</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">2、server返回一个(SYN,ACK)给client；</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">3、client返回一个(ACK)，三次握手结束。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">对client来说建连成功，client可以继续发送数据包给server，但是这个时候server端未必ready，画成图的话大概是这个样子：</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:center"><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640 [3].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">在BSD版本内核实现的tcp协议中，server端建连过程需要两个队列，一个是SYN queue，一个是accept queue。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">前者叫半开连接（或者半连接）队列，在接收到client发送的SYN时加入队列。（一种常见的网络攻击方式就是不断发送SYN，但是不发送ACK，从而导致server端的半开队列撑爆，server端拒绝服务）。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">后者叫全连接队列，server返回（SYN,ACK），在接收到client发送ACK后（此时client会认为建连已经完成，会开始发送PSH包），如果accept queue没有满，那么server从SYN queue把连接信息移到accept queue；如果此时accept queue溢出的话，server的行为要看配置。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">如果tcp_abort_on_overflow为0（默认），那么直接drop掉client发送的PSH包，此时client会进入重发过程，一段时间后server端重新发送SYN,ACK，重新从建连的第二步开始；如果tcp_abort_on_overflow为1，那么server端发现accept queue满之后直接发送reset。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">通过wireshark搜索发现，在一秒内有超过2000次对Redis Server端发起建连请求。我们尝试修改tcp backlog大小，从511调整到2048，问题并没有得到解决。所以此类微调，并不能彻底的解决问题。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:100%"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline-block;vertical-align:top;border-radius:3px 3px 0 0;margin-right:3px;background-color:rgb(32,119,218);color:rgb(255,255,255);font-size:18px;padding-left:6px;padding-right:6px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">四、网络包分析</span></strong></span></p></div><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640 [4].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:inline-block;vertical-align:bottom;width:0.8em"/></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">我们用wireshark来识别网络拥塞的准确时间点和原因。已经有了准确的报错时间点，先用editcap把超大的tcp包裁剪一下，裁成30秒间隔，并通过wireshark I/O 100ms间隔分析网络阻塞的准确时间点。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">根据图标可以明显看到tcp的packets来往存在block。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">对该block前后的网络包进行明细分析，网络包来往情况如下：</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><table cellpadding="0" cellspacing="0" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><tbody style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-width:1px;border-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">Time</span></strong></span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top-width:1px;border-right-width:1px;border-bottom-width:1px;border-top-color:windowtext;border-right-color:windowtext;border-bottom-color:windowtext;border-left:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">Source</span></strong></span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top-width:1px;border-right-width:1px;border-bottom-width:1px;border-top-color:windowtext;border-right-color:windowtext;border-bottom-color:windowtext;border-left:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">Dest</span></strong></span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top-width:1px;border-right-width:1px;border-bottom-width:1px;border-top-color:windowtext;border-right-color:windowtext;border-bottom-color:windowtext;border-left:none;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">Description</span></strong></span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">12:01:54.6536050</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Redis-Server</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Clients</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">TCP:Flags=…AP…</span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">12:01:54.6538580</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Redis-Server</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Clients</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">TCP:Flags=…AP…</span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">12:01:54.6539770</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Redis-Server</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Clients</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">TCP:Flags=…AP…</span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">12:01:54.6720580</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Redis-Server</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Clients</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">TCP:Flags=…A..S..</span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">12:01:54.6727200</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Redis-Server</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Clients</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">TCP:Flags=…A……</span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px;word-break:break-all" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,255,255);font-size:12px">12:01:54.6808480</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,255,255);font-size:12px">Redis-Server</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,255,255);font-size:12px">Clients</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,255,255);font-size:12px">TCP:Flags=…AP…..</span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">12:01:54.6910840</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">Redis-Server</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">Clients</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">TCP:Flags=…A…S.,</span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">12:01:54.6911950</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">Redis-Server</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">Clients</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">TCP:Flags=…A……</span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">…</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">…</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">…</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background-color:rgb(255,255,255)">…</span></p></td></tr><tr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-right-width:1px;border-bottom-width:1px;border-left-width:1px;border-right-color:windowtext;border-bottom-color:windowtext;border-left-color:windowtext;border-top:none;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,255,255);font-size:12px">12:01:56.1181350</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,255,255);font-size:12px">Redis-Server</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="114"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,255,255);font-size:12px">Clients</span></p></td><td style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-top:none;border-left:none;border-bottom-width:1px;border-bottom-color:windowtext;border-right-width:1px;border-right-color:windowtext;padding:0 7px" valign="top" width="227"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,255,255);font-size:12px">TCP:Flags=…AP….</span></p></td></tr></tbody></table><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">12:01:54.6808480,Redis Server端向客户端发送了一个Push包，也就是对于查询请求的一个结果返回。后面的包都是在做连接处理，包括Ack包，Ack确认包，以及重置的RST包，紧接着下面一个Push包是在12:01:56.1181350发出的。中间的间隔是1.4372870秒。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">也就是说，在这1.4372870秒期间，Redis的服务器端，除了做一个查询，其他的操作都是在做建连，或拒绝连接。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">客户端报错的前后逻辑已经清楚了，redis-server卡了1.43秒，client的connection pool被打满，疯狂新建连接，server的accept queue满，直接拒绝服务，client报错。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">开始怀疑client发送了特殊命令，这时需要确认一下client的最后几个命令是什么，找到redis-server卡死前的第一个包。装一个wireshark的redis插件，看到最后几个命令是简单的get，并且key-value都很小，不至于需要耗费1.43秒才能完成。服务端也没有slow log，此时排障再次陷入僵局。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:100%"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline-block;vertical-align:top;border-radius:3px 3px 0 0;margin-right:3px;background-color:rgb(32,119,218);color:rgb(255,255,255);font-size:18px;padding-left:6px;padding-right:6px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">五、进一步分析</span></strong></span></p></div><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640 [5].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:inline-block;vertical-align:bottom;width:0.8em"/></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">为了了解这1.43秒之内，Redis Server在做什么事情，我们用pstack来抓取信息。Pstack本质上是gdb attach，高频率的抓取会影响redis的吞吐。死循环0.5秒一次无脑抓，在redis-server卡死的时候抓到堆栈如下（过滤了没用的栈信息）：</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">Thu May 31 11:29:18 CST 2018</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">Thread 1 (Thread 0x7ff2db6de720 (LWP 8378)):</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#0  0x000000000048cec4 in ?? ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#1  0x00000000004914a4 in je_arena_ralloc ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#2  0x00000000004836a1 in je_realloc ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#3  0x0000000000422cc5 in zrealloc ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#4  0x00000000004213d7 in sdsRemoveFreeSpace ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,251,0);font-size:12px">#5  0x000000000041ef3c inclientsCronResizeQueryBuffer () </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:white;font-family:微软雅黑,sans-serif;font-size:12px">#6  0x00000000004205de in clientsCron ()</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#7  0x0000000000420784 in serverCron ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#8  0x0000000000418542 in aeProcessEvents ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#9  0x000000000041873b in aeMain ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#100x0000000000420fce in main ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thu May 31 11:29:19 CST 2018</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thread 1 (Thread 0x7ff2db6de720 (LWP8378)):</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#0  0x0000003729ee5407 in madvise () from/lib64/libc.so.6</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#1  0x0000000000493a4e in je_pages_purge ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#2  0x000000000048cf70 in ?? ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#3  0x00000000004914a4 in je_arena_ralloc ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#4  0x00000000004836a1 in je_realloc ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#5  0x0000000000422cc5 in zrealloc ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#6  0x00000000004213d7 in sdsRemoveFreeSpace ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:rgb(255,251,0);font-size:12px">#7  0x000000000041ef3c inclientsCronResizeQueryBuffer ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:white;font-family:微软雅黑,sans-serif;font-size:12px">#8  0x00000000004205de in clientsCron ()</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#9  0x0000000000420784 in serverCron ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#100x0000000000418542 in aeProcessEvents ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#110x000000000041873b in aeMain ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#12 0x0000000000420fcein main ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thu May 31 11:29:19 CST 2018</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thread 1 (Thread 0x7ff2db6de720 (LWP8378)):</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#0  0x000000000048108c in je_malloc_usable_size()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#1  0x0000000000422be6 in zmalloc ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#2  0x00000000004220bc in sdsnewlen ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#3  0x000000000042c409 in createStringObject ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#4  0x000000000042918e in processMultibulkBuffer()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#5  0x0000000000429662 in processInputBuffer ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#6  0x0000000000429762 in readQueryFromClient ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#7  0x000000000041847c in aeProcessEvents ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#8  0x000000000041873b in aeMain ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#9  0x0000000000420fce in main ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thu May 31 11:29:20 CST 2018</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thread 1 (Thread 0x7ff2db6de720 (LWP8378)):</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#0  0x000000372a60e7cd in write () from/lib64/libpthread.so.0</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#1  0x0000000000428833 in sendReplyToClient ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#2  0x0000000000418435 in aeProcessEvents ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#3  0x000000000041873b in aeMain ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:0.1px;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;font-size:12px">#4  0x0000000000420fce in main ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">重复多次抓取后，从堆栈中发现可疑堆栈clientsCronResizeQueryBuffer位置，属于serverCron()函数下，这个redis-server内部的定时调度，并不在用户线程下，这个解释了为什么卡死的时候没有出现慢查询。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><h2 style="font-weight:400;font-size:16px;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;color:windowtext;font-size:16px">查看redis源码，确认到底redis-server在做什么：</span></h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">clientsCron(server.h):</span></strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;color:olive;font-size:12px">#define CLIENTS_CRON_MIN_ITERATIONS 5</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">void</span><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">clientsCron</span></strong><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">void</span>){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*Makesuretoprocessatleastnumclients/server.hzofclients</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*percall.Sincethisfunctioniscalledserver.hztimespersecond</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*wearesurethatintheworstcaseweprocessalltheclientsin1</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*second.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">int</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">numclients</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">listLength</span>(server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">clients</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">int</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">iterations</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">numclients</span>/server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">hz</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:purple">mstime_t</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">now</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">mstime</span>();</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*Processatleastafewclientswhileweareatit,evenifweneed</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*toprocesslessthanCLIENTS_CRON_MIN_ITERATIONStomeetourcontract</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*ofprocessingeachclientoncepersecond.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">iterations</span>&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">CLIENTS_CRON_MIN_ITERATIONS</span>)</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">iterations</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">numclients</span>&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">CLIENTS_CRON_MIN_ITERATIONS</span>)?</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">numclients</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">:<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">CLIENTS_CRON_MIN_ITERATIONS</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">while</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">listLength</span>(server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">clients</span>)&amp;&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">iterations</span>--){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:purple">client</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:purple">listNode</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">head</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*Rotatethelist,takethecurrenthead,process.</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*Thiswayiftheclientmustberemovedfromthelistit'sthe</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*firstelementandwedon'tincurintoO(N)computation.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">listRotate(server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">clients</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">head</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">listFirst</span>(server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">clients</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">c</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">listNodeValue</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">head</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*Thefollowingfunctionsdodifferentservicechecksontheclient.</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*Theprotocolisthattheyreturnnon-zeroiftheclientwas</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*terminated.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">clientsCronHandleTimeout</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">now</span>))<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">continue</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">clientsCronResizeQueryBuffer</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>))<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">continue</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">}</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">clientsCron首先判断当前client的数量，用于控制一次清理连接的数量，生产服务器单实例的连接数量在5000不到，也就是一次清理的连接数是50个。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">clientsCronResizeQueryBuffer(server.h):</span></strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif"> </span></strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;color:green;font-size:12px">/*Theclientquerybufferisansds.cstringthatcanendwithalotof</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver"> </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*freespacenotused,thisfunctionreclaimsspaceifneeded.</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver"> </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver"> </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*Thefunctionalwaysreturns0asitneverterminatestheclient.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">int</span><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">clientsCronResizeQueryBuffer</span></strong><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:purple">client</span>*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:purple">size_t</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">querybuf_size</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">sdsAllocSize</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:purple">time_t</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">idletime</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">unixtime</span>-<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">lastinteraction</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*只在以下两种情况下会Resize querybuffer:</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*1)Querybuffer&gt;BIG_ARG(在server.h 中定义#definePROTO_MBULK_BIG_ARG     (1024*32))且这个Buffer的小于一段时间的客户端使用的峰值.</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*2)客户端空闲超过2s且Buffer size大于1k.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(((<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">querybuf_size</span>&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">PROTO_MBULK_BIG_ARG</span>)&amp;&amp;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">querybuf_size</span>/(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf_peak</span>+<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">1</span>))&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">2</span>)||</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">querybuf_size</span>&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">1024</span>&amp;&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">idletime</span>&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">2</span>))</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">{</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*Onlyresizethequerybufferifitisactuallywastingspace.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">sdsavail</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf</span>)&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">1024</span>){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">            </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">c</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">sdsRemoveFreeSpace</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*Resetthepeakagaintocapturethepeakmemoryusageinthenext</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*cycle.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">c</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf_peak</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">0</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">return</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:navy">0</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">}</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">如果redisClient对象的query buffer满足条件，那么就直接resize掉。满足条件的连接分成两种，一种是真的很大的，比该客户端一段时间内使用的峰值还大；还有一种是很闲（idle&gt;2）的，这两种都要满足一个条件，就是buffer free的部分超过1k。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">那么redis-server卡住的原因就是，正好有那么50个很大的或者空闲的并且free size超过了1k大小连接的同时，循环做了resize。由于redis都属于单线程工作的程序，所以block了client。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">那么解决这个问题办法就很明朗了，让resize的频率变低或者resize的执行速度变快。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">既然问题出在querybuffer上，我们先看一下这个东西被修改的位置：</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">readQueryFromClient</span></strong><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">（networking.c）:</span></strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:purple">redisClient</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">*<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">createClient</span></strong>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">int</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">fd</span>){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:purple">redisClient</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">zmalloc</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">sizeof</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:purple">redisClient</span>));</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*passing-1asfditispossibletocreateanonconnectedclient.</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*ThisisusefulsincealltheRediscommandsneedstobeexecuted</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*inthecontextofaclient.Whencommandsareexecutedinother</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*contexts(forinstanceaLuascript)weneedanonconnectedclient.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">fd</span>!=-<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">1</span>){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">anetNonBlock</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">NULL</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">fd</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">anetEnableTcpNoDelay</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">NULL</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">fd</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">tcpkeepalive</span>)</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">            </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">anetKeepAlive</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">NULL</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">fd</span>,server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">tcpkeepalive</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">aeCreateFileEvent</span>(server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">el</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">fd</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">AE_READABLE</span>,</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">            </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">readQueryFromClient,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>)==<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">AE_ERR</span>)</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">{</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">            </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">close</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">fd</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">            </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">zfree</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">            </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">return</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:navy">NULL</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">selectDb</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">0</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">c</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">id</span>=server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">next_client_id</span>++;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">c</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">fd</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">fd</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">c</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">name</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">NULL</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">c</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">bufpos</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">0</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;text-indent:21px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100);background:yellow">c</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;background:yellow">-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">sdsempty</span>();</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">初始化是0</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;text-indent:21px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">readQueryFromClient(networking.c):</span></strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">void</span><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">readQueryFromClient</span></strong><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:purple">aeEventLoop</span>*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">el</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">int</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">fd</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">void</span>*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">privdata</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">int</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">mask</span>){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:purple">redisClient</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>=(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:purple">redisClient</span>*)<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">privdata</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">int</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">nread</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">readlen</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:purple">size_t</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">qblen</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:navy">REDIS_NOTUSED</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">el</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:navy">REDIS_NOTUSED</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">mask</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">server.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">current_client</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">readlen</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">REDIS_IOBUF_LEN</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*Ifthisisamultibulkrequest,andweareprocessingabulkreply</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*thatislargeenough,trytomaximizetheprobabilitythatthequery</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*buffercontainsexactlytheSDSstringrepresentingtheobject,even</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*attheriskofrequiringmoreread(2)calls.Thiswaythefunction</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*processMultiBulkBuffer()canavoidcopyingbufferstocreatethe</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*RedisObjectrepresentingtheargument.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">reqtype</span>==<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">REDIS_REQ_MULTIBULK</span>&amp;&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">multibulklen</span>&amp;&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">bulklen</span>!=-<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">1</span></span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">&amp;&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">bulklen</span>&gt;=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">REDIS_MBULK_BIG_ARG</span>)</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">{</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">int</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">remaining</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">unsigned</span>)(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">bulklen</span>+<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">2</span>)-<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">sdslen</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">remaining</span>&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">readlen</span>)<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">readlen</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">remaining</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">qblen</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">sdslen</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf_peak</span>&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">qblen</span>)<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf_peak</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">qblen</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100);background:yellow">c</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;background:yellow">-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">sdsMakeRoomFor</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">c</span>-&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:maroon">querybuf</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">readlen</span>);</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">在这里会被扩大</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">由此可见c-&gt;querybuf在连接第一次读取命令后的大小就会被分配至少1024*32，所以回过头再去看resize的清理逻辑就明显存在问题。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">每个被使用到的query buffer的大小至少就是1024*32，但是清理的时候判断条件是&gt;1024，也就是说，所有的idle&gt;2的被使用过的连接都会被resize掉，下次接收到请求的时候再重新分配到1024*32。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">这个其实是没有必要的，在访问比较频繁的群集，内存会被频繁得回收重分配，所以我们尝试将清理的判断条件改造为如下，就可以避免大部分没有必要的resize操作。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">if (((querybuf_size &gt;REDIS_MBULK_BIG_ARG) &amp;&amp;</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">        (querybuf_size/(c-&gt;querybuf_peak+1)) &gt; 2) ||</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px;background:yellow">(querybuf_size &gt;1024*32 &amp;&amp; idletime &gt; 2</span>))</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">    {</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">       /* Only resize the query buffer if it is actually wasting space. */</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">       if (sdsavail(c-&gt;querybuf) &gt; 1024*32) {</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">           c-&gt;querybuf = sdsRemoveFreeSpace(c-&gt;querybuf);</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">       }</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">    }</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">这个改造的副作用是内存的开销，按照一个实例5k连接计算。5000*1024*32=160M，这点内存消耗对于上百G内存的服务器完全可以接受。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:100%"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline-block;vertical-align:top;border-radius:3px 3px 0 0;margin-right:3px;background-color:rgb(32,119,218);color:rgb(255,255,255);font-size:18px;padding-left:6px;padding-right:6px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">六、问题重现</span></strong></span></p></div><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640 [6].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:inline-block;vertical-align:bottom;width:0.8em"/></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">在使用修改过源码的Redisserver后，问题仍然重现了，客户端还是会报同类型的错误，且报错的时候，服务器内存依然会出现抖动。抓取内存堆栈信息如下</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thu Jun 14 21:56:54 CST 2018</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#3 0x0000003729ee893d in clone () from /lib64/libc.so.6</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thread 1 (Thread 0x7f2dc108d720 (LWP27851)):</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#0 0x0000003729ee5400 in madvise () from /lib64/libc.so.6</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#1 0x0000000000493a1e in je_pages_purge ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:yellow;font-size:12px">#2  0x000000000048cf40 in arena_purge ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#3 0x00000000004a7dad in je_tcache_bin_flush_large ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#4 0x00000000004a85e9 in je_tcache_event_hard ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#5 0x000000000042c0b5 in decrRefCount ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#6 0x000000000042744d in resetClient ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#7  0x000000000042963bin processInputBuffer ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#8 0x0000000000429762 in readQueryFromClient ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#9 0x000000000041847c in aeProcessEvents ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#10 0x000000000041873b in aeMain ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#11 0x0000000000420fce in main ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thu Jun 14 21:56:54 CST 2018</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">Thread 1 (Thread 0x7f2dc108d720 (LWP27851)):</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#0 0x0000003729ee5400 in madvise () from /lib64/libc.so.6</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#1 0x0000000000493a1e in je_pages_purge ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:yellow;font-size:12px">#2  0x000000000048cf40 in arena_purge ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#3 0x00000000004a7dad in je_tcache_bin_flush_large ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#4 0x00000000004a85e9 in je_tcache_event_hard ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#5 0x000000000042c0b5 in decrRefCount ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#6 0x000000000042744d in resetClient ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#7 0x000000000042963b in processInputBuffer ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#8 0x0000000000429762 in readQueryFromClient ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#9 0x000000000041847c in aeProcessEvents ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#10 0x000000000041873b in aeMain ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">#11 0x0000000000420fce in main ()</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">显然，Querybuffer被频繁resize的问题已经得到了优化，但是还是会出现客户端报错。这就又陷入了僵局。难道还有其他因素导致query buffer resize变慢？</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">我们再次抓取pstack。但这时，jemalloc引起了我们的注意。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">此时回想Redis的内存分配机制，Redis为避免libc内存不被释放导致大量内存碎片的问题，默认使用的是jemalloc用作内存分配管理，这次报错的堆栈信息中都是je_pages_purge() redis在调用jemalloc回收脏页。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">我们线上的Redis版本大多是2.8.19版本，原生代码中使用的是jemalloc 3.6的版本，我们看下jemalloc做了些什么。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">arena_purge(arena.c)</span></strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;color:olive;font-size:12px">staticvoid</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">arena_purge</span></strong><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(arena_t*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>,bool<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">all</span>)</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">{</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">arena_chunk_t*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">chunk</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">size_t<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgatory</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(config_debug){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">size_t<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">ndirty</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">0</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">arena_chunk_dirty_iter(&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;chunks_dirty,NULL,</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                             </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">chunks_dirty_iter_cb,(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:olive">void</span>*)&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">ndirty</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">assert(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">ndirty</span>==<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;ndirty);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">assert(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;ndirty&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;npurgatory||<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">all</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">assert((<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;nactive&gt;&gt;opt_lg_dirty_mult)&lt;(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;ndirty-</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;npurgatory)||<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">all</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(config_stats)</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;stats.npurge++;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">npurgatory</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">arena_compute_npurgatory</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">all</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;npurgatory+=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgatory</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">while</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgatory</span>&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">0</span>){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">size_t<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurged</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">nunpurged</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*Getnextchunkwithdirtypages.*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">chunk</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=arena_chunk_dirty_first(&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;chunks_dirty);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">chunk</span>==NULL){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                                             </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;npurgatory-=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgatory</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                                             </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">return</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">npurgeable</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">chunk</span>-&gt;ndirty;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">assert(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>!=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">0</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgatory</span>&amp;&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">chunk</span>-&gt;nruns_adjac==<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:navy">0</span>){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;color:silver;font-size:12px">                    </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                                             </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;npurgatory+=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>-<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgatory</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                                             </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">npurgatory</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;npurgatory-=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">npurgatory</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">npurged</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">arena_chunk_purge</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">chunk</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">all</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">nunpurged</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>-<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurged</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;npurgatory+=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">nunpurged</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">npurgatory</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">+=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">nunpurged</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">}</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">Jemalloc每次回收都会判断所有实际应该清理的chunck并对清理做count，这个操作对于高响应要求的系统是很奢侈的，所以我们考虑通过升级jemalloc的版本来优化purge的性能。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">Redis 4.0版本发布后，性能有很大的改进，并可以通过命令回收内存，我们线上也正准备进行升级，跟随4.0发布的jemalloc版本为4.1。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">jemalloc的版本使用的在jemalloc的4.0之后版本的arena_purge()做了很多优化，去掉了计数器的调用，简化了很多判断逻辑，增加了arena_stash_dirty()方法合并了之前的计算和判断逻辑，增加了purge_runs_sentinel，用保持脏块在每个arena LRU中的方式替代之前的保持脏块在arena树的dirty-run-containing chunck中的方式，大幅度减少了脏块purge的体积，并且在内存回收过程中不再移动内存块。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">代码如下：</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:11px;font-family:微软雅黑,sans-serif"> </span></strong></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">arena_purge(arena.c)</span></strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;color:olive;font-size:12px">staticvoid</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">arena_purge</span></strong><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(arena_t*<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>,bool<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">all</span>)</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">{</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">chunk_hooks_t<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">chunk_hooks</span>=chunk_hooks_get(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">size_t<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurge</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurged</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">arena_runs_dirty_link_t<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_runs_sentinel</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">extent_node_t<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_chunks_sentinel</span>;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;purging=true;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">/*</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*Callstoarena_dirty_count()aredisabledevenfordebugbuilds</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*becauseoverheadgrowsnonlinearlyasmemoryusageincreases.</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                     </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:green">*/</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(false&amp;&amp;config_debug){</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">size_t<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">ndirty</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">arena_dirty_count</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">assert(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">ndirty</span>==<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;ndirty);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">}</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">assert((<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;nactive&gt;&gt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;lg_dirty_mult)&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>-&gt;ndirty||<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">all</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:olive">if</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(config_stats)</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                                         </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;stats.npurge++;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">npurge</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">arena_compute_npurge</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">all</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">qr_new(&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_runs_sentinel</span>,rd_link);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">extent_node_dirty_linkage_init(&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_chunks_sentinel</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">npurgeable</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">arena_stash_dirty</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>,&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">chunk_hooks</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">all</span>,<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurge</span>,</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_runs_sentinel</span>,&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_chunks_sentinel</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">assert(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>&gt;=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurge</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">npurged</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(0,103,124)">arena_purge_stashed</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>,&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">chunk_hooks</span>,&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_runs_sentinel</span>,</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_chunks_sentinel</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">assert(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurged</span>==<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">npurgeable</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(0,103,124)">arena_unstash_purged</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">arena</span>,&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">chunk_hooks</span>,&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_runs_sentinel</span>,</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                        </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">&amp;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;color:rgb(9,46,100)">purge_chunks_sentinel</span>);</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:silver">                    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif;color:rgb(9,46,100)">arena</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;font-family:微软雅黑,sans-serif">-&gt;purging=false;</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:12px">}</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></strong></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:100%"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline-block;vertical-align:top;border-radius:3px 3px 0 0;margin-right:3px;background-color:rgb(32,119,218);color:rgb(255,255,255);font-size:18px;padding-left:6px;padding-right:6px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">七、解决问题</span></strong></span></p></div><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640 [7].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:inline-block;vertical-align:bottom;width:0.8em"/></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">实际上我们有多个选项。可以使用Google的tcmalloc来代替jemalloc，可以升级jemalloc的版本等等。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">根据上面的分析，我们尝试通过升级jemalloc版本，实际操作为升级Redis版本来解决。将Redis的版本升级到4.0.9之后观察，线上客户端连接超时这个棘手的问题得到了解决。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:100%"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline-block;vertical-align:top;border-radius:3px 3px 0 0;margin-right:3px;background-color:rgb(32,119,218);color:rgb(255,255,255);font-size:18px;padding-left:6px;padding-right:6px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">八、问题总结</span></strong></span></p></div><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640 [8].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:inline-block;vertical-align:bottom;width:0.8em"/></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">       </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">Redis在生产环境中因其支持高并发，响应快，易操作被广泛使用，对于运维人员而言，其响应时间的要求带来了各种各样的问题，</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">Redis的连接超时问题是其中比较典型的一种，从发现问题，客户端连接超时，到通过抓取客户端与服务端的网络包，内存堆栈定位问题，我们也被其中一些假象所迷惑，最终通过升级jemalloc（Redis）的版本解决问题。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif">希望本文能给遇到同样问题的小伙伴们一些启发。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:.1px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif"> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51)"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:18px;box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important">【推荐阅读】</strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51)"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:18px;box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></strong></span></p><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0;padding-left:10px;border-left:3px solid #dbdbdb;white-space:normal"><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em;list-style-type:square"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(51,51,51)"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697267581&amp;idx=1&amp;sn=a81ae51a7633c5970e6e5510afbb43f2&amp;chksm=8376f649b4017f5fa1e71f4b89cb0f9839b55e212a1d39304671e674b9a5c8e2e6cca93d5f4d&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;text-decoration:underline" target="_blank"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px">一文带你了解携程第四代全链路测试系统</span></a></p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(51,51,51)"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697267581&amp;idx=2&amp;sn=1ae968bb04275585a11508a92c38ae37&amp;chksm=8376f649b4017f5f6fd840cf46d313b87b749da8956dfe60230cb1612ec369ce68cf44dabd3c&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;text-decoration:underline" target="_blank"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px">如何选出最“美”图片展示给你？携程做了基于深度学习的图像美感评分系统</span></a></p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(51,51,51)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,122,170);text-decoration:underline"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697267537&amp;idx=1&amp;sn=3011302613b90749d7ffe0cc3a805d1f&amp;chksm=8376f665b4017f733ddef74173b7b6bf0f6156144d017fe6b7dd39c8cd6645c0352dfab61d73&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">知识图谱在旅游领域有哪些应用</a>？</span></p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(51,51,51)"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697267537&amp;idx=2&amp;sn=58e214cb3029e87f87ffa0f42ce02276&amp;chksm=8376f665b4017f73acc521bce665b201bf2dbe071e4d06dd1acf0621ff8aa9f8870c6c06fa63&amp;scene=21#wechat_redirect" style="margin:0;padding:0;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,122,170);text-decoration:underline" target="_blank">携程国际BU的SEO重构实践</a></p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(51,51,51)"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI3MjA5MQ==&amp;mid=2697267524&amp;idx=1&amp;sn=bc1d44b89970e58c419a9c9bf6cbb0a1&amp;chksm=8376f670b4017f66da28b52f4db9ac8cd54254e38efe79d5c3759dd3e69b5e0fc4f922c8a568&amp;scene=21#wechat_redirect" style="margin:0;padding:0;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,122,170);text-decoration:underline" target="_blank">携程机票如何利用大数据提升测试效果</a></p></li></ul></blockquote><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51);text-align:center"><img src="干货  记一个真实的排障案例：携程Redis偶发连接失败案例分析_files/640 [1].jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;height:auto !important;font-family:微软雅黑,sans-serif;box-sizing:border-box !important;word-wrap:break-word !important;width:451px !important;visibility:visible !important"/></p></div></div><ul style="margin:0;padding:0"></ul></div></div></div></span>
</div></body></html> 