<html>
<head>
  <title>拼多多面试：如何用 Redis 统计独立用户访问量？</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="13083"/>
<h1>拼多多面试：如何用 Redis 统计独立用户访问量？</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/10/20 12:20</i></td></tr>
<tr><td><b>标签：</b></td><td><i>微信</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&mid=2247487508&idx=1&sn=082e9a7a24f5e84920c2f1333a3001d6&chksm=96cd5058a1bad94e86d701e12bc79334c9b9ba5ce1061d85b9524049d5b3fe635bec188a01e1&mpshare=1&scene=1&srcid=&sharer_sharetime=1571545220732&sharer_shareid=f5b9960e886b8a68c0c249bd0ed30f43#rd"><i>http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247487508&amp;idx=1&amp;sn=082e9a7a24f5e84920c2f1333a3001d6&amp;chksm=96cd5058a1bad94e86d701e12bc79334c9b9ba5ce1061d85b9524049d5b3fe635bec188a01e1&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;sharer_sharetime=1571545220732&amp;sharer_shareid=f5b9960e886b8a68c0c249bd0ed30f43#rd</i></a></td></tr>
</table>
</div>
<br/>

<div><span style="margin:0px;"><div style="padding:8px 0px;margin:8px auto;max-width:700px;"> <div style="margin:0;padding:0;background-color:#fff"><div style="margin:0;padding:0"><div style="margin:0;padding:0"><h2 style="font-weight:400;margin:0;padding:0;font-size:22px;line-height:1.4;margin-bottom:14px"> 拼多多面试：如何用 Redis 统计独立用户访问量？ </h2><div style="margin:0;padding:0;margin-bottom:22px;line-height:20px;font-size:0;word-wrap:break-word;word-break:break-all"><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"> 沙茶敏碎碎念 </span><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);position:relative"><a style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)"> 占小狼的博客 </a></span><em style="padding:0;font-style:normal;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"></em></div><div style="margin:0;padding:0;overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:-apple-system-font,system-ui,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px;white-space:normal;color:rgb(62,62,62);font-size:15px;background-color:rgb(255,255,255)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:-apple-system-font,system-ui,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px;white-space:normal;color:rgb(62,62,62);font-size:15px;background-color:rgb(255,255,255)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(0,0,0);font-size:16px;text-align:center"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:-apple-system-font,BlinkMacSystemFont,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;color:rgb(178,178,178);letter-spacing:1px;font-size:14px">点击上方</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:-apple-system-font,BlinkMacSystemFont,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px;color:rgb(87,107,148);font-size:15px">蓝色字体</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:-apple-system-font,BlinkMacSystemFont,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;color:rgb(178,178,178);letter-spacing:1px;font-size:14px">，选择“设为星标”</span></p></div><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:-apple-system-font,system-ui,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px;white-space:normal;color:rgb(62,62,62);font-size:15px;background-color:rgb(255,255,255)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;color:rgb(0,0,0);font-size:16px;text-align:center"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(178,178,178);font-size:14px;font-family:-apple-system-font,BlinkMacSystemFont,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px">优质文章，及时送达</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-family:-apple-system-font,system-ui,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px;white-space:normal;color:rgb(62,62,62);font-size:15px;background-color:rgb(255,255,255);text-align:left"><img src="拼多多面试：如何用 Redis 统计独立用户访问量？_files/640.jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;visibility:visible !important;width:654px !important" width="100%"/></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:-apple-system-font,BlinkMacSystemFont,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px;white-space:normal;background-color:rgb(255,255,255)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:10px;border-left:3px solid #dbdbdb;font-size:15px;padding-top:4px;margin:1em 0;color:rgba(0,0,0,0.5)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:10px;color:rgba(0,0,0,0.498);letter-spacing:0.544px;widows:1;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:13px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;letter-spacing:0.544px">作者：</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;letter-spacing:0.544px">沙茶敏碎碎念</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;letter-spacing:0.544px"></span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:10px;color:rgba(0,0,0,0.498);letter-spacing:0.544px;widows:1;line-height:normal;text-align:left"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:13px">来源：</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:13px">https://url.cn/5tQPEQg</span></p></div></div></blockquote></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start">众所周至，拼多多的待遇也是高的可怕，在挖人方面也是不遗余力，对于一些工作3年的开发，稍微优秀一点的，都给到30K的Offer，当然，拼多多加班也是出名的，一周上6天班是常态，每天工作时间基本都是超过12个小时，也是相当辛苦的。废话不多说，今天我们来聊一聊拼多多的一道后台面试真题，是一道简单的架构类的题目：<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">拼多多有数亿的用户，那么对于某个网页，怎么使用Redis来统计一个网站的用户访问数呢？</strong><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><h3 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1.5rem;margin-bottom:1rem;color:rgb(21,153,87);line-height:1.35;font-size:20px;text-align:start;white-space:normal;font-family:Menlo,Monaco,&quot;Source Code Pro&quot;,Consolas,Inconsolata,&quot;Ubuntu Mono&quot;,&quot;DejaVu Sans Mono&quot;,&quot;Courier New&quot;,&quot;Droid Sans Mono&quot;,&quot;Hiragino Sans GB&quot;,微软雅黑,monospace !important">使用Hash</h3><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start">哈希是Redis的一种基础数据结构，Redis底层维护的是一个开散列，会把不同的key映射到哈希表上，如果是遇到关键字冲突，那么就会拉出一个链表出来。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start">当一个用户访问的时候，如果用户登陆过，那么我们就使用用户的id，如果用户没有登陆过，那么我们也能够前端页面随机生成一个key用来标识用户，当用户访问的时候，我们可以使用<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">HSET</strong>命令，key可以选择URI与对应的日期进行拼凑，field可以使用用户的id或者随机标识，value可以简单设置为1。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start">当我们要统计某一个网站某一天的访问量的时候，就可以直接使用<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">HLEN</strong>来得到最终的结果了。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><img src="拼多多面试：如何用 Redis 统计独立用户访问量？_files/640 [1].jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;border-width:2px;border-style:solid;border-color:rgb(238,238,238);border-radius:6px"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">优点</strong>：简单，容易实现，查询也是非常方便，数据准确性非常高。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">缺点</strong>：占用内存过大，。随着key的增多，性能也会下降。小网站还行，拼多多这种数亿PV的网站肯定受不了</p><h3 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1.5rem;margin-bottom:1rem;color:rgb(21,153,87);line-height:1.35;font-size:20px;text-align:start;white-space:normal;font-family:Menlo,Monaco,&quot;Source Code Pro&quot;,Consolas,Inconsolata,&quot;Ubuntu Mono&quot;,&quot;DejaVu Sans Mono&quot;,&quot;Courier New&quot;,&quot;Droid Sans Mono&quot;,&quot;Hiragino Sans GB&quot;,微软雅黑,monospace !important">使用Bitset</h3><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start">我们知道，对于一个32位的int，如果我们只用来记录id，那么只能够记录一个用户，但如果我们转成2进制，每位用来表示一个用户，那么我们就能够一口气表示32个用户，空间节省了32倍！对于有大量数据的场景，如果我们使用bitset，那么，可以节省非常多的内存。对于没有登陆的用户，我们也可以使用哈希算法，把对应的用户标识哈希成一个数字id。bitset非常的节省内存，假设有1亿个用户，也只需要100000000/8/1024/1024约等于12兆内存。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><img src="拼多多面试：如何用 Redis 统计独立用户访问量？_files/640 [2].jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;border-width:2px;border-style:solid;border-color:rgb(238,238,238);border-radius:6px"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start">Redis已经为我们提供了<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">SETBIT</strong>的方法，使用起来非常的方便，我们可以看看下面的例子，我们在item页面可以不停地使用<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">SETBIT</strong>命令，设置用户已经访问了该页面，也可以使用<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">GETBIT</strong>的方法查询某个用户是否访问。最后我们通过<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">BITCOUNT</strong>可以统计该网页每天的访问数量。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><img src="拼多多面试：如何用 Redis 统计独立用户访问量？_files/640 [3].jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;border-width:2px;border-style:solid;border-color:rgb(238,238,238);border-radius:6px"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">优点<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;font-size:16px;text-align:start;white-space:pre-line">：</span></strong>占用内存更小，查询方便，可以指定查询某个用户，数据可能略有瑕疵，对于非登陆的用户，可能不同的key映射到同一个id，否则需要维护一个非登陆用户的映射，有额外的开销。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">缺点<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;font-size:16px;text-align:start;white-space:pre-line">：</span></strong>如果用户非常的稀疏，那么占用的内存可能比方法一更大。</p><h3 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1.5rem;margin-bottom:1rem;color:rgb(21,153,87);line-height:1.35;font-size:20px;text-align:start;white-space:normal;font-family:Menlo,Monaco,&quot;Source Code Pro&quot;,Consolas,Inconsolata,&quot;Ubuntu Mono&quot;,&quot;DejaVu Sans Mono&quot;,&quot;Courier New&quot;,&quot;Droid Sans Mono&quot;,&quot;Hiragino Sans GB&quot;,微软雅黑,monospace !important">使用概率算法</h3><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start">对于拼多多这种多个页面都可能非常多访问量的网站，如果所需要的数量不用那么准确，可以使用概率算法，事实上，我们对一个网站的UV的统计，1亿跟1亿零30万其实是差不多的。在Redis中，已经封装了HyperLogLog算法，他是一种基数评估算法。这种算法的特征，一般都是数据不存具体的值，而是存用来计算概率的一些相关数据。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><img src="拼多多面试：如何用 Redis 统计独立用户访问量？_files/640 [4].jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;border-width:2px;border-style:solid;border-color:rgb(238,238,238);border-radius:6px"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start">当用户访问网站的时候，我们可以使用<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">PFADD</strong>命令，设置对应的命令，最后我们只要通过<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">PFCOUNT</strong>就能顺利计算出最终的结果，因为这个只是一个概率算法，所以可能存在0.81%的误差。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">优点<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;font-size:16px;text-align:start;white-space:pre-line">：</span></strong>占用内存极小，对于一个key，只需要12kb。对于拼多多这种超多用户的特别适用。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0)">缺点<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;font-size:16px;text-align:start;white-space:pre-line">：</span></strong>查询指定用户的时候，可能会出错，毕竟存的不是具体的数据。总数也存在一定的误差。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;text-align:start">上面就是常见的3种适用Redis统计网站用户访问数的方法了。</p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;letter-spacing:0.544px;color:rgb(62,62,62);font-size:15px;line-height:inherit;text-align:start"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:-apple-system-font,system-ui,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px;white-space:normal;font-size:14px;word-spacing:2px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0);font-size:medium;line-height:normal"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-right:1em;padding-left:1em;display:inline-block;color:rgb(89,89,89);font-size:15px;letter-spacing:0.5px;text-align:center"><span style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding:0.3em 0.5em;display:inline-block;border-radius:0.5em;font-size:13px;color:rgb(255,255,255);background-color:rgb(95,156,239)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">近期热文<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></span> </div><div style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:-1em;padding:20px 10px 10px;border-width:1px;border-style:solid;border-color:rgb(192,200,209);text-align:center;background-color:rgb(239,239,239)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;text-align:left"><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em;list-style-type:square"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;margin-bottom:5px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;text-decoration:underline;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer;font-size:14px"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247487265&amp;idx=1&amp;sn=46029e2d4c630635fd7636141dd90d23&amp;chksm=96cd4f6da1bac67bdf31d2f346e782b00e57a14615f2ea55b2bfbf174643ca76c5d8432240ab&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer;letter-spacing:0.544px" target="_blank">面试官问：MySQL的自增ID用完了，怎么办？</a></span></p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;margin-bottom:5px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;text-decoration:underline;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer;font-size:14px"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247487265&amp;idx=1&amp;sn=46029e2d4c630635fd7636141dd90d23&amp;chksm=96cd4f6da1bac67bdf31d2f346e782b00e57a14615f2ea55b2bfbf174643ca76c5d8432240ab&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer;letter-spacing:0.544px" target="_blank"></a><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247487445&amp;idx=1&amp;sn=2f83d55dcedb359f7df01ac4ca0dc3c2&amp;chksm=96cd4f99a1bac68f1d55e27495b62a8f5d280f32a0c5530402a9842806aed64a961c0b3663c7&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">ArrayList插入1000w条数据之后，我怀疑了jvm...</a></span></p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;margin-bottom:5px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;text-decoration:underline;-webkit-tap-highlight-color:rgba(0,0,0,0);cursor:pointer;font-size:14px"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247487488&amp;idx=1&amp;sn=820c8481f0543984fc0a3652862662ef&amp;chksm=96cd504ca1bad95a483105f35ba104198afde2ab90b7730f17af11e9fe90c5e0d9a617ac964a&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">面试官问：Redis 内存满了怎么办？我想不到！</a></span></p></li></ul></div></div></div></div></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:20px;font-family:-apple-system-font,system-ui,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px;white-space:normal;font-size:14px;word-spacing:2px;text-align:center"><img src="拼多多面试：如何用 Redis 统计独立用户访问量？_files/640 [5].jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;letter-spacing:0.544px;font-size:16px;visibility:visible !important;width:167px !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:5px;margin-bottom:5px;letter-spacing:0.544px;white-space:normal;font-family:&quot;Helvetica Neue&quot;,Helvetica,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;font-size:14px;word-spacing:2px;line-height:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;letter-spacing:0.544px;white-space:pre-line;color:rgb(120,172,254)">最后，分享一份面试宝典</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;letter-spacing:0.544px;white-space:pre-line;color:rgb(61,167,66)">《<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">Java核心知识点整理.pdf</strong>》</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:Avenir,-apple-system-font,微软雅黑,sans-serif;letter-spacing:0.544px;white-space:pre-line;color:rgb(120,172,254)">，覆盖了JVM、锁、高并发、反射、Spring原理、微服务、Zookeeper、数据库、数据结构等等。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;letter-spacing:0.544px;font-size:16px;word-spacing:2px;white-space:pre-line;line-height:30px;color:rgb(74,74,74);font-family:Avenir,-apple-system-font,微软雅黑,sans-serif"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(120,172,254);font-size:14px">获取方式：点“</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:14px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;letter-spacing:0.544px;line-height:30px;color:rgb(61,167,66)"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">在看</strong></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(120,172,254)">”，关注公众号并回复 </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(61,167,66)"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">Java</strong></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(120,172,254)"> 领取，更多内容陆续奉上。</span></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(120,172,254);font-size:15px"></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-family:-apple-system-font,system-ui,&quot;Helvetica Neue&quot;,&quot;PingFang SC&quot;,&quot;Hiragino Sans GB&quot;,&quot;Microsoft YaHei UI&quot;,&quot;Microsoft YaHei&quot;,Arial,sans-serif;letter-spacing:0.544px;white-space:normal;font-size:14px;word-spacing:2px;text-align:right"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;letter-spacing:0.544px;color:rgb(255,41,65);font-family:微软雅黑;font-size:16px">明天见(｡･ω･｡)ﾉ♡</strong></p></pre></div></div><ul style="margin:0;padding:0"></ul><div style="margin:0;padding:0;padding-top:15px"><div style="margin:0;padding:0;display:flex"><span style="margin:0;padding:0;visibility:hidden"><span style="margin:0;padding:0"><span style="margin:0;padding:0"> 在看</span><span style="margin:0;padding:0"></span></span></span></div></div></div></div></div></span>
</div></body></html> 