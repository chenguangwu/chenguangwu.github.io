<html>
<head>
  <title>分享一个自己写的爬虫框架 - 网络爬虫 - ITeye群组</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="7478"/>
<h1>分享一个自己写的爬虫框架 - 网络爬虫 - ITeye群组</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2016/3/15 23:33</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://crawl.group.iteye.com/group/topic/38325"><i>http://crawl.group.iteye.com/group/topic/38325</i></a></td></tr>
</table>
</div>
<br/>

<div><span><br/><div style="font-size: 16px"><div><div style="text-align:center;font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:12px;line-height:1.5;color:black;background:white;"><div style="text-align:center;background:white;"><div style="text-align:left;"><div style="overflow:hidden;"><table style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;"><tbody><tr><td style="font-size:1em;"><div style="font-family:Helvetica, Tahoma, Arial, sans-serif;font-size:14px;line-height:1.8em;"> 
      之前写过一年的垂直爬虫(抓博客什么的)，对于各种重复代码很厌倦，后来参考了据说是最优秀的爬虫框架scrapy，写了一个Java版的框架webmagic。
<br/>看到这个群讨论nutch和Heritrix的比较多，我是比较不喜欢这种动辄要写一本书的工具，webmagic对于小规模抓取足够了。
<br/>webmagic自己用着还是挺顺手的，底层封装了HttpClient、Jsoup、HtmlCleaner，支持多线程，也包括url去重、重试、编码判断、自动抽取什么的。
<br/>希望能帮到各位自己手写爬虫代码，但是厌倦了重复工作的同学，以及为了一些简单需求却要去看一本书来学用Heritrix的同学<img src="分享一个自己写的爬虫框架 - 网络爬虫 - ITeye群组_files/icon_biggrin.gif" type="image/gif" data-filename="icon_biggrin.gif" height="19" style="border:0px;" width="19"/> 。
<br/>代码不长，自认为模块化的也挺清晰，如果对爬虫原理感兴趣的可以看一看。
<br/>以下是使用webmagic抓取某个iteye博客的所有文章，并提取标题和正文的爬虫代码：
<br/><div style="font-family:Monaco, 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', Consolas, 'Courier New', monospace;font-size:12px;width:97%;overflow:auto;margin-left:9px;padding:1px;word-break:break-all;word-wrap:break-word;background-color:transparent;"><div><div style="padding:3px;text-align:left;margin:0px;color:black;font-weight:bold;">Java代码 <div></div> <a href="#" style="color:rgb(0, 102, 0);text-decoration:underline;" title="收藏这段代码"><img src="分享一个自己写的爬虫框架 - 网络爬虫 - ITeye群组_files/Image.png" type="image/png" data-filename="Image.png" alt="收藏代码" height="14" style="border:0px;" width="15"/></a></div></div><ol start="1" style="font-size:1em;line-height:1.4em;margin:0px 0px 1px;padding:2px 0px;border:1px solid rgb(209, 215, 220);list-style:decimal;color:rgb(43, 145, 175);background-color:rgb(255, 255, 255);"><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;"><span style="color:rgb(127, 0, 85);font-weight:bold;">public</span><span style="color:black;"> </span><span style="color:rgb(127, 0, 85);font-weight:bold;">class</span><span style="color:black;"> IteyeBlogProcessor </span><span style="color:rgb(127, 0, 85);font-weight:bold;">implements</span><span style="color:black;"> PageProcessor {  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">  </span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">    <span style="color:rgb(127, 0, 85);font-weight:bold;">private</span><span style="color:black;"> Site site;  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">  </span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">    <span style="color:rgb(100, 100, 100);">@Override</span><span style="color:black;">  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">    <span style="color:rgb(127, 0, 85);font-weight:bold;">public</span><span style="color:black;"> </span><span style="color:rgb(127, 0, 85);font-weight:bold;">void</span><span style="color:black;"> process(Page page) {  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">        page.addTargetRequests(page.getHtml().links().regex(<span style="color:blue;">&quot;.*yanghaoli\\.iteye\\.com/blog/\\d+&quot;</span><span style="color:black;">).all());  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">        page.putField(<span style="color:blue;">&quot;title&quot;</span><span style="color:black;">,page.getHtml().xpath(</span><span style="color:blue;">&quot;//title&quot;</span><span style="color:black;">).toString());  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">        <span style="color:rgb(0, 130, 0);padding:0px;margin:0px;width:auto;border:0px;">//自动抽取正文，用到了readability</span><span style="color:black;">  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">        page.putField(<span style="color:blue;">&quot;content&quot;</span><span style="color:black;">,page.getHtml().smartContent().toString());  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">    }  </span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">  </span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">    <span style="color:rgb(100, 100, 100);">@Override</span><span style="color:black;">  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">    <span style="color:rgb(127, 0, 85);font-weight:bold;">public</span><span style="color:black;"> Site getSite() {  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">        <span style="color:rgb(127, 0, 85);font-weight:bold;">if</span><span style="color:black;"> (site == </span><span style="color:rgb(127, 0, 85);font-weight:bold;">null</span><span style="color:black;">) {  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">            site = Site.me().setDomain(<span style="color:blue;">&quot;yanghaoli.iteye.com&quot;</span><span style="color:black;">).addStartUrl(</span><span style="color:blue;">&quot;http://yanghaoli.iteye.com/&quot;</span><span style="color:black;">).setSleepTime(</span><span style="color:rgb(192, 0, 0);">100</span><span style="color:black;">).setRetryTimes(</span><span style="color:rgb(192, 0, 0);">3</span><span style="color:black;">);  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">        }  </span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">        <span style="color:rgb(127, 0, 85);font-weight:bold;">return</span><span style="color:black;"> site;  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">    }  </span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">  </span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">    <span style="color:rgb(127, 0, 85);font-weight:bold;">public</span><span style="color:black;"> </span><span style="color:rgb(127, 0, 85);font-weight:bold;">static</span><span style="color:black;"> </span><span style="color:rgb(127, 0, 85);font-weight:bold;">void</span><span style="color:black;"> main(String[] args) {  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">        Spider.create(<span style="color:rgb(127, 0, 85);font-weight:bold;">new</span><span style="color:black;"> IteyeBlogProcessor()).thread(</span><span style="color:rgb(192, 0, 0);">5</span><span style="color:black;">).pipeline(</span><span style="color:rgb(127, 0, 85);font-weight:bold;">new</span><span style="color:black;"> FilePipeline(</span><span style="color:blue;">&quot;/data/webmagic/&quot;</span><span style="color:black;">)).run();  </span></span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">    }  </span></li><li style="font-size:1em;padding:0px;margin:0px 0px 0px 38px;border-left-width:1px;border-left-style:solid;border-left-color:rgb(209, 215, 220);padding-left:10px;line-height:18px;background-color:rgb(250, 250, 250);"><span style="color:black;">}  </span></li></ol></div>
<br/>
<br/>已收录到oschina：<a href="http://www.oschina.net/p/webmagic" style="color:rgb(0, 102, 0);text-decoration:underline;" target="_blank">http://www.oschina.net/p/webmagic</a>
<br/>github：<a href="https://github.com/code4craft/webmagic" style="color:rgb(0, 102, 0);text-decoration:underline;" target="_blank">https://github.com/code4craft/webmagic</a>
    </div></td></tr></tbody></table></div></div></div></div></div></div><br/></span>
</div></body></html> 