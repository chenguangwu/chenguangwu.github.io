<html>
<head>
  <title>springboot 使用RestTemplate 使用FastJson处理结果</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="12638"/>
<h1>springboot 使用RestTemplate 使用FastJson处理结果</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/7/26 14:00</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://www.jianshu.com/p/96f02a116dd1"><i>https://www.jianshu.com/p/96f02a116dd1</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="font-family:sans-serif;text-size-adjust:100%;box-sizing:border-box;font-size:10px;-webkit-tap-highlight-color:transparent;"><div style="box-sizing:border-box;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:17px;line-height:1.42857;background-color:rgb(255, 255, 255);min-width:768px;color:rgb(51, 51, 51);"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;">
        <h1 style="font-size:34px;margin:20px 0px 0px;box-sizing:border-box;font-family:-apple-system, &quot;SF UI Display&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-weight:700;line-height:1.3;color:inherit;word-break:break-word;margin-top:20px;margin-bottom:10px;">springboot 使用RestTemplate 使用FastJson处理结果</h1>

        
        <div style="box-sizing:border-box;margin:30px 0px 40px;">
          <a href="https://www.jianshu.com/u/beb7efdd11d0" style="background-color:transparent;box-sizing:border-box;color:rgb(51, 51, 51);text-decoration:none;cursor:pointer;width:48px;height:48px;display:inline-block;vertical-align:middle;">
            <img src="springboot 使用RestTemplate 使用FastJson处理结果_files/96.jpg" type="image/jpeg" data-filename="96.jpg" alt="96" height="46" style="border:1px solid rgb(221, 221, 221);box-sizing:border-box;vertical-align:middle;width:100%;height:100%;border-radius:50%;" width="46"/>
</a>          <div style="box-sizing:border-box;vertical-align:middle;display:inline-block;margin-left:8px;">
            <span style="box-sizing:border-box;margin-right:3px;font-size:16px;vertical-align:middle;"><a href="https://www.jianshu.com/u/beb7efdd11d0" style="background-color:transparent;box-sizing:border-box;color:rgb(51, 51, 51);text-decoration:none;cursor:pointer;">马木木</a></span>
            
            <a style="background-color:rgb(66, 192, 46);box-sizing:border-box;color:rgb(255, 255, 255);text-decoration:none;display:inline-block;margin-bottom:0px;font-weight:400;text-align:center;vertical-align:middle;touch-action:manipulation;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;padding:0px 7px 0px 5px;font-size:12px;line-height:normal;border-radius:40px;user-select:none;border-color:rgb(66, 192, 46);"><i style="box-sizing:border-box;font-size:inherit;font-style:normal;-webkit-font-smoothing:antialiased;font-family:iconfont;font-weight:400;"><span style="font-size:inherit;font-style:normal;font-family:iconfont;font-weight:400;"></span></i><span style="box-sizing:border-box;margin-left:2px;display:inline;">关注</span></a>
            
            <div style="box-sizing:border-box;margin-top:5px;font-size:12px;color:rgb(150, 150, 150);">
              
              
                <span style="box-sizing:border-box;padding-right:5px;" title="">2017.10.30 10:52*</span>
              <span style="box-sizing:border-box;padding-right:5px;">字数 318</span>
            <span style="box-sizing:border-box;padding-right:5px;">阅读 955</span><span style="box-sizing:border-box;padding-right:5px;">评论 0</span><span style="box-sizing:border-box;padding-right:5px;">喜欢 0</span></div>
          </div>
          
        </div>


        
        <div style="box-sizing:border-box;color:rgb(47, 47, 47);font-size:16px;font-weight:400;line-height:1.7;word-break:break-word;">
          <div style="box-sizing:border-box;">
            <h2 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:24px;margin:0px 0px 15px;text-rendering:optimizelegibility;margin-top:20px;margin-bottom:10px;">1. 创建请求工厂（可选）</h2>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;"><span style="box-sizing:border-box;color:rgb(97, 174, 238);">@Bean</span>
    <span style="box-sizing:border-box;color:rgb(97, 174, 238);">@ConditionalOnMissingBean</span>({ClientHttpRequestFactory.class})
    <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">public</span> ClientHttpRequestFactory <span style="box-sizing:border-box;color:rgb(97, 174, 238);">requestFactory</span><span style="box-sizing:border-box;">()</span> </span>{
        SimpleClientHttpRequestFactory factory = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> SimpleClientHttpRequestFactory();
        <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//ms</span>
        factory.setConnectTimeout(<span style="box-sizing:border-box;color:rgb(209, 154, 102);">15000</span>);
        factory.setReadTimeout(<span style="box-sizing:border-box;color:rgb(209, 154, 102);">15000</span>);
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> factory;
    }
</code></pre>
<blockquote style="box-sizing:border-box;padding:20px;margin:0px 0px 20px;font-size:16px;border-left:6px solid rgb(180, 180, 180);margin-bottom:25px;background-color:rgb(247, 247, 247);font-weight:400;line-height:30px;word-break:break-word;">
<p style="box-sizing:border-box;margin:0px 0px 25px;margin-bottom:0px;word-break:break-word;font-size:16px;font-weight:400;line-height:1.7;">为啥是可选的呢 因为你即使不创建 springboot在检测为空时也会为你创建一个<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">SimpleClientHttpRequestFactory</code> 类型的工程，当然如果你想使用其他的技术那就要指定了<br style="box-sizing:border-box;"/>
比如httpclient</p>
</blockquote>
<div style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;">
<div style="box-sizing:border-box;z-index:100;position:relative;background-color:transparent;transition:background-color 0.1s linear 0s;margin:0px auto;max-width:700px;max-height:297px;">
<div style="box-sizing:border-box;z-index:50;padding-bottom:39.71%;"></div>
<div style="box-sizing:border-box;position:absolute;top:0px;left:0px;width:100%;height:100%;overflow:hidden;"><img src="springboot 使用RestTemplate 使用FastJson处理结果_files/webp.webp" type="image/webp" data-filename="webp.webp" height="278" style="border:0px;box-sizing:border-box;vertical-align:middle;max-width:100%;display:block;transition:all 0.15s linear 0s;z-index:100;filter:blur(0px);opacity:1;height:auto;cursor:zoom-in;" width="700"/></div>
</div>
<div style="box-sizing:border-box;min-width:20%;max-width:80%;min-height:22px;display:inline-block;padding:10px;margin:0px auto;border-bottom:1px solid rgb(217, 217, 217);font-size:14px;color:rgb(150, 150, 150);line-height:1.7;">图片.png</div>
</div>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">当然肯定是需要其他的依赖包的</p>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:24px;margin:0px 0px 15px;text-rendering:optimizelegibility;margin-top:20px;margin-bottom:10px;">2. 实例化一个RestTemplate</h2>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">这个是我我们直接使用的请求类<br style="box-sizing:border-box;"/>
先上代码</p>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;">@Bean
    @ConditionalOnMissingBean({RestTemplate.class})
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">public</span> RestTemplate restTemplate(ClientHttpRequestFactory factory) {
        RestTemplate restTemplate = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> RestTemplate(factory);

        <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//换上fastjson</span>
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">List</span>&lt;HttpMessageConverter<span style="box-sizing:border-box;color:rgb(97, 174, 238);">&lt;?</span>&gt;&gt; httpMessageConverterList= restTemplate.getMessageConverters();
        Iterator&lt;HttpMessageConverter<span style="box-sizing:border-box;color:rgb(97, 174, 238);">&lt;?</span>&gt;&gt; iterator=httpMessageConverterList.iterator();
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span>(iterator.hasNext()){
            HttpMessageConverter<span style="box-sizing:border-box;color:rgb(97, 174, 238);">&lt;?</span>&gt; converter=iterator.next();
            <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//原有的String是ISO-8859-1编码 去掉</span>
            <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span>(converter <span style="box-sizing:border-box;color:rgb(198, 120, 221);">instanceof</span> StringHttpMessageConverter){
                iterator.remove();
            }

            <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//由于系统中默认有jackson 在转换json时自动会启用  但是我们不想使用它 可以直接移除或者将fastjson放在首位</span>
            <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">/*if(converter instanceof GsonHttpMessageConverter || converter instanceof MappingJackson2HttpMessageConverter){
                iterator.remove();
            }*/</span>

        }
        httpMessageConverterList.add(<span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> StringHttpMessageConverter(Charset.forName(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;utf-8&quot;</span>)));
        FastJsonHttpMessageConverter fastJsonHttpMessageConverter = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> FastJsonHttpMessageConverter();
        FastJsonConfig fastJsonConfig = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> FastJsonConfig();
        fastJsonConfig.setSerializerFeatures(
                SerializerFeature.WriteMapNullValue,
                SerializerFeature.WriteNullStringAsEmpty,
                SerializerFeature.WriteNullListAsEmpty,
                SerializerFeature.DisableCircularReferenceDetect);

        fastJsonHttpMessageConverter.setFastJsonConfig(fastJsonConfig);
        httpMessageConverterList.add(<span style="box-sizing:border-box;color:rgb(209, 154, 102);">0</span>,fastJsonHttpMessageConverter);

        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> restTemplate;

    }
</code></pre>
<blockquote style="box-sizing:border-box;padding:20px;margin:0px 0px 20px;font-size:16px;border-left:6px solid rgb(180, 180, 180);margin-bottom:25px;background-color:rgb(247, 247, 247);font-weight:400;line-height:30px;word-break:break-word;">
<p style="box-sizing:border-box;margin:0px 0px 25px;margin-bottom:0px;word-break:break-word;font-size:16px;font-weight:400;line-height:1.7;">创建<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">RestTemplate</code>最简单的方式就是注入一个<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">RestTemplateBuilder</code> 直接<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">.build()</code>即可 但是这样我们就无法定制了 还要使用fastjson呢</p>
</blockquote>
<blockquote style="box-sizing:border-box;padding:20px;margin:0px 0px 20px;font-size:16px;border-left:6px solid rgb(180, 180, 180);margin-bottom:25px;background-color:rgb(247, 247, 247);font-weight:400;line-height:30px;word-break:break-word;">
<p style="box-sizing:border-box;margin:0px 0px 25px;margin-bottom:0px;word-break:break-word;font-size:16px;font-weight:400;line-height:1.7;">在阅读源码时我们发现转化列表中有个<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">StringHttpMessageConverter</code>对象它的默认编码是“ISO-8859-1”,顺手给换个“UTF-8”的吧</p>
</blockquote>
<blockquote style="box-sizing:border-box;padding:20px;margin:0px 0px 20px;font-size:16px;border-left:6px solid rgb(180, 180, 180);margin-bottom:25px;background-color:rgb(247, 247, 247);font-weight:400;line-height:30px;word-break:break-word;">
<p style="box-sizing:border-box;margin:0px 0px 25px;margin-bottom:0px;word-break:break-word;font-size:16px;font-weight:400;line-height:1.7;">由于springboot中集成了jackson所以里边队友json的处理也都是jackson,但是本人不太喜欢用Jackson，那么咱就换成国产的<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Fastjson</code>，这里主要是要将<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">GsonHttpMessageConverter</code>和<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">FastJsonHttpMessageConverter</code>两个转换器去除然后加上新的<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">FastJsonHttpMessageConverter</code>,在源码中我们发现一旦有适合处理的转换器，就不会再找下一个了，这样我们就可以直接将自定义的<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">FastJsonHttpMessageConverter</code>放在列表的首位就行了</p>
</blockquote>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">完整源码如下</p>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">package</span> com.marry.dezhou.fg.config;

<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> com.alibaba.fastjson.serializer.SerializerFeature;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> com.alibaba.fastjson.support.config.FastJsonConfig;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.beans.factory.annotation.Autowired;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.boot.web.client.RestTemplateBuilder;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.context.annotation.Bean;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.context.annotation.Configuration;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.http.client.ClientHttpRequestFactory;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.http.client.SimpleClientHttpRequestFactory;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.http.converter.HttpMessageConverter;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.http.converter.StringHttpMessageConverter;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> org.springframework.web.client.RestTemplate;

<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> java.nio.charset.Charset;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> java.util.Iterator;
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">import</span> java.util.List;

<span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">/**
 * <span style="box-sizing:border-box;color:rgb(198, 120, 221);">@author</span> ml
 * <span style="box-sizing:border-box;color:rgb(198, 120, 221);">@create</span> 2017-10-27--15:53
 */</span>
<span style="box-sizing:border-box;color:rgb(97, 174, 238);">@Configuration</span>
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">public</span> <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">class</span> <span style="box-sizing:border-box;color:rgb(230, 192, 123);">RestConfiguration</span> </span>{

    <span style="box-sizing:border-box;color:rgb(97, 174, 238);">@Autowired</span>
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">private</span> RestTemplateBuilder builder;

    <span style="box-sizing:border-box;color:rgb(97, 174, 238);">@Bean</span>
    <span style="box-sizing:border-box;color:rgb(97, 174, 238);">@ConditionalOnMissingBean</span>({RestTemplate.class})
    <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">public</span> RestTemplate <span style="box-sizing:border-box;color:rgb(97, 174, 238);">restTemplate</span><span style="box-sizing:border-box;">(ClientHttpRequestFactory factory)</span> </span>{
        <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//return builder.build();</span>
        RestTemplate restTemplate = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> RestTemplate(factory);

        <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//换上fastjson</span>
        List&lt;HttpMessageConverter&lt;?&gt;&gt; httpMessageConverterList= restTemplate.getMessageConverters();
        Iterator&lt;HttpMessageConverter&lt;?&gt;&gt; iterator=httpMessageConverterList.iterator();
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span>(iterator.hasNext()){
            HttpMessageConverter&lt;?&gt; converter=iterator.next();
            <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//原有的String是ISO-8859-1编码 去掉</span>
            <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span>(converter <span style="box-sizing:border-box;color:rgb(198, 120, 221);">instanceof</span> StringHttpMessageConverter){
                iterator.remove();
            }

            <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//由于系统中默认有jackson 在转换json时自动会启用  但是我们不想使用它 可以直接移除或者将fastjson放在首位</span>
            <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">/*if(converter instanceof GsonHttpMessageConverter || converter instanceof MappingJackson2HttpMessageConverter){
                iterator.remove();
            }*/</span>

        }
        httpMessageConverterList.add(<span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> StringHttpMessageConverter(Charset.forName(<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;utf-8&quot;</span>)));
        FastJsonHttpMessageConverter fastJsonHttpMessageConverter = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> FastJsonHttpMessageConverter();
        FastJsonConfig fastJsonConfig = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> FastJsonConfig();
        fastJsonConfig.setSerializerFeatures(
                SerializerFeature.WriteMapNullValue,
                SerializerFeature.WriteNullStringAsEmpty,
                SerializerFeature.WriteNullListAsEmpty,
                SerializerFeature.DisableCircularReferenceDetect);

        fastJsonHttpMessageConverter.setFastJsonConfig(fastJsonConfig);
        httpMessageConverterList.add(<span style="box-sizing:border-box;color:rgb(209, 154, 102);">0</span>,fastJsonHttpMessageConverter);

        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> restTemplate;

    }

    <span style="box-sizing:border-box;color:rgb(97, 174, 238);">@Bean</span>
    <span style="box-sizing:border-box;color:rgb(97, 174, 238);">@ConditionalOnMissingBean</span>({ClientHttpRequestFactory.class})
    <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">public</span> ClientHttpRequestFactory <span style="box-sizing:border-box;color:rgb(97, 174, 238);">requestFactory</span><span style="box-sizing:border-box;">()</span> </span>{
        SimpleClientHttpRequestFactory factory = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> SimpleClientHttpRequestFactory();
        <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//ms</span>
        factory.setConnectTimeout(<span style="box-sizing:border-box;color:rgb(209, 154, 102);">15000</span>);
        factory.setReadTimeout(<span style="box-sizing:border-box;color:rgb(209, 154, 102);">15000</span>);
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> factory;
    }
}

</code></pre>

          </div>
        </div>
    </div></div></div></div></div></div><br/></div></span>
</div></body></html> 