<html>
<head>
  <title>阿里的STORM——JSTORM - 不可替代的毛线 - 博客园</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="9423"/>
<h1>阿里的STORM——JSTORM - 不可替代的毛线 - 博客园</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/7/6 16:36</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://www.cnblogs.com/cn-leodream/p/6497277.html"><i>https://www.cnblogs.com/cn-leodream/p/6497277.html</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;position: relative;"><div><div style="font-family:&quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(0, 0, 0);background:url(images/body_bg.jpg) center top no-repeat rgb(0, 0, 0);font-size:14px;"><div><div style="text-align:left;background:rgb(255, 255, 255);"><div style="text-overflow:ellipsis;overflow:hidden;word-break:break-all;background:rgb(255, 255, 255);"><div><div><div><div>
		<h1 style="margin:0px;padding:0px 100px 10px 20px;clear:both;border-left:5px solid rgb(31, 166, 230);font-size:130%;font-weight:bold;border-bottom:1px solid rgb(153, 153, 153);line-height:1.5em;padding-left:5px;">
			<a href="https://www.cnblogs.com/cn-leodream/p/6497277.html" style="margin:0px;padding:0px;text-decoration:none;color:rgb(28, 119, 145);">阿里的STORM——JSTORM</a>
		</h1>
		<div style="margin:0px;padding:0px;clear:both;"></div>
		<div style="margin:0px;padding:5px 2px 5px 5px;line-height:1.8;color:rgb(0, 0, 0);border-bottom:1px solid rgb(0, 0, 0);">
			<div style="margin:0px;padding:0px;margin-bottom:20px;word-break:break-word;"><p style="padding:0px;margin:10px auto;text-indent:0px;">看介绍文档貌似挺好：<br style="margin:0px;padding:0px;"/><a href="https://github.com/alibaba/jstorm" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">https://github.com/alibaba/jstorm</a></p>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="162" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="392"></img></p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">阿里拥有自己的实时计算引擎</p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">类似于hadoop 中的MR</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">开源storm响应太慢</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">开源社区的速度完全跟不上Ali的需求</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">降低未来运维成本</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">提供更多技术支持，加快内部业务响应速度</p>


</li>


</ol>
<p style="padding:0px;margin:10px auto;text-indent:0px;">现有Storm无法满足一些需求</p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">现有storm调度太简单粗暴，无法定制化</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">Storm 任务分配不平衡</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">RPC OOM一直没有解决</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">监控太简单</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">对ZK 访问频繁</p>


</li>


</ol>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">JStorm</strong><strong style="margin:0px;padding:0px;">相比Storm更稳定</strong></p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">Nimbus 实现HA：当一台nimbus挂了，自动热切到备份nimbus</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">原生Storm RPC：Zeromq 使用堆外内存，导致OS 内存不够，Netty 导致OOM；JStorm底层RPC 采用netty + disruptor保证发送速度和接受速度是匹配的</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">新上线的任务不会冲击老的任务：新调度从cpu，memory，disk，net 四个角度对任务进行分配，已经分配好的新任务，无需去抢占老任务的cpu，memory，disk和net</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">Supervisor主线</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">Spout/Bolt 的open/prepar</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">所有IO, 序列化，反序列化</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">减少对ZK的访问量：去掉大量无用的watch；task的心跳时间延长一倍；Task心跳检测无需全ZK扫描。</p>


</li>


</ol>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">JStorm</strong><strong style="margin:0px;padding:0px;">相比Storm调度更强大</strong></p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">彻底解决了storm 任务分配不均衡问题</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">从4个维度进行任务分配：CPU、Memory、Disk、Net</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">默认一个task，一个cpu slot。当task消耗更多的cpu时，可以申请更多cpu slot</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">默认一个task，一个memory slot。当task需要更多内存时，可以申请更多内存slot</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">默认task，不申请disk slot。当task 磁盘IO较重时，可以申请disk slot</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">可以强制某个component的task 运行在不同的节点上</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">可以强制topology运行在单独一个节点上</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">可以自定义任务分配，提前预约任务分配到哪台机器上，哪个端口，多少个cpu slot，多少内存，是否申请磁盘</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">可以预约上一次成功运行时的任务分配，上次task分配了什么资源，这次还是使用这些资源</p>


</li>


</ol>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">JStorm</strong><strong style="margin:0px;padding:0px;">相比Storm性能更好</strong></p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">JStorm 0.9.0 性能非常的好，使用netty时单worker 发送最大速度为11万QPS，使用zeromq时，最大速度为12万QPS。</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">JStorm 0.9.0 在使用Netty的情况下，比Storm 0.9.0 使用netty情况下，快10%， 并且JStorm netty是稳定的而Storm 的Netty是不稳定的</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">在使用ZeroMQ的情况下， JStorm 0.9.0 比Storm 0.9.0 快30%</p>


</li>


</ul>
<p style="padding:0px;margin:10px auto;text-indent:0px;">性能提升的原因：</p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">Zeromq 减少一次内存拷贝</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">增加反序列化线程</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">重写采样代码，大幅减少采样影响</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">优化ack代码</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">优化缓冲map性能</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">Java 比clojure更底层</p>


</li>


</ol>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">JStorm</strong><strong style="margin:0px;padding:0px;">的其他优化点</strong></p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">资源隔离。不同部门，使用不同的组名，每个组有自己的Quato；不同组的资源隔离；采用cgroups 硬隔离</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">Classloader。解决应用的类和Jstorm的类发生冲突，应用的类在自己的类空间中</p>


</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">Task 内部异步化。Worker 内部全流水线模式，Spout nextTuple和ack/fail运行在不同线程</p>


</li>


</ol>
<p style="padding:0px;margin:10px auto;text-indent:0px;"> 具体如何实现，请参考本ID的的博文系列  【jstorm-源码解析】</p>
<div style="margin:0px;padding:0px;"><hr style="margin:0px;padding:0px;"/></div>
<div style="margin:0px;padding:0px;">
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"> </h1>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">概叙 &amp; 应用场景</h1>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">JStorm 是一个分布式实时计算引擎。</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">JStorm 是一个类似Hadoop MapReduce的系统， 用户按照指定的接口实现一个任务，然后将这个任务递交给JStorm系统，Jstorm将这个任务跑起来，并且按7 * 24小时运行起来，一旦中间一个worker 发生意外故障， 调度器立即分配一个新的worker替换这个失效的worker。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">因此，从应用的角度，JStorm 应用是一种遵守某种编程规范的分布式应用。从系统角度， JStorm一套类似MapReduce的调度系统。 从数据的角度， 是一套基于流水线的消息处理机制。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">实时计算现在是大数据领域中最火爆的一个方向，因为人们对数据的要求越来越高，实时性要求也越来越快，传统的Hadoop Map Reduce，逐渐满足不了需求，因此在这个领域需求不断。</p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E6%A6%82%E5%8F%99-&amp;-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF#%E4%BC%98%E7%82%B9" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>优点</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">在Storm和JStorm出现以前，市面上出现很多实时计算引擎，但自storm和JStorm出现后，基本上可以说一统江湖： 究其优点：</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">开发非常迅速， 接口简单，容易上手，只要遵守Topology，Spout， Bolt的编程规范即可开发出一个扩展性极好的应用，底层rpc，worker之间冗余，数据分流之类的动作完全不用考虑。</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">扩展性极好， 当一级处理单元速度，直接配置一下并发数，即可线性扩展性能</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">健壮， 当worker失效或机器出现故障时， 自动分配新的worker替换失效worker</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">数据准确性， 可以采用Acker机制，保证数据不丢失。 如果对精度有更多一步要求，采用事务机制，保证数据准确。</li>


</ul>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E6%A6%82%E5%8F%99-&amp;-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>应用场景</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">JStorm处理数据的方式是基于消息的流水线处理， 因此特别<strong style="margin:0px;padding:0px;">适合无状态计算</strong>，也就是计算单元的依赖的数据全部在接受的消息中可以找到， 并且最好一个数据流不依赖另外一个数据流。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">因此，常常用于</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">日志分析，从日志中分析出特定的数据，并将分析的结果存入外部存储器如数据库。目前，主流日志分析技术就使用JStorm或Storm</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">管道系统， 将一个数据从一个系统传输到另外一个系统， 比如将数据库同步到Hadoop</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">消息转化器， 将接受到的消息按照某种格式进行转化，存储到另外一个系统如消息中间件</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">统计分析器， 从日志或消息中，提炼出某个字段，然后做count或sum计算，最后将统计值存入外部存储器。中间处理过程可能更复杂。</li>


</ul>


</div>


<small style="margin:0px;padding:0px;"><small style="margin:0px;padding:0px;"> </small></small></div>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">如何安装</h1>
<div style="margin:0px;padding:0px;">
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">安装步骤</h1>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">从<a href="https://github.com/alibaba/jstorm/wiki/Downloads" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">Downloads</a>下载relase包</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">搭建Zookeeper集群</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">安装Python 2.6</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">安装Java</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">安装zeromq</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">安装Jzmq</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">配置$JSTORM_HOME/conf/storm.yaml</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">搭建web ui</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">启动JStorm集群</li>


</ul>
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85#%E6%90%AD%E5%BB%BAzookeeper%E9%9B%86%E7%BE%A4" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>搭建Zookeeper集群</h2>
<p style="padding:0px;margin:10px auto;text-indent:0px;">本处不细描叙Zookeeper安装步骤</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">安装步骤麻烦参考 <a href="http://www.cnblogs.com/linjiqin/archive/2013/03/16/2962597.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">”zookeeper 安装步骤“</a></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">zookeeper配置麻烦参考 <a href="http://blog.csdn.net/hi_kevin/article/details/7089358" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">“zookeeper 配置介绍”</a></li>


</ul>
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85#%E6%90%AD%E5%BB%BAjstorm%E9%9B%86%E7%BE%A4" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>搭建JStorm集群</h2>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85#%E5%AE%89%E8%A3%85python-26" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>安装python 2.6</h3>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">如果当前系统提供python，可以不用安装python</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">自己可以参考 <a href="http://weixiaolu.iteye.com/blog/1617440" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">python</a></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">也可以使用<a href="https://github.com/utahta/pythonbrew" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">https://github.com/utahta/pythonbrew</a> 来安装python &gt; curl -kL<a href="http://xrl.us/pythonbrewinstall" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">http://xrl.us/pythonbrewinstall</a> | bash</li>


</ul>
<blockquote style="margin:0px;background:none;border:2px solid rgb(239, 239, 239);margin-top:10px;margin-bottom:10px;padding:5px 15px;min-height:35px;line-height:1.6;color:rgb(51, 51, 51);">
<p style="padding:0px;margin:10px auto;text-indent:0px;"><a href="https://github.com/alibaba/jstorm/wiki/-s-%24HOME-.pythonbrew-etc-bashrc" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">-s $HOME/.pythonbrew/etc/bashrc</a> &amp;&amp; source $HOME/.pythonbrew/etc/bashrc</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">pythonbrew install 2.6.7</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">pythonbrew switch 2.6.7</p>


</blockquote>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85#%E5%AE%89%E8%A3%85java" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>安装java</h3>
<p style="padding:0px;margin:10px auto;text-indent:0px;">注意，如果当前系统是64位系统，则需要下载java 64位，如果是32为系统，则下载32位java</p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85#%E5%AE%89%E8%A3%85zeromq%E5%A6%82%E6%9E%9C%E4%B8%8D%E4%BD%BF%E7%94%A8zeromq-%E5%8F%AF%E4%BB%A5%E4%B8%8D%E5%AE%89%E8%A3%85zeromq" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>安装zeromq(如果不使用zeromq， 可以不安装zeromq)</h3>
<blockquote style="margin:0px;background:none;border:2px solid rgb(239, 239, 239);margin-top:10px;margin-bottom:10px;padding:5px 15px;min-height:35px;line-height:1.6;color:rgb(51, 51, 51);">
<p style="padding:0px;margin:10px auto;text-indent:0px;">wget <a href="http://download.zeromq.org/zeromq-2.1.7.tar.gz" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">http://download.zeromq.org/zeromq-2.1.7.tar.gz</a></p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">tar zxf zeromq-2.1.7.tar.gz</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">cd zeromq-2.1.7</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">./configure</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">make</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">sudo make install</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">sudo ldconfig</p>


</blockquote>
<p style="padding:0px;margin:10px auto;text-indent:0px;">如果没有root权限，或当前用户无sudo权限时，执行 “ ./configure --prefix=/home/xxxxx” 替换 “./configure”, 其中/home/xxxx 为安装目标目录</p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85#%E5%AE%89%E8%A3%85jzmq%E5%A6%82%E6%9E%9C%E4%B8%8D%E4%BD%BF%E7%94%A8zeromq-%E5%8F%AF%E4%BB%A5%E4%B8%8D%E5%AE%89%E8%A3%85jzmq" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>安装jzmq(如果不使用zeromq， 可以不安装jzmq)</h3>
<blockquote style="margin:0px;background:none;border:2px solid rgb(239, 239, 239);margin-top:10px;margin-bottom:10px;padding:5px 15px;min-height:35px;line-height:1.6;color:rgb(51, 51, 51);">
<p style="padding:0px;margin:10px auto;text-indent:0px;">git clone git://github.com/nathanmarz/jzmq.git</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">cd jzmq</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">./autogen.sh</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">./configure</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">make</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">make install</p>


</blockquote>
<p style="padding:0px;margin:10px auto;text-indent:0px;">如果没有root权限，或当前用户无sudo权限时，执行 “ ./configure --prefix=/home/xxxx --with-zeromq=/home/xxxx” 替换 “./configure”, 其中/home/xxxx 为安装目标目录</p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85#%E5%AE%89%E8%A3%85jstorm" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>安装JStorm</h3>
<p style="padding:0px;margin:10px auto;text-indent:0px;">假设以jstorm-0.9.3.zip为例</p>
<blockquote style="margin:0px;background:none;border:2px solid rgb(239, 239, 239);margin-top:10px;margin-bottom:10px;padding:5px 15px;min-height:35px;line-height:1.6;color:rgb(51, 51, 51);">
<p style="padding:0px;margin:10px auto;text-indent:0px;">unzip jstorm-0.9.3.zip</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">vi ~/.bashrc</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">export JSTORM_HOME=/XXXXX/XXXX</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">export PATH=$PATH:$JSTORM_HOME/bin</p>


</blockquote>
<p style="padding:0px;margin:10px auto;text-indent:0px;">配置$JSTORM_HOME/conf/storm.yaml</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">配置项：</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">storm.zookeeper.servers: 表示zookeeper 的地址，</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">nimbus.host: 表示nimbus的地址</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">storm.zookeeper.root: 表示jstorm在zookeeper中的根目录，当多个JStorm共享一个ZOOKEEPER时，需要设置该选项，默认即为“/jstorm”</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">storm.local.dir: 表示jstorm临时数据存放目录，需要保证jstorm程序对该目录有写权限</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">java.library.path: zeromq 和java zeromq library的安装目录，默认&quot;/usr/local/lib:/opt/local/lib:/usr/lib&quot;</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">supervisor.slots.ports: 表示supervisor 提供的端口slot列表，注意不要和其他端口发生冲突，默认是68xx，而storm的是67xx</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">supervisor.disk.slot： 表示提供数据目录，当一台机器有多块磁盘时，可以提供磁盘读写slot，方便有重IO操作的应用。</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">topology.enable.classloader: false, 默认关闭classloader，如果应用的jar与jstorm的依赖的jar发生冲突，比如应用使用thrift9，但jstorm使用thrift7时，就需要打开classloader</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">nimbus.groupfile.path: 如果需要做资源隔离，比如数据仓库使用多少资源，技术部使用多少资源，无线部门使用多少资源时，就需要打开分组功能， 设置一个配置文件的绝对路径，改配置文件如源码中group_file.ini所示</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">storm.local.dir: jstorm使用的本地临时目录，如果一台机器同时运行storm和jstorm的话， 则不要共用一个目录，必须将二者分离开</li>


</ul>
<p style="padding:0px;margin:10px auto;text-indent:0px;">在提交jar的节点上执行:</p>
<div style="margin:0px;padding:0px;">
<div style="margin:0px;padding:0px;">#mkdir ~/.jstorm</div>
<div style="margin:0px;padding:0px;">#cp -f $JSTORM_HOME/conf/storm.yaml ~/.jstorm</div>


</div>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85#%E5%AE%89%E8%A3%85jstorm-web-ui" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>安装JStorm web ui</h3>
<p style="padding:0px;margin:10px auto;text-indent:0px;">必须使用tomcat 7.0 或以上版本， 注意不要忘记拷贝 <strong style="margin:0px;padding:0px;">~/.jstorm/storm.yaml</strong></p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">web ui 可以和nimbus不在同一个节点</p>
<blockquote style="margin:0px;background:none;border:2px solid rgb(239, 239, 239);margin-top:10px;margin-bottom:10px;padding:5px 15px;min-height:35px;line-height:1.6;color:rgb(51, 51, 51);">
<p style="padding:0px;margin:10px auto;text-indent:0px;">mkdir ~/.jstorm</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">cp -f $JSTORM_HOME/conf/storm.yaml ~/.jstorm</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">下载tomcat 7.x （以apache-tomcat-7.0.37 为例）</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">tar -xzf apache-tomcat-7.0.37.tar.gz</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">cd apache-tomcat-7.0.37</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">cd webapps</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">cp $JSTORM_HOME/jstorm-ui-0.9.3.war ./</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">mv ROOT ROOT.old</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">ln -s jstorm-ui-0.9.3 ROOT</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">cd ../bin</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">./startup.sh</p>


</blockquote>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85#%E5%90%AF%E5%8A%A8jstorm" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>启动JStorm</h3>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">在nimbus 节点上执行 “nohup jstorm nimbus &amp;”, 查看$JSTORM_HOME/logs/nimbus.log检查有无错误</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">在supervisor节点上执行 “nohup jstorm supervisor &amp;”, 查看$JSTORM_HOME/logs/supervisor.log检查有无错误 <br style="margin:0px;padding:0px;"/><br style="margin:0px;padding:0px;"/></li>


</ul>
<div style="margin:0px;padding:0px;">
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">基本概念</h1>


</div>
<div style="margin:0px;padding:0px;">
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">流</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">在JStorm中有对于流stream的抽象，流是一个不间断的无界的连续tuple，注意JStorm在建模事件流时，把流中的事件抽象为tuple即元组，后面会解释JStorm中如何使用tuple。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="31" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="69"></img></p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5#spoutbolt" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>Spout/Bolt</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">JStorm认为每个stream都有一个stream源，也就是原始元组的源头，所以它将这个源头抽象为spout，spout可能是连接消息中间件（如MetaQ， Kafka， TBNotify等），并不断发出消息，也可能是从某个队列中不断读取队列元素并装配为tuple发射。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">有了源头即spout也就是有了stream，那么该如何处理stream内的tuple呢，同样的思想JStorm将tuple的中间处理过程抽象为Bolt，bolt可以消费任意数量的输入流，只要将流方向导向该bolt，同时它也可以发送新的流给其他bolt使用，这样一来，只要打开特定的spout（管口）再将spout中流出的tuple导向特定的bolt，又bolt对导入的流做处理后再导向其他bolt或者目的地。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">我们可以认为spout就是一个一个的水龙头，并且每个水龙头里流出的水是不同的，我们想拿到哪种水就拧开哪个水龙头，然后使用管道将水龙头的水导向到一个水处理器（bolt），水处理器处理后再使用管道导向另一个处理器或者存入容器中。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="31" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="80"></img></p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5#topology" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>Topology</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="31" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="75"></img></p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">对应上文的介绍，我们可以很容易的理解这幅图，这是一张有向无环图，JStorm将这个图抽象为Topology即拓扑（的确，拓扑结构是有向无环的），拓扑是Jstorm中最高层次的一个抽象概念，它可以被提交到Jstorm集群执行，一个拓扑就是一个数据流转换图，图中每个节点是一个spout或者bolt，图中的边表示bolt订阅了哪些流，当spout或者bolt发送元组到流时，它就发送元组到每个订阅了该流的bolt（这就意味着不需要我们手工拉管道，只要预先订阅，spout就会将流发到适当bolt上）。 插个位置说下Jstorm的topology实现，为了做实时计算，我们需要设计一个拓扑图，并实现其中的Bolt处理细节，JStorm中拓扑定义仅仅是一些Thrift结构体，这样一来我们就可以使用其他语言来创建和提交拓扑。</p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5#tuple" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>Tuple</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">JStorm将流中数据抽象为tuple，一个tuple就是一个值列表value list，list中的每个value都有一个name，并且该value可以是基本类型，字符类型，字节数组等，当然也可以是其他可序列化的类型。拓扑的每个节点都要说明它所发射出的元组的字段的name，其他节点只需要订阅该name就可以接收处理。</p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5#workertask" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>Worker/Task</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">Worker和Task是JStorm中任务的执行单元， 一个worker表示一个进程，一个task表示一个线程， 一个worker可以运行多个task。</p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5#%E8%B5%84%E6%BA%90slot" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>资源slot</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">在JStorm中，资源类型分为4种， CPU, Memory，Disk， Port， 不再局限于Storm的port。 即一个supervisor可以提供多少个CPU slot，多少个Memory slot， 多少个Disk slot， 多少个Port slot</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">一个worker就消耗一个Port slot， 默认一个task会消耗一个CPU slot和一个Memory slot</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">当task执行任务较重时，可以申请更多的CPU slot，</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">当task需要更多内存时，可以申请更多的内存slot，</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">当task 磁盘读写较多时，可以申请磁盘slot，则该磁盘slot给该task独享。 </li>


</ul>
<div style="margin:0px;padding:0px;">
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">应用例子</h1>


</div>


</div>
<div style="margin:0px;padding:0px;">
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">最简单的JStorm例子分为4个步骤：</h1>
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%BA%94%E7%94%A8%E4%BE%8B%E5%AD%90#%E7%94%9F%E6%88%90topology" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>生成Topology</h2>
<div style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">Map conf <span style="margin:0px;padding:0px;">= <span style="margin:0px;padding:0px;">new <span style="margin:0px;padding:0px;">HashMp();<span style="margin:0px;padding:0px;">//topology所有自定义的配置均放入这个Map<span style="margin:0px;padding:0px;">TopologyBuilder builder <span style="margin:0px;padding:0px;">= <span style="margin:0px;padding:0px;">new <span style="margin:0px;padding:0px;">TopologyBuilder();<span style="margin:0px;padding:0px;">//创建topology的生成器<span style="margin:0px;padding:0px;">int spoutParal <span style="margin:0px;padding:0px;">= get(<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">&quot;spout.parallel<span style="margin:0px;padding:0px;">&quot;, <span style="margin:0px;padding:0px;">1);<span style="margin:0px;padding:0px;">//获取spout的并发设置<span style="margin:0px;padding:0px;">SpoutDeclarer spout <span style="margin:0px;padding:0px;">= builder<span style="margin:0px;padding:0px;">.setSpout(<span style="margin:0px;padding:0px;">SequenceTopologyDef<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">.SEQUENCE_SPOUT_NAME</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
<div style="margin:0px;padding:0px;">,</div>
<div style="margin:0px;padding:0px;"> </div>


<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">new <span style="margin:0px;padding:0px;">SequenceSpout(), spoutParal);<span style="margin:0px;padding:0px;">//创建Spout， 其中new SequenceSpout() 为真正spout对象，SequenceTopologyDef.SEQUENCE_SPOUT_NAME 为spout的名字，注意名字中不要含有空格<span style="margin:0px;padding:0px;">int boltParal <span style="margin:0px;padding:0px;">= get(<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">&quot;bolt.parallel<span style="margin:0px;padding:0px;">&quot;, <span style="margin:0px;padding:0px;">1);<span style="margin:0px;padding:0px;">//获取bolt的并发设置<span style="margin:0px;padding:0px;">BoltDeclarer totalBolt <span style="margin:0px;padding:0px;">= builder<span style="margin:0px;padding:0px;">.setBolt(<span style="margin:0px;padding:0px;">SequenceTopologyDef<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">.TOTAL_BOLT_NAME, <span style="margin:0px;padding:0px;">new <span style="margin:0px;padding:0px;">TotalCount(),</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
<div style="margin:0px;padding:0px;">                boltParal)</div>


<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">.shuffleGrouping(<span style="margin:0px;padding:0px;">SequenceTopologyDef<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">.SEQUENCE_SPOUT_NAME);<span style="margin:0px;padding:0px;">//创建bolt， SequenceTopologyDef.TOTAL_BOLT_NAME 为bolt名字，TotalCount 为bolt对象，boltParal为bolt并发数，<span style="margin:0px;padding:0px;">//shuffleGrouping（SequenceTopologyDef.SEQUENCE_SPOUT_NAME）， <span style="margin:0px;padding:0px;">//表示接收SequenceTopologyDef.SEQUENCE_SPOUT_NAME的数据，并且以shuffle方式，<span style="margin:0px;padding:0px;">//即每个spout随机轮询发送tuple到下一级bolt中<span style="margin:0px;padding:0px;">int ackerParal <span style="margin:0px;padding:0px;">= get(<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">&quot;acker.parallel<span style="margin:0px;padding:0px;">&quot;, <span style="margin:0px;padding:0px;">1);<span style="margin:0px;padding:0px;">Config<span style="margin:0px;padding:0px;">.setNumAckers(conf, ackerParal);<span style="margin:0px;padding:0px;">//设置表示acker的并发数<span style="margin:0px;padding:0px;">int workerNum <span style="margin:0px;padding:0px;">= get(<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">&quot;worker.num<span style="margin:0px;padding:0px;">&quot;, <span style="margin:0px;padding:0px;">10);</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
<div style="margin:0px;padding:0px;">conf<span style="margin:0px;padding:0px;">.put(<span style="margin:0px;padding:0px;">Config<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">.TOPOLOGY_WORKERS, workerNum);<span style="margin:0px;padding:0px;">//表示整个topology将使用几个worker</span></span></span></span></span></div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">conf<span style="margin:0px;padding:0px;">.put(<span style="margin:0px;padding:0px;">Config<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">.STORM_CLUSTER_MODE, <span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">&quot;distributed<span style="margin:0px;padding:0px;">&quot;);<span style="margin:0px;padding:0px;">//设置topolog模式为分布式，这样topology就可以放到JStorm集群上运行<span style="margin:0px;padding:0px;">StormSubmitter<span style="margin:0px;padding:0px;">.submitTopology(streamName, conf,</span></span></span></span></span></span></span></span></span></span></div>
<div style="margin:0px;padding:0px;">                builder<span style="margin:0px;padding:0px;">.createTopology());<span style="margin:0px;padding:0px;">//提交topology</span></span></div>


</div>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%BA%94%E7%94%A8%E4%BE%8B%E5%AD%90#irichspout" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>IRichSpout</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">IRichSpout 为最简单的Spout接口</p>
<div style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">IRichSpout</span></span>
<div style="margin:0px;padding:0px;">{ </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void open(<span style="margin:0px;padding:0px;">Map conf, <span style="margin:0px;padding:0px;">TopologyContext context, <span style="margin:0px;padding:0px;">SpoutOutputCollector</span></span></span></span></span></span></div>
<div style="margin:0px;padding:0px;">collector) {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void</span></span></span></div>
<div style="margin:0px;padding:0px;">close() {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void</span></span></span></div>
<div style="margin:0px;padding:0px;">activate() {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void</span></span></span></div>
<div style="margin:0px;padding:0px;">deactivate() {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void</span></span></span></div>
<div style="margin:0px;padding:0px;">nextTuple() {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void ack(<span style="margin:0px;padding:0px;">Object</span></span></span></span></div>
<div style="margin:0px;padding:0px;">msgId) {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void fail(<span style="margin:0px;padding:0px;">Object</span></span></span></span></div>
<div style="margin:0px;padding:0px;">msgId) {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void declareOutputFields(<span style="margin:0px;padding:0px;">OutputFieldsDeclarer</span></span></span></span></div>
<div style="margin:0px;padding:0px;">declarer) {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">Map&lt;<span style="margin:0px;padding:0px;">String, <span style="margin:0px;padding:0px;">Object&gt;</span></span></span></span></span></div>
<div style="margin:0px;padding:0px;">getComponentConfiguration() {</div>
<div style="margin:0px;padding:0px;"> </div>


<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">return <span style="margin:0px;padding:0px;">null;</span></span></span></span>
<div style="margin:0px;padding:0px;">    }</div>


</div>
<p style="padding:0px;margin:10px auto;text-indent:0px;">其中注意：</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">spout对象必须是继承Serializable， 因此要求spout内所有数据结构必须是可序列化的</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">spout可以有构造函数，但构造函数只执行一次，是在提交任务时，创建spout对象，因此在task分配到具体worker之前的初始化工作可以在此处完成，一旦完成，初始化的内容将携带到每一个task内（因为提交任务时将spout序列化到文件中去，在worker起来时再将spout从文件中反序列化出来）。</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">open是当task起来后执行的初始化动作</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">close是当task被shutdown后执行的动作</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">activate 是当task被激活时，触发的动作</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">deactivate 是task被deactive时，触发的动作</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">nextTuple 是spout实现核心， nextuple完成自己的逻辑，即每一次取消息后，用collector 将消息emit出去。</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">ack， 当spout收到一条ack消息时，触发的动作，详情可以参考 <a href="https://github.com/alibaba/jstorm/wiki/Ack-%E6%9C%BA%E5%88%B6" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">ack机制</a></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">fail， 当spout收到一条fail消息时，触发的动作，详情可以参考 <a href="https://github.com/alibaba/jstorm/wiki/Ack-%E6%9C%BA%E5%88%B6" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">ack机制</a></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">declareOutputFields， 定义spout发送数据，每个字段的含义</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">getComponentConfiguration 获取本spout的component 配置</li>


</ul>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%BA%94%E7%94%A8%E4%BE%8B%E5%AD%90#bolt" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>Bolt</h1>
<div style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">IRichBolt</span></span>
<div style="margin:0px;padding:0px;">{ </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void prepare(<span style="margin:0px;padding:0px;">Map stormConf, <span style="margin:0px;padding:0px;">TopologyContext context, <span style="margin:0px;padding:0px;">OutputCollector</span></span></span></span></span></span></div>
<div style="margin:0px;padding:0px;">collector) {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void execute(<span style="margin:0px;padding:0px;">Tuple</span></span></span></span></div>
<div style="margin:0px;padding:0px;">input) {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void</span></span></span></div>
<div style="margin:0px;padding:0px;">cleanup() {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">void declareOutputFields(<span style="margin:0px;padding:0px;">OutputFieldsDeclarer</span></span></span></span></div>
<div style="margin:0px;padding:0px;">declarer) {</div>
<div style="margin:0px;padding:0px;">    }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">    @<span style="margin:0px;padding:0px;">Override <span style="margin:0px;padding:0px;">public <span style="margin:0px;padding:0px;">Map&lt;<span style="margin:0px;padding:0px;">String, <span style="margin:0px;padding:0px;">Object&gt;</span></span></span></span></span></div>
<div style="margin:0px;padding:0px;">getComponentConfiguration() {</div>
<div style="margin:0px;padding:0px;"> </div>


<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">return <span style="margin:0px;padding:0px;">null;</span></span></span></span>
<div style="margin:0px;padding:0px;">    } </div>
<div style="margin:0px;padding:0px;">}</div>


</div>
<p style="padding:0px;margin:10px auto;text-indent:0px;">其中注意：</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">bolt对象必须是继承Serializable， 因此要求spout内所有数据结构必须是可序列化的</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">bolt可以有构造函数，但构造函数只执行一次，是在提交任务时，创建bolt对象，因此在task分配到具体worker之前的初始化工作可以在此处完成，一旦完成，初始化的内容将携带到每一个task内（因为提交任务时将bolt序列化到文件中去，在worker起来时再将bolt从文件中反序列化出来）。</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">prepare是当task起来后执行的初始化动作</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">cleanup是当task被shutdown后执行的动作</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">execute是bolt实现核心， 完成自己的逻辑，即接受每一次取消息后，处理完，有可能用collector 将产生的新消息emit出去。 ** 在executor中，当程序处理一条消息时，需要执行collector.ack， 详情可以参考 <a href="https://github.com/alibaba/jstorm/wiki/Ack-%E6%9C%BA%E5%88%B6" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">ack机制</a> ** 在executor中，当程序无法处理一条消息时或出错时，需要执行collector.fail ，详情可以参考 <a href="https://github.com/alibaba/jstorm/wiki/Ack-%E6%9C%BA%E5%88%B6" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">ack机制</a></li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">declareOutputFields， 定义bolt发送数据，每个字段的含义</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">getComponentConfiguration 获取本bolt的component 配置</li>


</ul>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%BA%94%E7%94%A8%E4%BE%8B%E5%AD%90#%E7%BC%96%E8%AF%91" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>编译</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">在Maven中配置</p>
<div style="margin:0px;padding:0px;">               &lt;<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">dependency&gt;</span></span>
<div style="margin:0px;padding:0px;">            &lt;<span style="margin:0px;padding:0px;">groupId&gt;com.alibaba.jstorm&lt;/<span style="margin:0px;padding:0px;">groupId&gt;</span></span></div>
<div style="margin:0px;padding:0px;">            &lt;<span style="margin:0px;padding:0px;">artifactId&gt;jstorm-client&lt;/<span style="margin:0px;padding:0px;">artifactId&gt;</span></span></div>
<div style="margin:0px;padding:0px;">            &lt;<span style="margin:0px;padding:0px;">version&gt;0.9.3.1&lt;/<span style="margin:0px;padding:0px;">version&gt;</span></span></div>
<div style="margin:0px;padding:0px;">            &lt;<span style="margin:0px;padding:0px;">scope&gt;provided&lt;/<span style="margin:0px;padding:0px;">scope&gt;</span></span></div>
<div style="margin:0px;padding:0px;">        &lt;/dependency&gt;</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">          &lt;dependency&gt;</div>
<div style="margin:0px;padding:0px;">            &lt;<span style="margin:0px;padding:0px;">groupId&gt;com.alibaba.jstorm&lt;/<span style="margin:0px;padding:0px;">groupId&gt;</span></span></div>
<div style="margin:0px;padding:0px;">            &lt;<span style="margin:0px;padding:0px;">artifactId&gt;jstorm-client-extension&lt;/<span style="margin:0px;padding:0px;">artifactId&gt;</span></span></div>
<div style="margin:0px;padding:0px;">            &lt;<span style="margin:0px;padding:0px;">version&gt;0.9.3.1&lt;/<span style="margin:0px;padding:0px;">version&gt;</span></span></div>
<div style="margin:0px;padding:0px;">            &lt;<span style="margin:0px;padding:0px;">scope&gt;provided&lt;/<span style="margin:0px;padding:0px;">scope&gt;</span></span></div>
<div style="margin:0px;padding:0px;">        &lt;/<span style="margin:0px;padding:0px;">dependency&gt;</span></div>


</div>
<p style="padding:0px;margin:10px auto;text-indent:0px;">如果找不到jstorm-client和jstorm-client-extension包，可以自己下载jstorm源码进行编译，请参考 <a href="https://github.com/alibaba/jstorm/wiki/%E7%BC%96%E8%AF%91%E6%BA%90%E7%A0%81" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">源码编译</a></p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">打包时，需要将所有依赖打入到一个包中</p>
<div style="margin:0px;padding:0px;">&lt;<span style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;">build&gt;</span></span>
<div style="margin:0px;padding:0px;">        &lt;plugins&gt;</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">            &lt;plugin&gt;</div>
<div style="margin:0px;padding:0px;">                &lt;<span style="margin:0px;padding:0px;">artifactId&gt;maven-assembly-plugin&lt;/<span style="margin:0px;padding:0px;">artifactId&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                &lt;configuration&gt;</div>
<div style="margin:0px;padding:0px;">                    &lt;descriptorRefs&gt;</div>
<div style="margin:0px;padding:0px;">                        &lt;<span style="margin:0px;padding:0px;">descriptorRef&gt;jar-with-dependencies&lt;/<span style="margin:0px;padding:0px;">descriptorRef&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                    &lt;/descriptorRefs&gt;</div>
<div style="margin:0px;padding:0px;">                    &lt;archive&gt;</div>
<div style="margin:0px;padding:0px;">                        &lt;manifest&gt;</div>
<div style="margin:0px;padding:0px;">                            &lt;<span style="margin:0px;padding:0px;">mainClass&gt;storm.starter.SequenceTopology&lt;/<span style="margin:0px;padding:0px;">mainClass&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                        &lt;/manifest&gt;</div>
<div style="margin:0px;padding:0px;">                    &lt;/archive&gt;</div>
<div style="margin:0px;padding:0px;">                &lt;/configuration&gt;</div>
<div style="margin:0px;padding:0px;">                &lt;executions&gt;</div>
<div style="margin:0px;padding:0px;">                    &lt;execution&gt;</div>
<div style="margin:0px;padding:0px;">                        &lt;<span style="margin:0px;padding:0px;">id&gt;make-assembly&lt;/<span style="margin:0px;padding:0px;">id&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                        &lt;<span style="margin:0px;padding:0px;">phase&gt;package&lt;/<span style="margin:0px;padding:0px;">phase&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                        &lt;goals&gt;</div>
<div style="margin:0px;padding:0px;">                            &lt;<span style="margin:0px;padding:0px;">goal&gt;single&lt;/<span style="margin:0px;padding:0px;">goal&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                        &lt;/goals&gt;</div>
<div style="margin:0px;padding:0px;">                    &lt;/execution&gt;</div>
<div style="margin:0px;padding:0px;">                &lt;/executions&gt;</div>
<div style="margin:0px;padding:0px;">            &lt;/plugin&gt;</div>
<div style="margin:0px;padding:0px;">            &lt;plugin&gt;</div>
<div style="margin:0px;padding:0px;">                &lt;<span style="margin:0px;padding:0px;">groupId&gt;org.apache.maven.plugins&lt;/<span style="margin:0px;padding:0px;">groupId&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                &lt;<span style="margin:0px;padding:0px;">artifactId&gt;maven-compiler-plugin&lt;/<span style="margin:0px;padding:0px;">artifactId&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                &lt;<span style="margin:0px;padding:0px;">configuration&gt;</span></div>
<div style="margin:0px;padding:0px;">                    &lt;<span style="margin:0px;padding:0px;">source&gt;1.6&lt;/<span style="margin:0px;padding:0px;">source&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                    &lt;<span style="margin:0px;padding:0px;">target&gt;1.6&lt;/<span style="margin:0px;padding:0px;">target&gt;</span></span></div>
<div style="margin:0px;padding:0px;">                &lt;/configuration&gt;</div>
<div style="margin:0px;padding:0px;">            &lt;/plugin&gt;</div>
<div style="margin:0px;padding:0px;">        &lt;/plugins&gt;</div>
<div style="margin:0px;padding:0px;">    &lt;/<span style="margin:0px;padding:0px;">build&gt;</span></div>


</div>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%BA%94%E7%94%A8%E4%BE%8B%E5%AD%90#%E6%8F%90%E4%BA%A4jar" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>提交jar</h1>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">JStorm vs Storm vs flume vs S4 选型</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">jstorm jar xxxxxx.jar com.alibaba.xxxx.xx parameter</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">xxxx.jar 为打包后的jar</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">com.alibaba.xxxx.xx 为入口类，即提交任务的类</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">parameter即为提交参数</li>


</ul>
<div style="margin:0px;padding:0px;"><span style="margin:0px;padding:0px;color:#333333;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;Segoe UI&quot;, Arial, freesans, sans-serif;font-size:medium;"> </span></div>
<div style="margin:0px;padding:0px;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">JStorm VS Storm 请参看 <a href="http://wenku.baidu.com/view/59e81017dd36a32d7375818b.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">JStorm 0.9.0 介绍.pptx</a></p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">JStorm 比Storm更稳定，更强大，更快， storm上跑的程序，一行代码不变可以运行在jstorm上。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><a href="http://flume.apache.org/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">Flume</a> 是一个成熟的系统，主要focus在管道上，将数据从一个数据源传输到另外一个数据源， 系统提供大量现成的插件做管道作用。当然也可以做一些计算和分析，但插件的开发没有Jstorm便捷和迅速。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><a href="http://incubator.apache.org/s4/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">S4</a> 就是一个半成品，健壮性还可以，但数据准确性较糟糕，无法保证数据不丢失，这个特性让S4 大受限制，也导致了S4开源很多年，但发展一直不是很迅速。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><a href="http://akka.io/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">AKKA</a> 是一个actor模型，也是一个不错的系统，在这个actor模型基本上，你想做任何事情都没有问题，但问题是你需要做更多的工作，topology怎么生成，怎么序列化。数据怎么流（随机，还是group by）等等。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><a href="http://spark.incubator.apache.org/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">Spark</a> 是一个轻量的内存MR， 更偏重批量数据处理</p>


<br style="margin:0px;padding:0px;"/>
<div style="margin:0px;padding:0px;"> </div>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">0.9.0 性能测试</h1>


<small style="margin:0px;padding:0px;"><small style="margin:0px;padding:0px;"> </small></small>JStorm 0.9.0 性能非常的好， 使用netty时单worker 发送最大速度为11万QPS， 使用zeromq时，最大速度为12万QPS.</div>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/0.9.0-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95#%E7%BB%93%E8%AE%BA" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>结论</h1>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">JStorm 0.9.0 在使用Netty的情况下，比Storm 0.9.0 使用netty情况下，快10%， 并且JStorm netty是稳定的而Storm 的Netty是不稳定的</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">在使用ZeroMQ的情况下， JStorm 0.9.0 比Storm 0.9.0 快30%</li>


</ul>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/0.9.0-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95#%E5%8E%9F%E5%9B%A0" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>原因</h1>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">Zeromq 减少一次内存拷贝</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">增加反序列化线程</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">重写采样代码，大幅减少采样影响</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">优化ack代码</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">优化缓冲map性能</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">Java 比clojure更底层</li>


</ul>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/0.9.0-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95#%E6%B5%8B%E8%AF%95" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>测试</h1>
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/0.9.0-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95#%E6%B5%8B%E8%AF%95%E6%A0%B7%E4%BE%8B" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>测试样例</h2>
<p style="padding:0px;margin:10px auto;text-indent:0px;">测试样例为<a href="https://github.com/longdafeng/storm-examples" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">https://github.com/longdafeng/storm-examples</a></p>
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/0.9.0-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>测试环境</h2>
<p style="padding:0px;margin:10px auto;text-indent:0px;">5 台 16核， 98G 物理机</p>
<div style="margin:0px;padding:0px;">
<div style="margin:0px;padding:0px;">uname -a :</div>
<div style="margin:0px;padding:0px;">Linux dwcache1 2.6.32-220.23.1.tb735.el5.x86_64 #1 SMP Tue Aug 14 16:03:04 CST 2012 x86_64 x86_64 x86_64 GNU/Linux</div>


</div>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/0.9.0-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>测试结果</h3>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">JStorm with netty， Spout 发送QPS 为 11万</li>


</ul>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="31" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="133"></img></p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">storm with netty, Spout 应用发送QPS 为 10万 （截图为上层应用的QPS， 没有包括发送到ack的QPS， Spout发送QPS 正好为上层应用QPS的2倍）</li>


</ul>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="31" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="129"></img></p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">JStorm with zeromq, Spout 发送QPS 为12万</li>


</ul>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="31" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="126"></img></p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">Storm with zeromq, Spout 发送QPS 为9万（截图为上层应用的QPS， 没有包括发送到ack的QPS， Spout发送QPS 正好为上层应用QPS的2倍）</li>


</ul>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="31" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="122"></img></p>
<div style="margin:0px;padding:0px;"><small style="margin:0px;padding:0px;"><small style="margin:0px;padding:0px;"><small style="margin:0px;padding:0px;"><br style="margin:0px;padding:0px;"/></small></small></small>
<div style="margin:0px;padding:0px;">
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">资源硬隔离</h1>


</div>
<p style="padding:0px;margin:10px auto;text-indent:0px;">cgroups是control groups的缩写，是Linux内核提供的一种可以限制, 记录, 隔离进程组(process groups)所使用的物理资源(如：cpu,memory,IO 等等)的机制。</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">在Jstorm中，我们使用cgroup进行cpu硬件资源的管理。使用前，需要做如下检查和配置。</p>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">检查/etc/passwd 文件中当前用户的uid和gid， 假设当前用户是admin， 则看/etc/passwd文件中admin的uid和gid是多少</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">
<p style="padding:0px;margin:10px auto;text-indent:0px;">cgroup功能在当前系统的内核版本是否支持</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">检查/etc/cgconfig.conf是否存在。如果不存在， 请“yum install libcgroup”，如果存在，设置cpu子系统的挂载目录位置， 以及修改该配置文件中相应的uid/gid为启动jstorm用户的uid/gid， 本例子中以500为例， 注意是根据第一步来进行设置的。</p>


</li>


</ul>
<div style="margin:0px;padding:0px;">
<div style="margin:0px;padding:0px;">  mount {    </div>
<div style="margin:0px;padding:0px;">      cpu = /cgroup/cpu;</div>
<div style="margin:0px;padding:0px;">  }</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;">  group jstorm {</div>
<div style="margin:0px;padding:0px;">       perm {</div>
<div style="margin:0px;padding:0px;">               task {</div>
<div style="margin:0px;padding:0px;">                      uid = 500;</div>
<div style="margin:0px;padding:0px;">                      gid = 500;</div>
<div style="margin:0px;padding:0px;">               }</div>
<div style="margin:0px;padding:0px;">               admin {</div>
<div style="margin:0px;padding:0px;">                      uid = 500;</div>
<div style="margin:0px;padding:0px;">                      gid = 500;</div>
<div style="margin:0px;padding:0px;">               }</div>
<div style="margin:0px;padding:0px;">       }</div>
<div style="margin:0px;padding:0px;">       cpu {</div>
<div style="margin:0px;padding:0px;">       }</div>
<div style="margin:0px;padding:0px;">  }</div>


</div>
<ul style="margin:0px;padding:0px;word-break:break-all;margin-left:30px;padding-left:0px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:disc;">然后启动cgroup服务</li>


</ul>
<div style="margin:0px;padding:0px;">
<div style="margin:0px;padding:0px;">service cgconfig restart</div>
<div style="margin:0px;padding:0px;">chkconfig --level 23456 cgconfig on</div>


</div>
<p style="padding:0px;margin:10px auto;text-indent:0px;">Note: cgconfig.conf只能在root模式下修改。</p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E8%B5%84%E6%BA%90%E7%A1%AC%E9%9A%94%E7%A6%BB#%E6%88%96%E8%80%85%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>或者直接执行命令</h3>
<p style="padding:0px;margin:10px auto;text-indent:0px;">这是一个cgconfig.conf配置文件例子。比如jstorm的启动用户为admin，admin在当前 系统的uid/gid为500（查看/etc/passwd 可以查看到uid和gid），那么相对应cpu子系统的jstorm目录uid/gid也需要设置为相同的值。 以便jstorm有相应权限可以在这个目录下为jstorm的每个需要进行资源隔离的进程创建对应 的目录和进行相关设置。</p>
<div style="margin:0px;padding:0px;">
<div style="margin:0px;padding:0px;">mkdir /cgroup/cpu</div>
<div style="margin:0px;padding:0px;">mount  -t cgroup -o cpu none /cgroup/cpu</div>
<div style="margin:0px;padding:0px;">mkdir /cgroup/cpu/jstorm</div>
<div style="margin:0px;padding:0px;">chown admin:admin /cgroup/cpu/jstorm</div>


</div>
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E8%B5%84%E6%BA%90%E7%A1%AC%E9%9A%94%E7%A6%BB#-%E5%9C%A8jstorm%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%89%93%E5%BC%80cgroup-%E9%85%8D%E7%BD%AEstormyaml" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>. 在jstorm配置文件中打开cgroup, 配置storm.yaml</h2>
<div style="margin:0px;padding:0px;"><code style="margin:0px;padding:0px;">   supervisor.enable.cgroup: true</code></div>


<br style="margin:0px;padding:0px;"/>
<div style="margin:0px;padding:0px;">
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">常见问题</h1>


</div>


<small style="margin:0px;padding:0px;"><small style="margin:0px;padding:0px;"> </small></small></div>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">性能问题</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">参考性能优化</p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E8%B5%84%E6%BA%90%E4%B8%8D%E5%A4%9F" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>资源不够</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">当报告 ”No supervisor resource is enough for component “， 则意味着资源不够 如果是仅仅是测试环境，可以将supervisor的cpu 和memory slot设置大，</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">在jstorm中， 一个task默认会消耗一个cpu slot和一个memory slot， 而一台机器上默认的cpu slot是(cpu 核数 -1）， memory slot数（物理内存大小 * 75%/1g）, 如果一个worker上运行task比较多时，需要将memory slot size设小（默认是1G）， 比如512M, memory.slot.per.size: 535298048</p>
<div style="margin:0px;padding:0px;">
<div style="margin:0px;padding:0px;"> #if it is null, then it will be detect by system</div>
<div style="margin:0px;padding:0px;"> supervisor.cpu.slot.num: null</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;"> #if it is null, then it will be detect by system</div>
<div style="margin:0px;padding:0px;"> supervisor.mem.slot.num: null</div>
<div style="margin:0px;padding:0px;"> </div>
<div style="margin:0px;padding:0px;"># support disk slot</div>
<div style="margin:0px;padding:0px;"># if it is null, it will use $(storm.local.dir)/worker_shared_data</div>
<div style="margin:0px;padding:0px;"> supervisor.disk.slot: null</div>


</div>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E5%BA%8F%E5%88%97%E5%8C%96%E9%97%AE%E9%A2%98" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>序列化问题</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">所有spout，bolt，configuration， 发送的消息（Tuple）都必须实现Serializable， 否则就会出现序列化错误.</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;">如果是spout或bolt的成员变量没有实现Serializable时，但又必须使用时， 可以对该变量申明时，增加transient 修饰符， 然后在open或prepare时，进行实例化</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="31" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="122"></img></p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#log4j-%E5%86%B2%E7%AA%81" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>Log4j 冲突</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">0.9.0 开始，JStorm依旧使用Log4J，但storm使用Logbak，因此应用程序如果有依赖log4j-over-slf4j.jar， 则需要exclude 所有log4j-over-slf4j.jar依赖，下个版本将自定义classloader，就不用担心这个问题。</p>
<div style="margin:0px;padding:0px;">
<div style="margin:0px;padding:0px;">SLF4J: Detected both log4j-over-slf4j.jar AND slf4j-log4j12.jar on the class path, preempting StackOverflowError. </div>
<div style="margin:0px;padding:0px;">SLF4J: See also </div>
<div style="margin:0px;padding:0px;">http://www.slf4j.org/codes.html#log4jDelegationLoop for more details.</div>
<div style="margin:0px;padding:0px;">Exception in thread &quot;main&quot; java.lang.ExceptionInInitializerError</div>
<div style="margin:0px;padding:0px;">        at org.apache.log4j.Logger.getLogger(Logger.java:39)</div>
<div style="margin:0px;padding:0px;">        at org.apache.log4j.Logger.getLogger(Logger.java:43)</div>
<div style="margin:0px;padding:0px;">        at com.alibaba.jstorm.daemon.worker.Worker.&lt;clinit&gt;(Worker.java:32)</div>
<div style="margin:0px;padding:0px;">Caused by: java.lang.IllegalStateException: Detected both log4j-over-slf4j.jar AND slf4j-log4j12.jar on the class path, preempting StackOverflowError. See also </div>
<div style="margin:0px;padding:0px;">http://www.slf4j.org/codes.html#log4jDelegationLoop for more details.</div>
<div style="margin:0px;padding:0px;">        at org.apache.log4j.Log4jLoggerFactory.&lt;clinit&gt;(Log4jLoggerFactory.java:49)</div>
<div style="margin:0px;padding:0px;">        ... 3 more</div>
<div style="margin:0px;padding:0px;">Could not find the main class: com.alibaba.jstorm.daemon.worker.Worker.  Program will exit.</div>


</div>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E7%B1%BB%E5%86%B2%E7%AA%81" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>类冲突</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">如果应用程序使用和JStorm相同的jar 但版本不一样时，建议打开classloader， 修改配置文件</p>
<div style="margin:0px;padding:0px;"><code style="margin:0px;padding:0px;">topology.enable.classloader: true</code></div>
<p style="padding:0px;margin:10px auto;text-indent:0px;">或者</p>
<div style="margin:0px;padding:0px;"><code style="margin:0px;padding:0px;">ConfigExtension.setEnableTopologyClassLoader(conf, true);</code></div>
<p style="padding:0px;margin:10px auto;text-indent:0px;">JStorm默认是关掉classloader，因此JStorm会强制使用JStorm依赖的jar</p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E6%8F%90%E4%BA%A4%E4%BB%BB%E5%8A%A1%E5%90%8E%E7%AD%89%E5%BE%85%E5%87%A0%E5%88%86%E9%92%9F%E5%90%8Eweb-ui%E5%A7%8B%E7%BB%88%E6%B2%A1%E6%9C%89%E6%98%BE%E7%A4%BA%E5%AF%B9%E5%BA%94%E7%9A%84task" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>提交任务后，等待几分钟后，web ui始终没有显示对应的task</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">有3种情况：</p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F%E5%88%9D%E5%A7%8B%E5%8C%96%E5%A4%AA%E6%85%A2" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>用户程序初始化太慢</h3>
<p style="padding:0px;margin:10px auto;text-indent:0px;">如果有用户程序的日志输出，则表明是用户的初始化太慢或者出错，查看日志即可。 另外对于MetaQ 1.x的应用程序，Spout会recover ~/.meta_recover/目录下文件，可以直接删除这些消费失败的问题，加速启动。</p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E9%80%9A%E5%B8%B8%E6%98%AF%E7%94%A8%E6%88%B7jar%E5%86%B2%E7%AA%81%E6%88%96%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%91%E7%94%9F%E9%97%AE%E9%A2%98" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>通常是用户jar冲突或初始化发生问题</h3>
<p style="padding:0px;margin:10px auto;text-indent:0px;">打开supervisor 日志，找出启动worker命令，单独执行，然后检查是否有问题。类似下图：</p>
<p style="padding:0px;margin:10px auto;text-indent:0px;"><img height="31" src="" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="128"></img></p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E6%A3%80%E6%9F%A5%E6%98%AF%E4%B8%8D%E6%98%AFstorm%E5%92%8Cjstorm%E4%BD%BF%E7%94%A8%E7%9B%B8%E5%90%8C%E7%9A%84%E6%9C%AC%E5%9C%B0%E7%9B%AE%E5%BD%95" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>检查是不是storm和jstorm使用相同的本地目录</h3>
<p style="padding:0px;margin:10px auto;text-indent:0px;">检查配置项 ”storm.local.dir“， 是不是storm和jstorm使用相同的本地目录，如果相同，则将二者分开</p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E6%8F%90%E7%A4%BA%E7%AB%AF%E5%8F%A3%E8%A2%AB%E7%BB%91%E5%AE%9A" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>提示端口被绑定</h1>
<p style="padding:0px;margin:10px auto;text-indent:0px;">有2种情况：</p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E5%A4%9A%E4%B8%AAworker%E6%8A%A2%E5%8D%A0%E4%B8%80%E4%B8%AA%E7%AB%AF%E5%8F%A3" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>多个worker抢占一个端口</h3>
<p style="padding:0px;margin:10px auto;text-indent:0px;">假设是6800 端口被占， 可以执行命令 “ps -ef|grep 6800” 检查是否有多个进程， 如果有多个进程，则手动杀死他们</p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;"><a href="https://github.com/alibaba/jstorm/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98#%E7%B3%BB%E7%BB%9F%E6%89%93%E5%BC%80%E5%A4%AA%E5%A4%9A%E7%9A%84connection" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"></a>系统打开太多的connection</h3>
<p style="padding:0px;margin:10px auto;text-indent:0px;">Linux对外连接端口数限制，TCP client对外发起连接数达到28000左右时，就开始大量抛异常，需要</p>
<div style="margin:0px;padding:0px;"><code style="margin:0px;padding:0px;"> # echo &quot;10000 65535&quot; &gt; /proc/sys/net/ipv4/ip_local_port_range</code></div>


</div>


</div></div>
<div style="margin:0px;padding:0px;clear:both;"></div>
<div style="margin:0px;padding:0px;margin-top:20px;">
<div style="margin:0px;padding:0px;margin-bottom:10px;">分类: <a href="http://www.cnblogs.com/cn-leodream/category/955397.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">storm</a>,<a href="http://www.cnblogs.com/cn-leodream/category/955406.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank">大数据</a></div>
<div style="margin:0px;padding:0px;font-size:9pt;color:rgb(102, 102, 102);margin-top:0px;"></div>
<div style="margin:0px;padding:0px;"><div style="margin:0px;padding:10px 0px;margin-bottom:10px;margin-top:10px;border:1px dashed silver;font-size:12px;width:320px;text-align:center;">
        <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 8px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:rgba(0, 0, 0, 0.498039) 0px 1px 3px;text-shadow:rgba(0, 0, 0, 0.247059) 0px -1px 1px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D) repeat-x;background-color:rgb(45, 174, 191);color:rgb(255, 255, 255);border:none;">好文要顶</a>
            <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 8px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:rgba(0, 0, 0, 0.498039) 0px 1px 3px;text-shadow:rgba(0, 0, 0, 0.247059) 0px -1px 1px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D) repeat-x;background-color:rgb(227, 49, 0);color:rgb(255, 255, 255);border:none;">关注我</a>
    <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 8px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:rgba(0, 0, 0, 0.498039) 0px 1px 3px;text-shadow:rgba(0, 0, 0, 0.247059) 0px -1px 1px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D) repeat-x;background-color:rgb(255, 181, 21);color:rgb(255, 255, 255);border:none;">收藏该文</a>
    <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 2px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:none;text-shadow:none;background:none;color:rgb(255, 255, 255);border:none;" title="分享至新浪微博"><img src="阿里的STORM——JSTORM - 不可替代的毛线 - 博客园_files/icon_weibo_24.png" type="image/png" data-filename="icon_weibo_24.png" height="24" style="margin:0px;padding:0px;height:auto;border:none;vertical-align:middle;margin-left:5px;box-shadow:none;max-width:300px;" width="24"/></a>
    <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 2px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:none;text-shadow:none;background:none;color:rgb(255, 255, 255);border:none;" title="分享至微信"><img src="阿里的STORM——JSTORM - 不可替代的毛线 - 博客园_files/wechat.png" type="image/png" data-filename="wechat.png" height="24" style="margin:0px;padding:0px;border:medium none;width:24px;height:24px;box-shadow:none;margin-left:5px;vertical-align:middle;max-width:300px;" width="24"/></a>
</div>
<div style="margin:0px;padding:0px;float:left;width:280px;margin-top:0px;margin-bottom:10px;color:rgb(0, 0, 0);margin-left:0px;font-size:12px;">
    <div style="margin:0px;padding:0px;float:left;line-height:18px;">
            <a href="http://home.cnblogs.com/u/cn-leodream/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" target="_blank"><img src="阿里的STORM——JSTORM - 不可替代的毛线 - 博客园_files/sample_face.gif" type="image/gif" data-filename="sample_face.gif" height="48" style="margin:0px;padding:0px;height:auto;border:0px;vertical-align:top;float:left;margin-right:5px;padding-top:5px;padding-left:2px;max-width:300px;" width="48"/></a>
        <div style="margin:0px;padding:0px;float:left;line-height:18px;">
            <a href="http://home.cnblogs.com/u/cn-leodream/" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;">不可替代的毛线</a><br style="margin:0px;padding:0px;"/>
            <a href="http://home.cnblogs.com/u/cn-leodream/followees" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;">关注 - 0</a><br style="margin:0px;padding:0px;"/>
            <a href="http://home.cnblogs.com/u/cn-leodream/followers" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;">粉丝 - 2</a>
        </div>
    </div>
    <div style="margin:0px;padding:0px;clear:both;"></div>
    <div style="margin:0px;padding:0px;"></div>
    <div style="margin:0px;padding:0px;">
                <a href="#" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;">+加关注</a>
    </div>
</div>
<div style="margin:0px;padding:0px;float:right;margin-bottom:10px;margin-right:30px;font-size:12px;width:125px;text-align:center;margin-top:10px;">
    <div style="margin:0px;padding:0px;float:left;width:46px;height:52px;background:url(//static.cnblogs.com/images/upup.gif) no-repeat;text-align:center;cursor:pointer;margin-top:2px;padding-top:5px;">
        <span style="margin:0px;padding:0px;font-size:14px;color:rgb(7, 93, 179);font-family:Verdana;line-height:1.5em;">0</span>
    </div>
    <div style="text-align:center;padding:0px;margin:0px;height:52px;background:url(//static.cnblogs.com/images/downdown.gif) no-repeat;margin-left:20px;cursor:pointer;margin-top:2px;padding-top:5px;width:46px;float:right;">
        <span style="margin:0px;padding:0px;font-size:14px;color:rgb(7, 93, 179);font-family:Verdana;line-height:1.5em;">0</span>
    </div>
    <div style="margin:0px;padding:0px;clear:both;"></div>
    <div style="margin:0px;padding:0px;margin-top:5px;margin-left:0px;font-size:12px;color:gray;">
    </div>
</div>
</div>
<div style="margin:0px;padding:0px;clear:both;"></div>
<div style="margin:0px;padding:0px;line-height:1.8;font-size:12px;"><a href="http://www.cnblogs.com/cn-leodream/p/6497257.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:none;">« </a> 上一篇：<a href="http://www.cnblogs.com/cn-leodream/p/6497257.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" title="发布于2017-03-03 16:19">Kafka的架构设计（目前翻译最好的一稿）</a><br style="margin:0px;padding:0px;"/><a href="http://www.cnblogs.com/cn-leodream/p/6497294.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:none;">» </a> 下一篇：<a href="http://www.cnblogs.com/cn-leodream/p/6497294.html" style="margin:0px;padding:0px;color:rgb(0, 0, 0);text-decoration:underline;" title="发布于2017-03-03 16:24">对Storm ETL的初步思考</a><br style="margin:0px;padding:0px;"/></div>
</div>


		</div>
		<div style="margin:0px;padding:0px;clear:both;float:none;text-align:right;padding-right:5px;color:rgb(102, 102, 102);margin-top:5px;">posted @ <span style="margin:0px;padding:0px;">2017-03-03 16:22</span> <a href="http://www.cnblogs.com/cn-leodream/" style="margin:0px;padding:0px;text-decoration:none;color:rgb(163, 163, 163);">不可替代的毛线</a> 阅读(<span style="margin:0px;padding:0px;">10775</span>) 评论(<span style="margin:0px;padding:0px;">0</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=6497277" rel="nofollow" style="margin:0px;padding:0px;text-decoration:none;color:rgb(163, 163, 163);">编辑</a> <a href="https://www.cnblogs.com/cn-leodream/p/6497277.html#" style="margin:0px;padding:0px;text-decoration:none;color:rgb(163, 163, 163);">收藏</a></div>
	</div></div></div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 