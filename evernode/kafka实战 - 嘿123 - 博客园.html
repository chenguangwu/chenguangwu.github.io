<html>
<head>
  <title>kafka实战 - 嘿123 - 博客园</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="7837"/>
<h1>kafka实战 - 嘿123 - 博客园</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/7/24 15:00</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://www.cnblogs.com/hei12138/p/7805475.html"><i>https://www.cnblogs.com/hei12138/p/7805475.html</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;position: relative;"><div><div style="font-family:&quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(0, 0, 0);background:url(/Skins/coffee/images/bg_body.gif) left top;line-height:1.5;font-size:14px;"><div style="min-width:auto;"><div style="min-width:auto;text-align:left;"><div style="background:transparent;text-align:left;overflow-x:hidden;"><div style="background:url(/Skins/coffee/images/bg_left.gif) left top repeat-x rgb(254, 254, 242);"><div><div style="text-overflow:ellipsis;overflow:hidden;word-break:break-all;"><div>
		<h1 style="margin:0px;padding:0px;width:100%;clear:both;font-weight:bold;float:left;line-height:1.5;font-size:14px;padding-left:5px;">
			<a href="https://www.cnblogs.com/hei12138/p/7805475.html" style="margin:0px;padding:0px;text-decoration:none;color:rgb(7, 93, 179);">kafka实战</a>
		</h1>
		<div style="margin:0px;padding:0px;clear:both;"></div>
		<div style="margin:0px;padding:5px 2px 5px 5px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin-top:5px;">
			<div style="margin:0px;padding:0px;margin-bottom:20px;word-break:break-word;"><div style="margin:0px;padding:0px;">
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;">1.       kafka介绍</h2>
</div>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;">1.1.       主要功能</h3>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">根据官网的介绍，ApacheKafka®是<em style="margin:0px;padding:0px;">一个分布式流媒体平台</em>，它主要有3种功能：</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　1：It lets you publish and subscribe to streams of records.发布和订阅消息流，这个功能类似于消息队列，这也是kafka归类为消息队列框架的原因</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　2：It lets you store streams of records in a fault-tolerant way.以容错的方式记录消息流，kafka以文件的方式来存储消息流</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　3：It lets you process streams of records as they occur.可以再消息发布的时候进行处理</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;">1.2.       使用场景</h3>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">1：Building real-time streaming data pipelines that reliably get data between systems or applications.在系统或应用程序之间构建可靠的用于传输实时数据的管道，消息队列功能</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">2：Building real-time streaming applications that transform or react to the streams of data。构建实时的流数据处理程序来变换或处理数据流，数据处理功能</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;">1.3.       详细介绍</h3>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">Kafka目前主要作为一个分布式的发布订阅式的消息系统使用，下面简单介绍一下kafka的基本机制</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">　　1.3.1 消息传输流程</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108181426763-1692750478.png" type="image/png" data-filename="760273-20171108181426763-1692750478.png" height="474" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="444"/></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　<strong style="margin:0px;padding:0px;">Producer</strong>即生产者，向Kafka集群发送消息，在发送消息之前，会对消息进行分类，即Topic，上图展示了两个producer发送了分类为topic1的消息，另外一个发送了topic2的消息。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　<strong style="margin:0px;padding:0px;">Topic</strong>即主题，通过对消息指定主题可以将消息分类，消费者可以只关注自己需要的Topic中的消息</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　<strong style="margin:0px;padding:0px;">Consumer</strong>即消费者，消费者通过与kafka集群建立长连接的方式，不断地从集群中拉取消息，然后可以对这些消息进行处理。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　从上图中就可以看出同一个Topic下的消费者和生产者的数量并不是对应的。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">　　1.3.2 kafka</strong><strong style="margin:0px;padding:0px;">服务器消息存储策略</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> <img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108181503075-2011721824.png" type="image/png" data-filename="760273-20171108181503075-2011721824.png" height="316" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="622"/></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　谈到kafka的存储，就不得不提到分区，即partitions，创建一个topic时，同时可以指定分区数目，分区数越多，其吞吐量也越大，但是需要的资源也越多，同时也会导致更高的不可用性，kafka在接收到生产者发送的消息之后，会根据均衡策略将消息存储到不同的分区中。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> <img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108181534809-1489003398.png" type="image/png" data-filename="760273-20171108181534809-1489003398.png" height="267" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="416"/></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　在每个分区中，消息以顺序存储，最晚接收的的消息会最后被消费。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">　　1.3.3 与生产者的交互</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> <img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108181730059-1009703405.png" type="image/png" data-filename="760273-20171108181730059-1009703405.png" height="447" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="669"/></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　生产者在向kafka集群发送消息的时候，可以通过指定分区来发送到指定的分区中</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　也可以通过指定均衡策略来将消息发送到不同的分区中</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　如果不指定，就会采用默认的随机均衡策略，将消息随机的存储到不同的分区中</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">　　1.3.4  与消费者的交互</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> <img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108181923325-686894915.png" type="image/png" data-filename="760273-20171108181923325-686894915.png" height="443" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="733"/> </p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　在消费者消费消息时，kafka使用offset来记录当前消费的位置</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　在kafka的设计中，可以有多个不同的group来同时消费同一个topic下的消息，如图，我们有两个不同的group同时消费，他们的的消费的记录位置offset各不项目，不互相干扰。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　对于一个group而言，消费者的数量不应该多余分区的数量，因为在一个group中，每个分区至多只能绑定到一个消费者上，即一个消费者可以消费多个分区，一个分区只能给一个消费者消费</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　因此，若一个group中的消费者数量大于分区数量的话，多余的消费者将不会收到任何消息。</p>
<div style="margin:0px;padding:0px;">
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;">2.       Kafka安装与使用</h2>
</div>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;">2.1.       下载</h3>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　你可以在kafka官网 <a href="http://kafka.apache.org/downloads" style="margin:0px;padding:0px;text-decoration:underline;color:rgb(7, 93, 179);">http://kafka.apache.org/downloads</a>下载到最新的kafka安装包，选择下载二进制版本的tgz文件，根据网络状态可能需要fq，这里我们选择的版本是0.11.0.1，目前的最新版</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;">2.2.       安装</h3>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　Kafka是使用scala编写的运行与jvm虚拟机上的程序，虽然也可以在windows上使用，但是kafka基本上是运行在linux服务器上，因此我们这里也使用linux来开始今天的实战。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　首先确保你的机器上安装了jdk，kafka需要java运行环境，以前的kafka还需要zookeeper，新版的kafka已经内置了一个zookeeper环境，所以我们可以直接使用</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　说是安装，如果只需要进行最简单的尝试的话我们只需要解压到任意目录即可，这里我们将kafka压缩包解压到/home目录</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;">2.3.       配置</h3>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　在kafka解压目录下下有一个config的文件夹，里面放置的是我们的配置文件</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　consumer.properites 消费者配置，这个配置文件用于配置于2.5节中开启的消费者，此处我们使用默认的即可</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　producer.properties 生产者配置，这个配置文件用于配置于2.5节中开启的生产者，此处我们使用默认的即可</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　server.properties kafka服务器的配置，此配置文件用来配置kafka服务器，目前仅介绍几个最基础的配置</p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="list-style-type:none;margin:0px;padding:0px;list-style:none;margin-bottom:1em;"><ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">broker.id 申明当前kafka服务器在集群中的唯一ID，需配置为integer,并且集群中的每一个kafka服务器的id都应是唯一的，我们这里采用默认配置即可</li>
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">listeners 申明此kafka服务器需要监听的端口号，如果是在本机上跑虚拟机运行可以不用配置本项，默认会使用localhost的地址，如果是在远程服务器上运行则必须配置，例如：</li>
</ol></li>
</ol>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　　　　　　　listeners=PLAINTEXT:// 192.168.180.128:9092。并确保服务器的9092端口能够访问</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　　　3.zookeeper.connect 申明kafka所连接的zookeeper的地址 ，需配置为zookeeper的地址，由于本次使用的是kafka高版本中自带zookeeper，使用默认配置即可</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　　　　　　　zookeeper.connect=localhost:2181</p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;">2.4.       运行</h3>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">启动zookeeper</li>
</ol>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">cd进入kafka解压目录，输入</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">bin/zookeeper-server-start.sh config/zookeeper.properties</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">启动zookeeper成功后会看到如下的输出</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108182511122-1998907932.png" type="image/png" data-filename="760273-20171108182511122-1998907932.png" height="60" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="900"/></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　2.启动kafka</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">cd进入kafka解压目录，输入</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">bin/kafka-server-start.sh config/server.properties</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">启动kafka成功后会看到如下的输出</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> <img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108182550794-999428192.png" type="image/png" data-filename="760273-20171108182550794-999428192.png" height="136" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="716"/></p>
<h3 style="padding:0px;font-size:16px;font-weight:bold;line-height:1.5;margin:10px 0px;">2.5.       第一个消息</h3>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　2.5.1   创建一个topic</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　Kafka通过topic对同一类的数据进行管理，同一类的数据使用同一个topic可以在处理数据时更加的便捷</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　在kafka解压目录打开终端，输入</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">　　　　bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic </code><code style="margin:0px;padding:0px;">test</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">　　　　创建一个名为test的topic</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> <img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108182719091-1211225701.png" type="image/png" data-filename="760273-20171108182719091-1211225701.png" height="70" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="726"/></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        　在创建topic后可以通过输入</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">            <code style="margin:0px;padding:0px;">bin/kafka-topics.sh --list --zookeeper localhost:2181</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">   </code><code style="margin:0px;padding:0px;">来查看已经创建的topic</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">　　2.4.2   </code><code style="margin:0px;padding:0px;">创建一个消息消费者</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">　　　在kafka解压目录打开终端，输入</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">　　　　bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic </code><code style="margin:0px;padding:0px;">test</code> <code style="margin:0px;padding:0px;">--from-beginning</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">　　　可以创建一个用于消费topic为test的消费者</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> <img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108182821481-1641650194.png" type="image/png" data-filename="760273-20171108182821481-1641650194.png" height="127" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="727"/></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">         消费者创建完成之后，因为还没有发送任何数据，因此这里在执行后没有打印出任何数据</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">         不过别着急，不要关闭这个终端，打开一个新的终端，接下来我们创建第一个消息生产者</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　2.4.3         创建一个消息生产者</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　在kafka解压目录打开一个新的终端，输入</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">　　　　bin/kafka-console-producer.sh --broker-list localhost:9092 --topic </code><code style="margin:0px;padding:0px;">test</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;">　　　　在执行完毕后会进入的编辑器页面</code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><code style="margin:0px;padding:0px;"><img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108182905559-858539154.png" type="image/png" data-filename="760273-20171108182905559-858539154.png" height="182" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="747"/></code></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">在发送完消息之后，可以回到我们的消息消费者终端中，可以看到，终端中已经打印出了我们刚才发送的消息</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><img src="kafka实战 - 嘿123 - 博客园_files/760273-20171108182938653-179427239.png" type="image/png" data-filename="760273-20171108182938653-179427239.png" height="206" style="margin:0px;padding:0px;border:0px;height:auto;max-width:300px;" width="726"/></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<div style="margin:0px;padding:0px;">
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;">3.       使用java程序</h2>
</div>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　跟上节中一样，我们现在在java程序中尝试使用kafka</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　　　<strong style="margin:0px;padding:0px;">3.1  创建Topic</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">public static void main(String[] args) {<br style="margin:0px;padding:0px;"/>
    //创建topic<br style="margin:0px;padding:0px;"/>
    Properties
props = new Properties();<br style="margin:0px;padding:0px;"/>
    props.put(&quot;bootstrap.servers&quot;,
&quot;192.168.180.128:9092&quot;);<br style="margin:0px;padding:0px;"/>
    AdminClient
adminClient = AdminClient.<em style="margin:0px;padding:0px;">create</em>(props);<br style="margin:0px;padding:0px;"/>
    ArrayList&lt;NewTopic&gt;
topics = new ArrayList&lt;NewTopic&gt;();<br style="margin:0px;padding:0px;"/>
    NewTopic
newTopic = new NewTopic(&quot;topic-test&quot;, 1, (short) 1);<br style="margin:0px;padding:0px;"/>
    topics.add(newTopic);<br style="margin:0px;padding:0px;"/>
    CreateTopicsResult
result = adminClient.createTopics(topics);<br style="margin:0px;padding:0px;"/>
    try {<br style="margin:0px;padding:0px;"/>
        result.all().get();<br style="margin:0px;padding:0px;"/>
    }
catch (InterruptedException e)
{<br style="margin:0px;padding:0px;"/>
        e.printStackTrace();<br style="margin:0px;padding:0px;"/>
    }
catch (ExecutionException e) {<br style="margin:0px;padding:0px;"/>
        e.printStackTrace();<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
}</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">　　使用AdminClient API可以来控制对kafka服务器进行配置，我们这里使用NewTopic(String
name, int numPartitions, short 　　replicationFactor)的构造方法来创建了一个名为“topic-test”，分区数为1，复制因子为1的Topic.</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">3.2  Producer生产者发送消息</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">public static void main(String[] args){<br style="margin:0px;padding:0px;"/>
    Properties props = new Properties();<br style="margin:0px;padding:0px;"/>
   
props.put(&quot;bootstrap.servers&quot;, &quot;192.168.180.128:9092&quot;);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;acks&quot;, &quot;all&quot;);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;retries&quot;, 0);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;batch.size&quot;, 16384);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;linger.ms&quot;, 1);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;buffer.memory&quot;,
33554432);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;key.serializer&quot;,
&quot;org.apache.kafka.common.serialization.StringSerializer&quot;);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;value.serializer&quot;,
&quot;org.apache.kafka.common.serialization.StringSerializer&quot;);<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
    Producer&lt;String, String&gt; producer = new KafkaProducer&lt;String, String&gt;(props);<br style="margin:0px;padding:0px;"/>
    for (int i = 0; i &lt; 100; i++)<br style="margin:0px;padding:0px;"/>
        producer.send(new ProducerRecord&lt;String, String&gt;(&quot;topic-test&quot;, Integer.<em style="margin:0px;padding:0px;">toString</em>(i), Integer.<em style="margin:0px;padding:0px;">toString</em>(i)));<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
    producer.close();<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
}</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">使用producer发送完消息可以通过2.5中提到的服务器端消费者监听到消息。也可以使用接下来介绍的java消费者程序来消费消息</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">3.3 Consumer消费者消费消息</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">public static void main(String[] args){<br style="margin:0px;padding:0px;"/>
    Properties props = new Properties();<br style="margin:0px;padding:0px;"/>
    props.put(&quot;bootstrap.servers&quot;,
&quot;192.168.12.65:9092&quot;);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;group.id&quot;, &quot;test&quot;);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;enable.auto.commit&quot;,
&quot;true&quot;);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;auto.commit.interval.ms&quot;,
&quot;1000&quot;);<br style="margin:0px;padding:0px;"/>
   
props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);<br style="margin:0px;padding:0px;"/>
    props.put(&quot;value.deserializer&quot;,
&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);<br style="margin:0px;padding:0px;"/>
    final KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;String,String&gt;(props);<br style="margin:0px;padding:0px;"/>
    consumer.subscribe(Arrays.<em style="margin:0px;padding:0px;">asList</em>(&quot;topic-test&quot;),new ConsumerRebalanceListener() {<br style="margin:0px;padding:0px;"/>
        public
void onPartitionsRevoked(Collection&lt;TopicPartition&gt;
collection) {<br style="margin:0px;padding:0px;"/>
        }<br style="margin:0px;padding:0px;"/>
        public
void onPartitionsAssigned(Collection&lt;TopicPartition&gt;
collection) {<br style="margin:0px;padding:0px;"/>
            //将偏移设置到最开始<br style="margin:0px;padding:0px;"/>
            consumer.seekToBeginning(collection);<br style="margin:0px;padding:0px;"/>
        }<br style="margin:0px;padding:0px;"/>
    });<br style="margin:0px;padding:0px;"/>
    while (true) {<br style="margin:0px;padding:0px;"/>
        ConsumerRecords&lt;String, String&gt; records = consumer.poll(100);<br style="margin:0px;padding:0px;"/>
        for (ConsumerRecord&lt;String, String&gt; record : records)<br style="margin:0px;padding:0px;"/>
            System.<em style="margin:0px;padding:0px;">out</em>.printf(&quot;offset = %d, key = %s, value = %s%n&quot;, record.offset(), record.key(),
record.value());<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
}</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">这里我们使用Consume API 来创建了一个普通的java消费者程序来监听名为“topic-test”的Topic，每当有生产者向kafka服务器发送消息，我们的消费者就能收到发送的消息。</p>
<div style="margin:0px;padding:0px;">
<h2 style="padding:0px;font-size:21px;font-weight:bold;line-height:1.5;margin:10px 0px;">4.       使用spring-kafka</h2>



















</div>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">Spring-kafka是正处于孵化阶段的一个spring子项目，能够使用spring的特性来让我们更方便的使用kafka</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">4.1   基本配置信息</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">与其他spring的项目一样，总是离不开配置，这里我们使用java配置来配置我们的kafka消费者和生产者。</p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">引入pom文件</li>

















</ol>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">&lt;!--kafka start--&gt;<br style="margin:0px;padding:0px;"/>
&lt;dependency&gt;<br style="margin:0px;padding:0px;"/>
    &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;<br style="margin:0px;padding:0px;"/>
    &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;<br style="margin:0px;padding:0px;"/>
    &lt;version&gt;0.11.0.1&lt;/version&gt;<br style="margin:0px;padding:0px;"/>
&lt;/dependency&gt;<br style="margin:0px;padding:0px;"/>
&lt;dependency&gt;<br style="margin:0px;padding:0px;"/>
    &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;<br style="margin:0px;padding:0px;"/>
    &lt;artifactId&gt;kafka-streams&lt;/artifactId&gt;<br style="margin:0px;padding:0px;"/>
    &lt;version&gt;0.11.0.1&lt;/version&gt;<br style="margin:0px;padding:0px;"/>
&lt;/dependency&gt;<br style="margin:0px;padding:0px;"/>
&lt;dependency&gt;<br style="margin:0px;padding:0px;"/>
    &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;<br style="margin:0px;padding:0px;"/>
    &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;<br style="margin:0px;padding:0px;"/>
    &lt;version&gt;1.3.0.RELEASE&lt;/version&gt;<br style="margin:0px;padding:0px;"/>
&lt;/dependency&gt;</p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">创建配置类</li>

















</ol>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">我们在主目录下新建名为KafkaConfig的类</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">@Configuration<br style="margin:0px;padding:0px;"/>
@EnableKafka<br style="margin:0px;padding:0px;"/>
public class KafkaConfig {<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
}</p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">配置Topic</li>

















</ol>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">在kafkaConfig类中添加配置</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">//topic config Topic的配置开始<br style="margin:0px;padding:0px;"/>
    @Bean<br style="margin:0px;padding:0px;"/>
    public
KafkaAdmin admin() {<br style="margin:0px;padding:0px;"/>
        Map&lt;String, Object&gt; configs = new HashMap&lt;String, Object&gt;();<br style="margin:0px;padding:0px;"/>
        configs.put(AdminClientConfig.<em style="margin:0px;padding:0px;">BOOTSTRAP_SERVERS_CONFIG</em>,&quot;192.168.180.128:9092&quot;);<br style="margin:0px;padding:0px;"/>
        return new KafkaAdmin(configs);<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
    @Bean<br style="margin:0px;padding:0px;"/>
    public
NewTopic topic1() {<br style="margin:0px;padding:0px;"/>
        return
new NewTopic(&quot;foo&quot;, 10,
(short)
2);<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
//topic的配置结束</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<ol style="margin:0px;padding:0px;padding-left:40px;">
<li style="margin:0px;padding:0px;list-style:none;margin-bottom:1em;list-style-type:decimal;">配置生产者Factort及Template</li>

















</ol>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">//producer config start<br style="margin:0px;padding:0px;"/>
    @Bean<br style="margin:0px;padding:0px;"/>
    public
ProducerFactory&lt;Integer,
String&gt; producerFactory() {<br style="margin:0px;padding:0px;"/>
        return
new DefaultKafkaProducerFactory&lt;Integer,String&gt;(producerConfigs());<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
    @Bean<br style="margin:0px;padding:0px;"/>
   
public Map&lt;String, Object&gt; producerConfigs() {<br style="margin:0px;padding:0px;"/>
        Map&lt;String, Object&gt; props = new HashMap&lt;String,Object&gt;();<br style="margin:0px;padding:0px;"/>
        props.put(ProducerConfig.<em style="margin:0px;padding:0px;">BOOTSTRAP_SERVERS_CONFIG</em>,
&quot;192.168.180.128:9092&quot;);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;acks&quot;, &quot;all&quot;);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;retries&quot;, 0);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;batch.size&quot;, 16384);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;linger.ms&quot;, 1);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;buffer.memory&quot;,
33554432);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;key.serializer&quot;,
&quot;org.apache.kafka.common.serialization.IntegerSerializer&quot;);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;value.serializer&quot;,
&quot;org.apache.kafka.common.serialization.StringSerializer&quot;);<br style="margin:0px;padding:0px;"/>
        return props;<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
    @Bean<br style="margin:0px;padding:0px;"/>
    public
KafkaTemplate&lt;Integer,
String&gt; kafkaTemplate() {<br style="margin:0px;padding:0px;"/>
        return
new KafkaTemplate&lt;Integer,
String&gt;(producerFactory());<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
//producer config end</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">5.配置ConsumerFactory</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">//consumer config start<br style="margin:0px;padding:0px;"/>
    @Bean<br style="margin:0px;padding:0px;"/>
    public
ConcurrentKafkaListenerContainerFactory&lt;Integer,String&gt; kafkaListenerContainerFactory(){<br style="margin:0px;padding:0px;"/>
       
ConcurrentKafkaListenerContainerFactory&lt;Integer, String&gt; factory = new ConcurrentKafkaListenerContainerFactory&lt;Integer, String&gt;();<br style="margin:0px;padding:0px;"/>
        factory.setConsumerFactory(consumerFactory());<br style="margin:0px;padding:0px;"/>
        return factory;<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
    @Bean<br style="margin:0px;padding:0px;"/>
    public
ConsumerFactory&lt;Integer,String&gt; consumerFactory(){<br style="margin:0px;padding:0px;"/>
        return
new DefaultKafkaConsumerFactory&lt;Integer, String&gt;(consumerConfigs());<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
    @Bean<br style="margin:0px;padding:0px;"/>
    public
Map&lt;String,Object&gt;
consumerConfigs(){<br style="margin:0px;padding:0px;"/>
        HashMap&lt;String, Object&gt; props = new HashMap&lt;String, Object&gt;();<br style="margin:0px;padding:0px;"/>
        props.put(&quot;bootstrap.servers&quot;,
&quot;192.168.180.128:9092&quot;);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;group.id&quot;, &quot;test&quot;);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;enable.auto.commit&quot;,
&quot;true&quot;);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;auto.commit.interval.ms&quot;,
&quot;1000&quot;);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;key.deserializer&quot;,
&quot;org.apache.kafka.common.serialization.IntegerDeserializer&quot;);<br style="margin:0px;padding:0px;"/>
        props.put(&quot;value.deserializer&quot;,
&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);<br style="margin:0px;padding:0px;"/>
        return props;<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
//consumer config end</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">4.2  创建消息生产者</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">//使用spring-kafka的template发送一条消息
发送多条消息只需要循环多次即可<br style="margin:0px;padding:0px;"/>
public static void main(String[] args) throws ExecutionException, InterruptedException {<br style="margin:0px;padding:0px;"/>
    AnnotationConfigApplicationContext
ctx = new AnnotationConfigApplicationContext(KafkaConfig.class);<br style="margin:0px;padding:0px;"/>
    KafkaTemplate&lt;Integer, String&gt; kafkaTemplate =
(KafkaTemplate&lt;Integer, String&gt;) ctx.getBean(&quot;kafkaTemplate&quot;);<br style="margin:0px;padding:0px;"/>
        String
data=&quot;this is a test message&quot;;<br style="margin:0px;padding:0px;"/>
        ListenableFuture&lt;SendResult&lt;Integer, String&gt;&gt; send =
kafkaTemplate.send(&quot;topic-test&quot;, 1,
data);<br style="margin:0px;padding:0px;"/>
        send.addCallback(new ListenableFutureCallback&lt;SendResult&lt;Integer, String&gt;&gt;() {<br style="margin:0px;padding:0px;"/>
            public
void onFailure(Throwable throwable) {<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
            }<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
            public
void onSuccess(SendResult&lt;Integer, String&gt; integerStringSendResult) {<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
            }<br style="margin:0px;padding:0px;"/>
        });<br style="margin:0px;padding:0px;"/>
}</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><strong style="margin:0px;padding:0px;">4.3   
创建消息消费者</strong></p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">我们首先创建一个一个用于消息监听的类，当名为”topic-test”的topic接收到消息之后，我们的这个listen方法就会调用。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">public class SimpleConsumerListener {<br style="margin:0px;padding:0px;"/>
    private
final static Logger <em style="margin:0px;padding:0px;">logger
</em>= LoggerFactory.<em style="margin:0px;padding:0px;">getLogger</em>(SimpleConsumerListener.class);<br style="margin:0px;padding:0px;"/>
    private final CountDownLatch latch1 = new CountDownLatch(1);<br style="margin:0px;padding:0px;"/>
<br style="margin:0px;padding:0px;"/>
    @KafkaListener(id =
&quot;foo&quot;, topics = &quot;topic-test&quot;)<br style="margin:0px;padding:0px;"/>
    public
void listen(byte[] records) {<br style="margin:0px;padding:0px;"/>
        //do
something here<br style="margin:0px;padding:0px;"/>
        this.latch1.countDown();<br style="margin:0px;padding:0px;"/>
    }<br style="margin:0px;padding:0px;"/>
}</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">         我们同时也需要将这个类作为一个Bean配置到KafkaConfig中</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">@Bean<br style="margin:0px;padding:0px;"/>
public SimpleConsumerListener simpleConsumerListener(){<br style="margin:0px;padding:0px;"/>
    return
new SimpleConsumerListener();<br style="margin:0px;padding:0px;"/>
}</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">默认spring-kafka会为每一个监听方法创建一个线程来向kafka服务器拉取消息</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"> </p>
<h1 style="padding:0px;font-size:28px;font-weight:bold;line-height:1.5;margin:10px 0px;">最后</h1>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">任何问题请联系hei12138@outlook.com</p></div>
<div style="margin:0px;padding:0px;clear:both;"></div>
<div style="margin:0px;padding:0px;margin-top:20px;">
<div style="margin:0px;padding:0px;margin-bottom:10px;"></div>
<div style="margin:0px;padding:0px;font-size:9pt;color:rgb(102, 102, 102);margin-top:0px;"></div>
<div style="margin:0px;padding:0px;"><div style="margin:0px;padding:10px 0px;margin-bottom:10px;margin-top:10px;border:1px dashed silver;font-size:12px;width:320px;text-align:center;">
        <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 8px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:rgba(0, 0, 0, 0.498039) 0px 1px 3px;text-shadow:rgba(0, 0, 0, 0.247059) 0px -1px 1px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D) repeat-x;background-color:rgb(45, 174, 191);color:rgb(255, 255, 255);border:none;">好文要顶</a>
            <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 8px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:rgba(0, 0, 0, 0.498039) 0px 1px 3px;text-shadow:rgba(0, 0, 0, 0.247059) 0px -1px 1px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D) repeat-x;background-color:rgb(227, 49, 0);color:rgb(255, 255, 255);border:none;">关注我</a>
    <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 8px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:rgba(0, 0, 0, 0.498039) 0px 1px 3px;text-shadow:rgba(0, 0, 0, 0.247059) 0px -1px 1px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAYAAABIdFAMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHhJREFUeNo8zjsOxCAMBFB/KEAUFFR0Cbng3nQPw68ArZdAlOZppPFIBhH5EAB8b+Tlt9MYQ6i1BuqFaq1CKSVcxZ2Acs6406KUgpt5/LCKuVgz5BDCSb13ZO99ZOdcZGvt4mJjzMVKqcha68iIePB86GAiOv8CDADlIUQBs7MD3wAAAABJRU5ErkJggg%3D%3D) repeat-x;background-color:rgb(255, 181, 21);color:rgb(255, 255, 255);border:none;">收藏该文</a>
    <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 2px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:none;text-shadow:none;background:none;color:rgb(255, 255, 255);border:none;" title="分享至新浪微博"><img src="kafka实战 - 嘿123 - 博客园_files/icon_weibo_24.png" type="image/png" data-filename="icon_weibo_24.png" height="24" style="margin:0px;padding:0px;height:auto;border:none;vertical-align:middle;margin-left:5px;box-shadow:none;max-width:300px;" width="24"/></a>
    <a href="#" style="margin-right:10px;margin:0px;border-radius:10px;padding:3px 2px;text-decoration:none;font-weight:bold;cursor:pointer;display:inline-block;vertical-align:middle;box-shadow:none;text-shadow:none;background:none;color:rgb(255, 255, 255);border:none;" title="分享至微信"><img src="kafka实战 - 嘿123 - 博客园_files/wechat.png" type="image/png" data-filename="wechat.png" height="24" style="margin:0px;padding:0px;border:medium none;width:24px;height:24px;box-shadow:none;margin-left:5px;vertical-align:middle;max-width:300px;" width="24"/></a>
</div>
<div style="margin:0px;padding:0px;float:left;width:280px;margin-top:0px;margin-bottom:10px;color:rgb(0, 0, 0);margin-left:0px;font-size:12px;">
    <div style="margin:0px;padding:0px;float:left;line-height:18px;">
            <a href="http://home.cnblogs.com/u/hei12138/" style="margin:0px;padding:0px;text-decoration:underline;color:rgb(7, 93, 179);" target="_blank"><img src="kafka实战 - 嘿123 - 博客园_files/sample_face.gif" type="image/gif" data-filename="sample_face.gif" height="48" style="margin:0px;padding:0px;height:auto;border:0px;vertical-align:top;float:left;margin-right:5px;padding-top:5px;padding-left:2px;max-width:300px;" width="48"/></a>
        <div style="margin:0px;padding:0px;float:left;line-height:18px;">
            <a href="http://home.cnblogs.com/u/hei12138/" style="margin:0px;padding:0px;text-decoration:underline;color:rgb(7, 93, 179);">嘿123</a><br style="margin:0px;padding:0px;"/>
            <a href="http://home.cnblogs.com/u/hei12138/followees" style="margin:0px;padding:0px;text-decoration:underline;color:rgb(7, 93, 179);">关注 - 0</a><br style="margin:0px;padding:0px;"/>
            <a href="http://home.cnblogs.com/u/hei12138/followers" style="margin:0px;padding:0px;text-decoration:underline;color:rgb(7, 93, 179);">粉丝 - 17</a>
        </div>
    </div>
    <div style="margin:0px;padding:0px;clear:both;"></div>
    <div style="margin:0px;padding:0px;"></div>
    <div style="margin:0px;padding:0px;">
                <a href="#" style="margin:0px;padding:0px;text-decoration:underline;color:rgb(7, 93, 179);">+加关注</a>
    </div>
</div>
<div style="margin:0px;padding:0px;float:right;margin-bottom:10px;margin-right:30px;font-size:12px;width:125px;text-align:center;margin-top:10px;">
    <div style="margin:0px;padding:0px;float:left;width:46px;height:52px;background:url(//static.cnblogs.com/images/upup.gif) no-repeat;text-align:center;cursor:pointer;margin-top:2px;padding-top:5px;">
        <span style="margin:0px;padding:0px;font-size:14px;color:rgb(7, 93, 179);font-family:Verdana;line-height:1.5em;">14</span>
    </div>
    <div style="text-align:center;padding:0px;margin:0px;height:52px;background:url(//static.cnblogs.com/images/downdown.gif) no-repeat;margin-left:20px;cursor:pointer;margin-top:2px;padding-top:5px;width:46px;float:right;">
        <span style="margin:0px;padding:0px;font-size:14px;color:rgb(7, 93, 179);font-family:Verdana;line-height:1.5em;">0</span>
    </div>
    <div style="margin:0px;padding:0px;clear:both;"></div>
    <div style="margin:0px;padding:0px;margin-top:5px;margin-left:0px;font-size:12px;color:gray;">
    </div>
</div>
</div>
<div style="margin:0px;padding:0px;clear:both;"></div>
<div style="margin:0px;padding:0px;line-height:1.8;font-size:12px;"><a href="http://www.cnblogs.com/hei12138/p/7694675.html" style="margin:0px;padding:0px;color:rgb(7, 93, 179);text-decoration:none;">« </a> 上一篇：<a href="http://www.cnblogs.com/hei12138/p/7694675.html" style="margin:0px;padding:0px;text-decoration:underline;color:rgb(7, 93, 179);" title="发布于2017-10-19 20:00">web容器启动后自动执行程序的几种方式比较</a><br style="margin:0px;padding:0px;"/><a href="http://www.cnblogs.com/hei12138/p/mybatis-spring.html" style="margin:0px;padding:0px;color:rgb(7, 93, 179);text-decoration:none;">» </a> 下一篇：<a href="http://www.cnblogs.com/hei12138/p/mybatis-spring.html" style="margin:0px;padding:0px;text-decoration:underline;color:rgb(7, 93, 179);" title="发布于2018-05-21 16:29">MyBatis-Spring中间件逻辑分析(怎么把Mapper接口注册到Spring中)</a><br style="margin:0px;padding:0px;"/></div>
</div>


		</div>
		<div style="margin:0px;padding:0px;clear:both;font-size:12px;float:right;width:100%;text-align:right;padding-right:5px;color:rgb(102, 102, 102);margin-top:5px;">posted @ <span style="margin:0px;padding:0px;">2017-11-08 18:31</span> <a href="http://www.cnblogs.com/hei12138/" style="margin:0px;padding:0px;text-decoration:none;color:rgb(7, 93, 179);">嘿123</a> 阅读(<span style="margin:0px;padding:0px;">61412</span>) 评论(<span style="margin:0px;padding:0px;">3</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=7805475" rel="nofollow" style="margin:0px;padding:0px;text-decoration:none;color:rgb(7, 93, 179);">编辑</a> <a href="https://www.cnblogs.com/hei12138/p/7805475.html#" style="margin:0px;padding:0px;text-decoration:none;color:rgb(7, 93, 179);">收藏</a></div>
	</div></div></div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 