<html>
<head>
  <title>一次过反爬虫的过五关斩六将</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="8522"/>
<h1>一次过反爬虫的过五关斩六将</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/3/20 18:09</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://mp.weixin.qq.com/s/EY-_V9-hC-jtMMwBXDGcrQ"><i>https://mp.weixin.qq.com/s/EY-_V9-hC-jtMMwBXDGcrQ</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="text-size-adjust:100%;line-height:1.6;"><div style="font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;line-height:inherit;background-color:rgb(255, 255, 255);"><div><div style="background-color:rgb(255, 255, 255);font-size:16px;word-wrap:break-word;"><div style="background-color:rgb(255, 255, 255);"><div>
                
                <h2 style="margin:0px;padding:0px;font-weight:400;font-size:24px;margin-bottom:14px;line-height:1.4;padding-bottom:10px;border-bottom:1px solid rgb(231, 231, 235);">
                    一次过反爬虫的过五关斩六将                                    </h2>
                <div style="margin:0px;padding:0px;margin-bottom:18px;line-height:20px;font-size:0px;position:relative;z-index:1;">
                                        <span style="font-size:15px;margin:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;padding:1px 0.5em;border:1px solid rgb(158, 158, 158);color:rgb(140, 140, 140);border-radius:20% 50%;line-height:1.1;max-width:none;">原创</span>
                                                            <em style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;color:rgb(140, 140, 140);max-width:none;font-style:normal;">2018-03-20</em>

                                        <em style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;color:rgb(140, 140, 140);max-width:none;font-style:normal;">ali0th</em>
                                        <a href="https://mp.weixin.qq.com/s/EY-_V9-hC-jtMMwBXDGcrQ##" style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;max-width:none;display:inline-block;">先知安全技术社区</a>
                    


                    
                </div>
                
                
                
                
                                                
                                                                
                
                <div style="margin:0px;padding:0px;overflow:hidden;color:rgb(62, 62, 62);min-height:350px;position:relative;">
                    

                    

                    
                    
                    <h3 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(62, 62, 62);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255, 41, 65);">先知安全技术社区独家发文，如需转载，请先联系社区授权；未经授权请勿转载。</strong></h3><h2 style="font-weight:bold;font-size:1.4em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-top:1.3em;margin-bottom:1em;border-bottom:1px solid rgb(238, 238, 238);">前言</h2><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">码一下半年前的一次过反爬虫的经历，不知道这个反爬虫有没有改进了，主要还是看看思路吧:)</p><h2 style="font-weight:bold;font-size:1.4em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-top:1.3em;margin-bottom:1em;border-bottom:1px solid rgb(238, 238, 238);">第一关：拿到javascript内容</h2><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">一开始浏览器看不到反爬虫的js代码。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">难点：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">一开始打开这个网站，比较难留意到有个状态是521页面的跳转。因为这个页面一小时只出现一次，并且为1500毫秒。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">过关技巧：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">阻止cookie来获得javascript</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">具体实现：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">删除cookie并阻止</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640.webp" type="image/webp" data-filename="640.webp" height="403" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">查看源码</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [1].webp" type="image/webp" data-filename="640.webp" height="388" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><h2 style="font-weight:bold;font-size:1.4em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-top:1.3em;margin-bottom:1em;border-bottom:1px solid rgb(238, 238, 238);">第二关：获得真实代码</h2><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">难点：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">将真正的代码隐藏起来，阻止了那些直接一上来就解码的人。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">过关技巧：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">找到最终输出点为eval</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">具体实现：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">1）美化<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>使用【http://jsbeautifier.org/】</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [2].webp" type="image/webp" data-filename="640.webp" height="302" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">2）理解代码</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [3].webp" type="image/webp" data-filename="640.webp" height="317" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="574"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">可以看到eval是最后一步，说明这里最后是通过eval来拼接并执行程序。所以这里可以把eval改为【console.log】放到F12的console口里看一下结果。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [4].webp" type="image/webp" data-filename="640.webp" height="612" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">可以看到黄色部分为运行结果，说明是二次混淆了，这个黄色部分才是真实代码。复制出来看。如下：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [5].webp" type="image/webp" data-filename="640.webp" height="314" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">把头尾的东西去掉，没用的。再美化之后：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [6].webp" type="image/webp" data-filename="640.webp" height="557" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><h2 style="font-weight:bold;font-size:1.4em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-top:1.3em;margin-bottom:1em;border-bottom:1px solid rgb(238, 238, 238);">第三关：修正代码</h2><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">难点：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">如果你看到上面有个eval就使用第二关的方法，那就错了，这里的eval在代码中间，只是用来拼接用的。而且这里还有个故意留下的坑，就是让程序运行错误，所以这里要好好理解代码，弄懂其逻辑。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">过关技巧：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">放到IDE里梳理代码。(这里使用ecilpse)</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">具体实现：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">1）代码贴到ecilpse里</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [7].webp" type="image/webp" data-filename="640.webp" height="268" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">使用eclipse搭建一个js的测试页面，随时用浏览器刷新查看结果。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">2）理清代码总体逻辑，并去掉不重要代码</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [8].webp" type="image/webp" data-filename="640.webp" height="398" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">如图为整体代码的大逻辑，于是我们可以去掉不重要的代码，留下重要部分，放到eclipse里调试。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">代码为：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [9].webp" type="image/webp" data-filename="640.webp" height="390" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="594"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">最后的dc即输出了我们要的结果。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">3）输出dc出来</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">在最后写上一句【console.log(dc);】然后放到F12里：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [10].webp" type="image/webp" data-filename="640.webp" height="84" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="275"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">看，这就是我们得到要的结果。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [11].webp" type="image/webp" data-filename="640.webp" height="454" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="654"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">但是,放在python里，这样流程走下来的结果偶尔会对，偶尔又不行了。为什么呢？还要继续深挖。</p><h2 style="font-weight:bold;font-size:1.4em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-top:1.3em;margin-bottom:1em;border-bottom:1px solid rgb(238, 238, 238);">第四关：jsfuck</h2><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">难点：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">特殊字符</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">过关技巧：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">细心</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">具体分析：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">cd数组，没错我们要搞cd数组。看起来应该是jsfuck，打CTF经常会遇到。但这里的话要怎么去分解他呢？看到这个地方：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [12].webp" type="image/webp" data-filename="640.webp" height="110" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="537"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">再仔细看看：<code style="padding-right:0.3em;margin:0px;border-radius:3px;background-color:rgb(248, 248, 248);border-color:rgb(234, 234, 234);font-size:0.85em;font-family:Consolas, Inconsolata, Courier, monospace;margin-right:0.15em;margin-left:0.15em;padding:0px;padding-left:0.3em;white-space:pre-wrap;border-width:1px;border-style:solid;word-wrap:break-word;box-sizing:border-box;max-width:100%;display:inline;">f.reverse()[[-~[]]](cd[i])</code>其中，reverse()是逆序的意思，可以先去掉，就剩下：<code style="padding-right:0.3em;margin:0px;border-radius:3px;background-color:rgb(248, 248, 248);border-color:rgb(234, 234, 234);font-size:0.85em;font-family:Consolas, Inconsolata, Courier, monospace;margin-right:0.15em;margin-left:0.15em;padding:0px;padding-left:0.3em;white-space:pre-wrap;border-width:1px;border-style:solid;word-wrap:break-word;box-sizing:border-box;max-width:100%;display:inline;">f[[-~[]]](cd[i])</code></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">这个的形式其实就是<code style="padding-right:0.3em;margin:0px;border-radius:3px;background-color:rgb(248, 248, 248);border-color:rgb(234, 234, 234);font-size:0.85em;font-family:Consolas, Inconsolata, Courier, monospace;margin-right:0.15em;margin-left:0.15em;padding:0px;padding-left:0.3em;white-space:pre-wrap;border-width:1px;border-style:solid;word-wrap:break-word;box-sizing:border-box;max-width:100%;display:inline;">f[ ]( )</code>，就是调用上面的f函数的形式，那么最奇怪的点就在这里<code style="padding-right:0.3em;margin:0px;border-radius:3px;background-color:rgb(248, 248, 248);border-color:rgb(234, 234, 234);font-size:0.85em;font-family:Consolas, Inconsolata, Courier, monospace;margin-right:0.15em;margin-left:0.15em;padding:0px;padding-left:0.3em;white-space:pre-wrap;border-width:1px;border-style:solid;word-wrap:break-word;box-sizing:border-box;max-width:100%;display:inline;">[ ]</code>里的<code style="padding-right:0.3em;margin:0px;border-radius:3px;background-color:rgb(248, 248, 248);border-color:rgb(234, 234, 234);font-size:0.85em;font-family:Consolas, Inconsolata, Courier, monospace;margin-right:0.15em;margin-left:0.15em;padding:0px;padding-left:0.3em;white-space:pre-wrap;border-width:1px;border-style:solid;word-wrap:break-word;box-sizing:border-box;max-width:100%;display:inline;">[-~[]]</code>，它是直接用的！<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>于是我试着直接看它是值是什么：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [13].webp" type="image/webp" data-filename="640.webp" height="98" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="362"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">它直接就是值为1的数组。那么直接看cd的值试试：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [14].webp" type="image/webp" data-filename="640.webp" height="547" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">没错是一堆数组。用python看，里面是有几层数组：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [15].webp" type="image/webp" data-filename="640.webp" height="134" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="586"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">为什么会这样呢？js的什么特性导致了？想了半天，想到了很多年前看到的一篇文章【http://www.freebuf.com/sectool/5352.html】：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [16].webp" type="image/webp" data-filename="640.webp" height="385" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">好了，过了这一关，基本上算是转折点，快接近终点了。</p><h2 style="font-weight:bold;font-size:1.4em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-top:1.3em;margin-bottom:1em;border-bottom:1px solid rgb(238, 238, 238);">第五关：列表里的列表</h2><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">难点：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">f函数逻辑。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">过关技巧：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">看懂f函数逻辑，慢慢调试才知每部分的功能。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">具体分析：</strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">上一关我们看到数组里面还要数组，那么我们就要看各个数组对应的是什么值。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>经过调试，发现最多出现三层数组。我们分别命名为x、y、z层。其中：</p><blockquote style="margin-top:1.2em;margin:0px;color:rgb(119, 119, 119);padding-right:1em;border-left-color:rgb(221, 221, 221);padding-left:1em;border-left:3px solid rgb(219, 219, 219);padding:0px;margin-bottom:1.2em;border-left-width:4px;word-wrap:break-word;box-sizing:border-box;max-width:100%;quotes:none;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">x层直接为字符串，只要拼接就行了。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">y1层为ascii码。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">y2层和z层为对应当前url的第n个字符。这就是为什么上面第三关还不算成功的原因。</p></blockquote><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [17].webp" type="image/webp" data-filename="640.webp" height="216" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="422"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">再具体看一下z层，下面这个函数可以获得当前的页面的url，所以每个网站都不一样的。所以这一层个人认为是个相当棒的设计。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [18].webp" type="image/webp" data-filename="640.webp" height="231" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="508"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">比如这里访问的是<code style="padding-right:0.3em;margin:0px;border-radius:3px;background-color:rgb(248, 248, 248);border-color:rgb(234, 234, 234);font-size:0.85em;font-family:Consolas, Inconsolata, Courier, monospace;margin-right:0.15em;margin-left:0.15em;padding:0px;padding-left:0.3em;white-space:pre-wrap;border-width:1px;border-style:solid;word-wrap:break-word;box-sizing:border-box;max-width:100%;display:inline;">http://localhost/</code>，那么先过滤出来<code style="padding-right:0.3em;margin:0px;border-radius:3px;background-color:rgb(248, 248, 248);border-color:rgb(234, 234, 234);font-size:0.85em;font-family:Consolas, Inconsolata, Courier, monospace;margin-right:0.15em;margin-left:0.15em;padding:0px;padding-left:0.3em;white-space:pre-wrap;border-width:1px;border-style:solid;word-wrap:break-word;box-sizing:border-box;max-width:100%;display:inline;">localhost/</code>，然后如果cd里这个z层数组值是4，那么得到的字符是<code style="padding-right:0.3em;margin:0px;border-radius:3px;background-color:rgb(248, 248, 248);border-color:rgb(234, 234, 234);font-size:0.85em;font-family:Consolas, Inconsolata, Courier, monospace;margin-right:0.15em;margin-left:0.15em;padding:0px;padding-left:0.3em;white-space:pre-wrap;border-width:1px;border-style:solid;word-wrap:break-word;box-sizing:border-box;max-width:100%;display:inline;">a</code>。所以最终，这个cd数组根据每一层的转换，就能变为：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [19].webp" type="image/webp" data-filename="640.webp" height="229" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="370"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;">然后拼接dc就是最终我们要的结果了啦啦啦：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;margin-bottom:1.2em !important;"><img src="一次过反爬虫的过五关斩六将_files/640 [20].webp" type="image/webp" data-filename="640.webp" height="114" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="452"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;margin-bottom:1.2em !important;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);"><div style="font-size:16px;margin:0px;border-color:initial;border-style:none;border-width:0px;margin-top:5px;padding:0px;line-height:normal;word-wrap:break-word;box-sizing:border-box;max-width:100%;background-image:none;"><div style="visibility:visible;margin:0px;background-color:rgb(51, 179, 235);box-shadow:rgb(190, 190, 190) 0px 3px 5px;border-radius:10px;margin-top:-1px;min-height:40px;padding:0px;height:40px;line-height:40px;word-wrap:break-word;box-sizing:border-box;max-width:100%;color:rgb(255, 255, 255);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;text-align:center;">↙↙↙   点击“阅读原文”查看相关话题探讨</span></div></div></div>
                </div>
                
                
                
                                
                

                
                                
                
                            </div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 