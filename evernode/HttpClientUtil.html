<html>
<head>
  <title>HttpClientUtil</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="12274"/>
<h1>HttpClientUtil</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/1/8 12:02</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2018/1/8 12:02</i></td></tr>
<tr><td><b>标签：</b></td><td><i>http, util</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><br/></div><div>import org.apache.http.Header;</div><div>import org.apache.http.HttpEntity;</div><div>import org.apache.http.client.ClientProtocolException;</div><div>import org.apache.http.client.methods.CloseableHttpResponse;</div><div>import org.apache.http.client.methods.HttpGet;</div><div>import org.apache.http.client.methods.HttpPost;</div><div>import org.apache.http.entity.ContentType;</div><div>import org.apache.http.entity.StringEntity;</div><div>import org.apache.http.entity.mime.MultipartEntityBuilder;</div><div>import org.apache.http.entity.mime.content.FileBody;</div><div>import org.apache.http.entity.mime.content.StringBody;</div><div>import org.apache.http.impl.client.CloseableHttpClient;</div><div>import org.apache.http.impl.client.HttpClientBuilder;</div><div>import org.apache.http.impl.client.HttpClients;</div><div>import org.apache.http.ssl.SSLContextBuilder;</div><div>import org.apache.http.ssl.TrustStrategy;</div><div>import org.apache.http.util.EntityUtils;</div><div><br/></div><div>import <a href="http://javax.net.ssl.sslcontext/">javax.net.ssl.SSLContext</a>;</div><div>import java.io.File;</div><div>import java.io.IOException;</div><div>import java.security.cert.CertificateException;</div><div>import java.security.cert.X509Certificate;</div><div>import java.util.Enumeration;</div><div>import java.util.Hashtable;</div><div><br/></div><div>public class HttpClientUtil {</div><div><br/></div><div>    public static Hashtable postHttp(String uri, String s, Hashtable head) {</div><div>        CloseableHttpClient httpclient = null;</div><div>        CloseableHttpResponse response = null;</div><div>        try {</div><div>            httpclient = getHttpClient(uri);</div><div>            HttpPost httppost = new HttpPost(uri);</div><div>            StringEntity body = new StringEntity(s, &quot;utf-8&quot;);</div><div>            body.setContentEncoding(&quot;UTF-8&quot;);</div><div>            body.setContentType(&quot;text/html&quot;);</div><div>            httppost.setEntity(body);</div><div>            Enumeration en = head.keys();</div><div>            while (en.hasMoreElements()) {</div><div>                String ok = en.nextElement().toString();</div><div>                httppost.setHeader(ok, head.get(ok).toString());</div><div>            }</div><div>            response = httpclient.execute(httppost);</div><div>            return getHttpResponse(response);</div><div>        } catch (Exception e) {</div><div>            e.printStackTrace();</div><div>            return new Hashtable();</div><div>        } finally {</div><div>            try {</div><div>                if (response != null) {</div><div>                    response.close();</div><div>                }</div><div>                if (httpclient != null) {</div><div>                    httpclient.close();</div><div>                }</div><div>            } catch (IOException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        }</div><div>    }</div><div><br/></div><div>    public static Hashtable getHttp(String uri, Hashtable head) {</div><div>        CloseableHttpClient httpclient = null;</div><div>        CloseableHttpResponse response = null;</div><div>        try {</div><div>            httpclient = getHttpClient(uri);</div><div>            HttpGet httpget = new HttpGet(uri);</div><div>            Enumeration en = head.keys();</div><div>            while (en.hasMoreElements()) {</div><div>                String ok = en.nextElement().toString();</div><div>                httpget.setHeader(ok, head.get(ok).toString());</div><div>            }</div><div>            response = httpclient.execute(httpget);</div><div>            return getHttpResponse(response);</div><div>        } catch (Exception e) {</div><div>            e.printStackTrace();</div><div>            return new Hashtable();</div><div>        } finally {</div><div>            try {</div><div>                if (response != null) {</div><div>                    response.close();</div><div>                }</div><div>                if (httpclient != null) {</div><div>                    httpclient.close();</div><div>                }</div><div>            } catch (IOException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        }</div><div><br/></div><div>    }</div><div><br/></div><div>    private static CloseableHttpClient getHttpClient(String uri) throws Exception {</div><div>        if (uri.contains(&quot;https:&quot;)) {</div><div>            HttpClientBuilder httpClientBuilder = HttpClientBuilder.create();</div><div>            SSLContext sslContext = new SSLContextBuilder().loadTrustMaterial(null, new TrustStrategy() {</div><div>                public boolean isTrusted(X509Certificate[] chain, String authType) throws CertificateException {</div><div>                    return true;</div><div>                }</div><div>            }).build();</div><div>            httpClientBuilder.setSSLContext(sslContext);</div><div>            return httpClientBuilder.build();</div><div>        } else {</div><div>            return HttpClients.createDefault();</div><div>        }</div><div>    }</div><div><br/></div><div>    private static Hashtable getHttpResponse(CloseableHttpResponse response) throws IOException {</div><div>        Hashtable ht = new Hashtable();</div><div>        ht.put(&quot;StatusCode&quot;, response.getStatusLine().getStatusCode());</div><div>        HttpEntity entity = response.getEntity();</div><div>        if (entity != null) {</div><div>            ht.put(&quot;Entity&quot;, EntityUtils.toString(entity, &quot;UTF-8&quot;));</div><div>            for (Header hd : response.getAllHeaders()) {</div><div>                ht.put(hd.getName(), hd.getValue());</div><div>            }</div><div>        }</div><div>        return ht;</div><div>    }</div><div><br/></div><div>    </div><div>    private void upload() {</div><div>        CloseableHttpClient httpclient = HttpClients.createDefault();</div><div>        try {</div><div>            HttpPost httppost = new HttpPost(&quot;<a href="http://localhost:8080/myDemo/Ajax/serivceFile.action">http://localhost:8080/myDemo/Ajax/serivceFile.action</a>&quot;);</div><div>            FileBody bin = new FileBody(new File(&quot;F:\\image\\sendpix0.jpg&quot;));</div><div>            StringBody comment = new StringBody(&quot;A binary file of some kind&quot;, ContentType.TEXT_PLAIN);</div><div><br/></div><div>            HttpEntity reqEntity = MultipartEntityBuilder.create().addPart(&quot;bin&quot;, bin).addPart(&quot;comment&quot;, comment).build();</div><div><br/></div><div>            httppost.setEntity(reqEntity);</div><div><br/></div><div>            System.out.println(&quot;executing request &quot; + httppost.getRequestLine());</div><div>            CloseableHttpResponse response = httpclient.execute(httppost);</div><div>            try {</div><div>                System.out.println(&quot;----------------------------------------&quot;);</div><div>                System.out.println(response.getStatusLine());</div><div>                HttpEntity resEntity = response.getEntity();</div><div>                if (resEntity != null) {</div><div>                    System.out.println(&quot;Response content length: &quot; + resEntity.getContentLength());</div><div>                }</div><div>                EntityUtils.consume(resEntity);</div><div>            } finally {</div><div>                response.close();</div><div>            }</div><div>        } catch (ClientProtocolException e) {</div><div>            e.printStackTrace();</div><div>        } catch (IOException e) {</div><div>            e.printStackTrace();</div><div>        } finally {</div><div>            try {</div><div>                httpclient.close();</div><div>            } catch (IOException e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        }</div><div>    }</div><div><br/></div><div>}</div><div><br/></div></span>
</div></body></html> 