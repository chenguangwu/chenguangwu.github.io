<html>
<head>
  <title>正确使用 Volatile 变量</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6064"/>
<h1>正确使用 Volatile 变量</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/11/13 17:44</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://www.ibm.com/developerworks/cn/java/j-jtp06197.html"><i>http://www.ibm.com/developerworks/cn/java/j-jtp06197.html</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="vertical-align:baseline;background:rgb(236, 236, 236);font-size:16px;font-family:Arial, sans-serif;color:rgb(50, 50, 50);"><div style="vertical-align:baseline;background:rgb(236, 236, 236);direction:ltr;font-size:16px;color:rgb(50, 50, 50);font-family:ibm-plex-sans, &quot;Helvetica Neue&quot;, Arial, sans-serif;"><div style="vertical-align:baseline;font-size:1rem;background:rgb(255, 255, 255);overflow:hidden;"><div style="vertical-align:baseline;font-size:1rem;"><span><div style="vertical-align:baseline;font-size:1rem;background:rgb(255, 255, 255);min-width:1200px;"><div style="vertical-align:baseline;font-size:1rem;"><div style="vertical-align:baseline;font-size:1rem;background:rgb(255, 255, 255);"><div style="vertical-align:baseline;font-size:1rem;"><div style="vertical-align:baseline;font-size:1rem;">
                                      
                                    <div style="border:0px;vertical-align:baseline;font-size:1rem;margin:0px;padding:0px 10px;box-sizing:border-box;float:left;min-height:1px;width:100%;">
                                        <div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;transition:top 0.5s;top:132px;position:fixed;width:380px;height:362px;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;right:-17px;">
                                            <h2 style="margin:0px;padding:0px 0px 15px;border:0px;vertical-align:baseline;font-weight:normal;font-size:0.9375rem;line-height:1.25rem;color:rgb(119, 118, 119);margin-top:7px;padding-bottom:6px;">内容</h2><div style="padding:0px;border:0px;vertical-align:baseline;font-size:1rem;border-top:1px solid rgb(199, 199, 199);clear:both;min-height:1px;margin:7px 0px 9px;margin-right:77px;"></div><ul style="border:0px;vertical-align:baseline;margin:0px;list-style:none;font-size:1rem;line-height:1.625rem;padding:0px 0px 22px;padding-right:77px;padding-left:1px;position:relative;"><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:0px;color:rgb(50, 50, 50);font-size:0.9375rem;line-height:1.25rem;"><span style="font-size:0.9375rem;line-height:1.25rem;color:rgb(50, 50, 50);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;"></span><a style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;text-decoration:none;color:rgb(0, 118, 112);transition:color 0.2s;font-weight:bold;"><span style="font-size:inherit;color:rgb(0, 118, 112);font-weight:bold;text-decoration:none;"></span>概览<span style="font-size:inherit;color:rgb(0, 118, 112);font-weight:bold;text-decoration:none;"></span></a></li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:0px;color:rgb(50, 50, 50);padding-top:20px;font-size:0.9375rem;line-height:1.25rem;"><span style="font-size:0.9375rem;line-height:1.25rem;color:rgb(50, 50, 50);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;"></span><a style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;text-decoration:none;color:rgb(102, 102, 102);"><span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span>Volatile 变量<span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span></a></li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:0px;color:rgb(50, 50, 50);padding-top:20px;font-size:0.9375rem;line-height:1.25rem;"><span style="font-size:0.9375rem;line-height:1.25rem;color:rgb(50, 50, 50);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;"></span><a style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;text-decoration:none;color:rgb(102, 102, 102);"><span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span>正确使用 volatile 的模式<span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span></a></li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:0px;color:rgb(50, 50, 50);padding-top:20px;font-size:0.9375rem;line-height:1.25rem;"><span style="font-size:0.9375rem;line-height:1.25rem;color:rgb(50, 50, 50);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;"></span><a style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;text-decoration:none;color:rgb(102, 102, 102);"><span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span>volatile 的高级模式<span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span></a></li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:0px;color:rgb(50, 50, 50);padding-top:20px;font-size:0.9375rem;line-height:1.25rem;"><span style="font-size:0.9375rem;line-height:1.25rem;color:rgb(50, 50, 50);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;"></span><a style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;text-decoration:none;color:rgb(102, 102, 102);"><span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span>结束语<span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span></a></li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:0px;color:rgb(50, 50, 50);padding-top:20px;font-size:0.9375rem;line-height:1.25rem;"><span style="font-size:0.9375rem;line-height:1.25rem;color:rgb(50, 50, 50);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;"></span><a style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;text-decoration:none;color:rgb(102, 102, 102);"><span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span>相关主题<span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span></a></li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:0px;color:rgb(50, 50, 50);padding-top:20px;font-size:0.9375rem;line-height:1.25rem;"><span style="font-size:0.9375rem;line-height:1.25rem;color:rgb(50, 50, 50);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;"></span><a style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;text-decoration:none;color:rgb(102, 102, 102);"><span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span>评论<span style="font-size:inherit;color:rgb(102, 102, 102);text-decoration:none;"></span></a></li></ul>
                                        </div></div>
                                    </div>
                                    
                                    
                                    
                                    <div style="border:0px;vertical-align:baseline;font-size:1rem;margin:0px;padding:0px 10px;box-sizing:border-box;float:left;min-height:1px;width:100%;">
                                            <p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.5625rem;padding:0px 0px 22px;font-size:1.125rem;color:rgb(118, 118, 118);padding-bottom:5px;">Java 理论与实践</p>
                                        <h1 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;line-height:2.8125rem;padding:0px;color:rgb(74, 74, 74);font-size:2.8125rem;">正确使用 Volatile 变量</h1><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.5625rem;margin-top:16px;padding:0px;font-size:1.25rem;color:rgb(118, 118, 118);">volatile 变量使用指南 </p>
                                        
                                                <div style="border:0px;vertical-align:baseline;font-size:1rem;clear:both;margin:0px -10px;padding:0px;width:auto;margin-top:40px;margin-bottom:30px;">
                                                    
                                                    <div style="border:0px;vertical-align:baseline;font-size:1rem;margin:0px;padding:0px 10px;box-sizing:border-box;float:left;min-height:1px;width:100%;display:table;">
                                                        <div style="margin:0px;padding:0px;border:0px;font-size:1rem;vertical-align:top;display:table-cell;width:62px;"><img src="正确使用 Volatile 变量_files/dw-author.png" type="image/png" data-filename="dw-author.png" alt="" height="42" style="margin:0px;padding:0px;vertical-align:baseline;font-size:inherit;border:1px solid rgb(153, 153, 153);border-radius:50%;" width="42"/></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;display:table-cell;line-height:1.3rem;font-size:0.875rem;">Brian Goetz<br/><span style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(138, 138, 138);line-height:1.3rem;">2007 年 7 月 05 日发布</span></div>
                                                    </div>
                                                    
                                                    <div style="border:0px;vertical-align:baseline;font-size:1rem;margin:0px;padding:0px 10px;box-sizing:border-box;float:left;min-height:1px;width:100%;display:table;">
                                                        
                                                        <div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;">
                                                            <div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;float:right;margin-right:20px;display:table-cell;height:29px;">
                                                                <div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><p style="margin:0px;border:0px;vertical-align:baseline;padding-bottom:0px;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);line-height:1.75rem;"><a href="http://service.weibo.com/share/share.php?url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-jtp06197.html%&amp;title=Java%20%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%3A%20%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%20Volatile%20%E5%8F%98%E9%87%8F&amp;language=zh_cn" style="position:relative;transition:color 0.3s;border:0px;vertical-align:baseline;font-size:inherit;text-decoration:none;margin-bottom:10px;color:rgb(50, 50, 50);margin:0px;padding:3px 0px;float:left;height:1.75em;display:block;margin-right:14px;overflow:hidden;text-indent:100px;width:1.55em;"><span style="font-size:inherit;color:rgb(0, 0, 0);text-indent:100px;text-decoration:none;display:inline-block;font-family:icons-ibm-v11;font-style:normal;font-weight:normal;font-variant-ligatures:normal;font-variant-caps:normal;left:-1px;position:absolute;speak:none;text-rendering:optimizeLegibility;text-transform:none;-webkit-font-smoothing:antialiased;"></span>Weibo<span style="font-size:1.6em;color:rgb(50, 50, 50);text-indent:100px;text-decoration:none;display:inline-block;font-family:icons-ibm-v11;font-style:normal;font-weight:normal;font-variant-ligatures:normal;font-variant-caps:normal;left:-1px;position:absolute;speak:none;text-rendering:optimizeLegibility;text-transform:none;-webkit-font-smoothing:antialiased;"></span></a><a href="https://plus.google.com/share?url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-jtp06197.html&amp;t=Java%20%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%3A%20%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%20Volatile%20%E5%8F%98%E9%87%8F" style="position:relative;transition:color 0.3s;border:0px;vertical-align:baseline;font-size:inherit;text-decoration:none;margin-bottom:10px;color:rgb(50, 50, 50);margin:0px;padding:3px 0px;float:left;height:1.75em;display:block;margin-right:14px;overflow:hidden;text-indent:100px;width:1.55em;"><span style="font-size:inherit;color:rgb(0, 0, 0);text-indent:100px;text-decoration:none;display:inline-block;font-family:icons-ibm-v11;font-style:normal;font-weight:normal;font-variant-ligatures:normal;font-variant-caps:normal;left:-1px;position:absolute;speak:none;text-rendering:optimizeLegibility;text-transform:none;-webkit-font-smoothing:antialiased;"></span>Google+<span style="font-size:1.6em;color:rgb(50, 50, 50);text-indent:100px;text-decoration:none;display:inline-block;font-family:icons-ibm-v11;font-style:normal;font-weight:normal;font-variant-ligatures:normal;font-variant-caps:normal;left:-1px;position:absolute;speak:none;text-rendering:optimizeLegibility;text-transform:none;-webkit-font-smoothing:antialiased;"></span></a><a href="https://www.ibm.com/developerworks/cn/java/j-jtp06197.htmlmailto:?subject=Java%20%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5%3A%20%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%20Volatile%20%E5%8F%98%E9%87%8F&amp;body=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fjava%2Fj-jtp06197.html" style="position:relative;transition:color 0.3s;border:0px;vertical-align:baseline;font-size:inherit;text-decoration:none;margin-bottom:10px;color:rgb(50, 50, 50);margin:0px;padding:3px 0px;float:left;height:1.75em;display:block;overflow:hidden;text-indent:100px;width:1.55em;margin-right:0px;"><span style="font-size:inherit;color:rgb(0, 0, 0);text-indent:100px;text-decoration:none;display:inline-block;font-family:icons-ibm-v11;font-style:normal;font-weight:normal;font-variant-ligatures:normal;font-variant-caps:normal;left:-1px;position:absolute;speak:none;text-rendering:optimizeLegibility;text-transform:none;-webkit-font-smoothing:antialiased;"></span>用电子邮件发送本页面<span style="font-size:1.6em;color:rgb(50, 50, 50);text-indent:100px;text-decoration:none;display:inline-block;font-family:icons-ibm-v11;font-style:normal;font-weight:normal;font-variant-ligatures:normal;font-variant-caps:normal;left:-1px;position:absolute;speak:none;text-rendering:optimizeLegibility;text-transform:none;-webkit-font-smoothing:antialiased;"></span></a><span style="font-size:1.0625rem;line-height:1.75rem;color:rgb(50, 50, 50);clear:both;display:block;height:0px;visibility:hidden;"></span></p></div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div style="margin:0px;padding:0px;border:0px;font-size:1rem;vertical-align:top;display:table-cell;padding-top:4px;width:60px;">
                                                            <div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;display:inline-block;">
                                                                <a href="https://www.ibm.com/developerworks/cn/java/j-jtp06197.html#icomments" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;transition:color 0.3s;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span>
                                                                    <img src="正确使用 Volatile 变量_files/dw-article-cmt-icon.png" type="image/png" data-filename="dw-article-cmt-icon.png" alt="Comments" height="29" style="margin:0px;padding:0px;border:0px;font-size:inherit;vertical-align:middle;margin-top:-2px;" width="29"/>
                                                                <span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a>
                                                            </div>
                                                            <div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;display:inline-block;">
                                                                <a href="https://www.ibm.com/developerworks/cn/java/j-jtp06197.html#icomments" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;transition:color 0.3s;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span>
                                                                    <div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;display:inline-block;color:rgb(138, 138, 138);">19</div>
                                                                <span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                <span style="font-size:1rem;clear:both;display:block;height:0px;visibility:hidden;overflow:hidden;"> </span></div>
<div style="margin:0px;padding:0px;vertical-align:baseline;font-size:1rem;border:1px solid rgb(238, 238, 238);background-color:rgb(249, 249, 249);margin-top:-20px;margin-bottom:25px;padding-bottom:20px;display:block;"><h3 style="font-weight:bold;font-size:1.1rem;margin:0px;padding:24px 0px 28px;border:0px;vertical-align:baseline;line-height:1.875rem;clear:left;color:rgb(63, 63, 63);margin-left:25px;padding-bottom:0px;padding-top:15px;">系列内容：</h3><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;display:block;"><h2 style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;font-weight:normal;padding:20px 15px 20px 25px;color:rgb(102, 102, 102);">此内容是该系列的一部分：<a href="http://www.ibm.com/developerworks/cn/java/j-jtp/" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;transition:color 0.3s;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span><span style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;font-weight:bold;padding-left:5px;">Java 理论与实践</span><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a></h2></div></div>
                                        
                                        
                                        <p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
Java 语言中的 volatile 变量可以被看作是一种 “程度较轻的 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code>”；与 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code> 块相比，volatile 变量所需的编码较少，并且运行时开销也较少，但是它所能实现的功能也仅是 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code> 的一部分。本文介绍了几种有效使用 volatile 变量的模式，并强调了几种不适合使用 volatile 变量的情形。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
锁提供了两种主要特性：<em style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;font-style:italic;">互斥（mutual exclusion）</em> 和<em style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;font-style:italic;">可见性（visibility）</em>。互斥即一次只允许一个线程持有某个特定的锁，因此可使用该特性实现对共享数据的协调访问协议，这样，一次就只有一个线程能够使用该共享数据。可见性要更加复杂一些，它必须确保释放锁之前对共享数据做出的更改对于随后获得该锁的另一个线程是可见的 —— 如果没有同步机制提供的这种可见性保证，线程看到的共享变量可能是修改前的值或不一致的值，这将引发许多严重问题。
</p><h2 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:2.1875rem;line-height:2.5rem;padding:12px 0px 28px;clear:left;color:rgb(63, 63, 63);">Volatile 变量</h2><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
Volatile 变量具有 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code> 的可见性特性，但是不具备原子特性。这就是说线程能够自动发现 volatile 变量的最新值。Volatile 变量可用于提供线程安全，但是只能应用于非常有限的一组用例：多个变量之间或者某个变量的当前值与修改后值之间没有约束。因此，单独使用 volatile 还不足以实现计数器、互斥锁或任何具有与多个变量相关的不变式（Invariants）的类（例如 “start &lt;=end”）。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
出于简易性或可伸缩性的考虑，您可能倾向于使用 volatile 变量而不是锁。当使用 volatile 变量而非锁时，某些习惯用法（idiom）更加易于编码和阅读。此外，volatile 变量不会像锁那样造成线程阻塞，因此也很少造成可伸缩性问题。在某些情况下，如果读操作远远大于写操作，volatile 变量还可以提供优于锁的性能优势。
</p><h3 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:1.5625rem;line-height:1.875rem;padding:24px 0px 28px;clear:left;color:rgb(63, 63, 63);">正确使用 volatile 变量的条件</h3><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">您只能在有限的一些情形下使用 volatile 变量替代锁。要使 volatile 变量提供理想的线程安全，必须同时满足下面两个条件：</p><ul style="border:0px;vertical-align:baseline;margin:0px;list-style:none;font-size:1rem;line-height:1.625rem;padding:0px 0px 22px;"><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:28px;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span>对变量的写操作不依赖于当前值。</li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:28px;padding-top:7px;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span>该变量没有包含在具有其他变量的不变式中。</li></ul><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
实际上，这些条件表明，可以被写入 volatile 变量的这些有效值独立于任何程序的状态，包括变量的当前状态。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
第一个条件的限制使 volatile 变量不能用作线程安全计数器。虽然增量操作（<code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">x++</code>）看上去类似一个单独操作，实际上它是一个由读取－修改－写入操作序列组成的组合操作，必须以原子方式执行，而 volatile 不能提供必须的原子特性。实现正确的操作需要使 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">x</code> 的值在操作期间保持不变，而 volatile 变量无法实现这点。（然而，如果将值调整为只从单个线程写入，那么可以忽略第一个条件。）
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
大多数编程情形都会与这两个条件的其中之一冲突，使得 volatile 变量不能像 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code> 那样普遍适用于实现线程安全。清单 1 显示了一个非线程安全的数值范围类。它包含了一个不变式 —— 下界总是小于或等于上界。
</p><h5 style="margin:0px;padding:0px 0px 15px;border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;font-weight:normal;">清单 1. 非线程安全的数值范围类</h5><span style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="position:relative;font-family:ibm-plex-sans, &quot;Helvetica Neue&quot;, Arial, sans-serif;border:0px;vertical-align:baseline;font-size:1rem;overflow-y:hidden;padding:0px;overflow:auto;background-color:white;width:100%;overflow-x:auto;margin:0px 0px 20px;"><table border="0" cellpadding="0" cellspacing="0" style="height:auto;font-size:0.875rem;font-style:inherit;font-variant:inherit;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:inherit;border-collapse:collapse;position:static;line-height:1.2em;background:none;border:0px;bottom:auto;float:none;vertical-align:baseline;left:auto;outline:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:100%;box-sizing:content-box;min-height:inherit;padding:0px;margin:0px;margin-bottom:30px;"><tbody style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><tr style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><td style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;left:auto;padding:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;color:rgb(112, 112, 112);"><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">1</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">2</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">3</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">4</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">5</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">6</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">7</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">8</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">9</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">10</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">11</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">12</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">13</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">14</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">15</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">16</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">17</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">18</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">19</div></td><td style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;vertical-align:baseline;box-sizing:content-box;min-height:inherit;line-height:1.2em;width:100%;"><div style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border:0px;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;position:relative;"><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">@NotThreadSafe </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public class NumberRange {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">private int lower, upper;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public int getLower() { return lower; }</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public int getUpper() { return upper; }</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public void setLower(int value) { </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">if (value &gt; upper) </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">            </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">throw new IllegalArgumentException(...);</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">lower = value;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public void setUpper(int value) { </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">if (value &lt; lower) </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">            </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">throw new IllegalArgumentException(...);</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">upper = value;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div></div></td></tr></tbody></table></div></div></div></span><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
这种方式限制了范围的状态变量，因此将 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">lower</code> 和 upper 字段定义为 volatile 类型不能够充分实现类的线程安全；从而仍然需要使用同步。否则，如果凑巧两个线程在同一时间使用不一致的值执行 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">setLower</code> 和 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">setUpper</code> 的话，则会使范围处于不一致的状态。例如，如果初始状态是 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">(0, 5)</code>，同一时间内，线程 A 调用 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">setLower(4)</code> 并且线程 B 调用 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">setUpper(3)</code>，显然这两个操作交叉存入的值是不符合条件的，那么两个线程都会通过用于保护不变式的检查，使得最后的范围值是 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">(4, 3)</code> —— 一个无效值。至于针对范围的其他操作，我们需要使 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">setLower()</code> 和 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">setUpper()</code> 操作原子化 —— 而将字段定义为 volatile 类型是无法实现这一目的的。
</p><h3 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:1.5625rem;line-height:1.875rem;padding:24px 0px 28px;clear:left;color:rgb(63, 63, 63);">性能考虑</h3><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
使用 volatile 变量的主要原因是其简易性：在某些情形下，使用 volatile 变量要比使用相应的锁简单得多。使用 volatile 变量次要原因是其性能：某些情况下，volatile 变量同步机制的性能要优于锁。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
很难做出准确、全面的评价，例如 “X 总是比 Y 快”，尤其是对 JVM 内在的操作而言。（例如，某些情况下 VM 也许能够完全删除锁机制，这使得我们难以抽象地比较 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">volatile</code>
和 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code> 的开销。）就是说，在目前大多数的处理器架构上，volatile 读操作开销非常低 —— 几乎和非 volatile 读操作一样。而 volatile 写操作的开销要比非 volatile 写操作多很多，因为要保证可见性需要实现内存界定（Memory Fence），即便如此，volatile 的总开销仍然要比锁获取低。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
volatile 操作不会像锁一样造成阻塞，因此，在能够安全使用 volatile 的情况下，volatile 可以提供一些优于锁的可伸缩特性。如果读操作的次数要远远超过写操作，与锁相比，volatile 变量通常能够减少同步的性能开销。
</p><h2 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:2.1875rem;line-height:2.5rem;padding:12px 0px 28px;clear:left;color:rgb(63, 63, 63);">正确使用 volatile 的模式</h2><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
很多并发性专家事实上往往引导用户远离 volatile 变量，因为使用它们要比使用锁更加容易出错。然而，如果谨慎地遵循一些良好定义的模式，就能够在很多场合内安全地使用 volatile 变量。要始终牢记使用 volatile 的限制 —— 只有在状态真正独立于程序内其他内容时才能使用 volatile —— 这条规则能够避免将这些模式扩展到不安全的用例。
</p><h3 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:1.5625rem;line-height:1.875rem;padding:24px 0px 28px;clear:left;color:rgb(63, 63, 63);">模式 #1：状态标志</h3><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
也许实现 volatile 变量的规范使用仅仅是使用一个布尔状态标志，用于指示发生了一个重要的一次性事件，例如完成初始化或请求停机。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
很多应用程序包含了一种控制结构，形式为 “在还没有准备好停止程序时再执行一些工作”，如清单 2 所示：
</p><h5 style="margin:0px;padding:0px 0px 15px;border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;font-weight:normal;">清单 2. 将 volatile 变量作为状态标志使用</h5><span style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="position:relative;font-family:ibm-plex-sans, &quot;Helvetica Neue&quot;, Arial, sans-serif;border:0px;vertical-align:baseline;font-size:1rem;overflow-y:hidden;padding:0px;overflow:auto;background-color:white;width:100%;overflow-x:auto;margin:0px 0px 20px;"><table border="0" cellpadding="0" cellspacing="0" style="height:auto;font-size:0.875rem;font-style:inherit;font-variant:inherit;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:inherit;border-collapse:collapse;position:static;line-height:1.2em;background:none;border:0px;bottom:auto;float:none;vertical-align:baseline;left:auto;outline:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:100%;box-sizing:content-box;min-height:inherit;padding:0px;margin:0px;margin-bottom:30px;"><tbody style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><tr style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><td style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;left:auto;padding:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;color:rgb(112, 112, 112);"><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">1</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">2</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">3</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">4</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">5</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">6</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">7</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">8</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">9</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">10</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">11</div></td><td style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;vertical-align:baseline;box-sizing:content-box;min-height:inherit;line-height:1.2em;width:100%;"><div style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border:0px;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;position:relative;"><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">volatile boolean shutdownRequested;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">...</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public void shutdown() { shutdownRequested = true; }</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public void doWork() { </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">while (!shutdownRequested) { </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">// do stuff</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div></div></td></tr></tbody></table></div></div></div></span><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">很可能会从循环外部调用
 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">shutdown()</code> 方法 —— 即在另一个线程中 —— 因此，需要执行某种同步来确保正确实现 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">shutdownRequested</code> 变量的可见性。（可能会从 JMX 侦听程序、GUI 事件线程中的操作侦听程序、通过 RMI 、通过一个 Web 服务等调用）。然而，使用 
<code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code> 块编写循环要比使用清单 2 所示的 volatile 状态标志编写麻烦很多。由于 
volatile 简化了编码，并且状态标志并不依赖于程序内任何其他状态，因此此处非常适合使用 volatile。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
这种类型的状态标记的一个公共特性是：通常只有一种状态转换；<code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">shutdownRequested</code> 标志从 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">false</code> 转换为 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">true</code>，然后程序停止。这种模式可以扩展到来回转换的状态标志，但是只有在转换周期不被察觉的情况下才能扩展（从 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">false</code> 到 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">true</code>，再转换到 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">false</code>）。此外，还需要某些原子状态转换机制，例如原子变量。
</p><h3 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:1.5625rem;line-height:1.875rem;padding:24px 0px 28px;clear:left;color:rgb(63, 63, 63);">模式 #2：一次性安全发布（one-time safe publication）</h3><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
缺乏同步会导致无法实现可见性，这使得确定何时写入对象引用而不是原语值变得更加困难。在缺乏同步的情况下，可能会遇到某个对象引用的更新值（由另一个线程写入）和该对象状态的旧值同时存在。（这就是造成著名的双重检查锁定（double-checked-locking）问题的根源，其中对象引用在没有同步的情况下进行读操作，产生的问题是您可能会看到一个更新的引用，但是仍然会通过该引用看到不完全构造的对象）。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
实现安全发布对象的一种技术就是将对象引用定义为 volatile 类型。清单 3 展示了一个示例，其中后台线程在启动阶段从数据库加载一些数据。其他代码在能够利用这些数据时，在使用之前将检查这些数据是否曾经发布过。
</p><h5 style="margin:0px;padding:0px 0px 15px;border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;font-weight:normal;">清单 3. 将 volatile 变量用于一次性安全发布</h5><span style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="position:relative;font-family:ibm-plex-sans, &quot;Helvetica Neue&quot;, Arial, sans-serif;border:0px;vertical-align:baseline;font-size:1rem;overflow-y:hidden;padding:0px;overflow:auto;background-color:white;width:100%;overflow-x:auto;margin:0px 0px 20px;"><table border="0" cellpadding="0" cellspacing="0" style="height:auto;font-size:0.875rem;font-style:inherit;font-variant:inherit;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:inherit;border-collapse:collapse;position:static;line-height:1.2em;background:none;border:0px;bottom:auto;float:none;vertical-align:baseline;left:auto;outline:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:100%;box-sizing:content-box;min-height:inherit;padding:0px;margin:0px;margin-bottom:30px;"><tbody style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><tr style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><td style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;left:auto;padding:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;color:rgb(112, 112, 112);"><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">1</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">2</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">3</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">4</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">5</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">6</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">7</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">8</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">9</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">10</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">11</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">12</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">13</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">14</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">15</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">16</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">17</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">18</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">19</div></td><td style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;vertical-align:baseline;box-sizing:content-box;min-height:inherit;line-height:1.2em;width:100%;"><div style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border:0px;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;position:relative;"><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public class BackgroundFloobleLoader {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public volatile Flooble theFlooble;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public void initInBackground() {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">// do lots of stuff</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">theFlooble = new Flooble();  // this is the only write to theFlooble</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public class SomeOtherClass {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public void doWork() {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">while (true) { </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">            </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">// do some stuff...</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">            </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">// use the Flooble, but only if it is ready</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">            </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">if (floobleLoader.theFlooble != null) </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">                </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">doSomething(floobleLoader.theFlooble);</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div></div></td></tr></tbody></table></div></div></div></span><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
如果 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">theFlooble</code> 引用不是 volatile 类型，<code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">doWork()</code> 中的代码在解除对 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">theFlooble</code> 的引用时，将会得到一个不完全构造的 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">Flooble</code>。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
该模式的一个必要条件是：被发布的对象必须是线程安全的，或者是有效的不可变对象（有效不可变意味着对象的状态在发布之后永远不会被修改）。volatile 类型的引用可以确保对象的发布形式的可见性，但是如果对象的状态在发布后将发生更改，那么就需要额外的同步。
</p><h3 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:1.5625rem;line-height:1.875rem;padding:24px 0px 28px;clear:left;color:rgb(63, 63, 63);">模式 #3：独立观察（independent observation）</h3><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
安全使用 volatile 的另一种简单模式是：定期 “发布” 观察结果供程序内部使用。例如，假设有一种环境传感器能够感觉环境温度。一个后台线程可能会每隔几秒读取一次该传感器，并更新包含当前文档的 volatile 变量。然后，其他线程可以读取这个变量，从而随时能够看到最新的温度值。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
使用该模式的另一种应用程序就是收集程序的统计信息。清单 4 展示了身份验证机制如何记忆最近一次登录的用户的名字。将反复使用 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">lastUser</code> 引用来发布值，以供程序的其他部分使用。
</p><h5 style="margin:0px;padding:0px 0px 15px;border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;font-weight:normal;">清单 4. 将 volatile 变量用于多个独立观察结果的发布</h5><span style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="position:relative;font-family:ibm-plex-sans, &quot;Helvetica Neue&quot;, Arial, sans-serif;border:0px;vertical-align:baseline;font-size:1rem;overflow-y:hidden;padding:0px;overflow:auto;background-color:white;width:100%;overflow-x:auto;margin:0px 0px 20px;"><table border="0" cellpadding="0" cellspacing="0" style="height:auto;font-size:0.875rem;font-style:inherit;font-variant:inherit;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:inherit;border-collapse:collapse;position:static;line-height:1.2em;background:none;border:0px;bottom:auto;float:none;vertical-align:baseline;left:auto;outline:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:100%;box-sizing:content-box;min-height:inherit;padding:0px;margin:0px;margin-bottom:30px;"><tbody style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><tr style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><td style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;left:auto;padding:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;color:rgb(112, 112, 112);"><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">1</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">2</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">3</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">4</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">5</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">6</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">7</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">8</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">9</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">10</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">11</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">12</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">13</div></td><td style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;vertical-align:baseline;box-sizing:content-box;min-height:inherit;line-height:1.2em;width:100%;"><div style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border:0px;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;position:relative;"><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public class UserManager {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public volatile String lastUser;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public boolean authenticate(String user, String password) {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">boolean valid = passwordIsValid(user, password);</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">if (valid) {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">            </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">User u = new User();</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">            </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">activeUsers.add(u);</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">            </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">lastUser = user;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">return valid;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div></div></td></tr></tbody></table></div></div></div></span><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
该模式是前面模式的扩展；将某个值发布以在程序内的其他地方使用，但是与一次性事件的发布不同，这是一系列独立事件。这个模式要求被发布的值是有效不可变的 —— 即值的状态在发布后不会更改。使用该值的代码需要清楚该值可能随时发生变化。
</p><h3 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:1.5625rem;line-height:1.875rem;padding:24px 0px 28px;clear:left;color:rgb(63, 63, 63);">模式 #4：“volatile bean” 模式</h3><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
volatile bean 模式适用于将 JavaBeans 作为“荣誉结构”使用的框架。在 volatile bean 模式中，JavaBean 被用作一组具有 getter 和/或 setter 方法 的独立属性的容器。volatile bean 模式的基本原理是：很多框架为易变数据的持有者（例如 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">HttpSession</code>）提供了容器，但是放入这些容器中的对象必须是线程安全的。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
在 volatile bean 模式中，JavaBean 的所有数据成员都是 volatile 类型的，并且 getter 和 setter 方法必须非常普通 —— 除了获取或设置相应的属性外，不能包含任何逻辑。此外，对于对象引用的数据成员，引用的对象必须是有效不可变的。（这将禁止具有数组值的属性，因为当数组引用被声明为 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">volatile</code> 时，只有引用而不是数组本身具有 volatile 语义）。对于任何 volatile 变量，不变式或约束都不能包含 JavaBean 属性。清单 5 中的示例展示了遵守 volatile bean 模式的 JavaBean：
</p><h5 style="margin:0px;padding:0px 0px 15px;border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;font-weight:normal;">清单 5. 遵守 volatile bean 模式的 Person 对象</h5><span style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="position:relative;font-family:ibm-plex-sans, &quot;Helvetica Neue&quot;, Arial, sans-serif;border:0px;vertical-align:baseline;font-size:1rem;overflow-y:hidden;padding:0px;overflow:auto;background-color:white;width:100%;overflow-x:auto;margin:0px 0px 20px;"><table border="0" cellpadding="0" cellspacing="0" style="height:auto;font-size:0.875rem;font-style:inherit;font-variant:inherit;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:inherit;border-collapse:collapse;position:static;line-height:1.2em;background:none;border:0px;bottom:auto;float:none;vertical-align:baseline;left:auto;outline:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:100%;box-sizing:content-box;min-height:inherit;padding:0px;margin:0px;margin-bottom:30px;"><tbody style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><tr style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><td style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;left:auto;padding:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;color:rgb(112, 112, 112);"><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">1</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">2</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">3</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">4</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">5</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">6</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">7</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">8</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">9</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">10</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">11</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">12</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">13</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">14</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">15</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">16</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">17</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">18</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">19</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">20</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">21</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">22</div></td><td style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;vertical-align:baseline;box-sizing:content-box;min-height:inherit;line-height:1.2em;width:100%;"><div style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border:0px;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;position:relative;"><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">@ThreadSafe</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public class Person {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">private volatile String firstName;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">private volatile String lastName;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">private volatile int age;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public String getFirstName() { return firstName; }</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public String getLastName() { return lastName; }</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public int getAge() { return age; }</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public void setFirstName(String firstName) { </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">this.firstName = firstName;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public void setLastName(String lastName) { </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">this.lastName = lastName;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public void setAge(int age) { </code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">this.age = age;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div></div></td></tr></tbody></table></div></div></div></span><h2 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:2.1875rem;line-height:2.5rem;padding:12px 0px 28px;clear:left;color:rgb(63, 63, 63);">volatile 的高级模式</h2><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
前面几节介绍的模式涵盖了大部分的基本用例，在这些模式中使用 volatile 非常有用并且简单。这一节将介绍一种更加高级的模式，在该模式中，volatile 将提供性能或可伸缩性优势。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
volatile 应用的的高级模式非常脆弱。因此，必须对假设的条件仔细证明，并且这些模式被严格地封装了起来，因为即使非常小的更改也会损坏您的代码！同样，使用更高级的 volatile 用例的原因是它能够提升性能，确保在开始应用高级模式之前，真正确定需要实现这种性能获益。需要对这些模式进行权衡，放弃可读性或可维护性来换取可能的性能收益 —— 如果您不需要提升性能（或者不能够通过一个严格的测试程序证明您需要它），那么这很可能是一次糟糕的交易，因为您很可能会得不偿失，换来的东西要比放弃的东西价值更低。
</p><h3 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:1.5625rem;line-height:1.875rem;padding:24px 0px 28px;clear:left;color:rgb(63, 63, 63);">模式 #5：开销较低的读－写锁策略</h3><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
目前为止，您应该了解了 volatile 的功能还不足以实现计数器。因为 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">++x</code> 实际上是三种操作（读、添加、存储）的简单组合，如果多个线程凑巧试图同时对 volatile 计数器执行增量操作，那么它的更新值有可能会丢失。
</p><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
然而，如果读操作远远超过写操作，您可以结合使用内部锁和 volatile 变量来减少公共代码路径的开销。清单 6 中显示的线程安全的计数器使用 
<code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code> 确保增量操作是原子的，并使用 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">volatile</code> 保证当前结果的可见性。如果更新不频繁的话，该方法可实现更好的性能，因为读路径的开销仅仅涉及 volatile 读操作，这通常要优于一个无竞争的锁获取的开销。
</p><h5 style="margin:0px;padding:0px 0px 15px;border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;font-weight:normal;">清单 6. 结合使用 volatile 和 synchronized 实现 “开销较低的读－写锁” </h5><span style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><div style="position:relative;font-family:ibm-plex-sans, &quot;Helvetica Neue&quot;, Arial, sans-serif;border:0px;vertical-align:baseline;font-size:1rem;overflow-y:hidden;padding:0px;overflow:auto;background-color:white;width:100%;overflow-x:auto;margin:0px 0px 20px;"><table border="0" cellpadding="0" cellspacing="0" style="height:auto;font-size:0.875rem;font-style:inherit;font-variant:inherit;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:inherit;border-collapse:collapse;position:static;line-height:1.2em;background:none;border:0px;bottom:auto;float:none;vertical-align:baseline;left:auto;outline:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:100%;box-sizing:content-box;min-height:inherit;padding:0px;margin:0px;margin-bottom:30px;"><tbody style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><tr style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;"><td style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;left:auto;padding:0px;overflow:visible;border-radius:0px;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;min-height:inherit;vertical-align:baseline;line-height:1.2em;color:rgb(112, 112, 112);"><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">1</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">2</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">3</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">4</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">5</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">6</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">7</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">8</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">9</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">10</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">11</div><div style="overflow:visible;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;right:auto;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;outline:0px;border:0px;position:static;min-height:inherit;box-sizing:content-box;top:auto;width:auto;margin:0px;line-height:1.2em;white-space:pre;background-color:white;border-right:3px solid rgb(108, 226, 108);text-align:right;padding:0px 0.5em 0px 1em;">12</div></td><td style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;margin:0px;background:none;border:0px;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border-radius:0px;position:static;right:auto;text-align:left;top:auto;vertical-align:baseline;box-sizing:content-box;min-height:inherit;line-height:1.2em;width:100%;"><div style="left:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;overflow:visible;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;padding:0px;outline:0px;border:0px;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;position:relative;"><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">@ThreadSafe</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public class CheesyCounter {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">// Employs the cheap read-write lock trick</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">// All mutative operations MUST be done with the 'this' lock held</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">@GuardedBy(&quot;this&quot;) private volatile int value;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public int getValue() { return value; }</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"> </div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">public synchronized int increment() {</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">        </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">return value++;</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;outline:0px;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;border:0px;overflow:visible;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;">    </code><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div><div style="outline:0px;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-size:0.875rem;position:static;vertical-align:baseline;border-radius:0px;background:none;bottom:auto;float:none;height:auto;left:auto;border:0px;overflow:visible;min-height:inherit;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;white-space:pre;background-color:white;padding:0px 1em;"><code style="height:auto;text-size-adjust:110%;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;font-weight:normal;font-size:0.875rem;overflow:visible;vertical-align:baseline;min-height:inherit;border-radius:0px;background:none;bottom:auto;float:none;padding:0px;left:auto;outline:0px;border:0px;position:static;right:auto;text-align:left;top:auto;width:auto;box-sizing:content-box;margin:0px;line-height:1.2em;color:black;">}</code></div></div></td></tr></tbody></table></div></div></div></span><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
之所以将这种技术称之为 “开销较低的读－写锁” 是因为您使用了不同的同步机制进行读写操作。因为本例中的写操作违反了使用 volatile 的第一个条件，因此不能使用 volatile 安全地实现计数器 —— 您必须使用锁。然而，您可以在读操作中使用 volatile 确保当前值的<em style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;font-style:italic;">可见性</em>，因此可以使用锁进行所有变化的操作，使用 volatile 进行只读操作。其中，锁一次只允许一个线程访问值，volatile 允许多个线程执行读操作，因此当使用 volatile 保证读代码路径时，要比使用锁执行全部代码路径获得更高的共享度 —— 就像读－写操作一样。然而，要随时牢记这种模式的弱点：如果超越了该模式的最基本应用，结合这两个竞争的同步机制将变得非常困难。
</p><h2 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:2.1875rem;line-height:2.5rem;padding:12px 0px 28px;clear:left;color:rgb(63, 63, 63);">结束语</h2><p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;padding:0px 0px 22px;font-size:1.0625rem;color:rgb(50, 50, 50);">
与锁相比，Volatile 变量是一种非常简单但同时又非常脆弱的同步机制，它在某些情况下将提供优于锁的性能和伸缩性。如果严格遵循 volatile 的使用条件 —— 即变量真正独立于其他变量和自己以前的值 —— 在某些情况下可以使用 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">volatile</code> 代替 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code> 来简化代码。然而，使用 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">volatile</code> 的代码往往比使用锁的代码更加容易出错。本文介绍的模式涵盖了可以使用 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">volatile</code> 代替 <code style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:0.9375rem;font-weight:normal;font-family:ibm-plex-mono, Menlo, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, Courier, monospace;">synchronized</code> 的最常见的一些用例。遵循这些模式（注意使用时不要超过各自的限制）可以帮助您安全地实现大多数用例，使用 volatile 变量获得更佳性能。
</p> 
                                        
                                        <div style="padding:0px;border:0px;vertical-align:baseline;font-size:1rem;margin:7px 0px 15px;border-top:1px solid rgb(199, 199, 199);clear:both;min-height:1px;"></div><h4 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:1.25rem;line-height:1.5625rem;padding:14px 0px 24px;clear:left;color:rgb(63, 63, 63);">相关主题</h4><ul style="border:0px;vertical-align:baseline;margin:0px;list-style:none;font-size:1rem;line-height:1.625rem;padding:0px 0px 22px;"><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:28px;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span>您可以参阅本文在 developerWorks 全球站点上的 <a href="http://www.ibm.com/developerworks/java/library/j-jtp06197.html?S_TACT=105AGX52&amp;S_CMP=cn-a-j" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);transition:color 0.3s;text-decoration:none;" target="_blank"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span>英文原文<span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a> 。</li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:28px;padding-top:7px;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><a href="http://www.amazon.com/exec/obidos/ASIN/0321349601/ref=nosim/none0b69" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);transition:color 0.3s;text-decoration:none;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span><em style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;font-style:italic;">Java
Concurrency in Practice</em><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a>：使用 Java 代码开发并发程序的 how-to 手册，内容包括构建并编写线程安全的类和程序、避免性能影响、管理性能和测试并发应用程序。</li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:28px;padding-top:7px;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><a href="http://www.ibm.com/developerworks/cn/java/j-jtp11234/" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);transition:color 0.3s;text-decoration:none;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span>流行的原子<span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a>：介绍了 Java 5.0 中新增的原子变量类，该特性对 volatile 变量进行了扩展，从而支持原子状态转换。</li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:28px;padding-top:7px;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><a href="http://www.ibm.com/developerworks/cn/java/j-jtp04186/" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);transition:color 0.3s;text-decoration:none;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span>非阻塞算法简介<span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a>：介绍如何使用原子变量而不是锁实现并发算法。</li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:28px;padding-top:7px;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><a href="http://en.wikipedia.org/wiki/Volatile_variable" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);transition:color 0.3s;text-decoration:none;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span>Volatiles<span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a>：从 Wikipedia 获得关于 volatile 变量的更多信息。</li><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:28px;padding-top:7px;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><a href="http://www.ibm.com/developerworks/cn/java/" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);transition:color 0.3s;text-decoration:none;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span>Java 技术专区<span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a>：提供了数百篇有关 Java 编程各个方面的文章。</li></ul>
                                        

<div style="padding:0px;border:0px;vertical-align:baseline;font-size:1rem;margin:7px 0px 15px;border-top:1px solid rgb(199, 199, 199);clear:both;min-height:1px;"></div>
<div style="border:0px;vertical-align:baseline;font-size:1rem;clear:both;margin:0px -10px;padding:0px;width:auto;">
    <div style="border:0px;vertical-align:baseline;font-size:1rem;margin:0px;padding:0px 10px;box-sizing:border-box;float:left;min-height:1px;width:100%;">
        <h4 style="margin:0px;border:0px;vertical-align:baseline;font-weight:normal;font-size:1.25rem;line-height:1.5625rem;padding:14px 0px 24px;clear:left;color:rgb(63, 63, 63);">评论</h4>
        <div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;">
            <p style="margin:0px;border:0px;vertical-align:baseline;line-height:1.625rem;font-weight:600;font-size:1.0625rem;color:rgb(50, 50, 50);padding:0px;">添加或订阅评论，请先<a style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;transition:color 0.3s;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span>登录<span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a>或<a style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;transition:color 0.3s;"><span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span>注册<span style="font-size:inherit;color:rgb(59, 108, 170);text-decoration:none;"></span></a>。</p>
        </div>
    </div>    
    <div style="border:0px;vertical-align:baseline;font-size:1rem;margin:0px;padding:0px 10px;box-sizing:border-box;float:left;min-height:1px;width:100%;"> 
        
        <span style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;color:rgb(204, 204, 204);">有新评论时提醒我</span>	   
    </div>
<span style="font-size:1rem;clear:both;display:block;height:0px;visibility:hidden;overflow:hidden;"> </span></div>

<div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;padding-top:40px;">       
    <div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;"><ul style="line-height:2em;border:0px;vertical-align:baseline;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;font-size:1em;clear:both;color:rgb(204, 204, 204);border-bottom:2px solid rgb(204, 204, 204);margin-bottom:0.5em;padding:0px 0px 22px;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;position:relative;"><li style="display:inline-block;margin:0px;border:0px;vertical-align:baseline;font-size:inherit;box-sizing:border-box;text-shadow:none;padding:0px 1em;position:relative;cursor:pointer;font-weight:bold;text-align:center;user-select:none;color:rgb(0, 0, 0);"><span style="font-size:inherit;cursor:pointer;font-weight:bold;text-align:center;color:rgb(0, 0, 0);margin-left:0px;"></span>最新的<span style="font-size:inherit;cursor:pointer;font-weight:bold;text-align:center;color:rgb(0, 0, 0);background:rgb(0, 0, 0);display:block;right:0px;height:2px;position:absolute;bottom:-2px;left:0px;"> </span></li><li style="display:inline-block;margin:0px;border:0px;vertical-align:baseline;font-size:inherit;padding-top:7px;box-sizing:border-box;text-shadow:none;padding:0px 1em;position:relative;cursor:pointer;font-weight:bold;text-align:center;user-select:none;"><span style="font-size:inherit;cursor:pointer;font-weight:bold;text-align:center;margin-left:0px;"></span>历史</li><li style="display:inline-block;margin:0px;border:0px;vertical-align:baseline;font-size:inherit;padding-top:7px;box-sizing:border-box;text-shadow:none;padding:0px 1em;position:relative;cursor:pointer;font-weight:bold;text-align:center;user-select:none;"><span style="font-size:inherit;cursor:pointer;font-weight:bold;text-align:center;margin-left:0px;"></span>热门</li></div></ul><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;"><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:0px 0px 22px;"><li style="margin:0px;padding:0px;border:0px;vertical-align:baseline;padding-left:28px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;overflow:hidden;border-top:none;"><img src="正确使用 Volatile 变量_files/Image.png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2016 年 12 月 09 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/Aaron_1s" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>Aaron_1s<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">Cooool!</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [1].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2016 年 05 月 12 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/yuanliangding" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>yuanliangding<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">我只能想得到1和5两种模型了。~_^</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [2].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2015 年 07 月 03 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/Rembau" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>Rembau<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">@moony320
volatile关键字可以禁止jit进行指令重排序，而new一个对象过程中，把变量指向已经完全创建好的对象是最后一步，既在指令没有重排序的情况下如果instance != null，这个对象就是已经完全创建好了。</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [3].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2015 年 04 月 22 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/ThinkHigher" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>ThinkHigher<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">@哈利小球
如果用synchronized修饰了setter方法，只能保证setter方法是原子的，也就是写的时候可以把最新值写回主内存，但是调用getter方法但是没有用volatile修饰value的话，线程并不会从主内存中读取value的值，只会从线程本地内存中读取线程自己所缓存的这个对象的值。</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [4].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2014 年 06 月 26 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/%E5%93%88%E5%88%A9%E5%B0%8F%E7%90%83" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>哈利小球<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">清单6中，针对value变更的写操作都用了synchronized 关键字修饰了，这个本身就保证了把value变更刷新到主存保证不同线程的可见性了吧。这种情况下读又是直接return value的，貌似不需要volatile修饰value，也能保证value的读可见性，因为写的时候都会刷新到住存，不会留在线程副本中。</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [5].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2014 年 01 月 12 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/bo_hai" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>bo_hai<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">没有懂。</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [6].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2013 年 10 月 09 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/moony320" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>moony320<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">&quot;模式2的一次安全发布，volatile能保证么？表示怀疑。感觉这里的问题在于，new操作有可能被打断，而非一致性问题吧？\n</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [7].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2013 年 07 月 29 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/woj_" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>woj_<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">&quot;普及知识！</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [8].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2013 年 01 月 17 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/EksWai" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>EksWai<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">@luhuajcdd：\n 这里的状态指的是lastUser的内部状态，而lastUser是String类型的，而String类是个不可变类（实例一旦发布，内部状态就不再改变）。\n 每次对String类型的实例进行变更类操作，如subString()，该操作内部都会生成一个新的String类型实例，而操作对象本身的状态并未改变，这种做法保证了实例的内部状态不被多个线程共享。</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [9].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2012 年 12 月 02 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/ben.s" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>ben.s<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">模式2中的一次安全发布，不是很理解，为什么加了volatile后，能保证其它线程能看到的是一个构造完成的对象？</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [10].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2012 年 10 月 28 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/%E5%B0%8F%E9%A3%9E%E4%BA%BA" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>小飞人<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">受益匪浅</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [11].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2012 年 10 月 09 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/a8hao" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>a8hao<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">对头痛的volatile介绍的很透彻</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [12].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2012 年 09 月 06 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/luhuajcdd" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>luhuajcdd<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">非常系统，详细， 有些东西不是很明白。例如清单4中的 public volatile String lastUser; 值的状态在发布后不会更改。 这里指的状态怎么理解， 希望有人能够帮忙解析下。</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [13].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2011 年 08 月 06 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/javafuns" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>javafuns<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">非常棒</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [14].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2011 年 05 月 05 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/huahua035" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>huahua035<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">不好意思，刚才的评论表达的有个问题；\nsynchronized不能修饰变量 -- 它修饰的是代码块或者是方法；</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [15].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2011 年 05 月 05 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/huahua035" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>huahua035<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">简单理解：\nvolatile和synchronized是不同级别的原子性；但是volatile的原子性仅限于可见性，并发使用中容易引起其他问题，所有可用的地方不多。（非常类似数据库中的事务级别，不同事务级别解决不同的并发问题）</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [16].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2011 年 05 月 05 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/huahua035" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>huahua035<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">volatile就是只具备可见性这个原子特性的关键字，它修饰的变量能让线程每次访问时候都拿到最新的数据，意味着只要它做了修改，就马上共享给每个访问它的线程；\nsynchronized也一样具有可见性这个特点（volatile能做的工作它完全能做），不过它修饰的变量每次只能有一个线程访问（典型的互斥性吧）；\n可以肯定，用synchronized修饰的变量肯定不用volatile修饰啦；</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [17].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2011 年 04 月 12 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/IdealIvan" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>IdealIvan<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">同意楼上的观点，如果作者能够在开始之前将一些术语如不变式，加以解释。可能更加容易读懂一些！</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li><li style="padding-left:28px;margin:0px;border:0px;vertical-align:baseline;padding:0px;padding-top:7px;box-sizing:border-box;text-shadow:none;clear:both;font-size:1.0625rem;color:rgb(50, 50, 50);"><span style="font-size:1.5rem;color:rgb(149, 149, 149);display:inline-block;font-family:Arial, sans-serif;margin-left:-1.3rem;position:absolute;">•</span><div style="margin:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;padding:0.5em;border-top:1px solid rgb(221, 221, 221);overflow:hidden;"><img src="正确使用 Volatile 变量_files/Image [18].png" type="image/png" data-filename="Image.png" alt="" height="50" style="text-shadow:none;border-radius:50%;border:0px;vertical-align:baseline;font-size:inherit;max-height:50px;box-sizing:border-box;padding:0px;float:left;width:3.6rem;height:3.6rem;max-width:50px;display:block;margin:0px 0.5rem 0px 0px;" width="50"/><span style="box-sizing:border-box;text-shadow:none;float:right;line-height:1.4em;margin-left:0.5em;font-size:0.8em;color:rgb(102, 102, 102);">2010 年 10 月 30 日</span><div style="text-shadow:none;margin:0px;border:0px;vertical-align:baseline;font-size:1rem;padding:0px;box-sizing:border-box;line-height:1.4em;font-weight:bold;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"><a href="https://www.ibm.com/developerworks/community/profiles/user/ol_beta" style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:inherit;transition:color 0.3s;box-sizing:border-box;text-shadow:none;text-decoration:none;color:inherit;"><span style="font-size:inherit;color:inherit;text-decoration:none;"></span>ol_beta<span style="font-size:inherit;color:inherit;text-decoration:none;"></span></a></div><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;line-height:1.3em;overflow:hidden;"><div style="margin:0px;padding:0px;border:0px;vertical-align:baseline;font-size:1rem;box-sizing:border-box;text-shadow:none;white-space:pre-line;word-break:break-word;">写的有些深奥，不适很理解</div></div></div><ul style="border:0px;vertical-align:baseline;font-size:1rem;line-height:1.625rem;box-sizing:border-box;text-shadow:none;margin:0px;list-style:none;padding:16px 0px;"></ul></li></ul></div></div>
</div>
                                        
                                    </div>   
                                <span style="font-size:1rem;clear:both;display:block;height:0px;visibility:hidden;overflow:hidden;"> </span></div></div></div></div></div></span></div></div></div></div></div><br/></div></span>
</div></body></html> 