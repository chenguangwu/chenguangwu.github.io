<html>
<head>
  <title>微店MySQL自动化运维实践</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="9083"/>
<h1>微店MySQL自动化运维实践</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/7/20 0:28</i></td></tr>
<tr><td><b>标签：</b></td><td><i>微信</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://mp.weixin.qq.com/s?__biz=MzIzMDEyNzM4NQ==&mid=2650956358&idx=1&sn=0b00a03f06053c582015ec35610a3fe2&chksm=f34ee030c4396926557128171e951d99c9a3004f377812a26885203eafe0982a5bb0995158ca&mpshare=1&scene=1&srcid=0720LoIVaEqIFwiT9RtsTzeK#rd"><i>http://mp.weixin.qq.com/s?__biz=MzIzMDEyNzM4NQ==&amp;mid=2650956358&amp;idx=1&amp;sn=0b00a03f06053c582015ec35610a3fe2&amp;chksm=f34ee030c4396926557128171e951d99c9a3004f377812a26885203eafe0982a5bb0995158ca&amp;mpshare=1&amp;scene=1&amp;srcid=0720LoIVaEqIFwiT9RtsTzeK#rd</i></a></td></tr>
</table>
</div>
<br/>

<div><span style="margin:0px;"><div style="padding:8px 0px;margin:8px auto;max-width:700px;"> <div style="padding:20px 16px 12px;margin:0;background-color:#fff"><div style="margin:0;padding:0"><div style="margin:0;padding:0"><h2 style="font-weight:400;margin:0;padding:0;font-size:22px;line-height:1.4;margin-bottom:14px"> 微店MySQL自动化运维实践 </h2><div style="margin:0;padding:0;margin-bottom:22px;line-height:20px;font-size:0;word-wrap:break-word;word-break:break-all"><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);margin-right:0;color:rgba(0,0,0,0.3)">原创：</span><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"> 林仁 </span><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);position:relative"><a style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)"> 微店技术团队 </a></span><em style="padding:0;font-style:normal;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"></em></div><div lang="=&quot;en&quot;" style="margin:0;padding:0;overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify"><h2 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;font-size:20px;line-height:1.5;border-bottom-color:rgb(46,61,84);font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">前言</span></h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">互联网时代，数据库如何满足敏捷开发，敏捷交付的要求。传统靠DBA人肉执行的方式，在面对大量业务需求时，</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">DBA手速再快，记忆力再好估计也不能提供好的数据库服务。在介绍自动化运维之前，我们来了解下是怎么使用数据库的。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">数据库的使用方式主要有两种：</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">应用混合部署（实例）：<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">有新数据库需求时，很多人都会选择找个实例，建个数据库和帐号提供给业务。好处是能快速提供数据库服务，这种方式在数据库运维的过程中会出现一些问题：第一，相互影响，个别应用有问题会影响所有数据库；第二， 应用DB的性能指标（qps, tps, rt...）不能获取；第三，定位问题源困难；第四，资源使用不合理。为了解决以上问题，最终会有拆库的过程，拆过库的同学都知道，一个拆库动作需要确认很多东西，所花费的时间是非常多的，过程中容易产生故障。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">应用独享（实例）：</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">在虚拟化，微服务深入人心的今天，</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">应用独享实例是数据库给出的解决办法。我们做到的是所有应用独享实例（分库分表的应用如：分成32个库的应用，业务初期阶段会分布在几个实例中，业务确实需要更多资源时再进行自动化拆库扩容）。这种方式需要大量的实例，传统单机单实例的运维体系就需要演变成单机多实例的方式。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">由此引出会有一系列问题需要解决：如何快速提供数据库服务？如何避免数据库资源合理分配？数据库监控怎么做？多实例数据库HA怎么做？</span></p><h2 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;font-size:20px;line-height:1.5;border-bottom-color:rgb(46,61,84);font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">MySQL的标准化与自动化</span></h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">我们实现的MySQL自动化运维体系能够解决规模化的痛点，主要包括实例创建、部署、监控、备份、HA切换、迁移、扩容等的自动化，所有模块的主发点是要能“自动化”的方式运作，尽量少的人为参与。</span></p><h3 style="font-weight:400;font-size:16px;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;line-height:1.5625;font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">一、标准化</h3><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">数据库上了一定规模后，数据库的各方面都需要标准规范起来，才能接下去做自动化。实例上的标准化我们主要做了以下几点：</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">1.应用独享实例</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">2.数据库Ｍ&lt;==&gt;S结构，备库不提供业务流量（异地容灾除外）</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">   很多人会选择一主多备，备库提供读流量。这种架构引起的故障挺多的，因为备库一定会存在延时，备库机器也会挂掉。事实上大部分时候流量都在主库是没问题，如果确实主库压力真的太大怎么办，我们应该及时发现问题并作出应对（方法可以是缓存＋拆库）。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">3.MySQL标准化（带thread_pool 功能MySQL）</p><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em;margin-top:10px;color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px;white-space:normal;background-color:rgb(255,255,255)"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">数据库版本一致</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">“相同”的my.cnf（除个别个性参数如server_id,buffer_pool_size等）</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">文件目录一致</p></li></ul><h3 style="font-weight:400;font-size:16px;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;line-height:1.5625;font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">二、构建MySQL自动化运维体系</h3><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">一套很好的大规模运维体系DBManage，整体思路是让一切自动化起来，不需要打通机器间的信任关系，避免或减少人为参与。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><img src="微店MySQL自动化运维实践_files/0.jpg" type="image/jpeg" data-filename="0.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important"/><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><h4 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:20px;font-size:14px;line-height:20px;font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">1.多实例创建</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">   一台机器上面开启多个不同的端口，运行多个MySQL服务进程，共用MySQL程序，使用不同配置文件，提供服务。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent">   关键点：</span></p><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em;margin-top:10px;color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px;white-space:normal;background-color:rgb(255,255,255)"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:transparent"> </span>“相同”的my.cnf（除个别个性参数如server_id,buffer_pool_size等）</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">数据文件目录标准化</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">创建实例（1.初始化一个标准的数据库，2.新建实例通过rsync控制速率，通过修改 &quot; my.cnf &quot; 文件新建不同实例，因为mysql_install_db安装新实例会占用过多IO)          </p></li></ul><h4 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:20px;font-size:14px;line-height:20px;font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">2. 元数据与监控</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">   数据库监控没有采用类似“lepus”的方式，中心控制的方式对于规模化精细华数据库管理冲突。中心化存在问题1：增加实例需要手动录入；问题2：不能获取响应时间RT(tcprstat)；问题3：不能获取主机性能数据等等。我们采用自研 db_agent 实现实例的自动发现，各项元数据及性能数据采集，告别人工处理。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">   每台数据库服务器上运行db_agent；自动发现实例，自动采集实例数据，主机数据，磁盘数据，自动添加监控。db_agent主要实现以下功能。</p><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em;margin-top:10px;color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px;white-space:normal;background-color:rgb(255,255,255)"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">采集实例信息(数据库列表，复制信息，表元数据等等)</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">心跳更新（每秒更新，因为show slave status的延时是不可靠的）</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">数据库性能数据( QPS, TPS......)</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">数据库响应时间RT(tcprstat)</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">实时慢SQL</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">主机性能数据(告别zabbix)</p></li></ul><h4 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:20px;font-size:14px;line-height:20px;font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">3. 备份</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">   数据库机器部署备份脚本（不区分是否主备机器），告别手动配置。</p><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em;margin-top:10px;color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px;white-space:normal;background-color:rgb(255,255,255)"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">只备份备库（备份前判断脚色）</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">多实例并发控制（控制速率及时间）</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">直接写入hdfs 或server(推荐hdfs存储)</p></li></ul><h4 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:20px;font-size:14px;line-height:20px;font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">4. 本地执行agent</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">    远程操作DB机器（创建实例，恢复数据库，etc），通过自定义一些消息调起DB机器对应脚本进行操作</p><h4 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:20px;font-size:14px;line-height:20px;font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">5. 监控告警</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">    基于db_agent采集数据，性能画图及告警。性能数据写入graphite</p><h4 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:20px;font-size:14px;line-height:20px;font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">6. MySQL高可用</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">    传统的使用MHA做MySQL HA架构是比较通用的方案，主要特点：通过Health Check 监控MySQL集群，应用通过VIP访问MySQL，VIP通过keepalive选主。这里不展开这种方式和一些改进型（zookeeper +MHA）的痛点，主要讲下多实例下基于zookeeper是怎么实现MySQL自动化高可用。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">    改造后的HA架构，跟通常架构的区别在于我们去掉了MySQL集群里的VIP，使用VDDS替代；完全去掉MHA。通过zookeeper分布式，实现ha_console的高可用。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><img src="微店MySQL自动化运维实践_files/0 [1].jpg" type="image/jpeg" data-filename="0.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important"/><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>   </p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">整个流程是</p><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em;margin-top:10px;color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px;white-space:normal;background-color:rgb(255,255,255)"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">VDDS(微店分布式数据库) 新建应用配置</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">ha_agent向zookeeper注册临时节点，并实时更新实例信息。<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">{</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;source_db_role&quot;: &quot;slave&quot;,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;master_instance&quot;: &quot;192.168.1.12_3306&quot;,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;repl_status&quot;: &quot;ok&quot;,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;h_time_delay&quot;: 0,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;repl_delay&quot;: 0,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;last_change_time&quot;: &quot;2016-10-15-01:00:45&quot;</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">}</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;background-color:transparent">ha_console根据zookeeper节点信息构造切换元数据（包括延时，切换对象，复制状态）</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">&quot;192.168.1.11_3306&quot;: &quot;{</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;source_db_role&quot;: &quot;master&quot;,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;master_instance&quot;: &quot;192.168.1.12_3306&quot;,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;repl_status&quot;: &quot;ok&quot;,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;h_time_delay&quot;: 0,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;repl_delay&quot;: 0,</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">    &quot;last_change_time&quot;: &quot;2016-10-15-01:00:45&quot;</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;background-color:transparent">}&quot;</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">ha_console监听alive目录临时节点</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">alive目录临时节点消失进行切换（判断延时及复制状态，不符合条件不切换），切换VDDS和数据库</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">切换前记录切换信息（slave：master_log_file: mysql-bin.000007，exec_master_log_pos: 57830。主库恢复后，用来生成日志解析）</p></li></ul><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">场景一：实例Crash，实例所在的服务器正常运行，ha_agent运行正常</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">实例Crash，ha_agent 正常运行，主动删除zookeeper 临时节点，ha_console 判断数据库角色，是主库走切换流程。原实例起来之后，作为备库运行。</span> </p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">场景二：实例所在的主机Crash。（实例和ha_agent同时Crash）</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">此时，由于ha_agent和实例同时Crash，zookeeper到ha_agent间的通讯失败。zookeeper 等待超过租约的时间，<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">ha_console 判断数据库角色，是主库走切换流程。原实例起来之后，作为备库运行。</span> </span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">场景三：实例正常，网络异常</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">       网络异常会发生大量实例掉线或部份异常。大量节点异常：ha_console判断时间范围内异常实例数量，超过阀值不进行切换，同时切换过程：切换脚本会去判断数据库状态，避免误切。（zookeeper client 连接掉线后，尽管实例及ha_agent正常运行，节点不能重用必须等待超时)</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">特点：完全不需要人工建入，切换元数据自动构建，所有实例自动注册，构造完整的切换元数据，避免了繁锁的配置或配置出错导致不能切换。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"> </p><h4 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:20px;font-size:14px;line-height:20px;font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">7.DBTask</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">     通过DBTask 替代人工操作。实现了数据库创建，配置VDDS, 数据库迁移，拆库扩容，恢复等等。整体思路是分解动作，每个脚本干一件事，再串起所有脚本。以数据库迁移为例我们可以分解为各个子任务，串起任务就是一个完整的自动化数据库迁移任务。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">数据库迁移：</p><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em;margin-top:10px;color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px;white-space:normal;background-color:rgb(255,255,255)"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">申请可用资源</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">实例创建</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">恢复备库A</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">恢复备库B</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">配置数据源(VDDS)</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">切换前检查</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">切换</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">清除VDDS配置</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">关闭老实例</p></li></ul><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">数据库资源申请：</p><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em;margin-top:10px;color:rgb(51,51,51);font-family:Arial,sans-serif;font-size:14px;white-space:normal;background-color:rgb(255,255,255)"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">申请可用资源</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">实例创建</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">新建库，MySQL帐号</p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">配置数据源(VDDS)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></li></ul><h2 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;font-size:20px;line-height:1.5;border-bottom-color:rgb(46,61,84);font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)">成果及展望</h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal">全套自动化运维体系采用：后台由python+shell+go(实时慢sql解析部分)；前端采用laravel+angularjs。 目前单机日常环境运行100+实例，agent的资源占用不多；业务申请数据库资源&lt;1分钟完成；自动化拆库（部份老的合在一起的还是要拆的?）等等。另外随着MySQL自动化运维的深入，慢慢的发现这将会演变数据库成私有云平台。对于如何更好的服务业务，如何诊断业务数据库等等都需要我们去完善。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"> </p><h2 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;font-size:20px;line-height:1.5;border-bottom-color:rgb(46,61,84);font-family:Arial,sans-serif;white-space:normal;background-color:rgb(255,255,255)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">参考资料</span></h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">python socket通信：</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><a rel="nofollow" style="margin:0;padding:0;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(50,108,166)">https://github.com/chris-piekarski/python-json-socket<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"> </span></a></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">python hdfs</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><a rel="nofollow" style="margin:0;padding:0;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(50,108,166)">https://pypi.python.org/pypi/hdfs/<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"> </span></a></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">响应时间</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">(rt):</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><a rel="nofollow" style="margin:0;padding:0;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(50,108,166)">https://github.com/Lowercases/tcprstat<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"> </span></a></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">python zookeeper:</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><a rel="nofollow" style="margin:0;padding:0;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(50,108,166)">https://github.com/python-zk/kazoo<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"> </span></a></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"> go tidb</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">解析</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">sql 中的表（用来合并分表）</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;color:rgb(51,51,51);background-color:rgb(255,255,255);font-family:Arial,sans-serif;font-size:14px;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><a rel="nofollow" style="margin:0;padding:0;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(50,108,166)">https://github.com/pingcap/tidb<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"> </span></a></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:center"><img src="微店MySQL自动化运维实践_files/0.png" type="image/png" data-filename="0.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important"/></p></div></div><ul style="margin:0;padding:0"></ul></div></div></div></span>
</div></body></html> 