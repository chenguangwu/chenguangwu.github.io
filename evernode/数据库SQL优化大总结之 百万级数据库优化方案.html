<html>
<head>
  <title>数据库SQL优化大总结之 百万级数据库优化方案</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3499"/>
<h1>数据库SQL优化大总结之 百万级数据库优化方案</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/10/12 8:57</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2019/1/27 12:54</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://mp.weixin.qq.com/s/LZ-L6fLI7nD3goIBbEoOKA"><i>https://mp.weixin.qq.com/s/LZ-L6fLI7nD3goIBbEoOKA</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;"><div style="text-size-adjust:100%;line-height:1.6;"><div style="font-family:-apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color:rgb(51, 51, 51);letter-spacing:0.034em;background-color:rgb(255, 255, 255);"><div><div style="word-wrap:break-word;"><div style="background-color:rgb(255, 255, 255);"><div><div>

                
                <h2 style="margin:0px;padding:0px;font-weight:400;font-size:22px;line-height:1.4;margin-bottom:14px;">
                    
                    
                    数据库SQL优化大总结之 百万级数据库优化方案

                                                                                </h2>
                <div style="margin:0px;padding:0px;margin-bottom:22px;line-height:20px;font-size:0px;word-wrap:break-word;word-break:break-all;position:relative;z-index:1;">
                                                                                <span style="padding:0px;margin:0px 10px 10px 0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);color:rgba(0, 0, 0, 0.3);">
                                                暴走森
                                            </span>
                                        
                                        <span style="padding:0px;margin:0px 10px 10px 0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);position:relative;">
                      <a href="#" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);">
                        互扯程序                      </a>
                      
                    </span>


                    <em style="padding:0px;margin:0px 10px 10px 0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);color:rgba(0, 0, 0, 0.3);font-style:normal;">3天前</em>





                </div>
                
                
                
                
                                                
                                                                
                                
                
                <div style="margin:0px;padding:0px;overflow:hidden;color:rgb(51, 51, 51);font-size:17px;word-wrap:break-word;text-align:justify;position:relative;">
                    

                    

                    
                    
                    <p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">网上关于SQL优化的教程很多，但是比较杂乱。近日有空整理了一下，写出来跟大家分享一下，其中有错误和不足的地方，还请大家纠正补充。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">1.对查询进行优化，要尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>2.应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">is</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">null</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">最好不要给数据库留NULL，尽可能的使用 NOT NULL填充数据库.</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">备注、描述、评论之类的可以设置为 NULL，其他的，最好不要使用NULL。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">不要以为 NULL 不需要空间，比如：char(100) 型，在字段建立时，空间就固定了， 不管是否插入值（NULL也包含在内），都是占用 100个字符的空间的，如果是varchar这样的变长字段， null 不占用空间。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> = <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">0</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>3.应尽量避免在 where 子句中使用 != 或 &lt;&gt; 操作符，否则将引擎放弃使用索引而进行全表扫描。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>4.应尽量避免在 where 子句中使用 or 来连接条件，如果一个字段有索引，一个字段没有索引，将导致引擎放弃使用索引而进行全表扫描，如：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span>=<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">10</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">or</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">Name</span> = <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(238, 220, 112);word-break:inherit !important;">'admin'</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">可以这样查询：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> = <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">10</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">union</span> allselect <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">Name</span> = <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(238, 220, 112);word-break:inherit !important;">'admin'</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>5.in 和 not in 也要慎用，否则会导致全表扫描，如：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">in</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">1</span>,<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">2</span>,<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">3</span>)<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">对于连续的数值，能用 between 就不要用 in 了：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">between</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">1</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">and</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">3</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">很多时候用 exists 代替 in 是一个好的选择：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> a <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">in</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> b)<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">用下面的语句替换：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> a <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">exists</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">1</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> b <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span>=a.num)<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> </p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">6.下面的查询也将导致全表扫描：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">name</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">like</span> ‘%abc%’<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">若要提高效率，可以考虑全文检索。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>7.如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然 而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> = @<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">可以改为强制查询使用索引：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">with</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">index</span>(索引名)) <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> = @<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">.应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span>/<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">2</span> = <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">100</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">应改为:</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">num</span> = <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">100</span>*<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">2</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>9.应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">substring</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">name</span>,<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">1</span>,<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">3</span>) = ’abc’       -–<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">name</span>以abc开头的idselect <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">datediff</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">day</span>,createdate,’<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">2005</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">-11</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">-30</span>′) = <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">0</span>    -–‘<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">2005</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">-11</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">-30</span>’    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(128, 128, 128);word-break:inherit !important;">--生成的id</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">应改为:</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">name</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">like</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(238, 220, 112);word-break:inherit !important;">'abc%'</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">id</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> t <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> createdate &gt;= <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(238, 220, 112);word-break:inherit !important;">'2005-11-30'</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">and</span> createdate &lt; <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(238, 220, 112);word-break:inherit !important;">'2005-12-1'</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>10.不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>11.在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>12.不要写一些没有意义的查询，如需要生成一个空表结构：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">select</span> col1,col2 <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">into</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(128, 128, 128);word-break:inherit !important;">#t from t where 1=0</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样：<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">create table #t(…)</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">13.Update 语句，如果只更改1、2个字段，不要Update全部字段，否则频繁调用会引起明显的性能消耗，同时带来大量日志。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>14.对于多张大数据量（这里几百条就算大了）的表JOIN，要先分页再JOIN，否则逻辑读会很高，性能很差。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>15.select count(*) from table；这样不带任何条件的count会引起全表扫描，并且没有任何业务意义，是一定要杜绝的。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>16.索引并不是越多越好，索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有 必要。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>17.应尽可能的避免更新 clustered 索引数据列，因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>18.尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连 接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>19.尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>20.任何地方都不要使用 select * from t ，用具体的字段列表代替“*”，不要返回用不到的任何字段。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>21.尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>22. 避免频繁创建和删除临时表，以减少系统表资源的消耗。临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件， 最好使用导出表。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>23.在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>24.如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>25.尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>26.使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>27.与临时表一样，游标并不是不可使用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时 间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>28.在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。无需在执行存储过程和触发器的每个语句后向客户端发送 DONE_IN_PROC 消息。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>29.尽量避免大事务操作，提高系统并发能力。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>30.尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> </p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">实际案例分析：拆分大的 DELETE 或INSERT 语句，批量提交SQL语句</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">如果你需要在一个在线的网站上去执行一个大的 DELETE 或 INSERT 查询，你需要非常小心，要避免你的操作让你的整个网站停止相应。因为这两个操作是会锁表的，表一锁住了，别的操作都进不来了。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Apache 会有很多的子进程或线程。所以，其工作起来相当有效率，而我们的服务器也不希望有太多的子进程，线程和数据库链接，这是极大的占服务器资源的事情，尤其是内存。</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">如果你把你的表锁上一段时间，比如30秒钟，那么对于一个有很高访问量的站点来说，这30秒所积累的访问进程/线程，数据库链接，打开的文件数，可能不仅仅会让你的WEB服务崩溃，还可能会让你的整台服务器马上挂了。<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>　　</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">所以，如果你有一个大的处理，你一定把其拆分，使用 LIMIT oracle(rownum),sqlserver(top)条件是一个好的方法。下面是一个</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">mysql示例：<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="font-size:16px;margin:0px;letter-spacing:0px;word-spacing:0px;line-height:1.6;padding:0px;color:rgb(62, 62, 62);word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="letter-spacing:0px;margin:0px 2px;max-width:100%;box-sizing:border-box;word-wrap:normal !important;overflow-wrap:break-word;line-height:18px;font-size:14px;font-weight:normal;word-spacing:0px;padding:0.5em;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;color:rgb(169, 183, 198);background:rgb(40, 43, 46) none repeat scroll 0% 0%;overflow-x:auto;display:block !important;white-space:pre !important;word-break:normal !important;overflow:auto !important;">while(1){<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/> 　　//每次只做1000条　　 mysql_query(“<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">delete</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">from</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">logs</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">where</span> log_date &lt;= ’<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">2012</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">-11</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">-01</span>’ <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(248, 35, 117);word-break:inherit !important;">limit</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(174, 135, 250);word-break:inherit !important;">1000</span>”);<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/> 　　if(mysql_affected_rows() == 0){<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>　　 　　//删除完成，退出！　　 　　break；<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>　　}//每次暂停一段时间，释放表让其他进程/线程访问。usleep(50000)<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/>}<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></code></pre></div><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"> </p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;">好了，到这里就写完了。我知道还有很多没有写到的，还请大家补充。后面有空会介绍一些SQL优化工具给大家。让我们一起学习，一起进步吧！</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="caret-color:rgb(51, 51, 51);margin:0px;text-size-adjust:auto;white-space:normal;letter-spacing:0.544px;font-size:17px;font-family:-apple-system-font, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Hiragino Sans GB, Microsoft YaHei UI, Microsoft YaHei, Arial, sans-serif;padding:0px;color:rgb(51, 51, 51);min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;color:rgb(89, 89, 89);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:16px;color:rgb(51, 51, 51);widows:1;font-family:微软雅黑;letter-spacing:0.544px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(61, 167, 66);">陛下...看完奏折，点个赞再走吧！</span></strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);">推荐阅读<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);">技术：<a href="https://mp.weixin.qq.com/s?__biz=MzU5OTMyODAyNg==&amp;mid=2247484736&amp;idx=1&amp;sn=329b54d1ec8be019b33b5a2b1f4f16f9&amp;chksm=feb7d135c9c05823fd78190cb22fd9713f1c246e26e8374d46ca47ecd7825b02fe9d48305786&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank">jenkins和docker实现自动化构建部署</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);">技术：<a href="https://mp.weixin.qq.com/s?__biz=MzU5OTMyODAyNg==&amp;mid=2247484463&amp;idx=1&amp;sn=7a53ef01a7b4752ea0c4492204a2a9f5&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;">设计图都不会画，还想做”架构师“？</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);">技术：<a href="http://mp.weixin.qq.com/s?__biz=MzU5OTMyODAyNg==&amp;mid=2247484700&amp;idx=1&amp;sn=10cacf3afd4781989ca30a5ff0a4fc50&amp;chksm=feb7d169c9c0587f0778e7f7bd4266661a10da32d1b335328362d37589b79643d6fbef8a7282&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 122, 170);">玩转linux 这些命令就够了 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);"><a href="http://mp.weixin.qq.com/s?__biz=MzU5OTMyODAyNg==&amp;mid=2247484246&amp;idx=1&amp;sn=49d9b0f7df40609e92f979ea7b6380b9&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);">技术：</span></a><a href="https://mp.weixin.qq.com/s?__biz=MzU5OTMyODAyNg==&amp;mid=2247484721&amp;idx=1&amp;sn=11e4e29886e581dd328311d308ccc068&amp;chksm=feb7d144c9c058529465b02a4e26a25ef76b60be8984ace9e4a0f5d3d98ca52e014ecb73b061&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank">Kafka、RabbitMQ、RocketMQ等消息中间件的对比<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);">技术：<a href="https://mp.weixin.qq.com/s?__biz=MzU5OTMyODAyNg==&amp;mid=2247484700&amp;idx=1&amp;sn=10cacf3afd4781989ca30a5ff0a4fc50&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank">玩转linux 这些命令就够了</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);">技术：<a href="http://mp.weixin.qq.com/s?__biz=MzU5OTMyODAyNg==&amp;mid=2247484542&amp;idx=1&amp;sn=c78dc2f612d871595b620ca3d2b8ea81&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank">30分钟如何学会使用Shiro <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);">工具：<a href="http://mp.weixin.qq.com/s?__biz=MzU5OTMyODAyNg==&amp;mid=2247483848&amp;idx=1&amp;sn=91ce0f4a36b1009d78c357f1129d5281&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;">如何通过技术手段 “干掉” 视频APP里讨厌广告？</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);">工具：<a href="http://mp.weixin.qq.com/s?__biz=MzU5OTMyODAyNg==&amp;mid=2247483860&amp;idx=1&amp;sn=c074f6cbffc03f216e6f47f4410c884b&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;">通过技术手段 “干掉” 视频APP里讨厌的广告之（腾讯视频）</a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);">博主11年java开发经验，现从事智能语音工作的研发，关注微信公众号与博主进行技术交流！更过干货资源等你来拿！</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;background-color:rgba(255, 255, 255, 0);"><img src="数据库SQL优化大总结之 百万级数据库优化方案_files/640" type="image/webp" data-filename="640" height="344" style="margin:0px;padding:0px;max-width:100% !important;box-sizing:border-box;word-wrap:break-word;height:auto !important;overflow-wrap:break-word !important;visibility:visible !important;width:auto !important;" width="auto"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;background-color:rgba(255, 255, 255, 0);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;color:rgb(51, 51, 51);"><img src="数据库SQL优化大总结之 百万级数据库优化方案_files/640 [1]" type="image/webp" data-filename="640" height="417" style="margin:0px;padding:0px;max-width:100% !important;box-sizing:border-box;word-wrap:break-word;height:auto !important;overflow-wrap:break-word !important;visibility:visible !important;width:auto !important;" width="auto"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p>
                </div>
                

                
                

                
                                

                
                                
                
                            </div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 