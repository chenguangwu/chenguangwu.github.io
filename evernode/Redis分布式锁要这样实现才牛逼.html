<html>
<head>
  <title>Redis分布式锁要这样实现才牛逼</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2841"/>
<h1>Redis分布式锁要这样实现才牛逼</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/12/13 10:42</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&mid=2247484940&idx=1&sn=f369b13599b8680675ea0f441b4de7be&chksm=96cd4640a1bacf566c14c16bf52072c51b8956ebd1597466cedc5059a8b79f3a42bdd19f3e52&scene=21#wechat_redirect"><i>https://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484940&amp;idx=1&amp;sn=f369b13599b8680675ea0f441b4de7be&amp;chksm=96cd4640a1bacf566c14c16bf52072c51b8956ebd1597466cedc5059a8b79f3a42bdd19f3e52&amp;scene=21#wechat_redirect</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;"><div style="text-size-adjust:100%;line-height:1.6;"><div style="font-family:-apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color:rgb(51, 51, 51);letter-spacing:0.034em;background-color:rgb(255, 255, 255);"><div><div style="word-wrap:break-word;"><div style="background-color:rgb(255, 255, 255);"><div>
                                    
                        

            <div style="margin:0px;padding:0px;">

                
                <h2 style="margin:0px;padding:0px;font-weight:400;font-size:22px;line-height:1.4;margin-bottom:14px;">
                    
                    
                    Redis分布式锁要这样实现才牛逼

                                                                                </h2>
                <div style="margin:0px;padding:0px;margin-bottom:22px;line-height:20px;font-size:0px;word-wrap:break-word;word-break:break-all;position:relative;z-index:1;">
                                                                                <span style="padding:0px;margin:0px 10px 10px 0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);color:rgba(0, 0, 0, 0.3);">
                                                <span style="margin:0px;padding:0px;color:rgb(87, 107, 149);">阿飞的博客</span>
                                            </span>
                                        
                                       
                                                                    
                                        <span style="padding:0px;margin:0px 10px 10px 0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);position:relative;">
                      <a href="#" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);">
                        占小狼的博客                      </a>
                      
                    </span>


                    <em style="padding:0px;margin:0px 10px 10px 0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);color:rgba(0, 0, 0, 0.3);font-style:normal;">11月27日</em>





                </div>
                
                
                
                
                                                
                                                                
                                
                
                <div style="margin:0px;padding:0px;overflow:hidden;color:rgb(51, 51, 51);font-size:17px;word-wrap:break-word;text-align:justify;position:relative;">
                    

                    

                    
                    
                    <p style="min-height:1em;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;padding:0px;margin-bottom:15px;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">说到Redis分布式锁大部分人都会想到：setnx+lua，或者知道set key value px milliseconds nx。后一种方式的核心实现命令如下：</p><pre style="border-radius:0px;margin:0px;border-style:solid !important;border-width:1px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;margin-top:0px;margin-bottom:0px;background-color:rgb(45, 45, 45);padding:8px 0px 6px;overflow-y:auto;color:rgb(80, 97, 109);font-size:10px;line-height:12px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:rgb(226, 226, 226) !important;"><ol style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">//获取锁（unique_value可以是UUID等）</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">SET resource_name unique_value NX PX </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(249, 145, 87);line-height:20px;font-size:13px !important;white-space:inherit !important;">30000</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">//释放锁（lua脚本中，一定要比较value，防止误解锁）</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">if</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> redis</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">call</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;get&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">KEYS</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">[</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(249, 145, 87);line-height:20px;font-size:13px !important;white-space:inherit !important;">1</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">])</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">==</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> ARGV</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">[</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(249, 145, 87);line-height:20px;font-size:13px !important;white-space:inherit !important;">1</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">]</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">then</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">return</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> redis</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">call</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;del&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">KEYS</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">[</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(249, 145, 87);line-height:20px;font-size:13px !important;white-space:inherit !important;">1</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">])</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">else</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">return</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(249, 145, 87);line-height:20px;font-size:13px !important;white-space:inherit !important;">0</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">end</span></code></span></span></p></li></ol></pre><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">这种实现方式有3大要点（也是面试概率非常高的地方）：</p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">set命令要用set key value px milliseconds nx；</span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">value要具有唯一性；</span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">释放锁时要验证value值，不能误解锁；</span></span></p></li></ul><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">事实上这类琐最大的缺点就是它加锁时只作用在一个Redis节点上，即使Redis通过sentinel保证高可用，如果这个master节点由于某些原因发生了主从切换，那么就会出现锁丢失的情况：</p><ol style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">在Redis的master节点上拿到了锁；</span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">但是这个加锁的key还没有同步到slave节点；</span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">master故障，发生故障转移，slave节点升级为master节点；</span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">导致锁丢失。</span></span></p></li></ol><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">正因为如此，Redis作者antirez基于分布式环境下提出了一种更高级的分布式锁的实现方式：<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 0, 0);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:20px;">Redlock</span></strong></span></p><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">笔者认为Redlock也是Redis所有分布式锁实现方式中唯一能让面试官高潮的方式。</p><h3 style="word-wrap:break-word;font-weight:400;margin:0px;padding:0px;white-space:normal;line-height:1.35;font-size:20px;margin-top:1.5rem;margin-bottom:1rem;color:rgb(21, 153, 87);box-sizing:border-box;max-width:100%;font-family:Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">Redlock实现</h3><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">antirez提出的redlock算法大概是这样的：</p><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">在Redis的分布式环境中，我们假设有N个Redis master。这些节点完全互相独立，不存在主从复制或者其他集群协调机制。我们确保将在N个实例上使用与在Redis单实例下相同方法获取和释放锁。现在我们假设有5个Redis master节点，同时我们需要在5台服务器上面运行这些Redis实例，这样保证他们不会同时都宕掉。</p><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">为了取到锁，客户端应该执行以下操作:</p><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">获取当前Unix时间，以毫秒为单位。</p><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">依次尝试从5个实例，使用相同的key和具有唯一性的value（例如UUID）获取锁。当向Redis请求获取锁时，客户端应该设置一个网络连接和响应超时时间，这个超时时间应该小于锁的失效时间。例如你的锁自动失效时间为10秒，则超时时间应该在5-50毫秒之间。这样可以避免服务器端Redis已经挂掉的情况下，客户端还在死死地等待响应结果。如果服务器端没有在规定时间内响应，客户端应该尽快尝试去另外一个Redis实例请求获取锁。</p><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">客户端使用当前时间减去开始获取锁时间（步骤1记录的时间）就得到获取锁使用的时间。当且仅当从大多数（N/2+1，这里是3个节点）的Redis节点都取到锁，并且使用的时间小于锁失效时间时，锁才算获取成功。</p><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">如果取到了锁，key的真正有效时间等于有效时间减去获取锁所使用的时间（步骤3计算的结果）。</p><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">如果因为某些原因，获取锁失败（没有在至少N/2+1个Redis实例取到锁或者取锁时间已经超过了有效时间），客户端应该在所有的Redis实例上进行解锁（即便某些Redis实例根本就没有加锁成功，防止某些节点获取到锁但是客户端没有得到响应而导致接下来的一段时间不能被重新获取锁）。</p><h3 style="word-wrap:break-word;font-weight:400;margin:0px;padding:0px;white-space:normal;line-height:1.35;font-size:20px;margin-top:1.5rem;margin-bottom:1rem;color:rgb(21, 153, 87);box-sizing:border-box;max-width:100%;font-family:Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">Redlock源码</h3><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">redisson已经有对redlock算法封装，接下来对其用法进行简单介绍，并对核心源码进行分析（假设5个redis实例）。</p><h4 style="word-wrap:break-word;font-weight:400;margin:0px;padding:0px;line-height:1.35;color:rgb(21, 153, 87);font-size:18px;margin-top:1.5rem;margin-bottom:1rem;white-space:normal;box-sizing:border-box;max-width:100%;font-family:Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">POM依赖</h4><pre style="border-radius:0px;margin:0px;border-style:solid !important;border-width:1px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;margin-top:0px;margin-bottom:0px;background-color:rgb(45, 45, 45);padding:8px 0px 6px;overflow-y:auto;color:rgb(80, 97, 109);font-size:10px;line-height:12px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:rgb(226, 226, 226) !important;"><ol style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;!-- https://mvnrepository.com/artifact/org.redisson/redisson --&gt;</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(242, 119, 122);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;dependency&gt;</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(242, 119, 122);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;groupId&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">org.redisson</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(242, 119, 122);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;/groupId&gt;</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(242, 119, 122);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;artifactId&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">redisson</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(242, 119, 122);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;/artifactId&gt;</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(242, 119, 122);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;version&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">3.3.2</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(242, 119, 122);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;/version&gt;</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(242, 119, 122);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;/dependency&gt;</span></code></span></span></p></li></ol></pre><h4 style="word-wrap:break-word;font-weight:400;margin:0px;padding:0px;white-space:normal;line-height:1.35;font-size:18px;margin-top:1.5rem;margin-bottom:1rem;color:rgb(21, 153, 87);box-sizing:border-box;max-width:100%;font-family:Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">用法</h4><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">首先，我们来看一下redission封装的redlock算法实现的分布式锁用法，非常简单，跟重入锁（ReentrantLock）有点类似：</p><pre style="border-radius:0px;margin:0px;border-style:solid !important;border-width:1px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;margin-top:0px;margin-bottom:0px;background-color:rgb(45, 45, 45);padding:8px 0px 6px;overflow-y:auto;color:rgb(80, 97, 109);font-size:10px;line-height:12px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:rgb(226, 226, 226) !important;"><ol style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">Config</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> config </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">=</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">new</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">Config</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">();</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">config</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">useSentinelServers</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">().</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">addSentinelAddress</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;127.0.0.1:6369&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;127.0.0.1:6379&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;127.0.0.1:6389&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">)</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">        </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">setMasterName</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;masterName&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">)</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">        </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">setPassword</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;password&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">).</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">setDatabase</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(249, 145, 87);line-height:20px;font-size:13px !important;white-space:inherit !important;">0</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">);</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">RedissonClient</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> redissonClient </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">=</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">Redisson</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">create</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">config</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">);</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 还可以getFairLock(), getReadWriteLock()</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">RLock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> redLock </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">=</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> redissonClient</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">getLock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;REDLOCK_KEY&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">);</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">boolean</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> isLock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">;</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">try</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">{</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    isLock </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">=</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> redLock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">tryLock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">();</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 500ms拿不到锁, 就认为获取锁失败。10000ms即10s是锁失效时间。</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    isLock </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">=</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> redLock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">tryLock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(249, 145, 87);line-height:20px;font-size:13px !important;white-space:inherit !important;">500</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(249, 145, 87);line-height:20px;font-size:13px !important;white-space:inherit !important;">10000</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">TimeUnit</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">MILLISECONDS</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">);</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">if</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">isLock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">)</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">{</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">        </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">//TODO if get lock success, do something;</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">}</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">}</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">catch</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">Exception</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> e</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">)</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">{</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">}</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">finally</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">{</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 无论如何, 最后都要解锁</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    redLock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">unlock</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">();</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">}</span></code></span></span></p></li></ol></pre><h4 style="word-wrap:break-word;font-weight:400;margin:0px;padding:0px;white-space:normal;line-height:1.35;font-size:18px;margin-top:1.5rem;margin-bottom:1rem;color:rgb(21, 153, 87);box-sizing:border-box;max-width:100%;font-family:Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">唯一ID</h4><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">实现分布式锁的一个非常重要的点就是set的value要具有唯一性，redisson的value是怎样保证value的唯一性呢？答案是UUID+threadId。入口在redissonClient.getLock(&quot;REDLOCK_KEY&quot;)，源码在Redisson.java和RedissonLock.java中：</p><pre style="border-radius:0px;margin:0px;border-style:solid !important;border-width:1px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;margin-top:0px;margin-bottom:0px;background-color:rgb(45, 45, 45);padding:8px 0px 6px;overflow-y:auto;color:rgb(80, 97, 109);font-size:10px;line-height:12px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:rgb(226, 226, 226) !important;"><ol style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">protected</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">final</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> UUID id </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">=</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> UUID</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">randomUUID</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">();</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">String</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> getLockName</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">long</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> threadId</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">)</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">{</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">return</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> id </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;:&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> threadId</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">;</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">}</span></code></span></span></p></li></ol></pre><h4 style="word-wrap:break-word;font-weight:400;margin:0px;padding:0px;white-space:normal;line-height:1.35;font-size:18px;margin-top:1.5rem;margin-bottom:1rem;color:rgb(21, 153, 87);box-sizing:border-box;max-width:100%;font-family:Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">获取锁</h4><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;font-size:16px;white-space:pre-line;background-color:rgb(255, 255, 255);">获取锁的代码为 </span><code style="font-size:16px;margin:0px;border-style:initial !important;border-width:0px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;background:rgb(243, 241, 241);color:rgb(88, 88, 88);padding:0px;white-space:pre-line;line-height:18px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:initial !important;"><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">redLock</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">.</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">tryLock</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">()</span></code><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;font-size:16px;white-space:pre-line;background-color:rgb(255, 255, 255);">或者 </span><code style="font-size:16px;margin:0px;border-style:initial !important;border-width:0px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;background:rgb(243, 241, 241);color:rgb(88, 88, 88);padding:0px;white-space:pre-line;line-height:18px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:initial !important;"><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">redLock</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">.</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">tryLock</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">(</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">500</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">,</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">10000</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">,</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">TimeUnit</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">.</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">MILLISECONDS</span><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">)</span></code><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;font-size:16px;white-space:pre-line;background-color:rgb(255, 255, 255);">，两者的最终核心源码都是下面这段代码，只不过前者获取锁的默认租约时间leaseTime是 </span><code style="font-size:16px;margin:0px;border-style:initial !important;border-width:0px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;background:rgb(243, 241, 241);color:rgb(88, 88, 88);padding:0px;white-space:pre-line;line-height:18px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:initial !important;"><span style="background-repeat:initial;margin:0px;padding-left:2px;padding-right:2px;display:inline-block;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px;">LOCK_EXPIRATION_INTERVAL_SECONDS</span></code><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;font-size:16px;white-space:pre-line;background-color:rgb(255, 255, 255);">，</span>即30s：</p><pre style="border-radius:0px;margin:0px;border-style:solid !important;border-width:1px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;margin-top:0px;margin-bottom:0px;background-color:rgb(45, 45, 45);padding:8px 0px 6px;overflow-y:auto;color:rgb(80, 97, 109);font-size:10px;line-height:12px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:rgb(226, 226, 226) !important;"><ol style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">public</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">T</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">RFuture</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">T</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> tryLockInnerAsync</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">long</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> leaseTime</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">TimeUnit</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> unit</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">long</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> threadId</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">RedisStrictCommand</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">T</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> command</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">)</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">{</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    internalLockLeaseTime </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">=</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> unit</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">toMillis</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">leaseTime</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">);</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 获取锁时向5个redis实例发送的命令</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">return</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> commandExecutor</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">evalWriteAsync</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">getName</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(),</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">LongCodec</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">INSTANCE</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> command</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">              </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 首先分布式锁的KEY不能存在，如果确实不存在，那么执行hset命令（hset REDLOCK_KEY uuid+threadId 1），并通过pexpire设置失效时间（也是锁的租约时间）</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">              </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;if (redis.call('exists', KEYS[1]) == 0) then &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                  </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;redis.call('hset', KEYS[1], ARGV[2], 1); &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                  </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;redis.call('pexpire', KEYS[1], ARGV[1]); &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                  </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;return nil; &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">              </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;end; &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">              </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 如果分布式锁的KEY已经存在，并且value也匹配，表示是当前线程持有的锁，那么重入次数加1，并且设置失效时间</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">              </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;if (redis.call('hexists', KEYS[1], ARGV[2]) == 1) then &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                  </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;redis.call('hincrby', KEYS[1], ARGV[2], 1); &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                  </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;redis.call('pexpire', KEYS[1], ARGV[1]); &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                  </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;return nil; &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">              </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;end; &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">              </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 获取分布式锁的KEY的失效时间毫秒数</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">              </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;return redis.call('pttl', KEYS[1]);&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">              </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 这三个参数分别对应KEYS[1]，ARGV[1]和ARGV[2]</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">Collections</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.&lt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">Object</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">singletonList</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">getName</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">()),</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> internalLockLeaseTime</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> getLockName</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">threadId</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">));</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">}</span></code></span></span></p></li></ol></pre><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">获取锁的命令中，</p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">KEYS[1]就是 <code style="color:rgb(88, 88, 88);margin:0px;border-style:initial !important;border-width:0px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;background:rgb(243, 241, 241);padding:0px;font-size:16px;line-height:18px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:initial !important;"><span style="background-repeat:initial;margin:0px;line-height:22px;padding-left:2px;padding-right:2px;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;display:inline-block;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px !important;">Collections</span><span style="background-repeat:initial;margin:0px;line-height:22px;padding-left:2px;padding-right:2px;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;display:inline-block;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px !important;">.</span><span style="background-repeat:initial;margin:0px;line-height:22px;padding-left:2px;padding-right:2px;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;display:inline-block;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px !important;">singletonList</span><span style="background-repeat:initial;margin:0px;line-height:22px;padding-left:2px;padding-right:2px;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;display:inline-block;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px !important;">(</span><span style="background-repeat:initial;margin:0px;line-height:22px;padding-left:2px;padding-right:2px;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;display:inline-block;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px !important;">getName</span><span style="background-repeat:initial;margin:0px;line-height:22px;padding-left:2px;padding-right:2px;background-image:initial;background-position:initial;background-size:initial;padding:0px;background-attachment:initial;background-origin:initial;background-clip:initial;display:inline-block;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-size:14px !important;">())</span></code>，表示分布式锁的key，即REDLOCK_KEY；</span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">ARGV[1]就是internalLockLeaseTime，即锁的租约时间，默认30s；</span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);line-height:22px;font-size:14px !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;">ARGV[2]就是getLockName(threadId)，是获取锁时set的唯一值，即UUID+threadId：</span></span></p></li></ul><h4 style="word-wrap:break-word;font-weight:400;margin:0px;padding:0px;white-space:normal;line-height:1.35;font-size:18px;margin-top:1.5rem;margin-bottom:1rem;color:rgb(21, 153, 87);box-sizing:border-box;max-width:100%;font-family:Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">释放锁</h4><p style="margin-top:15px;margin:0px;color:rgb(74, 74, 74);line-height:30px;white-space:pre-line;font-size:16px;margin-bottom:15px;padding:0px;min-height:1em;clear:both;word-wrap:break-word;box-sizing:border-box;max-width:100%;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;">释放锁的代码为redLock.unlock()，核心源码如下：</p><pre style="border-radius:0px;margin:0px;border-style:solid !important;border-width:1px !important;font-family:consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot;!important;margin-top:0px;margin-bottom:0px;background-color:rgb(45, 45, 45);padding:8px 0px 6px;overflow-y:auto;color:rgb(80, 97, 109);font-size:10px;line-height:12px;word-wrap:break-word;box-sizing:border-box;max-width:100%;border-color:rgb(226, 226, 226) !important;"><ol style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:none;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">protected</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">RFuture</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&lt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">Boolean</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> unlockInnerAsync</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">long</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> threadId</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">)</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">{</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 向5个redis实例都执行如下命令</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">    </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">return</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> commandExecutor</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">evalWriteAsync</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">getName</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(),</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">LongCodec</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">INSTANCE</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">RedisCommands</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">EVAL_BOOLEAN</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 如果分布式锁KEY不存在，那么向channel发布一条消息</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;if (redis.call('exists', KEYS[1]) == 0) then &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;redis.call('publish', KEYS[2], ARGV[1]); &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;return 1; &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;end;&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 如果分布式锁存在，但是value不匹配，表示锁已经被占用，那么直接返回</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;if (redis.call('hexists', KEYS[1], ARGV[3]) == 0) then &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;return nil;&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;end; &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 如果就是当前线程占有分布式锁，那么将重入次数减1</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;local counter = redis.call('hincrby', KEYS[1], ARGV[3], -1); &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 重入次数减1后的值如果大于0，表示分布式锁有重入过，那么只设置失效时间，还不能删除</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;if (counter &gt; 0) then &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;redis.call('pexpire', KEYS[1], ARGV[2]); &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;return 0; &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;else &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 重入次数减1后的值如果为0，表示分布式锁只获取过1次，那么删除这个KEY，并发布解锁消息</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;redis.call('del', KEYS[1]); &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;redis.call('publish', KEYS[2], ARGV[1]); &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">                </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;return 1; &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;end; &quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">+</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 204, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">&quot;return nil;&quot;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(153, 153, 153);line-height:20px;font-size:13px !important;white-space:inherit !important;">// 这5个参数分别对应KEYS[1]，KEYS[2]，ARGV[1]，ARGV[2]和ARGV[3]</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">            </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">Arrays</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.&lt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">Object</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">&gt;</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">asList</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">getName</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(),</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> getChannelName</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">()),</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(102, 153, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">LockPubSub</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">.</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">unlockMessage</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> internalLockLeaseTime</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">,</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;"> getLockName</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">(</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">threadId</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">));</span></code></span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(74, 74, 74);display:block;line-height:22px;font-size:14px !important;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;line-height:22px;display:block;word-break:inherit !important;"><code style="line-height:12px;margin:0px;font-family:inherit !important;font-size:10px;border-color:initial;margin-left:-20px;display:flex;overflow:initial;padding:0px;overflow-wrap:normal;border-width:0px;border-style:initial;word-wrap:break-word;box-sizing:border-box;max-width:100%;white-space:pre !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(204, 204, 204);line-height:20px;font-size:13px !important;white-space:inherit !important;">}</span></code></span></span></p></li></ol></pre><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><em style="margin:0px;padding:0px;font-style:italic;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(178, 178, 178);font-size:inherit;letter-spacing:0px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;">参考：https://redis.io/topics/distlock</span></em><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;letter-spacing:0.544px;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="min-height:1em;margin:15px 8px;max-width:100%;box-sizing:border-box;word-wrap:break-word;clear:both;padding:0px;letter-spacing:0.544px;color:rgb(62, 62, 62);font-family:Helvetica, Arial, sans-serif;font-size:15px;line-height:1.75em;text-align:center;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;letter-spacing:1px;color:rgb(64, 118, 0);">-END-</span></strong></p><p style="clear:both;margin:5px 8px;max-width:100%;box-sizing:border-box;word-wrap:break-word;padding:0px;min-height:1em;letter-spacing:0.544px;font-size:16px;color:rgb(62, 62, 62);word-spacing:2px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 255, 255);background-color:rgb(64, 118, 0);"> </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 255, 255);background-color:rgb(64, 118, 0);font-size:15px;">近期热文：</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484720&amp;idx=2&amp;sn=1bf6609004171d2e69e8f21cca154074&amp;chksm=96cd457ca1bacc6a1fe95e1bda3818111e82066a9174dd940b6fdf9a5a96221bb0dbeb9ba6d5&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">缓存穿透、缓存并发、缓存失效之思路变迁</a></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484923&amp;idx=1&amp;sn=250ddc59d358075f2d7a8bbe21a300da&amp;chksm=96cd45b7a1bacca10b3001643c6a3ceedb02dc707daddbdc0b00cd25e5b0d86fc2a05a8b3f02&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">图解elasticsearch原理</a><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484909&amp;idx=1&amp;sn=c23ecd81f3bdb6ab65a132f0c0dd2bc4&amp;chksm=96cd45a1a1baccb7b30b0e45ea06e80a3abe9f523156659026a968f474c0b2dd3906fd733e7f&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">阿里员工都是这样排查Java问题的，附工具单</a></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484884&amp;idx=1&amp;sn=721c8d7461a481e06784972ac3c9e2f8&amp;chksm=96cd4598a1bacc8ed313c3f1e926e78b709cd297e6e3face48b5bcbcf18a0694ace9121d8753&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">如何使用MAT进行JVM内存泄露分析</a><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484751&amp;idx=1&amp;sn=8616aece193d174c12757d22e3e04924&amp;chksm=96cd4503a1bacc154aceaaa89cdb8eeb4c2a83a459df0edb2c5380579aa46a946a94bfa1dac1&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">来之不易的美团面试，结果居然挂了...（附面试答案）</a><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484715&amp;idx=1&amp;sn=de8d79aaf675cf1b2b26b1f48fc3472c&amp;chksm=96cd4567a1bacc7140d5ac0ba970568036cdf3c4bca5ba80247881738e41b262bebd39b68022&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">一文带你了解Java Agent</a></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484695&amp;idx=1&amp;sn=b1b07370e72d8a8a5e16c2d689fbe6de&amp;chksm=96cd455ba1bacc4de41b31ec79176fb5cd6f031ae2761dd46ad66ab5c868d8c98253a640a1b5&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">优秀开源框架的扩展机制，原来都是这样实现的...</a></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484669&amp;idx=1&amp;sn=5b79f5c3a7c62323e36b72091c2df502&amp;chksm=96cd44b1a1bacda7eeffd506293e6d59c4edd2cc6afe56c0addbd552c36a532594f4b1b56fdc&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">蚂蚁金服中间件，一大波面经来袭！</a></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484619&amp;idx=1&amp;sn=8f4470aca7e0a817d53b2283b5811d49&amp;chksm=96cd4487a1bacd91a7e59b16163423485bd39a44075ea83c56462c4b7c1580963231228f1f14&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">【第二弹】21个让程序员泪流满面的瞬间</a></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484783&amp;idx=2&amp;sn=d22116d6e9562e15a240bded40383e22&amp;chksm=96cd4523a1bacc35f7eacfcc3d3d4dcd13947d6d612d9299256dc50a47e2d868a4d302bc9fb0&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">又发生频繁FGC，这次是谁的锅？</a></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484767&amp;idx=1&amp;sn=bcb48e4df05c296b33b27369a560a2cb&amp;chksm=96cd4513a1bacc058afbda2aee55f2df7d6beb7428aa39a2dea520865ad7f153a64cc4fa8b44&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;" target="_blank">算法面试，如何在100 亿URL中判断某个URL是否存在？</a></h2></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><h2 style="margin:0px;padding:0px;font-weight:400;font-size:16px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484774&amp;idx=1&amp;sn=e588f5925213c115a13deac2be300e68&amp;chksm=96cd452aa1bacc3cc15d82f92e9014147c42e092b606604d68ba248b5419739e6a3ac923cf61&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank">百万并发下的Nginx性能优化之道，值得看！！！</a></span></h2></li></ul><p style="text-indent:0em;margin:5px 8px;max-width:100%;box-sizing:border-box;word-wrap:break-word;clear:both;min-height:1em;letter-spacing:0.544px;padding:0px;font-size:16px;word-spacing:2px;text-align:center;white-space:pre-line;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height:1.75em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/><img src="Redis分布式锁要这样实现才牛逼_files/640" type="image/webp" data-filename="640" height="258" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;visibility:visible !important;width:258px !important;" width="258"/></p></div></div></div></div></div></div></div>
                </div>
                

                
                
                
                
                

                
                                
                                
                                                
                
                                <a href="https://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247484940&amp;idx=1&amp;sn=f369b13599b8680675ea0f441b4de7be&amp;chksm=96cd4640a1bacf566c14c16bf52072c51b8956ebd1597466cedc5059a8b79f3a42bdd19f3e52&amp;scene=21##" style="text-decoration:none;margin:20px 0px;padding:1.17em 0px;color:rgb(51, 51, 51);-webkit-tap-highlight-color:rgba(0, 0, 0, 0);display:block;border:1px solid rgb(234, 234, 234);border-width:0px;position:relative;"><span style="color:rgb(51, 51, 51);position:absolute;left:0px;top:0px;right:0px;height:1px;border-top:1px solid rgb(223, 223, 223);transform-origin:0px 0px 0px;transform:scaleY(0.5);"> </span>
                    <div style="margin:0px;display:flex;-webkit-box-align:center;align-items:center;padding:0px;font-size:14px;">
                        <div style="margin:0px;padding:0px;-webkit-box-flex:1;flex:1 1 0%;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal;">
                          <p style="margin:0px;padding:0px;color:rgba(0, 0, 0, 0.3);">文章转载自公众号</p>
                        </div>
                        <div style="margin:0px;padding:0px;font-size:14px;color:rgb(136, 136, 136);padding-left:1em;white-space:nowrap;">
                            <span style="margin:0px;display:inline-block;background-color:rgb(255, 255, 255);border-radius:50%;overflow:hidden;vertical-align:middle;padding:0px;width:20px;height:20px;margin-right:0.2em;">
                                                                <img src="Redis分布式锁要这样实现才牛逼_files/0" type="image/jpeg" data-filename="0" height="20" style="margin:0px;padding:0px;display:block;width:100%;border-radius:50%;background-color:rgb(238, 238, 238);height:100%;" width="20"/>
                                                            </span>
                            <strong style="overflow:hidden;margin:0px;padding:0px;vertical-align:middle;font-weight:400;width:auto;display:inline-block;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal;max-width:8em;color:rgb(0, 0, 0);">
                              阿飞的博客
                            </strong>
                        <span style="font-size:14px;color:rgb(136, 136, 136);white-space:nowrap;display:inline-block;height:8px;width:8px;border-width:1px 1px 0px 0px;border-color:rgb(203, 202, 208);border-style:solid;transform:matrix(0.71, 0.71, -0.71, 0.71, 0, 0);position:relative;top:0px;margin-right:4px;"> </span></div>
                    </div>
                <span style="color:rgb(51, 51, 51);position:absolute;left:0px;bottom:0px;right:0px;height:1px;border-bottom:1px solid rgb(223, 223, 223);transform-origin:0px 100% 0px;transform:scaleY(0.5);"> </span></a>
                            </div>
                                    
                        


                        
            


            
                        <div style="margin:0px;padding:0px;overflow:hidden;line-height:32px;font-size:15px;padding-top:15px;">

                                            


                

                
                
                
            </div>

            
            

            

            
            

            






                      </div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 