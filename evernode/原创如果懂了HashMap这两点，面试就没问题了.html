<html>
<head>
  <title>原创|如果懂了HashMap这两点，面试就没问题了</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="13104"/>
<h1>原创|如果懂了HashMap这两点，面试就没问题了</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/11/7 14:18</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://mp.weixin.qq.com/s?__biz=MzU1MzUzODM2NQ==&mid=2247484088&idx=1&sn=e131fa785d249a8df74809a85fb46f27&chksm=fbf004eacc878dfca482d4891ed28286a948d35b5520134ff2000f9adf2d53ed3748a38daf0e#rd"><i>http://mp.weixin.qq.com/s?__biz=MzU1MzUzODM2NQ==&amp;mid=2247484088&amp;idx=1&amp;sn=e131fa785d249a8df74809a85fb46f27&amp;chksm=fbf004eacc878dfca482d4891ed28286a948d35b5520134ff2000f9adf2d53ed3748a38daf0e#rd</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="text-size-adjust:100%;line-height:1.6;-webkit-appearance:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"><div style="font-family:-apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color:rgb(51, 51, 51);background-color:rgb(242, 242, 242);letter-spacing:0.034em;line-height:1.6;font-size:16px;-webkit-appearance:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"><div><div style="overflow-wrap:break-word;"><div style="background-color:rgb(255, 255, 255);"><div><div>
                
                <h2 style="font-weight:400;font-size:22px;margin:0px;padding:0px;line-height:1.4;margin-bottom:14px;">
                    
                    
                    
            原创|如果懂了HashMap这两点，面试就没问题了
                      </h2>
                <div style="margin:0px;padding:0px;margin-bottom:22px;line-height:20px;font-size:0px;overflow-wrap:break-word;word-break:break-all;position:relative;z-index:1;">
                                                            <span style="margin:0px 10px 10px 0px;padding:0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);margin-right:0px;color:rgba(0, 0, 0, 0.3);">原创：</span>
                                                                                            <span style="margin:0px 10px 10px 0px;padding:0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);color:rgba(0, 0, 0, 0.3);">
                                                                                                            <span style="margin:0px;padding:0px;">每天晒白牙</span>
                                                                                                </span>
                                                                
                                                                                                            <span style="margin:0px 10px 10px 0px;padding:0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);position:relative;">
                      <a href="#" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);cursor:pointer;">
                        每天晒白牙                      </a>
                      
                    </span>


                    <em style="margin:0px 10px 10px 0px;padding:0px;font-style:normal;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);color:rgba(0, 0, 0, 0.3);">今天</em>





                </div>

                

                

                

                
                                


                
                
                
                
                                                
                                                                
                                
                
                <div style="margin:0px;padding:0px;overflow:hidden;color:rgb(51, 51, 51);font-size:17px;overflow-wrap:break-word;text-align:justify;position:relative;z-index:0;">
                    

                    

                    
                    
                    <div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:15px;color:rgb(62, 62, 62);line-height:1.6;letter-spacing:0px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">HashMap 是后端面试的常客，比如默认初始容量是多少？加载因子是多少？是线程非安全的吗？put 操作过程复述下？get 操作复述下？在 jdk 1.7 和 1.8 实现上有什么不同？等等一系列问题，可能这些问题你都能对答如流，说明对 HashMap 还是比较理解的，但最近我们团队的同学做了一个技术分享，其中有几点我挺有收获的，我给大家分享下</p><blockquote style="margin:1em 0px;padding:15px 15px 15px 1rem;max-width:100%;box-sizing:border-box;overflow-wrap:normal;padding-left:10px;border-left:3px solid rgb(219, 219, 219);color:rgb(129, 145, 152);font-size:0.9em;padding-top:4px;line-height:inherit;border-left-width:6px;border-left-color:rgb(220, 230, 240);background:rgb(242, 247, 251);overflow:auto;word-break:normal;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;">我们每周五都会进行技术分享，大家轮流分享，其实这种机制挺好的，大家坐在一起深入讨论一个知识点，进行思维的碰撞，多赢</p></blockquote><h3 style="font-weight:bold;font-size:1.3em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">抛出两个问题，看你能否回答出来？</span></h3><blockquote style="margin:1em 0px;padding:15px 15px 15px 1rem;max-width:100%;box-sizing:border-box;overflow-wrap:normal;padding-left:10px;border-left:3px solid rgb(219, 219, 219);color:rgb(129, 145, 152);font-size:0.9em;padding-top:4px;line-height:inherit;border-left-width:6px;border-left-color:rgb(220, 230, 240);background:rgb(242, 247, 251);overflow:auto;word-break:normal;"><ol style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;padding-left:2.2em;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">如何找到比设置的初始容量值大的最小的 2 的幂次方整数？</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">HashMap 中对 key 做 hash 处理时，做了什么特殊操作？为什么这么做？</span></p></li></ol></blockquote><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">先自己思考下，再往下阅读效果更佳哦！</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">下面的分析都是针对 jdk 1.8</p><h3 style="font-weight:bold;font-size:1.3em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">分析</span></h3><h4 style="font-weight:bold;font-size:1.2em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">问题1：如何找到比设置的初始容量值大的最小的 2 的幂次方整数？</span></h4><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">我们在用  HashMap 的时候，如果用默认构造器，就会建一个初始容量为 16，加载因子为 0.75 的 HashMap。这样做有个缺点，就是在数据量比较大的时候，会进行频繁的扩容操作，扩容会发生数据的移位，为了避免扩容，提高性能，我们习惯预估下容量，然后通过带容量的构造器创建，看下源码</p><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="margin:0px;padding:0.5em;max-width:100%;box-sizing:border-box;overflow-wrap:normal !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;background:rgb(29, 31, 33);color:rgb(197, 200, 198);word-break:normal !important;overflow:auto !important;display:-webkit-box !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;color:inherit;line-height:inherit;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">public</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(129, 162, 190);word-break:inherit !important;">HashMap</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">int</span> initialCapacity, <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">float</span> loadFactor)</span> </span>{<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    ...<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(150, 152, 150);word-break:inherit !important;">// 如果设置的初始容量大于最大容量就默认为最大容量 2^30     </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>        initialCapacity = MAXIMUM_CAPACITY;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    ...<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">this</span>.loadFactor = loadFactor;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(150, 152, 150);word-break:inherit !important;">// tableSizeFor 方法主要就是计算比给定的初始容量值大的最小的 2 的幂次方整数</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">this</span>.threshold = tableSizeFor(initialCapacity);<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>}<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></code></pre><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">通过源码我们可知，容量最大值为 2^30，也就是说 HashMap 的数组部分的长度的范围为[0,2^30]，然后计算比初始容量大的最小的2的幂次方整数，其中 <strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">tableSizeFor</strong> 方法是重点，我们看下源码</p><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="margin:0px;padding:0.5em;max-width:100%;box-sizing:border-box;overflow-wrap:normal !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;background:rgb(29, 31, 33);color:rgb(197, 200, 198);word-break:normal !important;overflow:auto !important;display:-webkit-box !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(150, 152, 150);word-break:inherit !important;">// Returns a power of two size for the given target capacity</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;color:inherit;line-height:inherit;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">static</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">final</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">int</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(129, 162, 190);word-break:inherit !important;">tableSizeFor</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">int</span> cap)</span> </span>{<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">int</span> n = cap - <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">1</span>;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    n |= n &gt;&gt;&gt; <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">1</span>;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    n |= n &gt;&gt;&gt; <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">2</span>;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    n |= n &gt;&gt;&gt; <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">4</span>;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    n |= n &gt;&gt;&gt; <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">8</span>;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    n |= n &gt;&gt;&gt; <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">16</span>;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">return</span> (n &lt; <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">0</span>) ? <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">1</span>;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>}<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></code></pre><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">这个方法设计的非常巧妙，因为 HashMap 要保证容量是 2 的整数次幂，该方法实现的效果就是如果你输入的 cap   本身就是偶数，那么就返回 cap 本身，如果输入的 cap 是奇数，返回的就是比 cap 大的最小的 2 的整数次幂</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">为什么容量要是 2 的整数次幂？</strong></p><blockquote style="margin:1em 0px;padding:15px 15px 15px 1rem;max-width:100%;box-sizing:border-box;overflow-wrap:normal;padding-left:10px;border-left:3px solid rgb(219, 219, 219);color:rgb(129, 145, 152);font-size:0.9em;padding-top:4px;line-height:inherit;border-left-width:6px;border-left-color:rgb(220, 230, 240);background:rgb(242, 247, 251);overflow:auto;word-break:normal;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;">因为获取 key 在数组中对应的下标是通过 key 的哈希值与数组长度 -1 进行与运算，如：tab[i = (n - 1) &amp; hash]</p><ol style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;padding-left:2.2em;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">n 为 2 的整数次幂，这样 n-1 后之前为 1 的位后面全是 1，这样就能保证 (n-1) &amp; hash 后相应的位数既可能是 0 又可能是 1，这取决于 hash 的值，这样能保证散列的均匀，同时与运算效率高</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">如果 n 不是 2 的整数次幂，会造成更多的 hash 冲突</span></p></li></ol></blockquote><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">该方法首先执行了  cap -1 操作，这样做的好处是避免输入的 cap 是偶数，最后计算的数是 cap 的 2 倍的情况，因为设置的偶数 cap 已经满足 HashMap 的要求了，没有必要初始化一个 2 倍容量的 HashMap 了，看不明白不急后面有示例分析</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">前面我们已经介绍 HashMap 的最大容量为 2^30，所以容量最大就是 30 bit 的整数，我们就用 30 位的一个数演示下算法中的移位取或操作，假设 n = 001xxx xxxxxxxx xxxxxxxx xxxxxxxx （x 代表该位上是 0 还是 1 我们不关心）</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">第一次右移 n |=  n &gt;&gt;&gt; 1 ，该操作是用 n 本身 和 n 右移 1 位后的数进行或操作，这样可以实现把 n 的最高位的 1 紧邻的右边一位也置为 1</p><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="margin:0px;padding:0.5em;max-width:100%;box-sizing:border-box;overflow-wrap:normal !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;background:rgb(29, 31, 33);color:rgb(197, 200, 198);word-break:normal !important;overflow:auto !important;display:-webkit-box !important;">n       <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">001</span>xxx xxxxxxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>n <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">&gt;&gt;&gt; </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">1</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">0001</span>xx xxxxxxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">| 或操作 0011xx xxxxxxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>结果就是把 n 的最高位为 1 的紧邻的右边的 1 位也置为了 1，这样高位中有连续两位都是 1<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></span></code></pre><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">第二次右移 n |= n &gt;&gt;&gt; 2</p><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="margin:0px;padding:0.5em;max-width:100%;box-sizing:border-box;overflow-wrap:normal !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;background:rgb(29, 31, 33);color:rgb(197, 200, 198);word-break:normal !important;overflow:auto !important;display:-webkit-box !important;">n       <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">0011</span>xx xxxxxxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>n <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">&gt;&gt;&gt; </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">2</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">000011</span> xxxxxxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">| 或操作 001111 xxxxxxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>结果就是 n 的高位中有连续 4 个 1<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></span></code></pre><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">第三次右移 n |= n &gt;&gt;&gt; 4</p><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="margin:0px;padding:0.5em;max-width:100%;box-sizing:border-box;overflow-wrap:normal !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;background:rgb(29, 31, 33);color:rgb(197, 200, 198);word-break:normal !important;overflow:auto !important;display:-webkit-box !important;">n       <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">001111</span> xxxxxxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>n <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">&gt;&gt;&gt; </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">4</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">000000</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">1111</span>xxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">| 或操作 001111 1111xxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>结果就是 n 的高位中有连续 8 个 1<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></span></code></pre><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">第四次右移 n |= n &gt;&gt;&gt; 8</p><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="margin:0px;padding:0.5em;max-width:100%;box-sizing:border-box;overflow-wrap:normal !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;background:rgb(29, 31, 33);color:rgb(197, 200, 198);word-break:normal !important;overflow:auto !important;display:-webkit-box !important;">n        <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">001111</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">1111</span>xxxx xxxxxxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>n <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">&gt;&gt;&gt; </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">8</span>  <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">000000</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">00001111</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">1111</span>xxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">| 或操作  001111 11111111 1111xxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>结果就是 n 的高位中有连续 16 个 1<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></span></code></pre><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">第五次右移 n | n &gt;&gt;&gt; 16</p><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="margin:0px;padding:0.5em;max-width:100%;box-sizing:border-box;overflow-wrap:normal !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;background:rgb(29, 31, 33);color:rgb(197, 200, 198);word-break:normal !important;overflow:auto !important;display:-webkit-box !important;">n        <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">001111</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">11111111</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">1111</span>xxxx xxxxxxxx<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>n <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">&gt;&gt;&gt; </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">16</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">000000</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">00000000</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">00001111</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">11111111</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">| 或操作  001111 11111111 11111111 11111111<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>结果就是 n 的高位1后面都置为 1<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></span></code></pre><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">最后会对 n 和最大容量做比较，如果 &gt;= 2^30，就取最大容量，如果 &lt; 2^30 ，就对 n 进行 +1 操作，因为后面位数都为1，所以 +1 就相当于找比这个数大的最小的 2的整数次幂</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">011111 11111111 11111111 11111111，这个值就是比给的值大的最小的 2 的整数次幂</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">下面我们用一个具体说演示下，比如 cap = 18</p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><img src="原创如果懂了HashMap这两点，面试就没问题了_files/640.webp" type="image/webp" data-filename="640.webp" height="492" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;font-size:inherit;color:inherit;line-height:inherit;display:block;margin-right:auto;margin-left:auto;width:317px !important;visibility:visible !important;" title="cap为18" width="317"/><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;line-height:inherit;margin-top:10px;text-align:center;color:rgb(153, 153, 153);font-size:0.7em;">cap为18</div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">我们输入的是 18，输出的是 32，正好是比 18 大的最小的 2 整数次幂</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">如果 cap 本身就为 2的整数次幂，输出结果为什么？</strong></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><img src="原创如果懂了HashMap这两点，面试就没问题了_files/640 [1].webp" type="image/webp" data-filename="640.webp" height="494" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;font-size:inherit;color:inherit;line-height:inherit;display:block;margin-right:auto;margin-left:auto;width:334px !important;visibility:visible !important;" title="cap为16" width="334"/><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;line-height:inherit;margin-top:10px;text-align:center;color:rgb(153, 153, 153);font-size:0.7em;">cap为16</div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">通过演示可见，cap 本身就是 2 的整数次幂的输出结果为其本身</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">上面还遗留了个问题，就是先对 cap -1，我解释说为了避免输出的是偶数，最后计算的结果为 2*cap，浪费空间，看下面的演示</p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><img src="原创如果懂了HashMap这两点，面试就没问题了_files/640 [2].webp" type="image/webp" data-filename="640.webp" height="490" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;font-size:inherit;color:inherit;line-height:inherit;display:block;margin-right:auto;margin-left:auto;width:325px !important;visibility:visible !important;" title="cap为16未减一" width="325"/><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;line-height:inherit;margin-top:10px;text-align:center;color:rgb(153, 153, 153);font-size:0.7em;">cap为16未减一</div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">通过演示，我们可以看出，输入的是 16，最后计算的结果却是 32，这就会浪费空间了，所以说算法很牛，先对 cap 做了减一操作</p><h4 style="font-weight:bold;font-size:1.2em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">问题2：HashMap 中对 key 做 hash 处理时，做了什么特殊操作？为什么这么做？</span></h4><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">首先我们知道 HashMap 在做 put 操作的时候，会先对 key 做 hash 操作，直接定位到源码位置</p><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="margin:0px;padding:0.5em;max-width:100%;box-sizing:border-box;overflow-wrap:normal !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;background:rgb(29, 31, 33);color:rgb(197, 200, 198);word-break:normal !important;overflow:auto !important;display:-webkit-box !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;color:inherit;line-height:inherit;word-break:inherit !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">static</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">final</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">int</span> <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(129, 162, 190);word-break:inherit !important;">hash</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">(Object key)</span> </span>{<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">int</span> h;<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>    <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">return</span> (key == <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(178, 148, 187);word-break:inherit !important;">null</span>) ? <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:inherit !important;font-size:inherit;line-height:inherit;color:rgb(222, 147, 95);word-break:inherit !important;">16</span>);<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>}<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></code></pre><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">可以看到再对 key 做 hash 操作时，执行了 <strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">(h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</strong></p><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><code style="margin:0px;padding:0.5em;max-width:100%;box-sizing:border-box;overflow-wrap:normal !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0px;font-family:Consolas, Inconsolata, Courier, monospace;border-radius:0px;background:rgb(29, 31, 33);color:rgb(197, 200, 198);word-break:normal !important;overflow:auto !important;display:-webkit-box !important;">原 hashCode 值: 10110101 01001100 10010101 11011111<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>右移 16 位后的值: 00000000 00000000 10110101 01001100 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/>异或后的值：      10110101 01001100 00100000 10010011<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></code></pre><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">这个操作是把 key 的 hashCode 值与 hashCode 值右移 16 位做<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">异或（不同为 1，相同为 0）</strong>，这样就是把哈希值的高位和低位一起混合计算，这样就能使生成的 hash 值更离散</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">这里需要我解释下，通过前面的介绍，我们知道数组的容量范围是 [0,2^30]，这个数还是比较大的，平时使用的数组容量还是比较小的，比如默认的大小 16，假设三个不同的 key 生成的 hashCoe 值如下所示：</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">19305951     00000001 00100110 10010101 11011111</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">128357855   00000111 10100110 10010101 11011111</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">38367            00000000 00000000 10010101 11011111</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">他们三个有个共同点是低 16 位完全一样，但高 16 位不同，当计算他们在数组中所在的下标时，通过 (n-1)&amp;hash，这里 n 是 16，n-1=15,15 的二进制表示为</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">00000000 00000000 00000000 00001111</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">用 19305951、128357855、38367 都与 15 进行 &amp; 运算，结果如下</p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><img src="原创如果懂了HashMap这两点，面试就没问题了_files/640 [3].webp" type="image/webp" data-filename="640.webp" height="372" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;font-size:inherit;color:inherit;line-height:inherit;display:block;margin-right:auto;margin-left:auto;width:437px !important;visibility:visible !important;" title="hash冲突" width="437"/><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;line-height:inherit;margin-top:10px;text-align:center;color:rgb(153, 153, 153);font-size:0.7em;">hash冲突</div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">通过计算后发现他们的结果一样，也就是说他们会被放到同一个下标下的链表或红黑树中，显然不符合我们的预期</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">所以对 hash 与其右移 16 位后的值进行异或操作，然后与 15 做与运算，看 hash 冲突情况</p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"><img src="原创如果懂了HashMap这两点，面试就没问题了_files/640 [4].webp" type="image/webp" data-filename="640.webp" height="379" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;font-size:inherit;color:inherit;line-height:inherit;display:block;margin-right:auto;margin-left:auto;width:677px !important;visibility:visible !important;" title="解决hash冲突" width="677"/><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;line-height:inherit;margin-top:10px;text-align:center;color:rgb(153, 153, 153);font-size:0.7em;">解决hash冲突</div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;">可见经过右移 16位后再进行异或操作，然后计算其对应的数组下标后，就被分到了不同的桶中，解决了哈希碰撞问题，思想就是把高位和低位混合进行计算，提高分散性</p><h4 style="font-weight:bold;font-size:1.2em;margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;">总结</span></h4><blockquote style="margin:1em 0px;padding:15px 15px 15px 1rem;max-width:100%;box-sizing:border-box;overflow-wrap:normal;padding-left:10px;border-left:3px solid rgb(219, 219, 219);color:rgb(129, 145, 152);font-size:0.9em;padding-top:4px;line-height:inherit;border-left-width:6px;border-left-color:rgb(220, 230, 240);background:rgb(242, 247, 251);overflow:auto;word-break:normal;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;">其实 HashMap 还有很多值得研究的点，上面两个点搞明白后，会感叹作者写代码的能力真是牛，我们在工作中要借鉴这些思想，希望通过我的讲解，你能掌握这两个知识点，如果有不懂的可以留言或私聊我</p></blockquote></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></p>
                </div>
                

                
  


                
                

                                    
                    
                                            
                                                </div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 