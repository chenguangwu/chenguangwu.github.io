<html>
<head>
  <title>使用formidable接收前端上传数据后再进行异步请求会出现跨域导致失败？ - CNode技术社区</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5964"/>
<h1>使用formidable接收前端上传数据后再进行异步请求会出现跨域导致失败？ - CNode技术社区</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/4/10 11:35</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://cnodejs.org/topic/580336e227a1d99178a98ed9"><i>http://cnodejs.org/topic/580336e227a1d99178a98ed9</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="font-size:100%;text-size-adjust:100%;"><div style="background-color:rgb(225, 225, 225);font-size:14px;line-height:20px;color:rgb(51, 51, 51);word-break:break-word;font-family:&quot;Helvetica Neue&quot;, &quot;Luxi Sans&quot;, &quot;DejaVu Sans&quot;, Tahoma, &quot;Hiragino Sans GB&quot;, STHeiti, sans-serif;"><div style="min-width:960px;"><div><div><div style="line-height:2em;background-color:rgb(255, 255, 255);border-radius:0px 0px 3px 3px;"><div><div><p style="word-break:break-word;margin:1em 0px;font-size:15px;white-space:pre-wrap;word-wrap:break-word;line-height:1.7em;overflow:auto;margin-top:0px;">前端封装FormData对象post给后端nodejs，nodejs使用formidable解析请求，到这一步为止没有出现任何问题，nodejs能成功解析请求并打印出自己期望的数据。但是我想把解析请求后得到的数据通过superagent post给python服务器，所以用的promise分隔这两段事务，但是却失败了。浏览器提示跨域…</p>
<blockquote style="padding:0px 0px 0px 15px;margin:0px 0px 20px;border-left:5px solid rgb(238, 238, 238);"><span style=""></span>
<p style="word-break:break-word;font-weight:300;margin:1em 0px;font-size:15px;line-height:1.7em;white-space:pre-wrap;word-wrap:break-word;overflow:auto;">Error: Request has been terminated Possible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.</p>
<p style="word-break:break-word;font-weight:300;margin:1em 0px;font-size:15px;line-height:1.7em;white-space:pre-wrap;word-wrap:break-word;overflow:auto;">…Possible causes: the network is offline, Origin is not allowed by Access-Control…</p>
<span style=""></span></blockquote>
<p style="word-break:break-word;margin:1em 0px;font-size:15px;white-space:pre-wrap;word-wrap:break-word;line-height:1.7em;overflow:auto;">我把post请求部分改为简单的setTimeout这种异步任务，也出现了同样的错误。总之就是我用formidable解析请求后拿到的数据无法再进行下一步的异步任务，一执行就会提示跨域。
单独使用formidable解析请求不进行后续的异步请求不会有问题，使用假数据单独执行后续的异步请求不使用formidable解析请求得到数据也不会有问题。但组合在一起就报错了…
这个bug困扰我三天了，实在解决不了，所以特来此求各路大神帮忙了，感激不尽。
这是我的nodejs接口的代码：</p>
<pre style="word-break:break-all;line-height:22px;white-space:pre-wrap;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;display:block;color:rgb(51, 51, 51);background:rgb(247, 247, 247);border-radius:0px;font-size:14px;padding:0px 15px;border:1px solid rgb(136, 136, 136);margin:20px -10px;border-style:none;border-color:initial;border-image:initial;border-width:1px 0px;tab-size:4;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;border-radius:3px;white-space:pre-wrap;padding:0px;color:inherit;background-color:transparent;border:0px;"><span style="color:rgb(0, 0, 0);">router</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">post</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 136, 0);">&quot;/api/publish_activity&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">function</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> req</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> res</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">next</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">){</span><span style="color:rgb(0, 0, 0);">

    </span><span style="color:rgb(136, 0, 0);">//后续的异步任务</span><span style="color:rgb(0, 0, 0);">
     </span><span style="color:rgb(0, 0, 136);">function</span><span style="color:rgb(0, 0, 0);"> async_task</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> result </span><span style="color:rgb(102, 102, 0);">){</span><span style="color:rgb(0, 0, 0);">
         </span><span style="color:rgb(0, 0, 136);">return</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">new</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Promise</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> resolve</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> reject </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">=&gt;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);">
             console</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">log</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">  result </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
             fetch_data_post</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> back_end_router</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">publish_activity</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> result </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
         </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
     </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);">
     </span><span style="color:rgb(136, 0, 0);">//formidable解析请求</span><span style="color:rgb(0, 0, 0);">
     formidablePromise</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> req </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
         </span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 136);">then</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> result </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">=&gt;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);">
             </span><span style="color:rgb(0, 0, 136);">return</span><span style="color:rgb(0, 0, 0);"> async_task</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> result </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
         </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
         </span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 136);">then</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> async_task_result </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">=&gt;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);">
             res</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">json</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);"> error </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> async_task_result</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">body</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">error</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> message </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> async_task_result</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">body</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">message </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
         </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
         </span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 136);">catch</span><span style="color:rgb(102, 102, 0);">((</span><span style="color:rgb(0, 0, 0);"> error </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">=&gt;</span><span style="color:rgb(0, 0, 0);"> console</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">log</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> error </span><span style="color:rgb(102, 102, 0);">))</span><span style="color:rgb(0, 0, 0);">
 </span><span style="color:rgb(102, 102, 0);">})</span></code></pre><p style="word-break:break-word;margin:1em 0px;font-size:15px;white-space:pre-wrap;word-wrap:break-word;line-height:1.7em;overflow:auto;">``</p>
<p style="word-break:break-word;margin:1em 0px;font-size:15px;white-space:pre-wrap;word-wrap:break-word;line-height:1.7em;overflow:auto;">这是formidablePromise，用于解析请求并返回解析后的数据：</p>
<p style="word-break:break-word;margin:1em 0px;font-size:15px;white-space:pre-wrap;word-wrap:break-word;line-height:1.7em;overflow:auto;">function formidablePromise( req ){
return new Promise(( resolve, reject ) =&gt; {</p>
<pre style="word-break:break-all;line-height:22px;white-space:pre-wrap;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;display:block;color:rgb(51, 51, 51);background:rgb(247, 247, 247);border-radius:0px;font-size:14px;padding:0px 15px;border:1px solid rgb(136, 136, 136);margin:20px -10px;border-style:none;border-color:initial;border-image:initial;border-width:1px 0px;tab-size:4;"><code style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:12px;border-radius:3px;white-space:pre-wrap;padding:0px;color:inherit;background-color:transparent;border:0px;"><span style="color:rgb(0, 0, 0);">    </span><span style="color:rgb(136, 0, 0);">// 图片文件将要上传到哪个文件夹下面</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(0, 0, 0);"> uploadfoldername </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;uploadfiles&quot;</span><span style="color:rgb(102, 102, 0);">;</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(0, 0, 0);"> uploadfolderpath </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> path</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">resolve</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> __dirname</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;../asset/&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> uploadfoldername </span><span style="color:rgb(102, 102, 0);">);</span><span style="color:rgb(0, 0, 0);">

    </span><span style="color:rgb(136, 0, 0);">// 参数设置</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(0, 0, 0);"> form </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">new</span><span style="color:rgb(0, 0, 0);"> formidable</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(102, 0, 102);">IncomingForm</span><span style="color:rgb(102, 102, 0);">({</span><span style="color:rgb(0, 0, 0);">
        encoding </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;utf-8&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);">
                uploadDir </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> uploadfolderpath</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);">
                keepExtensions </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">true</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(102, 102, 0);">})</span><span style="color:rgb(0, 0, 0);">

    </span><span style="color:rgb(136, 0, 0);">// 保存字段</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(0, 0, 0);"> fieldList </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);">

    </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(136, 0, 0);">// 保存图片url</span><span style="color:rgb(0, 0, 0);">
    </span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(0, 0, 0);"> fileList </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 0, 0);">  </span><span style="color:rgb(102, 102, 0);">];</span><span style="color:rgb(0, 0, 0);">

    </span><span style="color:rgb(136, 0, 0);">// 解析请求</span><span style="color:rgb(0, 0, 0);">
    form</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">parse</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> req </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">on</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;error&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">function</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> err </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">return</span><span style="color:rgb(0, 0, 0);"> reject</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> err </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">on</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;field&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">function</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> name</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> value </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);">
            fieldList</span><span style="color:rgb(102, 102, 0);">[</span><span style="color:rgb(0, 0, 0);"> name </span><span style="color:rgb(102, 102, 0);">]</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> value
        </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">on</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;file&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">function</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> name</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> file </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);">
            </span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(0, 0, 0);"> filename </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">new</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 0, 102);">Date</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">  </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">).</span><span style="color:rgb(0, 0, 0);">getTime</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">  </span><span style="color:rgb(102, 102, 0);">);</span><span style="color:rgb(0, 0, 0);">
                    </span><span style="color:rgb(0, 0, 136);">switch</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> file</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">type </span><span style="color:rgb(102, 102, 0);">){</span><span style="color:rgb(0, 0, 0);">
                        </span><span style="color:rgb(0, 0, 136);">case</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;image/jpeg&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
                                    filename </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> filename </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;.jpg&quot;</span><span style="color:rgb(0, 0, 0);">
                                    </span><span style="color:rgb(0, 0, 136);">break</span><span style="color:rgb(0, 0, 0);">
                            </span><span style="color:rgb(0, 0, 136);">case</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;image/png&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
                                    filename </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> filename </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;.png&quot;</span><span style="color:rgb(0, 0, 0);">
                                    </span><span style="color:rgb(0, 0, 136);">break</span><span style="color:rgb(0, 0, 0);">
                            </span><span style="color:rgb(0, 0, 136);">default</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);">
                                    filename </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> filename </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;.png&quot;</span><span style="color:rgb(0, 0, 0);">
                                   </span><span style="color:rgb(0, 0, 136);">break</span><span style="color:rgb(0, 0, 0);">
                    </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> 
                 </span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(0, 0, 0);"> file_save_path </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> uploadfolderpath </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;/&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> filename</span><span style="color:rgb(102, 102, 0);">;</span><span style="color:rgb(0, 0, 0);">
                 console</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">log</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> file</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">path </span><span style="color:rgb(102, 102, 0);">);</span><span style="color:rgb(0, 0, 0);">
                    fs</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">rename</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> file</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">path</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> file_save_path</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">function</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">err</span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);">
                        </span><span style="color:rgb(0, 0, 136);">if</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> err </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);">
                            console</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">log</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> err </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
                            </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);">
                    </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">);</span><span style="color:rgb(0, 0, 0);">
                    </span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(0, 0, 0);"> filepath </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;http://&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> server </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;:&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> port </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;/&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> uploadfoldername </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;/&quot;</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">+</span><span style="color:rgb(0, 0, 0);"> filename</span><span style="color:rgb(102, 102, 0);">;</span><span style="color:rgb(0, 0, 0);">
            fileList</span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">push</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> filepath </span><span style="color:rgb(102, 102, 0);">);</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(102, 102, 0);">.</span><span style="color:rgb(0, 0, 0);">on</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 136, 0);">&quot;end&quot;</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(0, 0, 136);">function</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);">  </span><span style="color:rgb(102, 102, 0);">){</span><span style="color:rgb(0, 0, 0);">
            </span><span style="color:rgb(0, 0, 136);">var</span><span style="color:rgb(0, 0, 0);"> result </span><span style="color:rgb(102, 102, 0);">=</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">{</span><span style="color:rgb(0, 0, 0);"> fieldList </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> fieldList</span><span style="color:rgb(102, 102, 0);">,</span><span style="color:rgb(0, 0, 0);"> fileList </span><span style="color:rgb(102, 102, 0);">:</span><span style="color:rgb(0, 0, 0);"> fileList </span><span style="color:rgb(102, 102, 0);">};</span><span style="color:rgb(0, 0, 0);">
            resolve</span><span style="color:rgb(102, 102, 0);">(</span><span style="color:rgb(0, 0, 0);"> result </span><span style="color:rgb(102, 102, 0);">);</span><span style="color:rgb(0, 0, 0);">
        </span><span style="color:rgb(102, 102, 0);">}</span><span style="color:rgb(0, 0, 0);"> </span><span style="color:rgb(102, 102, 0);">)</span><span style="color:rgb(0, 0, 0);">
</span><span style="color:rgb(102, 102, 0);">})</span></code></pre><p style="word-break:break-word;margin:1em 0px;font-size:15px;white-space:pre-wrap;word-wrap:break-word;line-height:1.7em;overflow:auto;">}</p>
<p style="word-break:break-word;margin:1em 0px;font-size:15px;white-space:pre-wrap;word-wrap:break-word;line-height:1.7em;overflow:auto;">fetch_data_post是使用promise封装superagent的post请求的方法：</p>
<blockquote style="padding:0px 0px 0px 15px;margin:0px 0px 20px;border-left:5px solid rgb(238, 238, 238);margin-bottom:1em;"><span style=""></span>
<p style="word-break:break-word;font-weight:300;margin:1em 0px;font-size:15px;line-height:1.7em;white-space:pre-wrap;word-wrap:break-word;overflow:auto;">fetch_data_post : function( url, post_data, content_type ){
var content_type = typeof( content_type ) != “undefined” ? content_type : { “Content-Type” : “application/x-www-form-urlencoded” }
return new Promise(( resolve, reject ) =&gt; {
request
.post( url )
.set( content_type )
.send( post_data )
.end(( error, result ) =&gt; {
error ? reject( error ) : resolve( result );
})
})
}</p>
<span style=""></span></blockquote>
</div></div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 