<html>
<head>
  <title>Java NIO框架(Java编程) - 小小程序员 - 博客频道 - CSDN.NET</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="7609"/>
<h1>Java NIO框架(Java编程) - 小小程序员 - 博客频道 - CSDN.NET</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2015/9/4 23:41</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://blog.csdn.net/xia0615/article/details/6220815"><i>http://blog.csdn.net/xia0615/article/details/6220815</i></a></td></tr>
</table>
</div>
<br/>

<div><span><br/><div style="font-size: 16px"><div><div style="background-image:url(http://static.blog.csdn.net/skin/ink/images/body_bg.jpg);color:rgb(54, 46, 43);text-align:center;font-size:12px;font-family:Arial, Console, Verdana, 'Courier New';background-position:50% 0%;"><div style="background-image:url(http://static.blog.csdn.net/skin/ink/images/head_bg.jpg);background-position:50% 0%;background-repeat:no-repeat no-repeat;"><div style="text-align:left;"><div style="overflow:hidden;background-color:rgb(255, 255, 255);"><div><div>
    <div style="display:block;margin:5px 0px;color:rgb(0, 0, 0);font-style:normal;font-variant:normal;font-weight:normal;font-size:20px;line-height:30px;font-family:'Microsoft YaHei';">   
         <span style="display:inline-block;width:19px;height:19px;margin:0px 2px 0px 0px;background-image:url(http://static.blog.csdn.net/skin/ink/images/ico_Original.gif);vertical-align:middle;background-position:0px 0px;background-repeat:no-repeat no-repeat;"></span>


    <h1 style="margin:0px;padding:0px;display:inline;font-style:normal;font-variant:normal;font-weight:normal;font-size:20px;line-height:30px;font-family:'Microsoft YaHei';vertical-align:middle;">
        <span><a href="http://blog.csdn.net/xia0615/article/details/6220815" style="text-decoration:none;color:rgb(0, 0, 0);">
        Java NIO框架(Java编程)            
        </a></span>
    </h1>
<span style="color:rgb(0, 0, 0);font-style:normal;font-variant:normal;font-weight:normal;font-size:20px;line-height:30px;font-family:'Microsoft YaHei';display:block;height:0px;clear:both;visibility:hidden;">.</span></div>

   

    <div style="padding:5px 0px;color:rgb(153, 153, 153);font-style:normal;font-variant:normal;font-weight:normal;font-size:12px;line-height:24px;font-family:Arial;text-align:right;">
        <span style="margin:0px 5px;float:left;">
        分类：
            <a href="http://blog.csdn.net/xia0615/article/category/791461" style="color:rgb(106, 57, 6);text-decoration:none;">道听途说</a> 
        </span>
    <span style="margin:0px 5px 0px 0px;">2011-03-03 15:28</span>
    <span style="margin:0px 5px;padding:0px 0px 0px 14px;background-image:url(http://static.blog.csdn.net/images/ico_view.png);background-position:0% 50%;background-repeat:no-repeat no-repeat;" title="阅读次数">7071人阅读</span>
    <span style="margin:0px 5px;padding:0px 0px 0px 14px;background-image:url(http://static.blog.csdn.net/images/ico_comm.png);background-position:0% 50%;background-repeat:no-repeat no-repeat;" title="评论次数"><a href="http://blog.csdn.net/xia0615/article/details/6220815#comments" style="color:rgb(106, 57, 6);text-decoration:none;">评论</a>(0)</span>
    <span style="margin:0px 5px;"><a href="#" style="color:rgb(106, 57, 6);text-decoration:none;" title="收藏">收藏</a></span>
    <span style="margin:0px 5px;"><a href="http://blog.csdn.net/xia0615/article/details/6220815#report" style="color:rgb(106, 57, 6);text-decoration:none;" title="举报">举报</a></span>
    
</div>
<div style="margin:10px 0px;"><a href="http://www.csdn.net/tag/java" style="border:1px solid rgb(238, 238, 238);color:rgb(106, 57, 6);text-decoration:none;padding:4px 10px;line-height:100%;margin-right:10px;display:inline-block;background-color:rgb(238, 238, 238);border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;" target="_blank">java</a><a href="http://www.csdn.net/tag/%e6%a1%86%e6%9e%b6" style="border:1px solid rgb(238, 238, 238);color:rgb(106, 57, 6);text-decoration:none;padding:4px 10px;line-height:100%;margin-right:10px;display:inline-block;background-color:rgb(238, 238, 238);border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;" target="_blank">框架</a><a href="http://www.csdn.net/tag/import" style="border:1px solid rgb(238, 238, 238);color:rgb(106, 57, 6);text-decoration:none;padding:4px 10px;line-height:100%;margin-right:10px;display:inline-block;background-color:rgb(238, 238, 238);border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;" target="_blank">import</a><a href="http://www.csdn.net/tag/mina" style="border:1px solid rgb(238, 238, 238);color:rgb(106, 57, 6);text-decoration:none;padding:4px 10px;line-height:100%;margin-right:10px;display:inline-block;background-color:rgb(238, 238, 238);border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;" target="_blank">mina</a><a href="http://www.csdn.net/tag/exception" style="border:1px solid rgb(238, 238, 238);color:rgb(106, 57, 6);text-decoration:none;padding:4px 10px;line-height:100%;margin-right:10px;display:inline-block;background-color:rgb(238, 238, 238);border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;" target="_blank">exception</a><a href="http://www.csdn.net/tag/string" style="border:1px solid rgb(238, 238, 238);color:rgb(106, 57, 6);text-decoration:none;padding:4px 10px;line-height:100%;margin-right:10px;display:inline-block;background-color:rgb(238, 238, 238);border-top-left-radius:10px;border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;" target="_blank">string</a></div>

  

  
  
     

<div style="margin:20px 0px 0px;font-style:normal;font-variant:normal;font-weight:normal;font-size:14px;line-height:26px;font-family:Arial;">
<p>
</p><p><span style="font-family:mceinline;">Java NIO框架</span></p>
<p><span style="font-family:mceinline;">MINA</span></p>
<p><span style="font-family:mceinline;">用netty性能和链接数、并发等压力测试参数好于mina</span></p>
<p><span style="font-family:mceinline;">1。NIO弥补了原来的I/O的不足，它再标准java代码中提供了高速和面向块的I/O</span></p>
<p><span style="font-family:mceinline;">原力的I/O库与NIO最重要的区别是数据打包和传输方式的不同，原来的I/O以流的方式处理数据，而NIO以块的方式处理数据</span></p>
<p><span style="font-family:mceinline;">2.NIO以通道channel和缓冲区Buffer为基础来实现面向块的IO数据处理</span></p>
<p><span style="font-family:mceinline;">MINA是开源的</span></p>
<p><span style="font-family:mceinline;">
</span></p><p align="left">Java　NIO非堵塞应用通常适用用在I/O读写等方面，我们知道，系统运行的性能瓶颈通常在I/O读写，包括对端口和文件的操作上，过去，在打开一个I/O通道后，read()将一直等待在端口一边读取字节内容，如果没有内容进来，read()也是傻傻的等，这会影响我们程序继续做其他事情，那么改进做法就是开设线程，让线程去等待，但是这样做也是相当耗费资源的。</p>
<p align="left">Java NIO非堵塞技术实际是采取Reactor模式，或者说是Observer模式为我们监察I/O端口，如果有内容进来，会自动通知我们，这样，我们就不必开启多个线程死等，从外界看，实现了流畅的I/O读写，不堵塞了。</p>
<p align="left">Java NIO出现不只是一个技术性能的提高，你会发现网络上到处在介绍它，因为它具有里程碑意义，从JDK1.4开始，Java开始提高性能相关的功能，从而使得Java在底层或者并行分布式计算等操作上已经可以和C或Perl等语言并驾齐驱。</p>
<p align="left">如果你至今还是在怀疑Java的性能，说明你的思想和观念已经完全落伍了，Java一两年就应该用新的名词来定义。从JDK1.5开始又要提供关于线程、并发等新性能的支持，Java应用在游戏等适时领域方面的机会已经成熟，Java在稳定自己中间件地位后，开始蚕食传统C的领域。</p>
<p align="left">本文主要简单介绍NIO的基本原理，在下一篇文章中，将结合Reactor模式和著名线程大师<a href="http://gee.cs.oswego.edu/dl/" style="color:rgb(106, 57, 6);text-decoration:none;">Doug Lea</a>的一篇文章深入讨论。</p>
<p align="left">NIO主要原理和适用。</p>
<p align="left">NIO 有一个主要的类Selector,这个类似一个观察者，只要我们把需要探知的socketchannel告诉Selector,我们接着做别的事情，当有事件发生时，他会通知我们，传回一组SelectionKey,我们读取这些Key,就会获得我们刚刚注册过的socketchannel,然后，我们从这个Channel中读取数据，放心，包准能够读到，接着我们可以处理这些数据。</p>
<p align="left">Selector内部原理实际是在做一个对所注册的channel的轮询访问，不断的轮询(目前就这一个算法)，一旦轮询到一个channel有所注册的事情发生，比如数据来了，他就会站起来报告，交出一把钥匙，让我们通过这把钥匙来读取这个channel的内容。</p>
<p align="left">了解了这个基本原理，我们结合代码看看使用，在使用上，也在分两个方向，一个是线程处理，一个是用非线程，后者比较简单，看下面代码：</p>
<p align="left"><br/>import java.io.*;<br/>import java.nio.*;<br/>import java.nio.channels.*;<br/>import java.nio.channels.spi.*;<br/>import java.net.*;<br/>import java.util.*;
</p><p>/**<br/>*<br/>* @author Administrator<br/>* @version<br/>*/</p>
<p>
</p><table bgcolor="#CCCCCC" border="0" cellpadding="0" cellspacing="0" style="font-size:inherit;font-weight:inherit;font-style:inherit;font-variant:inherit;width:100%;background-color:rgb(204, 204, 204);">
<tbody>
<tr>
<td>
<p>public class NBTest {</p>
<p><br/>　　/** Creates new NBTest */<br/>　　public NBTest()<br/>　　{<br/>　　}</p>
<p>　　public void startServer() throws Exception<br/>　　{<br/>　　int channels = 0;<br/>　　int nKeys = 0;<br/>　　int currentSelector = 0;<br/><br/>　　//使用Selector<br/>　　Selector selector = Selector.open();<br/><br/>　　//建立Channel 并绑定到9000端口<br/>　　ServerSocketChannel ssc = ServerSocketChannel.open();<br/>　　InetSocketAddress address = new InetSocketAddress(InetAddress.getLocalHost(),9000); <br/>　　ssc.socket().bind(address);<br/><br/>　　//使设定non-blocking的方式。<br/>　　ssc.configureBlocking(false);</p>
<p>　　//向Selector注册Channel及我们有兴趣的事件<br/>　　SelectionKey s = ssc.register(selector, SelectionKey.OP_ACCEPT);<br/>　　printKeyInfo(s);</p>
<p>　　while(true) //不断的轮询<br/>　　{<br/>　　　　debug(&quot;NBTest: Starting select&quot;);<br/><br/>　　　　//Selector通过select方法通知我们我们感兴趣的事件发生了。<br/>　　　　nKeys = selector.select();<br/>　　　　//如果有我们注册的事情发生了，它的传回值就会大于0<br/>　　　　if(nKeys &gt; 0)<br/>　　　　{<br/>　　　　　　debug(&quot;NBTest: Number of keys after select operation: &quot; +nKeys);<br/><br/>　　　　　　//Selector传回一组SelectionKeys<br/>　　　　　　//我们从这些key中的channel()方法中取得我们刚刚注册的channel。<br/>　　　　　　Set selectedKeys = selector.selectedKeys();<br/>　　　　　　Iterator i = selectedKeys.iterator();<br/>　　　　　　while(i.hasNext())<br/>　　　　　　{<br/>　　　　　　 　 s = (SelectionKey) i.next();<br/>　　　　　　 　 printKeyInfo(s);<br/>　　　　　　 　 debug(&quot;NBTest: Nr Keys in selector: &quot; +selector.keys().size());<br/><br/>　　　　　　 　 //一个key被处理完成后，就都被从就绪关键字（ready keys）列表中除去<br/>　　　　　　 　 i.remove();<br/>　　　　　　 　 if(s.isAcceptable())<br/>　　　　　　 　 {<br/>　　　　　　 　 　 // 从channel()中取得我们刚刚注册的channel。<br/>　　　　　　 　 　 Socket socket = ((ServerSocketChannel)s.channel()).accept().socket();<br/>　　　　　　 　 　 SocketChannel sc = socket.getChannel();<br/><br/>　　　　　　 　 　 sc.configureBlocking(false);<br/>　　　　　　 　 　 sc.register(selector, SelectionKey.OP_READ |SelectionKey.OP_WRITE);<br/>　　　　　　 　 　 　　　　　　 　 　 System.out.println(++channels);<br/>　　　　　　 　 }<br/>　　　　　　 　 else<br/>　　　　　　 　 {<br/>　　　　　　 　 　 debug(&quot;NBTest: Channel not acceptable&quot;);<br/>　　　　　　 　 }<br/>　　　　　 }<br/>　　　}<br/>　　　else<br/>　　　{<br/>　　　　　　debug(&quot;NBTest: Select finished without any keys.&quot;);<br/>　　　}</p>
<p>　 }<br/><br/>}</p>
<p><br/>private static void debug(String s)<br/>{<br/>　 System.out.println(s);<br/>}</p>
<p><br/>private static void printKeyInfo(SelectionKey sk)<br/>{<br/>　 String s = new String();</p>
<p>　 s = &quot;Att: &quot; + (sk.attachment() == null ? &quot;no&quot; : &quot;yes&quot;);<br/>　 s += &quot;, Read: &quot; + sk.isReadable();<br/>　 s += &quot;, Acpt: &quot; + sk.isAcceptable();<br/>　 s += &quot;, Cnct: &quot; + sk.isConnectable();<br/>　 s += &quot;, Wrt: &quot; + sk.isWritable();<br/>　 s += &quot;, Valid: &quot; + sk.isValid();<br/>　 s += &quot;, Ops: &quot; + sk.interestOps();<br/>　 debug(s);<br/>}</p>
<p><br/>/**<br/>* @param args the command line arguments<br/>*/<br/>public static void main (String args[])<br/>{<br/>　 NBTest nbTest = new NBTest();<br/>　 try<br/>　 {<br/>　 　 nbTest.startServer();<br/>　 }<br/>　 　 catch(Exception e)<br/>　 {<br/>　 　 e.printStackTrace();<br/>　 }<br/>}</p>
<p>}</p>
<p> </p>
</td>
</tr>
</tbody>
</table>
<p align="left">这是一个守候在端口9000的noblock server例子，如果我们编制一个客户端程序，就可以对它进行互动操作，或者使用telnet 主机名　90000 可以链接上。</p>
<p align="left">通过仔细阅读这个例程，相信你已经大致了解NIO的原理和使用方法，下一篇，我们将使用多线程来处理这些数据，再搭建一个自己的Reactor模式。</p>
<div></div>
<div></div>
<div>http://www.jdon.com/concurrent/nio%D4%AD%C0%ED%D3%A6%D3%C3.htm</div>
<p></p>
<p></p>
<p></p>
<p></p>    
        <div style="padding-top:20px;">         
            <p style="font-size:12px;">版权声明：本文为博主原创文章，未经博主允许不得转载。</p>
        </div>
</div>









<div style="zoom:1;float:right;">
<a href="http://blog.csdn.net/xia0615/article/details/6220815#" style="padding-left:17px;color:rgb(51, 51, 51);background-image:url('http://bdimg.share.baidu.com/static/api/img/share/icons_0_16.png?v=d754dcc0.png') !important;background-position:0 0 !important;float:left;font-size:12px;text-decoration:none;line-height:16px;height:16px;cursor:pointer;margin:6px 6px 6px 0px;background-repeat:no-repeat no-repeat;"></a>
<a href="http://blog.csdn.net/xia0615/article/details/6220815#" style="line-height:16px;color:rgb(106, 57, 6);background-position:0 -52px !important;text-decoration:none;font-size:12px;padding-left:17px;float:left;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/img/share/icons_0_16.png?v=d754dcc0.png);cursor:pointer;margin:6px 6px 6px 0px;background-repeat:no-repeat no-repeat;" title="分享到QQ空间"></a>
<a href="http://blog.csdn.net/xia0615/article/details/6220815#" style="line-height:16px;color:rgb(106, 57, 6);background-position:0 -104px !important;text-decoration:none;font-size:12px;padding-left:17px;float:left;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/img/share/icons_0_16.png?v=d754dcc0.png);cursor:pointer;margin:6px 6px 6px 0px;background-repeat:no-repeat no-repeat;" title="分享到新浪微博"></a>
<a href="http://blog.csdn.net/xia0615/article/details/6220815#" style="line-height:16px;color:rgb(106, 57, 6);background-position:0 -260px !important;text-decoration:none;font-size:12px;padding-left:17px;float:left;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/img/share/icons_0_16.png?v=d754dcc0.png);cursor:pointer;margin:6px 6px 6px 0px;background-repeat:no-repeat no-repeat;" title="分享到腾讯微博"></a>
<a href="http://blog.csdn.net/xia0615/article/details/6220815#" style="line-height:16px;color:rgb(106, 57, 6);background-position:0 -208px !important;text-decoration:none;font-size:12px;padding-left:17px;float:left;height:16px;background-image:url(http://bdimg.share.baidu.com/static/api/img/share/icons_0_16.png?v=d754dcc0.png);cursor:pointer;margin:6px 6px 6px 0px;background-repeat:no-repeat no-repeat;" title="分享到人人网"></a>
<a href="http://blog.csdn.net/xia0615/article/details/6220815#" style="height:16px;color:rgb(106, 57, 6);text-decoration:none;font-size:12px;padding-left:17px;line-height:16px;float:left;background-image:url(http://bdimg.share.baidu.com/static/api/img/share/icons_0_16.png?v=d754dcc0.png);cursor:pointer;margin:6px 6px 6px 0px;background-repeat:no-repeat no-repeat;background-position:0 -1612px !important;" title="分享到微信"></a>
<span style="visibility:hidden;display:block;height:0px;clear:both;">.</span></div>



   

    

<ul style="line-height:24px;display:block;font-style:normal;font-variant:normal;font-weight:normal;font-size:14px;color:rgb(102, 102, 102);font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif;clear:both;float:left;margin:0px 0px 5px;padding:10px 0px 0px;">
            <li style="list-style-type:none;clear:both;padding:0px 0px 3px;overflow:hidden;"><span style="color:rgb(255, 255, 255);display:block;width:52px;padding:0px 0px 0px 27px;height:26px;background-color:rgb(153, 153, 153);float:left;font-size:14px;margin-right:7px;background-image:url(http://static.blog.csdn.net/skin/ink/images/blog-page-arr.png);background-position:9px 8px;background-repeat:no-repeat no-repeat;">上一篇</span><a href="http://blog.csdn.net/xia0615/article/details/6220750" style="text-decoration:none;display:block;float:left;font-size:14px;color:rgb(51, 51, 51);">SNS</a></li>
            <li style="list-style-type:none;clear:both;padding:0px 0px 3px;overflow:hidden;"><span style="color:rgb(255, 255, 255);display:block;width:52px;padding:0px 0px 0px 27px;height:26px;background-color:rgb(153, 153, 153);float:left;font-size:14px;margin-right:7px;background-image:url(http://static.blog.csdn.net/skin/ink/images/blog-page-arr.png);background-position:9px -22px;background-repeat:no-repeat no-repeat;">下一篇</span><a href="http://blog.csdn.net/xia0615/article/details/6220827" style="text-decoration:none;display:block;float:left;font-size:14px;color:rgb(51, 51, 51);">MINA原理</a></li>
<span style="color:rgb(102, 102, 102);font-style:normal;font-variant:normal;font-weight:normal;font-size:14px;line-height:24px;font-family:'Microsoft YaHei', Arial, Helvetica, sans-serif;display:block;height:0px;clear:both;visibility:hidden;">.</span></ul>







 

      
</div></div></div></div></div></div></div></div><br/></span>
</div></body></html> 