<html>
<head>
  <title>简单理解Vue中的nextTick</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="11913"/>
<h1>简单理解Vue中的nextTick</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/5/7 9:29</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://www.jianshu.com/p/a7550c0e164f"><i>https://www.jianshu.com/p/a7550c0e164f</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="font-family:sans-serif;text-size-adjust:100%;box-sizing:border-box;font-size:10px;-webkit-tap-highlight-color:transparent;"><div style="box-sizing:border-box;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size:17px;line-height:1.42857;background-color:rgb(255, 255, 255);min-width:768px;color:rgb(51, 51, 51);"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;">
        <h1 style="font-size:34px;margin:20px 0px 0px;box-sizing:border-box;font-family:-apple-system, &quot;SF UI Display&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-weight:700;line-height:1.3;color:inherit;word-break:break-word;margin-top:20px;margin-bottom:10px;">简单理解Vue中的nextTick</h1>

        
        <div style="box-sizing:border-box;margin:30px 0px 40px;">
          <a href="https://www.jianshu.com/u/0fa6f5d09040" style="background-color:transparent;box-sizing:border-box;color:rgb(51, 51, 51);text-decoration:none;cursor:pointer;width:48px;height:48px;display:inline-block;vertical-align:middle;">
            <img src="简单理解Vue中的nextTick_files/96.jpg" type="image/jpeg" data-filename="96.jpg" alt="96" height="46" style="border:1px solid rgb(221, 221, 221);box-sizing:border-box;vertical-align:middle;width:100%;height:100%;border-radius:50%;" width="46"/>
</a>          <div style="box-sizing:border-box;vertical-align:middle;display:inline-block;margin-left:8px;">
            <span style="box-sizing:border-box;margin-right:3px;font-size:16px;vertical-align:middle;"><a href="https://www.jianshu.com/u/0fa6f5d09040" style="background-color:transparent;box-sizing:border-box;color:rgb(51, 51, 51);text-decoration:none;cursor:pointer;">Ruheng</a></span>
            
            <a style="background-color:rgb(66, 192, 46);box-sizing:border-box;color:rgb(255, 255, 255);text-decoration:none;display:inline-block;margin-bottom:0px;font-weight:400;text-align:center;vertical-align:middle;touch-action:manipulation;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;padding:0px 7px 0px 5px;font-size:12px;line-height:normal;border-radius:40px;user-select:none;border-color:rgb(66, 192, 46);"><i style="box-sizing:border-box;font-size:inherit;font-style:normal;-webkit-font-smoothing:antialiased;font-family:iconfont;font-weight:400;"><span style="font-size:inherit;font-style:normal;font-family:iconfont;font-weight:400;"></span></i><span style="box-sizing:border-box;margin-left:2px;display:inline;">关注</span></a>
            
            <div style="box-sizing:border-box;margin-top:5px;font-size:12px;color:rgb(150, 150, 150);">
              
                <span style="box-sizing:border-box;color:rgb(234, 111, 90);padding-right:5px;">
                  <i style="box-sizing:border-box;font-size:inherit;font-style:normal;-webkit-font-smoothing:antialiased;font-family:iconfont;font-weight:400;"><span style="font-size:inherit;font-style:normal;font-family:iconfont;font-weight:400;"></span></i> 3.8
                </span>
              
                <span style="box-sizing:border-box;padding-right:5px;">2018.01.30 10:34</span>
              <span style="box-sizing:border-box;padding-right:5px;">字数 1476</span>
            <span style="box-sizing:border-box;padding-right:5px;">阅读 96748</span><span style="box-sizing:border-box;padding-right:5px;">评论 3</span><span style="box-sizing:border-box;padding-right:5px;">喜欢 85</span></div>
          </div>
          
        </div>


        
        <div style="box-sizing:border-box;color:rgb(47, 47, 47);font-size:16px;font-weight:400;line-height:1.7;word-break:break-word;">
          <div style="box-sizing:border-box;">
            <blockquote style="box-sizing:border-box;padding:20px;margin:0px 0px 20px;font-size:16px;border-left:6px solid rgb(180, 180, 180);margin-bottom:25px;background-color:rgb(247, 247, 247);font-weight:400;line-height:30px;word-break:break-word;">
<p style="box-sizing:border-box;margin:0px 0px 25px;margin-bottom:0px;word-break:break-word;font-size:16px;font-weight:400;line-height:1.7;">Vue中的<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>涉及到Vue中DOM的异步更新，感觉很有意思，特意了解了一下。其中关于<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>的源码涉及到不少知识，很多不太理解，暂且根据自己的一些感悟介绍下<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>。</p>
</blockquote>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:24px;margin:0px 0px 15px;text-rendering:optimizelegibility;margin-top:20px;margin-bottom:10px;">一、示例</h2>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">先来一个示例了解下关于Vue中的DOM更新以及<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>的作用。</p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><strong style="font-weight:700;box-sizing:border-box;">模板</strong></p>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;"><span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">class</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;app&quot;</span>&gt;</span>
  <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">ref</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;msgDiv&quot;</span>&gt;</span>{{msg}}<span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span>&gt;</span>
  <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">v-if</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;msg1&quot;</span>&gt;</span>Message got outside $nextTick: {{msg1}}<span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span>&gt;</span>
  <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">v-if</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;msg2&quot;</span>&gt;</span>Message got inside $nextTick: {{msg2}}<span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span>&gt;</span>
  <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span> <span style="box-sizing:border-box;color:rgb(209, 154, 102);">v-if</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;msg3&quot;</span>&gt;</span>Message got outside $nextTick: {{msg3}}<span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span>&gt;</span>
  <span style="box-sizing:border-box;">&lt;<span style="box-sizing:border-box;color:rgb(224, 108, 117);">button</span> @<span style="box-sizing:border-box;color:rgb(209, 154, 102);">click</span>=<span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;changeMsg&quot;</span>&gt;</span>
    Change the Message
  <span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">button</span>&gt;</span>
<span style="box-sizing:border-box;">&lt;/<span style="box-sizing:border-box;color:rgb(224, 108, 117);">div</span>&gt;</span>
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><strong style="font-weight:700;box-sizing:border-box;">Vue实例</strong></p>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> Vue({
  <span style="box-sizing:border-box;color:rgb(209, 154, 102);">el</span>: <span style="box-sizing:border-box;color:rgb(152, 195, 121);">'.app'</span>,
  <span style="box-sizing:border-box;color:rgb(209, 154, 102);">data</span>: {
    <span style="box-sizing:border-box;color:rgb(209, 154, 102);">msg</span>: <span style="box-sizing:border-box;color:rgb(152, 195, 121);">'Hello Vue.'</span>,
    <span style="box-sizing:border-box;color:rgb(209, 154, 102);">msg1</span>: <span style="box-sizing:border-box;color:rgb(152, 195, 121);">''</span>,
    <span style="box-sizing:border-box;color:rgb(209, 154, 102);">msg2</span>: <span style="box-sizing:border-box;color:rgb(152, 195, 121);">''</span>,
    <span style="box-sizing:border-box;color:rgb(209, 154, 102);">msg3</span>: <span style="box-sizing:border-box;color:rgb(152, 195, 121);">''</span>
  },
  <span style="box-sizing:border-box;color:rgb(209, 154, 102);">methods</span>: {
    changeMsg() {
      <span style="box-sizing:border-box;color:rgb(198, 120, 221);">this</span>.msg = <span style="box-sizing:border-box;color:rgb(152, 195, 121);">&quot;Hello world.&quot;</span>
      <span style="box-sizing:border-box;color:rgb(198, 120, 221);">this</span>.msg1 = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">this</span>.$refs.msgDiv.innerHTML
      <span style="box-sizing:border-box;color:rgb(198, 120, 221);">this</span>.$nextTick(<span style="box-sizing:border-box;"><span style="box-sizing:border-box;">()</span> =&gt;</span> {
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">this</span>.msg2 = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">this</span>.$refs.msgDiv.innerHTML
      })
      <span style="box-sizing:border-box;color:rgb(198, 120, 221);">this</span>.msg3 = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">this</span>.$refs.msgDiv.innerHTML
    }
  }
})
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><strong style="font-weight:700;box-sizing:border-box;">点击前</strong><br style="box-sizing:border-box;"/>
</p><div style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;">
<div style="box-sizing:border-box;z-index:100;position:relative;background-color:transparent;transition:background-color 0.1s linear 0s;margin:0px auto;max-width:152px;max-height:57px;">
<div style="box-sizing:border-box;z-index:50;padding-bottom:37.5%;"></div>
<div style="box-sizing:border-box;position:absolute;top:0px;left:0px;width:100%;height:100%;overflow:hidden;"><img src="简单理解Vue中的nextTick_files/webp.webp" type="image/webp" data-filename="webp.webp" height="57" style="border:0px;box-sizing:border-box;vertical-align:middle;max-width:100%;display:block;transition:all 0.15s linear 0s;z-index:100;filter:blur(0px);opacity:1;height:auto;cursor:zoom-in;" width="152"/></div>
</div>

</div><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"></p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><strong style="font-weight:700;box-sizing:border-box;">点击后</strong><br style="box-sizing:border-box;"/>
</p><div style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;">
<div style="box-sizing:border-box;z-index:100;position:relative;background-color:transparent;transition:background-color 0.1s linear 0s;margin:0px auto;max-width:341px;max-height:123px;">
<div style="box-sizing:border-box;z-index:50;padding-bottom:36.07%;"></div>
<div style="box-sizing:border-box;position:absolute;top:0px;left:0px;width:100%;height:100%;overflow:hidden;"><img src="简单理解Vue中的nextTick_files/webp [1].webp" type="image/webp" data-filename="webp.webp" height="123" style="border:0px;box-sizing:border-box;vertical-align:middle;max-width:100%;display:block;transition:all 0.15s linear 0s;z-index:100;filter:blur(0px);opacity:1;height:auto;cursor:zoom-in;" width="341"/></div>
</div>

</div><p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"></p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">从图中可以得知：msg1和msg3显示的内容还是变换之前的，而msg2显示的内容是变换之后的。其根本原因是因为Vue中DOM更新是异步的（详细解释在后面）。</p>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:24px;margin:0px 0px 15px;text-rendering:optimizelegibility;margin-top:20px;margin-bottom:10px;">二、应用场景</h2>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">下面了解下<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>的主要应用的场景及原因。</p>
<ul style="box-sizing:border-box;word-break:break-word;padding:0px;margin:-5px 0px 20px 20px;margin-top:0px;margin-bottom:10px;padding-left:0px;">
<li style="box-sizing:border-box;line-height:30px;">在Vue生命周期的<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">created()</code>钩子函数进行的DOM操作一定要放在<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Vue.nextTick()</code>的回调函数中</li>
</ul>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">在<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">created()</code>钩子函数执行的时候DOM 其实并未进行任何渲染，而此时进行DOM操作无异于徒劳，所以此处一定要将DOM操作的js代码放进<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Vue.nextTick()</code>的回调函数中。与之对应的就是<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">mounted()</code>钩子函数，因为该钩子函数执行时所有的DOM挂载和渲染都已完成，此时在该钩子函数中进行任何DOM操作都不会有问题 。</p>
<ul style="box-sizing:border-box;word-break:break-word;padding:0px;margin:-5px 0px 20px 20px;margin-top:0px;margin-bottom:10px;padding-left:0px;">
<li style="box-sizing:border-box;line-height:30px;">在数据变化后要执行的某个操作，而这个操作需要使用随数据改变而改变的DOM结构的时候，这个操作都应该放进<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Vue.nextTick()</code>的回调函数中。</li>
</ul>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">具体原因在Vue的官方文档中详细解释：</p>
<blockquote style="box-sizing:border-box;padding:20px;margin:0px 0px 20px;font-size:16px;border-left:6px solid rgb(180, 180, 180);margin-bottom:25px;background-color:rgb(247, 247, 247);font-weight:400;line-height:30px;word-break:break-word;">
<p style="box-sizing:border-box;margin:0px 0px 25px;margin-bottom:0px;word-break:break-word;font-size:16px;font-weight:400;line-height:1.7;">Vue 异步执行 DOM 更新。只要观察到数据变化，Vue 将开启一个队列，并缓冲在同一事件循环中发生的所有数据改变。如果同一个 watcher 被多次触发，只会被推入到队列中一次。这种在缓冲时去除重复数据对于避免不必要的计算和 DOM 操作上非常重要。然后，在下一个的事件循环“tick”中，Vue 刷新队列并执行实际 (已去重的) 工作。Vue 在内部尝试对异步队列使用原生的 <code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Promise.then</code> 和<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MessageChannel</code>，如果执行环境不支持，会采用 <code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">setTimeout(fn, 0)</code>代替。</p>
</blockquote>
<blockquote style="box-sizing:border-box;padding:20px;margin:0px 0px 20px;font-size:16px;border-left:6px solid rgb(180, 180, 180);margin-bottom:25px;background-color:rgb(247, 247, 247);font-weight:400;line-height:30px;word-break:break-word;">
<p style="box-sizing:border-box;margin:0px 0px 25px;margin-bottom:0px;word-break:break-word;font-size:16px;font-weight:400;line-height:1.7;">例如，当你设置<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">vm.someData = 'new value'</code>，该组件不会立即重新渲染。当刷新队列时，组件会在事件循环队列清空时的下一个“tick”更新。多数情况我们不需要关心这个过程，但是如果你想在 DOM 状态更新后做点什么，这就可能会有些棘手。虽然 Vue.js 通常鼓励开发人员沿着“数据驱动”的方式思考，避免直接接触 DOM，但是有时我们确实要这么做。为了在数据变化之后等待 Vue 完成更新 DOM ，可以在数据变化之后立即使用<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Vue.nextTick(callback)</code> 。这样回调函数在 DOM 更新完成后就会调用。</p>
</blockquote>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:700;line-height:1.7;color:rgb(47, 47, 47);font-size:24px;margin:0px 0px 15px;text-rendering:optimizelegibility;margin-top:20px;margin-bottom:10px;">三、<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>源码浅析</h2>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><strong style="font-weight:700;box-sizing:border-box;">作用</strong></p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Vue.nextTick</code>用于延迟执行一段代码，它接受2个参数（回调函数和执行回调函数的上下文环境），如果没有提供回调函数，那么将返回<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">promise</code>对象。</p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><strong style="font-weight:700;box-sizing:border-box;">源码</strong></p>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;"><span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">/**
 * Defer a task to execute it asynchronously.
 */</span>
<span style="box-sizing:border-box;color:rgb(198, 120, 221);">export</span> <span style="box-sizing:border-box;color:rgb(198, 120, 221);">const</span> nextTick = (<span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">function</span> (<span style="box-sizing:border-box;"></span>) </span>{
  <span style="box-sizing:border-box;color:rgb(198, 120, 221);">const</span> callbacks = []
  <span style="box-sizing:border-box;color:rgb(198, 120, 221);">let</span> pending = <span style="box-sizing:border-box;color:rgb(86, 182, 194);">false</span>
  <span style="box-sizing:border-box;color:rgb(198, 120, 221);">let</span> timerFunc

  <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">function</span> <span style="box-sizing:border-box;color:rgb(97, 174, 238);">nextTickHandler</span> (<span style="box-sizing:border-box;"></span>) </span>{
    pending = <span style="box-sizing:border-box;color:rgb(86, 182, 194);">false</span>
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">const</span> copies = callbacks.slice(<span style="box-sizing:border-box;color:rgb(209, 154, 102);">0</span>)
    callbacks.length = <span style="box-sizing:border-box;color:rgb(209, 154, 102);">0</span>
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">for</span> (<span style="box-sizing:border-box;color:rgb(198, 120, 221);">let</span> i = <span style="box-sizing:border-box;color:rgb(209, 154, 102);">0</span>; i &lt; copies.length; i++) {
      copies[i]()
    }
  }

  <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// the nextTick behavior leverages the microtask queue, which can be accessed</span>
  <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// via either native Promise.then or MutationObserver.</span>
  <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// MutationObserver has wider support, however it is seriously bugged in</span>
  <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// UIWebView in iOS &gt;= 9.3.3 when triggered in touch event handlers. It</span>
  <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// completely stops working after triggering a few times... so, if native</span>
  <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// Promise is available, we will use it:</span>
  <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">/* istanbul ignore if */</span>
  <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span> (<span style="box-sizing:border-box;color:rgb(198, 120, 221);">typeof</span> <span style="box-sizing:border-box;color:rgb(230, 192, 123);">Promise</span> !== <span style="box-sizing:border-box;color:rgb(152, 195, 121);">'undefined'</span> &amp;&amp; isNative(<span style="box-sizing:border-box;color:rgb(230, 192, 123);">Promise</span>)) {
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">var</span> p = <span style="box-sizing:border-box;color:rgb(230, 192, 123);">Promise</span>.resolve()
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">var</span> logError = <span style="box-sizing:border-box;"><span style="box-sizing:border-box;">err</span> =&gt;</span> { <span style="box-sizing:border-box;color:rgb(230, 192, 123);">console</span>.error(err) }
    timerFunc = <span style="box-sizing:border-box;"><span style="box-sizing:border-box;">()</span> =&gt;</span> {
      p.then(nextTickHandler).catch(logError)
      <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// in problematic UIWebViews, Promise.then doesn't completely break, but</span>
      <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// it can get stuck in a weird state where callbacks are pushed into the</span>
      <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// microtask queue but the queue isn't being flushed, until the browser</span>
      <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// needs to do some other work, e.g. handle a timer. Therefore we can</span>
      <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// &quot;force&quot; the microtask queue to be flushed by adding an empty timer.</span>
      <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span> (isIOS) setTimeout(noop)
    }
  } <span style="box-sizing:border-box;color:rgb(198, 120, 221);">else</span> <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span> (!isIE &amp;&amp; <span style="box-sizing:border-box;color:rgb(198, 120, 221);">typeof</span> MutationObserver !== <span style="box-sizing:border-box;color:rgb(152, 195, 121);">'undefined'</span> &amp;&amp; (
    isNative(MutationObserver) ||
    <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// PhantomJS and iOS 7.x</span>
    MutationObserver.toString() === <span style="box-sizing:border-box;color:rgb(152, 195, 121);">'[object MutationObserverConstructor]'</span>
  )) {
    <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// use MutationObserver where native Promise is not available,</span>
    <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// e.g. PhantomJS, iOS7, Android 4.4</span>
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">var</span> counter = <span style="box-sizing:border-box;color:rgb(209, 154, 102);">1</span>
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">var</span> observer = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> MutationObserver(nextTickHandler)
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">var</span> textNode = <span style="box-sizing:border-box;color:rgb(230, 192, 123);">document</span>.createTextNode(<span style="box-sizing:border-box;color:rgb(230, 192, 123);">String</span>(counter))
    observer.observe(textNode, {
      <span style="box-sizing:border-box;color:rgb(209, 154, 102);">characterData</span>: <span style="box-sizing:border-box;color:rgb(86, 182, 194);">true</span>
    })
    timerFunc = <span style="box-sizing:border-box;"><span style="box-sizing:border-box;">()</span> =&gt;</span> {
      counter = (counter + <span style="box-sizing:border-box;color:rgb(209, 154, 102);">1</span>) % <span style="box-sizing:border-box;color:rgb(209, 154, 102);">2</span>
      textNode.data = <span style="box-sizing:border-box;color:rgb(230, 192, 123);">String</span>(counter)
    }
  } <span style="box-sizing:border-box;color:rgb(198, 120, 221);">else</span> {
    <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">// fallback to setTimeout</span>
    <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">/* istanbul ignore next */</span>
    timerFunc = <span style="box-sizing:border-box;"><span style="box-sizing:border-box;">()</span> =&gt;</span> {
      setTimeout(nextTickHandler, <span style="box-sizing:border-box;color:rgb(209, 154, 102);">0</span>)
    }
  }

  <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> <span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">function</span> <span style="box-sizing:border-box;color:rgb(97, 174, 238);">queueNextTick</span> (<span style="box-sizing:border-box;">cb?: Function, ctx?: Object</span>) </span>{
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">let</span> _resolve
    callbacks.push(<span style="box-sizing:border-box;"><span style="box-sizing:border-box;">()</span> =&gt;</span> {
      <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span> (cb) {
        <span style="box-sizing:border-box;color:rgb(198, 120, 221);">try</span> {
          cb.call(ctx)
        } <span style="box-sizing:border-box;color:rgb(198, 120, 221);">catch</span> (e) {
          handleError(e, ctx, <span style="box-sizing:border-box;color:rgb(152, 195, 121);">'nextTick'</span>)
        }
      } <span style="box-sizing:border-box;color:rgb(198, 120, 221);">else</span> <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span> (_resolve) {
        _resolve(ctx)
      }
    })
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span> (!pending) {
      pending = <span style="box-sizing:border-box;color:rgb(86, 182, 194);">true</span>
      timerFunc()
    }
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">if</span> (!cb &amp;&amp; <span style="box-sizing:border-box;color:rgb(198, 120, 221);">typeof</span> <span style="box-sizing:border-box;color:rgb(230, 192, 123);">Promise</span> !== <span style="box-sizing:border-box;color:rgb(152, 195, 121);">'undefined'</span>) {
      <span style="box-sizing:border-box;color:rgb(198, 120, 221);">return</span> <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> <span style="box-sizing:border-box;color:rgb(230, 192, 123);">Promise</span>(<span style="box-sizing:border-box;">(<span style="box-sizing:border-box;">resolve, reject</span>) =&gt;</span> {
        _resolve = resolve
      })
    }
  }
})()
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">首先，先了解<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>中定义的三个重要变量。</p>
<ul style="box-sizing:border-box;word-break:break-word;padding:0px;margin:-5px 0px 20px 20px;margin-top:0px;margin-bottom:10px;padding-left:0px;">
<li style="box-sizing:border-box;line-height:30px;"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">callbacks</code></li>
</ul>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">用来存储所有需要执行的回调函数</p>
<ul style="box-sizing:border-box;word-break:break-word;padding:0px;margin:-5px 0px 20px 20px;margin-top:0px;margin-bottom:10px;padding-left:0px;">
<li style="box-sizing:border-box;line-height:30px;"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">pending</code></li>
</ul>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">用来标志是否正在执行回调函数</p>
<ul style="box-sizing:border-box;word-break:break-word;padding:0px;margin:-5px 0px 20px 20px;margin-top:0px;margin-bottom:10px;padding-left:0px;">
<li style="box-sizing:border-box;line-height:30px;"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">timerFunc</code></li>
</ul>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">用来触发执行回调函数</p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">接下来，了解<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTickHandler()</code>函数。</p>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;"><span style="box-sizing:border-box;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">function</span> <span style="box-sizing:border-box;color:rgb(97, 174, 238);">nextTickHandler</span> (<span style="box-sizing:border-box;"></span>) </span>{
    pending = <span style="box-sizing:border-box;color:rgb(86, 182, 194);">false</span>
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">const</span> copies = callbacks.slice(<span style="box-sizing:border-box;color:rgb(209, 154, 102);">0</span>)
    callbacks.length = <span style="box-sizing:border-box;color:rgb(209, 154, 102);">0</span>
    <span style="box-sizing:border-box;color:rgb(198, 120, 221);">for</span> (<span style="box-sizing:border-box;color:rgb(198, 120, 221);">let</span> i = <span style="box-sizing:border-box;color:rgb(209, 154, 102);">0</span>; i &lt; copies.length; i++) {
      copies[i]()
    }
  }
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">这个函数用来执行<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">callbacks</code>里存储的所有回调函数。</p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">接下来是将触发方式赋值给<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">timerFunc</code>。</p>
<ul style="box-sizing:border-box;word-break:break-word;padding:0px;margin:-5px 0px 20px 20px;margin-top:0px;margin-bottom:10px;padding-left:0px;">
<li style="box-sizing:border-box;line-height:30px;">先判断是否原生支持promise，如果支持，则利用promise来触发执行回调函数；</li>
<li style="box-sizing:border-box;line-height:30px;">否则，如果支持MutationObserver，则实例化一个观察者对象，观察文本节点发生变化时，触发执行所有回调函数。</li>
<li style="box-sizing:border-box;line-height:30px;">如果都不支持，则利用setTimeout设置延时为0。</li>
</ul>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">最后是<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">queueNextTick</code>函数。因为<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>是一个即时函数，所以<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">queueNextTick</code>函数是返回的函数，接受用户传入的参数，用来往callbacks里存入回调函数。<br style="box-sizing:border-box;"/>
</p><div style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;">
<div style="box-sizing:border-box;z-index:100;position:relative;background-color:transparent;transition:background-color 0.1s linear 0s;margin:0px auto;max-width:700px;max-height:222px;">
<div style="box-sizing:border-box;z-index:50;padding-bottom:24.610000000000003%;"></div>
<div style="box-sizing:border-box;position:absolute;top:0px;left:0px;width:100%;height:100%;overflow:hidden;"><img src="简单理解Vue中的nextTick_files/webp [2].webp" type="image/webp" data-filename="webp.webp" height="172" style="border:0px;box-sizing:border-box;vertical-align:middle;max-width:100%;display:block;transition:all 0.15s linear 0s;z-index:100;filter:blur(0px);opacity:1;height:auto;cursor:zoom-in;" width="700"/></div>
</div>

</div><br style="box-sizing:border-box;"/>
上图是整个执行流程，关键在于<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">timeFunc()</code>，该函数起到延迟执行的作用。<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"></p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">从上面的介绍，可以得知<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">timeFunc()</code>一共有三种实现方式。</p>
<ul style="box-sizing:border-box;word-break:break-word;padding:0px;margin:-5px 0px 20px 20px;margin-top:0px;margin-bottom:10px;padding-left:0px;">
<li style="box-sizing:border-box;line-height:30px;"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Promise</code></li>
<li style="box-sizing:border-box;line-height:30px;"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MutationObserver</code></li>
<li style="box-sizing:border-box;line-height:30px;"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">setTimeout</code></li>
</ul>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">其中<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Promise</code>和<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">setTimeout</code>很好理解，是一个异步任务，会在同步任务以及更新DOM的异步任务之后回调具体函数。</p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">下面着重介绍一下<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MutationObserver</code>。</p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MutationObserver</code>是HTML5中的新API，是个用来监视DOM变动的接口。他能监听一个DOM对象上发生的子节点删除、属性修改、文本内容修改等等。<br style="box-sizing:border-box;"/>
调用过程很简单，但是有点不太寻常：你需要先给他绑回调：</p>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">var</span> mo = <span style="box-sizing:border-box;color:rgb(198, 120, 221);">new</span> MutationObserver(callback)
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">通过给<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MutationObserver</code>的构造函数传入一个回调，能得到一个<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MutationObserver</code>实例，这个回调就会在<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MutationObserver</code>实例监听到变动时触发。</p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">这个时候你只是给<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MutationObserver</code>实例绑定好了回调，他具体监听哪个DOM、监听节点删除还是监听属性修改，还没有设置。而调用他的<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">observer</code>方法就可以完成这一步:</p>
<pre style="overflow:auto;font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;display:block;padding:15px;margin:0px 0px 10px;line-height:1.42857;word-break:break-word;overflow-wrap:normal;color:rgb(171, 178, 191);border:1px solid rgb(204, 204, 204);border-radius:4px;margin-bottom:20px;white-space:pre;overflow-x:auto;background:rgb(40, 44, 52);background-color:rgb(245, 245, 245);"><code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:inherit;background-color:transparent;border-radius:0px;padding:0px;white-space:pre;border:none;vertical-align:middle;"><span style="box-sizing:border-box;color:rgb(198, 120, 221);">var</span> domTarget = 你想要监听的dom节点
mo.observe(domTarget, {
      <span style="box-sizing:border-box;color:rgb(209, 154, 102);">characterData</span>: <span style="box-sizing:border-box;color:rgb(86, 182, 194);">true</span> <span style="box-sizing:border-box;color:rgb(146, 146, 146);font-style:normal;">//说明监听文本内容的修改。</span>
})
</code></pre>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"></p><div style="box-sizing:border-box;padding-bottom:25px;width:700px;margin-left:-40px;text-align:center;">
<div style="box-sizing:border-box;z-index:100;position:relative;background-color:transparent;transition:background-color 0.1s linear 0s;margin:0px auto;max-width:432px;max-height:253px;">
<div style="box-sizing:border-box;z-index:50;padding-bottom:58.56%;"></div>
<div style="box-sizing:border-box;position:absolute;top:0px;left:0px;width:100%;height:100%;overflow:hidden;"><img src="简单理解Vue中的nextTick_files/webp [3].webp" type="image/webp" data-filename="webp.webp" height="253" style="border:0px;box-sizing:border-box;vertical-align:middle;max-width:100%;display:block;transition:all 0.15s linear 0s;z-index:100;filter:blur(0px);opacity:1;height:auto;cursor:zoom-in;" width="432"/></div>
</div>

</div><br style="box-sizing:border-box;"/>
在<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>中 <code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MutationObserver</code>的作用就如上图所示。在监听到DOM更新后，调用回调函数。<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;"></p>
<p style="box-sizing:border-box;margin:0px 0px 25px;word-break:break-word;">其实使用 <code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">MutationObserver</code>的原因就是 <code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">nextTick</code>想要一个异步API，用来在当前的同步代码执行完毕后，执行我想执行的异步回调，包括<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">Promise</code>和 <code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">setTimeout</code>都是基于这个原因。其中深入还涉及到<code style="font-family:Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;box-sizing:border-box;color:rgb(199, 37, 78);background-color:rgb(246, 246, 246);border-radius:4px;padding:2px 4px;border:none;white-space:pre-wrap;vertical-align:middle;">microtask</code>等内容，暂时不理解，就不深入介绍了。</p>

          </div>
        </div>
    </div></div></div></div></div></div><br/></div></span>
</div></body></html> 