<html>
<head>
  <title>poi导出Excel，设置数据有效性</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="9313"/>
<h1>poi导出Excel，设置数据有效性</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/10/26 17:36</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/10/26 17:37</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="about:blank"><i>about:blank</i></a></td></tr>
</table>
</div>
<br/>

<div>
<span><div><span style="color: #cc7832;">private</span> DataValidation <span style="color: #ffc66d;">getDataValidationByFormula</span>(String[] formulaString<span style="color: #cc7832;">, int</span> firstRow<span style="color: #cc7832;">, int</span> lastRow<span style="color: #cc7832;">, int</span> firstCol) {</div><div><span style="color: #808080;">//加载下拉列表内容</span></div><div>DVConstraint constraint = DVConstraint.<span style="font-style: italic;">createExplicitListConstraint</span>(formulaString)<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">//设置数据有效性加载在哪个单元格上。</span></div><div><span style="color: #808080;">//四个参数分别是：起始行、终止行、起始列、终止列</span></div><div>CellRangeAddressList regions = <span style="color: #cc7832;">new</span> CellRangeAddressList(firstRow<span style="color: #cc7832;">,</span> lastRow<span style="color: #cc7832;">,</span> firstCol<span style="color: #cc7832;">,</span> firstCol)<span style="color: #cc7832;">;</span></div><div>DataValidation <span style="background-color: #52503a;">data_validation_list</span> = <span style="color: #cc7832;">new</span> HSSFDataValidation(regions<span style="color: #cc7832;">,</span> constraint)<span style="color: #cc7832;">;</span></div><div><span style="color: #cc7832;">return</span> data_validation_list<span style="color: #cc7832;">;</span></div><div>}</div><div><br/></div><div><span style="color: #cc7832;">private void</span> <span style="color: #ffc66d;">exportExcell</span>(HttpServletResponse response<span style="color: #cc7832;">,</span> String cold<span style="color: #cc7832;">,</span> String coln<span style="color: #cc7832;">,</span> Vector v) {</div><div><br/></div><div><span style="color: #cc7832;">try</span> {</div><div><span style="color: #808080;">// 声明一个工作薄</span></div><div>HSSFWorkbook workbook = <span style="color: #cc7832;">new</span> HSSFWorkbook()<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">// 生成一个表格</span></div><div>HSSFSheet sheet = workbook.createSheet()<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">//设置数据有效性</span></div><div>String orderType = <span style="color: #6a8759;">&quot;GOA,PrePay&quot;</span><span style="color: #cc7832;">;</span></div><div>String cardType = <span style="color: #6a8759;">&quot;Plat,Cent&quot;</span><span style="color: #cc7832;">;</span></div><div>String hotelType = <span style="color: #6a8759;">&quot;INTL,DOM&quot;</span><span style="color: #cc7832;">;</span></div><div>sheet.addValidationData(getDataValidationByFormula(hotelType.split(<span style="color: #6a8759;">&quot;,&quot;</span>)<span style="color: #cc7832;">,</span> <span style="color: #6897bb;">1</span><span style="color: #cc7832;">,</span> v.size()<span style="color: #cc7832;">,</span> <span style="color: #6897bb;">10</span>))<span style="color: #cc7832;">;</span></div><div>sheet.addValidationData(getDataValidationByFormula(cardType.split(<span style="color: #6a8759;">&quot;,&quot;</span>)<span style="color: #cc7832;">,</span> <span style="color: #6897bb;">1</span><span style="color: #cc7832;">,</span> v.size()<span style="color: #cc7832;">,</span> <span style="color: #6897bb;">3</span>))<span style="color: #cc7832;">;</span></div><div>sheet.addValidationData(getDataValidationByFormula(orderType.split(<span style="color: #6a8759;">&quot;,&quot;</span>)<span style="color: #cc7832;">,</span> <span style="color: #6897bb;">1</span><span style="color: #cc7832;">,</span> v.size()<span style="color: #cc7832;">,</span> <span style="color: #6897bb;">9</span>))<span style="color: #cc7832;">;</span></div><div><br/></div><div><span style="color: #808080;">// 设置表格默认列宽度为15个字节</span></div><div>sheet.setDefaultColumnWidth((<span style="color: #cc7832;">short</span>) <span style="color: #6897bb;">15</span>)<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">// 生成一个样式</span></div><div>HSSFCellStyle style = workbook.createCellStyle()<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">// 设置这些样式</span></div><div>style.setFillForegroundColor(HSSFColor.SKY_BLUE.<span style="color: #9876aa; font-style: italic;">index</span>)<span style="color: #cc7832;">;</span></div><div>style.setFillPattern(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">SOLID_FOREGROUND</span>)<span style="color: #cc7832;">;</span></div><div>style.setBorderBottom(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">BORDER_THIN</span>)<span style="color: #cc7832;">;</span></div><div>style.setBorderLeft(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">BORDER_THIN</span>)<span style="color: #cc7832;">;</span></div><div>style.setBorderRight(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">BORDER_THIN</span>)<span style="color: #cc7832;">;</span></div><div>style.setBorderTop(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">BORDER_THIN</span>)<span style="color: #cc7832;">;</span></div><div>style.setAlignment(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">ALIGN_CENTER</span>)<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">// 生成一个字体</span></div><div>HSSFFont font = workbook.createFont()<span style="color: #cc7832;">;</span></div><div>font.setColor(HSSFColor.VIOLET.<span style="color: #9876aa; font-style: italic;">index</span>)<span style="color: #cc7832;">;</span></div><div>font.setFontHeightInPoints((<span style="color: #cc7832;">short</span>) <span style="color: #6897bb;">12</span>)<span style="color: #cc7832;">;</span></div><div>font.setBoldweight(HSSFFont.<span style="color: #9876aa; font-style: italic;">BOLDWEIGHT_BOLD</span>)<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">// 把字体应用到当前的样式</span></div><div>style.setFont(font)<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">// 生成并设置另一个样式</span></div><div>HSSFCellStyle style2 = workbook.createCellStyle()<span style="color: #cc7832;">;</span></div><div>style2.setFillForegroundColor(HSSFColor.LIGHT_YELLOW.<span style="color: #9876aa; font-style: italic;">index</span>)<span style="color: #cc7832;">;</span></div><div>style2.setFillPattern(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">SOLID_FOREGROUND</span>)<span style="color: #cc7832;">;</span></div><div>style2.setBorderBottom(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">BORDER_THIN</span>)<span style="color: #cc7832;">;</span></div><div>style2.setBorderLeft(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">BORDER_THIN</span>)<span style="color: #cc7832;">;</span></div><div>style2.setBorderRight(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">BORDER_THIN</span>)<span style="color: #cc7832;">;</span></div><div>style2.setBorderTop(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">BORDER_THIN</span>)<span style="color: #cc7832;">;</span></div><div>style2.setAlignment(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">ALIGN_CENTER</span>)<span style="color: #cc7832;">;</span></div><div>style2.setVerticalAlignment(HSSFCellStyle.<span style="color: #9876aa; font-style: italic;">VERTICAL_CENTER</span>)<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">// 生成另一个字体</span></div><div>HSSFFont font2 = workbook.createFont()<span style="color: #cc7832;">;</span></div><div>font2.setBoldweight(HSSFFont.<span style="color: #9876aa; font-style: italic;">BOLDWEIGHT_NORMAL</span>)<span style="color: #cc7832;">;</span></div><div><span style="color: #808080;">// 把字体应用到当前的样式</span></div><div>style2.setFont(font2)<span style="color: #cc7832;">;</span></div><div><br/></div><div><span style="color: #808080;">/* // 声明一个画图的顶级管理器</span></div><div><span style="color: #808080;">HSSFPatriarch patriarch = sheet.createDrawingPatriarch();</span></div><div><span style="color: #808080;">// 定义注释的大小和位置,详见文档</span></div><div><span style="color: #808080;">HSSFComment comment = patriarch.createComment(new HSSFClientAnchor(0, 0, 0, 0, (short) 4, 2, (short) 6, 5));</span></div><div><span style="color: #808080;">// 设置注释内容</span></div><div><span style="color: #808080;">comment.setString(new HSSFRichTextString(&quot;可以在POI中添加注释！&quot;));</span></div><div><span style="color: #808080;">// 设置注释作者，当鼠标移动到单元格上是可以在状态栏中看到该内容.</span></div><div><span style="color: #808080;">comment.setAuthor(&quot;leno&quot;);*/</span></div><div><br/></div><div><span style="color: #808080;">// 产生表格标题行</span></div><div>HSSFRow row = sheet.createRow(<span style="color: #6897bb;">0</span>)<span style="color: #cc7832;">;</span></div><div>String[] headerName = cold.split(<span style="color: #6a8759;">&quot;,&quot;</span>)<span style="color: #cc7832;">;</span></div><div><span style="color: #cc7832;">for</span> (<span style="color: #cc7832;">short</span> i = <span style="color: #6897bb;">0</span><span style="color: #cc7832;">;</span> i &lt; headerName.<span style="color: #9876aa;">length</span><span style="color: #cc7832;">;</span> i++) {</div><div>HSSFCell cell = row.createCell(i)<span style="color: #cc7832;">;</span></div><div>cell.setCellStyle(style)<span style="color: #cc7832;">;</span></div><div>HSSFRichTextString text = <span style="color: #cc7832;">new</span> HSSFRichTextString(headerName[i])<span style="color: #cc7832;">;</span></div><div>cell.setCellValue(text)<span style="color: #cc7832;">;</span></div><div>}</div><div>String[] headers = coln.split(<span style="color: #6a8759;">&quot;,&quot;</span>)<span style="color: #cc7832;">;</span></div><div><span style="color: #cc7832;">for</span> (<span style="color: #cc7832;">int</span> i = <span style="color: #6897bb;">0</span><span style="color: #cc7832;">;</span> i &lt; v.size()<span style="color: #cc7832;">;</span> i++) {</div><div>Hashtable ht = (Hashtable) v.get(i)<span style="color: #cc7832;">;</span></div><div>row = sheet.createRow(i + <span style="color: #6897bb;">1</span>)<span style="color: #cc7832;">;</span></div><div><span style="color: #cc7832;">for</span> (<span style="color: #cc7832;">int</span> k = <span style="color: #6897bb;">0</span><span style="color: #cc7832;">;</span> k &lt; headers.<span style="color: #9876aa;">length</span><span style="color: #cc7832;">;</span> k++) {</div><div>HSSFCell cell = row.createCell(k)<span style="color: #cc7832;">;</span></div><div>cell.setCellStyle(style2)<span style="color: #cc7832;">;</span></div><div>String textValue = <span style="color: #6a8759;">&quot;&quot;</span><span style="color: #cc7832;">;</span></div><div><span style="color: #cc7832;">if</span> (<span style="font-style: italic;">isNumeric</span>(String.<span style="font-style: italic;">valueOf</span>(ht.get(headers[k]))) &amp;&amp; !<span style="color: #6a8759;">&quot;CardNo&quot;</span>.equals(headers[k]) &amp;&amp; !<span style="color: #6a8759;">&quot;TravellerPhone&quot;</span>.equals(headers[k]) &amp;&amp; !<span style="color: #6a8759;">&quot;CellPhone&quot;</span>.equals(headers[k])) {</div><div>textValue = String.<span style="font-style: italic;">valueOf</span>(ht.get(headers[k]))<span style="color: #cc7832;">;</span></div><div><span style="color: #cc7832;">if</span> ((<span style="color: #6a8759;">&quot;null&quot;</span>.equals(textValue)) || (<span style="color: #6a8759;">&quot;&quot;</span>.equals(textValue))) {</div><div>textValue = <span style="color: #6a8759;">&quot;0&quot;</span><span style="color: #cc7832;">;</span></div><div>}</div><div>} <span style="color: #cc7832;">else</span> {</div><div>textValue = String.<span style="font-style: italic;">valueOf</span>(ht.get(headers[k]))<span style="color: #cc7832;">;</span></div><div><span style="color: #cc7832;">if</span> (<span style="color: #6a8759;">&quot;null&quot;</span>.equals(textValue)) {</div><div>textValue = <span style="color: #6a8759;">&quot;&quot;</span><span style="color: #cc7832;">;</span></div><div>}</div><div>}</div><div>cell.setCellValue(textValue)<span style="color: #cc7832;">;</span></div><div>}</div><div>}</div><div><span style="color: #cc7832;">try</span> {</div><div>workbook.write(response.getOutputStream())<span style="color: #cc7832;">;</span></div><div>} <span style="color: #cc7832;">catch</span> (IOException e) {</div><div>e.printStackTrace()<span style="color: #cc7832;">;</span></div><div>}</div><div>} <span style="color: #cc7832;">catch</span> (Exception e) {</div><div>e.printStackTrace()<span style="color: #cc7832;">;</span></div><div>}</div><div><br/></div><div>}</div><div><br/></div><div><span style="color: #cc7832;">private static</span> Pattern <span style="color: #9876aa; font-style: italic;">p</span> = Pattern.<span style="font-style: italic;">compile</span>(<span style="color: #6a8759;">&quot;^//d+(//.//d+)?$&quot;</span>)<span style="color: #cc7832;">;</span></div><div><br/></div></span>
</div></body></html> 