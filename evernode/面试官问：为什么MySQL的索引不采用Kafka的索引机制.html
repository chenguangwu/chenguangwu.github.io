<html>
<head>
  <title>面试官问：为什么MySQL的索引不采用Kafka的索引机制</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="13217"/>
<h1>面试官问：为什么MySQL的索引不采用Kafka的索引机制</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/11/15 10:31</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&mid=2247487694&idx=1&sn=8d7906dc10e31750a079a0624eb6f9e7&chksm=96cd5082a1bad994c25df6612b070b143b6953cbbd848b3c1ec89d39228fe77e5ee484e39dfc#rd"><i>http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247487694&amp;idx=1&amp;sn=8d7906dc10e31750a079a0624eb6f9e7&amp;chksm=96cd5082a1bad994c25df6612b070b143b6953cbbd848b3c1ec89d39228fe77e5ee484e39dfc#rd</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="text-size-adjust:100%;line-height:1.6;-webkit-appearance:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"><div style="font-family:-apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color:rgb(51, 51, 51);background-color:rgb(242, 242, 242);letter-spacing:0.034em;line-height:1.6;font-size:16px;-webkit-appearance:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"><div><div style="overflow-wrap:break-word;"><div style="background-color:rgb(255, 255, 255);"><div><div>
                
                <h2 style="font-weight:400;font-size:22px;margin:0px;padding:0px;line-height:1.4;margin-bottom:14px;">
                    
                    
                    
            面试官问：为什么MySQL的索引不采用Kafka的索引机制
                      </h2>
                <div style="margin:0px;padding:0px;margin-bottom:22px;line-height:20px;font-size:0px;overflow-wrap:break-word;word-break:break-all;position:relative;z-index:1;">
                                                                                                                            
                                        <span style="margin:0px 10px 10px 0px;padding:0px;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);position:relative;">
                      <a href="#" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);cursor:pointer;">
                        占小狼的博客                      </a>
                      
                    </span>


                    <em style="margin:0px 10px 10px 0px;padding:0px;font-style:normal;display:inline-block;vertical-align:middle;font-size:15px;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);color:rgba(0, 0, 0, 0.3);">昨天</em>





                </div>

                

                

                

                
                                    
                    <div style="margin:0px;padding:0px;margin-bottom:0;font-size:15px;">
                                                                                                </div>

                    
                                            <div style="margin:0px;padding:0px;margin-bottom:24px;font-size:15px;">
                            <p style="margin:0px;padding:0px;line-height:1.4;color:rgba(0, 0, 0, 0.3);">
                                                                    <span style="margin:0px;padding:0px;">以下文章来源于朱小厮的博客</span>
                                                                                                    <span style="margin:0px;padding:0px;">，作者朱小厮</span>
                                                            </p>
                            <a href="https://mp.weixin.qq.com/s/VeTl00IcmQP7KFrMBgUvEA#" style="margin:0px;padding:20px 16px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);margin-top:16px;border-radius:8px;background-color:rgba(0, 0, 0, 0.03);line-height:1.4;-webkit-box-align:center;align-items:center;display:flex;cursor:pointer;">
                                <div style="margin:0px;padding:0px;">
                                    <span style="display:inline-block;background-color:rgb(255, 255, 255);padding:0px;border-radius:50%;overflow:hidden;vertical-align:middle;margin:0px;width:40px;height:40px;margin-right:12px;">
                                        <img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/0.jpg" type="image/jpeg" data-filename="0.jpg" alt="朱小厮的博客" height="40" style="display:block;width:100%;height:100%;border-radius:50%;background-color:rgb(238, 238, 238);margin:0px;padding:0px;" width="40"/>
                                    </span>
                                </div>
                                <div style="margin:0px;padding:0px;min-width:0px;-webkit-box-flex:1;flex:1 1 0%;">
                                    <strong style="margin:0px;padding:0px;color:rgba(0, 0, 0, 0.9);font-size:17px;font-weight:700;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow-wrap:normal;display:block;">朱小厮的博客</strong>
                                                                            <p style="margin:0px;padding:0px;color:rgba(0, 0, 0, 0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow-wrap:normal;">著有畅销书：《深入理解Kafka》和《RabbitMQ实战指南》。公众号主要用来分享Java技术栈、Golang技术栈、消息中间件（如Kafka、RabbitMQ）、存储、大数据以及通用型技术架构等相关的技术。</p>
                                                                    </div>
                                <div style="margin:0px;padding:0px;position:relative;padding-right:24px;"><span style="font-size:10px;background:url(&quot;data:image/svg+xml;charset=utf8, %3csvg width='10' height='20' viewbox='0 0 10 20' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Cpath d='M6.323 10.358l-.884.884L.623 6.426a.83.83 0 0 1 0-1.177L5.44.433l.884.884-4.52 4.52 4.52 4.521z' id='a'/%3E%3C/defs%3E%3Cuse fill='%23000' transform='rotate(-180 4.184 7.921)' xlink:href='%23a' fill-rule='evenodd' opacity='.2' /%3E%3C/svg%3E&quot;) 0px 0px / 1em no-repeat transparent;width:1em;height:2em;position:absolute;right:0px;top:50%;margin-top:-1em;"></span></div>
                            </a>
                        </div>
                                                    


                
                
                
                
                                                
                                                                
                                
                
                <div style="margin:0px;padding:0px;overflow:hidden;color:rgb(51, 51, 51);font-size:17px;overflow-wrap:break-word;text-align:justify;position:relative;z-index:0;">
                    

                    

                    
                    
                    <p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;white-space:normal;color:rgb(62, 62, 62);font-family:-apple-system-font, system-ui, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:15px;letter-spacing:0.544px;background-color:rgb(255, 255, 255);text-align:center;"><img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/640.webp" type="image/webp" data-filename="640.webp" height="1096" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;font-family:"Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;letter-spacing:1px;word-spacing:1px;width:79% !important;visibility:visible !important;" width="535"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:15px;color:rgb(62, 62, 62);line-height:1.6;word-spacing:1px;letter-spacing:1px;font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;text-align:center;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"/></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;">第一眼看到这个问题，也是很迷惑的，谁没事会问这种问题。然而，事实上这居然是一道真实的面试题。</p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;">首先，从时间上来说，这是不同时期的两个典型产品，MySQL要早于Kafka。</p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">首先我们来说一说MySQL的历史。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">MySQL可以追溯到1979年，一个名为Monty Widenius的程序员在为TcX的小公司打工，并且用BASIC设计了一个报表工具，使其可以在4MHz主频和16KB内存的计算机上运行。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">当时，这只是一个很底层的且仅面向报表的存储引擎，名叫Unireg。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">1990年，TcX公司的客户中开始有人要求为他的API提供SQL支持。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Monty直接借助于mSQL的代码，将它集成到自己的存储引擎中。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">令人失望的是，效果并不太令人满意，决心自己重写一个SQL支持。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">1996年，MySQL 1.0发布，它只面向一小拨人，相当于内部发布。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">到了1996年10月，MySQL 3.11.1发布(MySQL没有2.x版本)，最开始只提供Solaris下的二进制版本。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">一个月后，Linux版本出现了。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">在接下来的两年里，MySQL被依次移植到各个平台。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">2000年，MySQL不仅公布自己的源代码，并采用GPL(GNU General Public License)许可协议，正式进入开源世界。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">同年4月，MySQL对旧的存储引擎ISAM进行了整理，将其命名为MyISAM。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">2003年12月，MySQL 5.0版本发布，提供了视图、存储过程等功能。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">2010年12月，MySQL 5.5发布，其主要新特性包括半同步的复制及对SIGNAL/RESIGNAL的异常处理功能的支持，最重要的是InnoDB存储引擎终于变为当前MySQL的默认存储引擎。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">好了，再来简单聊聊Kafka的历史。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;"></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Apache Kafka最初由LinkedIn开发，并在2011年初开源。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;"></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">在2012年10月23日由Apache Incubator孵化出站，成为了Apache软件基金会的项目。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;"></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">2014年11月， Jun Rao、Jay Kreps、 Neha Narkhede等几个曾在LinkedIn为Kafka工作的工程师，创建了名为Confluent的新公司，并着眼于Kafka。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">根据2014年Quora（美版知乎）的帖子，Jay Kreps将Kafka以作家Franz Kafka（奥匈帝国作家，代表作：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">《变形记》）命名。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Kreps选择将该系统以一个作家命名是因为，它是“a system optimized for writing”（一个用于优化写作的系统），而且他很喜欢Kafka的作品。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">从时间上来说，先者不能预测未来的事情，也就是说MySQL不能预测未来某个产品的架构以及其能够从此未来架构上吸取点什么经验。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">但是前面的这些说辞只能用来做加分项，要彻底说服面试官显然还是不行的。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">MySQL经历了这么多年的变迁和改进，底层的存储引擎也有好多个，比如MyISAM、InnoDB，如果觉得某个东西适合自己，是可以在这个变迁的过程中引进过来。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">技术面试，还是要从技术的角度去剖析。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">回答这个问题，除了要考虑时间这个加分项之外，还要说道以下3个技术点：</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;"></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">1. MySQL中的索引机制；</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;"></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">2. Kafka中的索引机制；</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;"></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">3. MySQL与Kafka索引机制的对比。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">何为索引？</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">很多人都知道“索引是一个排序的列表，在这个列表中存储着索引的值和包含这个值的数据所在行的物理地址，在数据十分庞大的时候，索引可以大大加快查询的速度，这是因为使用索引后可以不用扫描全表来定位某行的数据，而是先通过索引表找到该行数据对应的物理地址然后访问相应的数据。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">索引的建立对于MySQL的高效运行是很重要的，索引可以大大提高MySQL的检索速度。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">拿汉语字典的目录页（索引）打比方，我们可以按拼音、笔画、偏旁部首等排序的目录（索引）快速查找到需要的字。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">但过多的使用索引将会造成滥用。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">因此索引也会有它的缺点：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">索引是在MYSQL的存储引擎层中实现的，而不是在服务层实现的。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">所以每种存储引擎的索引都不一定完全相同，也不是所有的存储引擎都支持所有的索引类型。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">MYSQL目前主要提供了以下4种索引 :</span></p><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;padding-left:2.2em;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">B/B+树索引：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">最常见的索引类型，大部分引擎都支持B树索引。</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">HASH 索引：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">只有Memory引擎支持，使用场景简单。</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">R-Tree 索引(空间数据索引)：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">空间索引是MyISAM的一种特殊索引类型，主要用于地理空间数据类型。</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">Full-text (全文索引)：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">全文索引也是MyISAM的一种特殊索引类型，主要用于全文索引，InnoDB从MYSQL5.6版本提供对全文索引的支持。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"></span></p></li></ul><blockquote style="margin:1em 0px;padding:10px 15px 10px 1rem;max-width:100%;box-sizing:border-box;overflow-wrap:normal;padding-left:10px;border-left:3px solid rgb(219, 219, 219);color:rgb(129, 145, 152);font-size:0.9em;padding-top:4px;line-height:inherit;border-left-width:6px;border-left-color:rgb(220, 230, 240);background:rgb(242, 247, 251);overflow:auto;word-break:normal;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">其它索引类别：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">还有很多第三方的存储引擎使用不同类型的数据结构来存储索引。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">例如TokuDB使用分形树索引（fractal tree index），这是一类较新开发的数据结构，既有B-Tree的很多优点，也避免了B-Tree的一些缺点。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">多数情况下，针对InnoDB的讨论也都适用于TokuDB。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">ScaleDB使用Patricia tries，其他一些存储引擎技术如InfiniDB和Infobright则使用了一些特殊的数据结构来优化某些特殊的查询。</span></p></blockquote><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">我们知道MySQL从5.5版本开始就将InnoDB作为了默认的存储引擎，在《高性能MySQL》一书对于如何选择存储引擎就发表过这样的观点：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">除非需要用到某些InnoDB不具备的特性，并且没有其它办法可以替代，否则都应该优先选择InnoDB引擎。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">虽然从学术陈词上来说并不太严谨，但是我们可以简单的认为：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">在绝大多数情况下，现在我们所说的MySQL所使用的引擎为InnoDB，而索引是在存储引擎中实现的。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">“为什么MySQL的索引不采用kafka的索引机制？</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">”这个命题也可以简单的修改为“为什么InnoDB中不采用Kafka的索引机制？</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">”</span></p><blockquote style="margin:1em 0px;padding:10px 15px 10px 1rem;max-width:100%;box-sizing:border-box;overflow-wrap:normal;padding-left:10px;border-left:3px solid rgb(219, 219, 219);color:rgb(129, 145, 152);font-size:0.9em;padding-top:4px;line-height:inherit;border-left-width:6px;border-left-color:rgb(220, 230, 240);background:rgb(242, 247, 251);overflow:auto;word-break:normal;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">MySQL中的存储引擎有很多，除了MyISAM、InnoDB之外，还有Archive、Blackhole、CSV、Federated、Memory、Merge、NDB、Groonga、OQGraph、Q4M、SphinxSE、Spider、VPForMySQL….等等，每个存储引擎多针对的优化场景也不同，而且这里我们无法针对每个存储引擎来做分析，所以这里我们针对最最通用的InnoDB来做进一步的分析。</span></p></blockquote><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">为了弄清楚“为什么mysql的索引不采用kafka的索引机制？</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">”或者“为什么InnoDB中不采用Kafka的索引机制？</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">” ，那么我们还是先来复习一下Kafka中的索引机制。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">在kafka中，每个日志分段文件都对应了两个索引文件——偏移量索引文件和时间戳索引文件（还有其它的诸如事务日志索引文件就不细表了），主要用来提高查找消息的效率。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">偏移量索引文件用来建立消息偏移量(offset)到物理地址之间的映射关系，方便快速定位消息所在的物理文件位置；</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">时间戳索引文件则根据指定的时间戳(timestamp)来查找对应的偏移量信息。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Kafka 中的索引文件以稀疏索引(sparse index)的方式构造消息的索引，它并不保证每个消息在索引文件中都有对应的索引项。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">每当写入一定量(由 broker 端参数 log.index.interval.bytes 指定，默认值为 4096，即 4KB)的消息时，偏移量索引文件和时间戳索引文件分别增加一个偏移量索引项和时间戳索引项，增大或减小 log.index.interval.bytes 的值，对应地可以缩小或增加索引项的密度。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">稀疏索引通过 MappedByteBuffer 将索引文件映射到内存中，以加快索引的查询速度。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">偏移量索引文件中的偏移量是单调递增的，查询指定偏移量时，使用二分查找法来快速定位偏移量的位置，如果指定的偏移量不在索引文件中，则会返回小于指定偏移量的最大偏移量。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">时间戳索引文件中的时间戳也保持严格的单调递增，查询指定时间戳时，也根据二分查找法来查找不大于该时间戳的最大偏移量，至于要找到对应的物理文件位置还需要根据偏移量索引文件来进行再次定位。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">稀疏索引的方式是在磁盘空间、内存空间、查找时间等多方面之间的一个折中。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">以偏移量索引文件来做具体分析。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">偏移量索引项的格式如下图所示。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">每个索引项占用 8 个字节，分为两个部分：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">(1) relativeOffset: 相对偏移量，表示消息相对于 baseOffset 的偏移量，占用 4 个字节，当前索引文件的文件名即为 baseOffset 的值。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">(2) position: 物理地址，也就是消息在日志分段文件中对应的物理位置，占用 4 个字节。</span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;text-align:center;"><img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/640 [1].webp" type="image/webp" data-filename="640.webp" height="133" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;width:57% !important;visibility:visible !important;" width="386"/></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">消息的偏移量(offset)占用 8 个字节，也可以称为绝对偏移量。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">索引项中没有直接使用绝对偏移量而改为只占用 4 个字节的相对偏移量(relativeOffset = offset - baseOffset)，这样可以减小索引文件占用的空间。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">举个例子，一个日志分段的 baseOffset 为 32，那么其文件名就是 00000000000000000032.log，offset 为 35 的消息在索引文件中的 relativeOffset 的值为 35-32=3。</span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;text-align:center;"><img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/640 [2].webp" type="image/webp" data-filename="640.webp" height="461" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;width:89% !important;visibility:visible !important;" width="603"/></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">如果我们要查找偏移量为 23 的消息，那么应该怎么做呢?首先通过二分法在偏移量索引文件中找到不大于 23 的最大索引项，即[22, 656]，然后从日志分段文件中的物理位置 656 开始顺序查找偏移量为 23 的消息。</span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;text-align:center;"><img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/640 [3].webp" type="image/webp" data-filename="640.webp" height="232" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;width:677px !important;visibility:visible !important;" width="677"/></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">以上是最简单的一种情况。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">参考上图，如果要查找偏移量为 268 的消息，那么应该怎么 办呢?首先肯定是定位到baseOffset为251的日志分段，然后计算相对偏移量relativeOffset = 268 - 251 = 17，之后再在对应的索引文件中找到不大于 17 的索引项，最后根据索引项中的 position 定位到具体的日志分段文件位置开始查找目标消息。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">那么又是如何查找 baseOffset 为 251 的日志分段的呢?这里并不是顺序查找，而是用了跳跃表的结构。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Kafka 的每个日志对象中使用了 ConcurrentSkipListMap 来保存各个日志分段，每个日志分段的 baseOffset 作为 key，这样可以根据指定偏移量来快速定位到消息所在的日志分段。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">在Kafka中要定位一条消息，那么首先根据 offset 从 ConcurrentSkipListMap 中来查找到到对应（baseOffset）日志分段的索引文件，然后读取偏移量索引索引文件，之后使用二分法在偏移量索引文件中找到不大于 offset - baseOffset z的最大索引项，接着再读取日志分段文件并且从日志分段文件中顺序查找relativeOffset对应的消息。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Kafka中通过offset查询消息内容的整个流程我们可以简化成下图：</span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;text-align:center;"><img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/640 [4].webp" type="image/webp" data-filename="640.webp" height="118" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;width:677px !important;visibility:visible !important;" width="677"/></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">我们再来复习MySQL（InnoDB）中的索引机制。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">可以说数据库必须有索引，没有索引则检索过程变成了顺序查找，O(n)的时间复杂度几乎是不能忍受的。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">我们非常容易想象出一个只有单关键字组成的表如何使用B+树进行索引，只要将关键字存储到树的节点即可。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">当数据库一条记录里包含多个字段时，一棵B+树就只能存储主键，如果检索的是非主键字段，则主键索引失去作用，又变成顺序查找了。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">这时应该在第二个要检索的列上建立第二套索引。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;"> 这个索引由独立的B+树来组织。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">有两种常见的方法可以解决多个B+树访问同一套表数据的问题，一种叫做聚簇索引（clustered index ），一种叫做非聚簇索引（secondary index）。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">这两个名字虽然都叫做索引，但这并不是一种单独的索引类型，而是一种数据存储方式。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">对于聚簇索引存储来说，行数据和主键B+树存储在一起，辅助键B+树只存储辅助键和主键，主键和非主键B+树几乎是两种类型的树。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">对于非聚簇索引存储来说，主键B+树在叶子节点存储指向真正数据行的指针，而非主键。</span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;text-align:center;"><img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/640 [5].webp" type="image/webp" data-filename="640.webp" height="182" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;width:79% !important;visibility:visible !important;" width="535"/></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">InnoDB使用的是聚簇索引，将主键组织到一棵B+树中，而行数据就储存在叶子节点上，若使用&quot;where id = 14&quot;这样的条件查找主键，则按照B+树的检索算法即可查找到对应的叶节点，之后获得行数据。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">若对Name列进行条件搜索，则需要两个步骤：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">第一步在辅助索引B+树中检索Name，到达其叶子节点获取对应的主键。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">第二步使用主键在主索引B+树种再执行一次B+树检索操作，最终到达叶子节点即可获取整行数据。</span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;text-align:center;"><img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/640 [6].webp" type="image/webp" data-filename="640.webp" height="533" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;width:89% !important;visibility:visible !important;" width="603"/></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Kafka中消息的offset可以类比成InnoDB中的主键，前者是通过offset检索出整条Record的数据，后者是通过主键检索出整条Record的数据。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">InnoDB中通过主键查询数据内容的整个流程建议简化成下图(下半部分)。</span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;text-align:center;"><img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/640 [7].webp" type="image/webp" data-filename="640.webp" height="208" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;height:auto !important;width:677px !important;visibility:visible !important;" width="677"/></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">从上图中我们也可以明显的看到就检索而言，InnoDB中的索引机制比Kafka中的索引机制要简略一点，检索效率应该也是InnoDB获胜，我们将上图中分为左中右三部分来分析：</span></p><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;padding-left:2.2em;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">最左部分：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">ConcurrentSkipListMap和B+树索引的查询时间复杂度都为logN，B+树中的非叶子节点一般也可以都驻留在内存中，我们可以简单的将Kafka中查找baseOffset对应的日志分段和InnoDB中查找对应叶子节点的消耗看做差不多相等的，粗略算作平手。</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">最右部分：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">Kafka中后面通过索引读取分段日志文件的内容是一个页的大小（可以思考下前面提及的“每当写入一定量(由 broker 端参数 log.index.interval.bytes 指定，默认值为 4096，即 4KB)的消息时，偏移量索引文件和时间戳索引文件分别增加一个偏移量索引项和时间戳索引项”），B+树中一个叶子节点也是一个页的大小。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">最后都是从这块内容中查找所要的内容，Kafka中是顺序查找，InnoDB中还会有更有的方式去查找（比如以主键为搜索条件，可以使用Page Directory通过二分法快速定位），这里比较而言，应该是InnoDB小胜。</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">中间部分：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;word-spacing:1px;letter-spacing:1px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align:start;font-size:14px;">显而易见，InnoDB获胜。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:inherit;color:inherit;line-height:inherit;"></span></p></li></ul><blockquote style="margin:1em 0px;padding:10px 15px 10px 1rem;max-width:100%;box-sizing:border-box;overflow-wrap:normal;padding-left:10px;border-left:3px solid rgb(219, 219, 219);color:rgb(129, 145, 152);font-size:0.9em;padding-top:4px;line-height:inherit;border-left-width:6px;border-left-color:rgb(220, 230, 240);background:rgb(242, 247, 251);overflow:auto;word-break:normal;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;">Kafka中通过时间戳索引文件去检索消息的方式可以类比于InnoDB中的辅助索引的检索方式：前者是通过timestamp去找offset，后者是通过索引去找主键，后面两者的过程就和上面的陈述相同。</p></blockquote><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">我们再来思考一个问题：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">既然InnoDB的索引这么厉害，那么作为后起之秀的Kafka不采用呢？</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">我们还要考虑一个问题：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">InnoDB中维护索引的代价比Kafka中的要高。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Kafka中当有新的索引文件建立的时候ConcurrentSkipListMap才会更新，而不是每次有数据写入时就会更新，这块的维护量基本可以忽略，B+树中数据有插入、更新、删除的时候都需要更新索引，还会引来“页分裂”等相对耗时的操作。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Kafka中的索引文件也是顺序追加文件的操作，和B+树比起来工作量要小很多。</span></p><p style="margin:1em 2px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">说到底还是应用场景不同所决定的。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">MySQL中需要频繁地执行CRUD的操作，CRUD是MySQL的主要工作内容，而为了支撑这个操作需要使用维护量大很多的B+树去支撑。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">Kafka中的消息一般都是顺序写入磁盘，再到从磁盘顺序读出（不深入探讨page cache等），他的主要工作内容就是：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">写入+读取，很少有检索查询的操作，换句话说，检索查询只是Kafka的一个辅助功能，不需要为了这个功能而去花费特别太的代价去维护一个高level的索引。</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;font-size:16px;color:rgb(74, 74, 74);line-height:30px;word-spacing:1px;letter-spacing:1px;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space:pre-line;text-align:start;">前面也说过，Kafka中的这种方式是在磁盘空间、内存空间、查找时间等多方面之间的一个折中。</span></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;color:rgb(62, 62, 62);white-space:normal;font-family:-apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing:0.544px;background-color:rgb(255, 255, 255);font-size:14px;word-spacing:2px;text-align:start;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;color:rgb(0, 0, 0);font-size:medium;line-height:normal;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;margin-top:10px;margin-bottom:10px;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;padding-right:1em;padding-left:1em;display:inline-block;color:rgb(89, 89, 89);font-size:15px;letter-spacing:0.5px;text-align:center;"><span style="margin:0px;padding:0.3em 0.5em;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;display:inline-block;border-radius:0.5em;font-size:13px;color:rgb(255, 255, 255);background-color:rgb(95, 156, 239);"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;clear:both;min-height:1em;">近期热文<br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;"/></p></span> </div><div style="margin:0px;padding:20px 10px 10px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;margin-top:-1em;border-width:1px;border-style:solid;border-color:rgb(192, 200, 209);text-align:center;background-color:rgb(239, 239, 239);"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;text-align:left;"><ul style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;padding-left:2.2em;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;margin-bottom:5px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);cursor:pointer;font-size:14px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247487265&amp;idx=1&amp;sn=46029e2d4c630635fd7636141dd90d23&amp;chksm=96cd4f6da1bac67bdf31d2f346e782b00e57a14615f2ea55b2bfbf174643ca76c5d8432240ab&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;cursor:pointer;letter-spacing:0.544px;" target="_blank">面试官问：MySQL的自增ID用完了，怎么办？</a></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;margin-bottom:5px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);cursor:pointer;font-size:14px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247487445&amp;idx=1&amp;sn=2f83d55dcedb359f7df01ac4ca0dc3c2&amp;chksm=96cd4f99a1bac68f1d55e27495b62a8f5d280f32a0c5530402a9842806aed64a961c0b3663c7&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;cursor:pointer;" target="_blank">ArrayList插入1000w条数据之后，我怀疑了jvm...</a></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;overflow-wrap:break-word;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;clear:both;min-height:1em;margin-top:10px;margin-bottom:5px;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwMzY1OTU1NQ==&amp;mid=2247487562&amp;idx=1&amp;sn=acf69453e7540215cbda381d6402609b&amp;chksm=96cd5006a1bad9104de9c521f1e2ac03dc6c16e6b7b8b561b645dde7d45b88777c0701ad9ac0&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(87, 107, 149);text-decoration:underline;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;cursor:pointer;font-size:14px;" target="_blank">蚂蚁二面，面试官问我零拷贝的实现原理，当场懵了…</a></p></li></ul></div></div></div></div></div></div></div></div></div></div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;clear:both;min-height:1em;margin-top:20px;color:rgb(62, 62, 62);white-space:normal;font-family:-apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing:0.544px;background-color:rgb(255, 255, 255);font-size:14px;word-spacing:2px;text-align:center;"><img src="面试官问：为什么MySQL的索引不采用Kafka的索引机制_files/640 [8].webp" type="image/webp" data-filename="640.webp" height="167" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;height:auto !important;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;letter-spacing:0.544px;font-size:16px;visibility:visible !important;width:167px !important;" width="167"/></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;clear:both;min-height:1em;margin-top:5px;margin-bottom:5px;color:rgb(62, 62, 62);font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;white-space:normal;letter-spacing:0.544px;background-color:rgb(255, 255, 255);font-size:14px;word-spacing:2px;text-align:start;line-height:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;letter-spacing:0.544px;white-space:pre-line;color:rgb(120, 172, 254);">最后，分享一份面试宝典</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;letter-spacing:0.544px;white-space:pre-line;color:rgb(61, 167, 66);">《<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;">Java核心知识点整理.pdf</strong>》</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;letter-spacing:0.544px;white-space:pre-line;color:rgb(120, 172, 254);">，覆盖了JVM、锁、高并发、反射、Spring原理、微服务、Zookeeper、数据库、数据结构等等。</span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;clear:both;min-height:1em;margin-top:15px;margin-bottom:15px;letter-spacing:0.544px;background-color:rgb(255, 255, 255);word-spacing:2px;text-align:start;font-size:16px;white-space:pre-line;line-height:30px;color:rgb(74, 74, 74);font-family:Avenir, -apple-system-font, 微软雅黑, sans-serif;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;color:rgb(120, 172, 254);font-size:14px;">获取方式：点“</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;letter-spacing:0.544px;line-height:30px;color:rgb(61, 167, 66);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;">在看</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;color:rgb(120, 172, 254);">”，关注公众号并回复 </span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;color:rgb(61, 167, 66);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;">Java</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;color:rgb(120, 172, 254);"> 领取，更多内容陆续奉上。</span></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;color:rgb(120, 172, 254);font-size:15px;"></span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;clear:both;min-height:1em;color:rgb(62, 62, 62);white-space:normal;font-family:-apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing:0.544px;background-color:rgb(255, 255, 255);font-size:14px;word-spacing:2px;text-align:right;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;overflow-wrap:break-word !important;letter-spacing:0.544px;color:rgb(255, 41, 65);font-family:微软雅黑;font-size:16px;">明天见(｡･ω･｡)ﾉ♡</strong></p></div>
                </div>
                

                
  


                
                

                            </div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 