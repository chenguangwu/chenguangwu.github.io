<html>
<head>
  <title>MNetUtil</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5693"/>
<h1>MNetUtil</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2016/1/2 19:01</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2018/1/8 10:34</i></td></tr>
<tr><td><b>标签：</b></td><td><i>http, util</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>package net.leadtour.util;</div><div><br/></div><div><br/></div><div>import java.io.*;</div><div>import <a href="http://java.net.httpurlconnection/">java.net.HttpURLConnection</a>;</div><div>import <a href="http://java.net.url/">java.net.URL</a>;</div><div>import java.util.Enumeration;</div><div>import java.util.Hashtable;</div><div>import java.util.zip.GZIPOutputStream;</div><div><br/></div><div>public class MNetUtil {</div><div><br/></div><div>    public static String getUrlContent(String destURL) {</div><div>        return getUrlContent(destURL, &quot;&quot;);</div><div>    }</div><div><br/></div><div>    public static String getUrlContent(String destURL, String paramStr) {</div><div>        return getUrlContent(destURL, paramStr, 60);</div><div>    }</div><div><br/></div><div>    public static String getUrlContent(String destURL, String paramStr, int timeout) {</div><div>        return getUrlContent(destURL, paramStr, timeout, &quot;UTF-8&quot;);</div><div>    }</div><div><br/></div><div>    public static String getUrlContent(String destURL, String paramStr, int timeout, String encoding) {</div><div>        return getUrlContent(destURL, paramStr, timeout, encoding, &quot;POST&quot;);</div><div>    }</div><div><br/></div><div>    public static String getUrlContent(String destURL, String paramStr, int timeout, String encoding, String method) {</div><div>        return getUrlContent(destURL, paramStr, timeout, encoding, method, new Hashtable());</div><div>    }</div><div><br/></div><div>    public static String getUrlContent(String destURL, String paramStr, int timeout, String encoding, String method, Hashtable head) {</div><div>        HttpURLConnection httpConn = null;</div><div>        OutputStream out = null;</div><div>        BufferedReader reader = null;</div><div>        try {</div><div>            if (destURL.contains(&quot;https:&quot;)) {</div><div>                SslConnection urlConnect = new SslConnection();</div><div>                httpConn = urlConnect.openConnection(destURL);</div><div>            } else {</div><div>                URL url = new URL(destURL);</div><div>                httpConn = (HttpURLConnection) url.openConnection();</div><div>            }</div><div>            HttpURLConnection.setFollowRedirects(true);</div><div><br/></div><div>            httpConn.setRequestProperty(&quot;content-type&quot;, &quot;text/html&quot;);</div><div>            Enumeration en = head.keys();</div><div>            while (en.hasMoreElements()) {</div><div>                String ok = en.nextElement().toString();</div><div>                httpConn.setRequestProperty(ok, head.get(ok).toString());</div><div>            }</div><div>            httpConn.setRequestMethod(method);</div><div>            httpConn.setConnectTimeout(timeout * 1000);</div><div>            httpConn.setReadTimeout(timeout * 1000);</div><div>            httpConn.setDoOutput(true);</div><div>            httpConn.setDoInput(true);</div><div>            if (&quot;POST&quot;.equals(method)) {</div><div>                out = httpConn.getOutputStream();</div><div>                out.write(paramStr.getBytes(encoding));</div><div>                out.flush();</div><div>                out.close();</div><div>            }</div><div>//             httpConn.connect();</div><div>            StringBuffer buf = new StringBuffer();</div><div>            if (httpConn.getResponseCode() == 500) {</div><div><br/></div><div>                reader = new BufferedReader(new InputStreamReader(httpConn.getErrorStream(), encoding));</div><div>                String line;</div><div>                while ((line = reader.readLine()) != null) {</div><div>                    buf.append(line);</div><div>                    buf.append(&quot;\r\n&quot;);</div><div>                }</div><div>            } else {</div><div>                reader = new BufferedReader(new InputStreamReader(httpConn.getInputStream(), encoding));</div><div>                String line;</div><div>                while ((line = reader.readLine()) != null) {</div><div>                    buf.append(line);</div><div>                    buf.append(&quot;\r\n&quot;);</div><div>                }</div><div><br/></div><div>            }</div><div>            return buf.toString();</div><div>        } catch (Exception ex) {</div><div>            return &quot;&lt;Error&gt;&quot; + ex.toString() + &quot;&lt;/Error&gt;&quot;;</div><div>        } finally {</div><div>            try {</div><div>                httpConn.disconnect();</div><div>            } catch (Exception e) {</div><div><br/></div><div>            }</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div>    public static String getGZIPUrlContent(String destURL, String paramStr, int timeout, String encoding, String method, Hashtable head) {</div><div>        HttpURLConnection httpConn = null;</div><div>        GZIPOutputStream out = null;</div><div>        BufferedReader reader = null;</div><div>        try {</div><div>            URL url = new URL(destURL);</div><div>            httpConn = (HttpURLConnection) url.openConnection();</div><div>            HttpURLConnection.setFollowRedirects(true);</div><div><br/></div><div>            httpConn.setRequestProperty(&quot;content-type&quot;, &quot;text/html&quot;);</div><div>            Enumeration en = head.keys();</div><div>            while (en.hasMoreElements()) {</div><div>                String ok = en.nextElement().toString();</div><div>                httpConn.setRequestProperty(ok, head.get(ok).toString());//)</div><div>            }</div><div>            httpConn.setRequestMethod(method);</div><div>            httpConn.setConnectTimeout(timeout * 1000);</div><div>            httpConn.setReadTimeout(timeout * 1000);</div><div>            httpConn.setDoOutput(true);</div><div>            httpConn.setDoInput(true);</div><div>            if (&quot;POST&quot;.equals(method)) {</div><div>                out = new GZIPOutputStream(httpConn.getOutputStream());</div><div>                out.write(paramStr.getBytes(encoding));</div><div>                out.flush();</div><div>                out.close();</div><div>            }</div><div>            // httpConn.connect();</div><div>            StringBuffer buf = new StringBuffer();</div><div>            if (httpConn.getResponseCode() == 500) {</div><div><br/></div><div>                reader = new BufferedReader(new InputStreamReader(httpConn.getErrorStream(), encoding));</div><div>                String line;</div><div>                while ((line = reader.readLine()) != null) {</div><div>                    buf.append(line);</div><div>                    buf.append(&quot;\r\n&quot;);</div><div>                }</div><div>            } else {</div><div>                reader = new BufferedReader(new InputStreamReader(httpConn.getInputStream(), encoding));</div><div>                String line;</div><div>                while ((line = reader.readLine()) != null) {</div><div>                    buf.append(line);</div><div>                    buf.append(&quot;\r\n&quot;);</div><div>                }</div><div><br/></div><div>            }</div><div>            return buf.toString();</div><div>        } catch (IOException ex) {</div><div>            return &quot;&lt;Error&gt;&quot; + ex.toString() + &quot;&lt;/Error&gt;&quot;;</div><div>        } finally {</div><div>            try {</div><div>                httpConn.disconnect();</div><div>            } catch (Exception e) {</div><div><br/></div><div>            }</div><div>        }</div><div>    }</div><div><br/></div><div>    public static String getUrlXml(String str_url, String string) {</div><div>        HttpURLConnection httpConn = null;</div><div>        PrintWriter out = null;</div><div>        BufferedReader reader = null;</div><div>        try {</div><div>            URL url = new URL(str_url);</div><div>            httpConn = (HttpURLConnection) url.openConnection();</div><div>            HttpURLConnection.setFollowRedirects(true);</div><div>            httpConn.setRequestProperty(&quot;content-type&quot;, &quot;text/xml&quot;);</div><div>            httpConn.setRequestMethod(&quot;POST&quot;);</div><div>            httpConn.setConnectTimeout(450000);</div><div>            httpConn.setReadTimeout(450000);</div><div>            httpConn.setDoOutput(true);</div><div>            httpConn.setDoInput(true);</div><div>            out = new PrintWriter(httpConn.getOutputStream());</div><div>            out.print(string);</div><div>            out.flush();</div><div>            httpConn.connect();</div><div>            reader = new BufferedReader(new InputStreamReader(httpConn.getInputStream()));</div><div>            StringBuffer buf = new StringBuffer();</div><div>            String line;</div><div>            while ((line = reader.readLine()) != null) {</div><div>                buf.append(line);</div><div>                buf.append(&quot;\r\n&quot;);</div><div>            }</div><div><br/></div><div>            return buf.toString();</div><div>        } catch (IOException ex) {</div><div>            return &quot;&lt;Error&gt;&quot; + ex.toString() + &quot;&lt;/Error&gt;&quot;;</div><div>        }</div><div>    }</div><div><br/></div><div><br/></div><div>    public static String SoapRequest(String callurl, String soapAction, String xml) throws Exception {</div><div>        if (xml == null) throw new Exception(&quot;&quot;);</div><div>        if (callurl == null) throw new Exception(&quot;&quot;);</div><div>        // StringReader reader = null;</div><div>        String result = &quot;&quot;;</div><div>        // System.out.println(&quot;UrlAddress:&quot; + callurl);</div><div>        // System.out.println(&quot;SoapAction:&quot; + soapAction);</div><div><br/></div><div>        URL u0 = new URL(callurl);</div><div><br/></div><div>        HttpURLConnection conn = (HttpURLConnection) u0.openConnection();</div><div><br/></div><div>        byte[] contentbyte = xml.getBytes();</div><div><br/></div><div>        conn.setRequestMethod(&quot;POST&quot;);</div><div>        conn.setRequestProperty(&quot;SOAPAction&quot;, soapAction);</div><div>        conn.setRequestProperty(&quot;Content-Type&quot;, &quot;text/xml; charset=utf-8&quot;);</div><div>        conn.setRequestProperty(&quot;Content-Length&quot;, Integer.toString(contentbyte.length));</div><div>        conn.setUseCaches(false);</div><div>        conn.setDoInput(true);</div><div>        conn.setDoOutput(true);</div><div>        OutputStream out = conn.getOutputStream();</div><div>        out.write(contentbyte);</div><div>        out.flush();</div><div>        out.close();</div><div><br/></div><div>        InputStream in = conn.getInputStream();</div><div>        StringBuffer buffer = new StringBuffer();</div><div><br/></div><div>        int i = 0;</div><div>        while (i != -1) {</div><div>            i = in.read();</div><div>            if (i != -1) {</div><div>                buffer.append((char) i);</div><div>            }</div><div>        }</div><div>        in.close();</div><div><br/></div><div>        if (conn.getResponseCode() != 200) {</div><div><br/></div><div>            try {</div><div>                System.in.read();</div><div>            } catch (Exception e) {</div><div>                e.printStackTrace();</div><div>            }</div><div>        } else {</div><div><br/></div><div>        }</div><div>        if (conn.getResponseCode() != 200) {</div><div>            return null;</div><div>        }</div><div><br/></div><div>        // FileOper fileOper = new FileOper();</div><div>        // fileOper.writeInfoToFile(buffer.toString());</div><div>        result = buffer.toString();</div><div><br/></div><div>        try {</div><div>            result = new String(buffer.toString().getBytes(&quot;iso-8859-1&quot;), &quot;utf-8&quot;);</div><div>        } catch (Exception ex) {</div><div>            result = ex.getMessage();</div><div>        }</div><div><br/></div><div>        return result;</div><div><br/></div><div>    }</div><div><br/></div><div>}</div><div><br/></div></span>
</div></body></html> 