<html>
<head>
  <title>表达式处理 - Jevo - 博客园</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="10272"/>
<h1>表达式处理 - Jevo - 博客园</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/3/29 17:06</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://www.cnblogs.com/jevo/archive/2013/04/01/3007268.html"><i>http://www.cnblogs.com/jevo/archive/2013/04/01/3007268.html</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div><div style="font-family:&quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(0, 0, 0);background:url(&quot;/Skins/coffee/images/bg_body.gif&quot;) left top;line-height:1.5;font-size:14px;"><div style="min-width:auto;"><div style="min-width:auto;text-align:left;"><div style="background:transparent;text-align:left;overflow-x:hidden;"><div style="background:url(&quot;/Skins/coffee/images/bg_left.gif&quot;) left top repeat-x rgb(254, 254, 242);"><div><div style="text-overflow:ellipsis;overflow:hidden;word-break:break-all;"><div><div style="line-height:1.5;color:rgb(0, 0, 0);font-size:13px;"><div style="word-break:break-word;"><p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">曾经在一个项目中使用表达式来判断处理一些条件，比如订单价格的折扣计算，库存数量的告警线设置等。我们引入了Jexl（一种表达式语言引擎）来处理这些表达式。这里根据几个例子来总结一下它的应用。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">例一、算式表达式的处理：</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">public class jextTest {<br style="margin:0px;padding:0px;"/>    public static void main(String[] args) {<br style="margin:0px;padding:0px;"/>        //数学公式解析和计算 <br style="margin:0px;padding:0px;"/>        String expression = &quot;(a+b)/c*5&quot;;<br style="margin:0px;padding:0px;"/>        JexlContext jexlContext = new MapContext();<br style="margin:0px;padding:0px;"/>        jexlContext.set(&quot;a&quot;, 4);<br style="margin:0px;padding:0px;"/>        jexlContext.set(&quot;b&quot;, 2);<br style="margin:0px;padding:0px;"/>        jexlContext.set(&quot;c&quot;, 2);<br style="margin:0px;padding:0px;"/>        jexlContext.set(&quot;d&quot;, 5);<br style="margin:0px;padding:0px;"/>        Expression e = (Expression) new JexlEngine().createExpression(expression);<br style="margin:0px;padding:0px;"/>        Number num = (Number) e.evaluate(jexlContext);<br style="margin:0px;padding:0px;"/>        System.out.println(num);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><br style="margin:0px;padding:0px;"/>        expression = &quot;a || b &amp;&amp; c || d&quot;;<br style="margin:0px;padding:0px;"/>        jexlContext = new MapContext();<br style="margin:0px;padding:0px;"/>        jexlContext.set(&quot;a&quot;, true);<br style="margin:0px;padding:0px;"/>        jexlContext.set(&quot;b&quot;, false);<br style="margin:0px;padding:0px;"/>        jexlContext.set(&quot;c&quot;, true);<br style="margin:0px;padding:0px;"/>        jexlContext.set(&quot;d&quot;, false);<br style="margin:0px;padding:0px;"/>        org.apache.commons.jexl2.Expression e1 = new JexlEngine().createExpression(expression);<br style="margin:0px;padding:0px;"/>        Boolean num1 = (Boolean) e1.evaluate(jexlContext);<br style="margin:0px;padding:0px;"/>        System.out.println(num1);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><br style="margin:0px;padding:0px;"/>        JexlEngine jexl = new JexlEngine();<br style="margin:0px;padding:0px;"/>        jexl.setCache(512);//Sets a cache for expressions of the defined size<br style="margin:0px;padding:0px;"/>        jexl.setLenient(false);//Sets whether this engine considers unknown variables, methods and constructors as errors or evaluates them as null or zero.<br style="margin:0px;padding:0px;"/>        jexl.setSilent(false); //Sets whether this engine throws JexlException during evaluation when an error is triggered.<br style="margin:0px;padding:0px;"/>        jexl.setStrict(false); //Sets whether this engine behaves in strict or lenient mode.</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        String calculate = &quot;(a + b) &gt; 10&quot;;<br style="margin:0px;padding:0px;"/>        e = jexl.createExpression(calculate);<br style="margin:0px;padding:0px;"/>        JexlContext context = new MapContext();<br style="margin:0px;padding:0px;"/>        context.set(&quot;a&quot;, &quot;3&quot;);<br style="margin:0px;padding:0px;"/>        context.set(&quot;b&quot;, &quot;5&quot;);<br style="margin:0px;padding:0px;"/>        Object res = e.evaluate(context);//silent为false时evaluate方法会抛异常，为true不抛异常但res为null<br style="margin:0px;padding:0px;"/>        System.out.println(res);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;"><br style="margin:0px;padding:0px;"/>    }<br style="margin:0px;padding:0px;"/>}</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">运行结果如下：</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">15<br style="margin:0px;padding:0px;"/>true<br style="margin:0px;padding:0px;"/>false</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">从上例中可以看出，实现一个表达式的解析运算，共涉及到三个主要类：JexlContext、Expression和JexlEngine。</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">例二、数组取值</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">ublic class ArrayTest {<br style="margin:0px;padding:0px;"/>    public static void main(String[] args) {<br style="margin:0px;padding:0px;"/>        JexlEngine jexl = new JexlEngine();<br style="margin:0px;padding:0px;"/>        JexlContext jc = new MapContext();</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        List l = new ArrayList();<br style="margin:0px;padding:0px;"/>        l.add(&quot;It is from location 0&quot;);<br style="margin:0px;padding:0px;"/>        Integer two = new Integer(2);<br style="margin:0px;padding:0px;"/>        l.add(two);<br style="margin:0px;padding:0px;"/>        jc.set(&quot;array&quot;, l);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        Expression e = jexl.createExpression(&quot;array[1]&quot;);//从array中取数据<br style="margin:0px;padding:0px;"/>        Object o = e.evaluate(jc);<br style="margin:0px;padding:0px;"/>        System.err.println(&quot;Object @ location 1 = &quot; + o);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        e = jexl.createExpression(&quot;array[0]&quot;);//从array中取数据<br style="margin:0px;padding:0px;"/>        o = e.evaluate(jc);<br style="margin:0px;padding:0px;"/>        System.err.println(&quot;Object @ location 0 = &quot; + o);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        e = jexl.createExpression(&quot;array[0].length()&quot;);<br style="margin:0px;padding:0px;"/>        o = e.evaluate(jc);<br style="margin:0px;padding:0px;"/>        System.err.println(&quot;The length of the string at location 0 is :&quot; + o);<br style="margin:0px;padding:0px;"/>    }<br style="margin:0px;padding:0px;"/>}</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">运行结果如下：</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">Object @ location 1 = 2<br style="margin:0px;padding:0px;"/>Object @ location 0 = It is from location 0<br style="margin:0px;padding:0px;"/>The length of the string at location 0 is :21</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">例三、取方法运行</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">public class MethodPropertyTest {<br style="margin:0px;padding:0px;"/>    public static void main(String[] args) {<br style="margin:0px;padding:0px;"/>        JexlEngine jexl = new JexlEngine();<br style="margin:0px;padding:0px;"/>        JexlContext jc = new MapContext();</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        MethodPropertyTest foo = new MethodPropertyTest();<br style="margin:0px;padding:0px;"/>        Integer number = new Integer(10);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        jc.set(&quot;foo&quot;, foo);<br style="margin:0px;padding:0px;"/>        jc.set(&quot;number&quot;, number);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        Expression e = jexl.createExpression(&quot;foo.getFoo()&quot;);<br style="margin:0px;padding:0px;"/>        Object o = e.evaluate(jc);<br style="margin:0px;padding:0px;"/>        System.err.println(&quot;value returned by the method getFoo() is : &quot; + o);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        e = jexl.createExpression(&quot;foo.convert(1)&quot;);<br style="margin:0px;padding:0px;"/>        o = e.evaluate(jc);<br style="margin:0px;padding:0px;"/>        System.err.println(&quot;value of &quot; + e.getExpression() + &quot; is : &quot; + o);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        e = jexl.createExpression(&quot;foo.convert(1+7)&quot;);<br style="margin:0px;padding:0px;"/>        o = e.evaluate(jc);<br style="margin:0px;padding:0px;"/>        System.err.println(&quot;value of &quot; + e.getExpression() + &quot; is : &quot; + o);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        e = jexl.createExpression(&quot;foo.convert(1+number)&quot;);<br style="margin:0px;padding:0px;"/>        o = e.evaluate(jc);<br style="margin:0px;padding:0px;"/>        System.err.println(&quot;value of &quot; + e.getExpression() + &quot; is : &quot; + o);</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">        e = jexl.createExpression(&quot;foo.bar&quot;);<br style="margin:0px;padding:0px;"/>        o = e.evaluate(jc);<br style="margin:0px;padding:0px;"/>        System.err.println(&quot;value returned for the property 'bar' is : &quot; + o);<br style="margin:0px;padding:0px;"/>    }</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">    public String getFoo() {<br style="margin:0px;padding:0px;"/>        return &quot;This is from getFoo()&quot;;<br style="margin:0px;padding:0px;"/>    }</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">    public String get(String arg) {<br style="margin:0px;padding:0px;"/>        return &quot;This is the property &quot; + arg;<br style="margin:0px;padding:0px;"/>    }</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">    public String convert(long i) {<br style="margin:0px;padding:0px;"/>        return &quot;The value is : &quot; + i;<br style="margin:0px;padding:0px;"/>    }<br style="margin:0px;padding:0px;"/>}</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">运行结果如下：</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">value returned by the method getFoo() is : This is from getFoo()<br style="margin:0px;padding:0px;"/>value of foo.convert(1) is : The value is : 1<br style="margin:0px;padding:0px;"/>value of foo.convert(1+7) is : The value is : 8<br style="margin:0px;padding:0px;"/>value of foo.convert(1+number) is : The value is : 11<br style="margin:0px;padding:0px;"/>value returned for the property 'bar' is : This is the property bar</p>
<p style="padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin:10px auto;text-indent:0px;">表达式的处理也可以集成Groovy来处理。相比Jexl来讲，Groovy的功能更强大。</p></div></div></div></div></div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 