<html>
<head>
  <title>TestMongodb</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="11480"/>
<h1>TestMongodb</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2016/11/22 15:24</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2016/11/22 15:25</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>package ali;</div><div><br/></div><div>/*import static com.mongodb.client.model.Filters.*;</div><div>import static com.mongodb.client.model.Updates.*;*/</div><div><br/></div><div>import java.io.File;</div><div>import java.io.FileInputStream;</div><div>import java.io.FileOutputStream;</div><div>import java.io.IOException;</div><div>import java.io.InputStream;</div><div>import java.util.ArrayList;</div><div>import java.util.List;</div><div><br/></div><div>import org.bson.Document;</div><div>import org.bson.types.ObjectId;</div><div><br/></div><div>import com.mongodb.Block;</div><div>import com.mongodb.MongoClient;</div><div>import com.mongodb.client.MongoCollection;</div><div>import com.mongodb.client.MongoCursor;</div><div>import com.mongodb.client.MongoDatabase;</div><div>import com.mongodb.client.gridfs.GridFSBucket;</div><div>import com.mongodb.client.gridfs.GridFSBuckets;</div><div>import com.mongodb.client.gridfs.model.GridFSDownloadByNameOptions;</div><div>import com.mongodb.client.gridfs.model.GridFSFile;</div><div>public class TestMongodb {</div><div>    public static void main(String[] args) throws Exception {</div><div>        MongoClient mongoClient = new MongoClient(&quot;127.0.0.1&quot; , 27017 );</div><div>        MongoDatabase db = mongoClient.getDatabase(&quot;mydb&quot;);</div><div>        MongoCollection&lt;Document&gt; col = db.getCollection(&quot;foo&quot;);</div><div>//        insertM(db);</div><div>        MongoCursor&lt;Document&gt; cursor ;</div><div>        Document doc = new Document();</div><div>        // 查询全部</div><div>        /*cursor = col.find().iterator();</div><div>        try {</div><div>            while (cursor.hasNext()) {</div><div>                System.out.println(cursor.next().toJson());</div><div>            }</div><div>        } finally {</div><div>            cursor.close();</div><div>        }*/</div><div><br/></div><div>        /*// 使用查询条件</div><div>        // 首先导入 import static com.mongodb.client.model.Filters.*;</div><div><br/></div><div>        doc = col.find(eq(&quot;i&quot;, 5)).first(); // i 等于5 的第一个文档</div><div>        System.out.println(doc.toJson());*/</div><div><br/></div><div>        /*cursor = col.find(and(gt(&quot;i&quot;, 5), lte(&quot;i&quot;, 10))).iterator();</div><div><br/></div><div>        try {</div><div>            while (cursor.hasNext()) {</div><div>                System.out.println(cursor.next().toJson());</div><div>            }</div><div>        } finally {</div><div>            cursor.close();</div><div>        }*/</div><div><br/></div><div><br/></div><div>        // 排序</div><div>//        doc = col.find(exists(&quot;i&quot;)).sort(descending(&quot;i&quot;)).first();</div><div>//        System.out.println(doc.toJson());</div><div><br/></div><div>        // 更新一个</div><div>//        import static com.mongodb.client.model.Updates.*;</div><div>//        col.updateOne(eq(&quot;i&quot;, 1), set(&quot;i&quot;, 110));</div><div><br/></div><div>        // 更新多个</div><div>//        UpdateResult updateResult = col.updateMany(lt(&quot;i&quot;, 20), set(&quot;i&quot;, 10));</div><div>//        System.out.println(updateResult.getModifiedCount());</div><div><br/></div><div>        // 删除一个</div><div>//        col.deleteOne(eq(&quot;i&quot;, 10));</div><div><br/></div><div>        // 删除多个</div><div>//        DeleteResult deleteResult = col.deleteMany(lte(&quot;_id&quot;, 10));</div><div>//        System.out.println(deleteResult.getDeletedCount());</div><div><br/></div><div>        // 批量写入操作</div><div>//        List&lt;WriteModel&lt;Document&gt;&gt; writes = new ArrayList&lt;WriteModel&lt;Document&gt;&gt;();</div><div>//        writes.add(new InsertOneModel&lt;Document&gt;(new Document(&quot;_id&quot;, 11)));</div><div>//        writes.add(new InsertOneModel&lt;Document&gt;(new Document(&quot;_id&quot;, 12)));</div><div>//        writes.add(new InsertOneModel&lt;Document&gt;(new Document(&quot;_id&quot;, 13)));</div><div>//        writes.add(new UpdateOneModel&lt;Document&gt;(new Document(&quot;_id&quot;, 1), new Document(&quot;$set&quot;, new Document(&quot;x&quot;, 2))));</div><div>//        writes.add(new DeleteOneModel&lt;Document&gt;(new Document(&quot;_id&quot;, 1)));</div><div>//        writes.add(new ReplaceOneModel&lt;Document&gt;(new Document(&quot;_id&quot;, 3), new Document(&quot;_id&quot;, 3).append(&quot;x&quot;, 4)));</div><div><br/></div><div>//        col.bulkWrite(writes);</div><div><br/></div><div>//        col.drop();</div><div>////</div><div>//        col.bulkWrite(writes, new BulkWriteOptions().ordered(false));</div><div>//        collection.find().forEach(printBlock);</div><div><br/></div><div>        // 删除数据库</div><div>//        db.drop();</div><div><br/></div><div><br/></div><div>//        GridFSBucket gridFSBucket = GridFSBuckets.create(db);</div><div>//        File file = new File(&quot;D:/test.txt&quot;);</div><div>//        if(!file.exists()) file.createNewFile();</div><div>//        InputStream upload = new FileInputStream(file);</div><div>//        ObjectId fileId = gridFSBucket.uploadFromStream(&quot;test.txt&quot;, upload);</div><div>//        System.out.println(&quot;上传成功 fileID：&quot; + fileId);</div><div><br/></div><div>        // 查看上传的文件列表</div><div>//        gridFSBucket.find().forEach(new Block&lt;GridFSFile&gt;() {</div><div>//            @Override</div><div>//            public void apply(final GridFSFile gridFSFile) {</div><div>//                System.out.println(gridFSFile.getFilename());</div><div>//            }</div><div>//        });</div><div><br/></div><div>        // 下载一个文件通过FileId</div><div>//        FileOutputStream streamToDownloadTo = new FileOutputStream(&quot;d:/test3.txt&quot;);</div><div>//        gridFSBucket.downloadToStream(new ObjectId(&quot;5833efd56d660635003ee6ac&quot;), streamToDownloadTo);</div><div>//        streamToDownloadTo.close();</div><div><br/></div><div>        // 通过文件名下载一个文件</div><div>//        streamToDownloadTo = new FileOutputStream(&quot;/tmp/test.txt&quot;);</div><div>//        GridFSDownloadByNameOptions downloadOptions = new GridFSDownloadByNameOptions().revision(0);</div><div>//        gridFSBucket.downloadToStreamByName(&quot;test.txt&quot;, streamToDownloadTo, downloadOptions);</div><div>//        streamToDownloadTo.close();</div><div><br/></div><div>        // 根据FileId重命名和删除文件</div><div>//        gridFSBucket.rename(new ObjectId(&quot;5833efd56d660635003ee6ac&quot;), &quot;test1.txt&quot;);</div><div>//        gridFSBucket.delete(new ObjectId(&quot;5833efd56d660635003ee6ac&quot;));</div><div>    }</div><div><br/></div><div>//    插入</div><div>    private static void insertM(MongoDatabase db) {</div><div>        MongoCollection&lt;Document&gt; col = db.getCollection(&quot;foo1&quot;);</div><div>        // 单个插入</div><div>        Document doc = new Document(&quot;name&quot;, &quot;MongoDB&quot;).append(&quot;type&quot;, &quot;database&quot;);</div><div>        col.insertOne(doc);</div><div>        // 可以把JSON 字符串直接解析成Document</div><div>        doc = Document.parse(&quot;{'name':'Java', 'type':'language'}&quot;);</div><div>        col.insertOne(doc);</div><div><br/></div><div>        // 插入多个文档</div><div>        List&lt;Document&gt; documents = new ArrayList&lt;Document&gt;();</div><div>        for(int i=0; i&lt;10; i++){</div><div>            documents.add(new Document(&quot;i&quot;, i));</div><div>        }</div><div>        col.insertMany(documents);</div><div>    }</div><div><br/></div><div>}</div><div><br/></div></span>
</div></body></html> 