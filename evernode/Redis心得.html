<html>
<head>
  <title>Redis心得</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2535"/>
<h1>Redis心得</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/8/1 14:17</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2019/1/27 12:54</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://note.youdao.com/share/?id=608834b5efabea9f184c99ffb129dbf5&type=note#/"><i>https://note.youdao.com/share/?id=608834b5efabea9f184c99ffb129dbf5&amp;type=note#/</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;position: relative;"><div style="font-stretch:normal;font-family:&quot;\\5FAE软雅黑&quot;, &quot;Microsoft Yahei&quot;, &quot;Helvetica Neue&quot;, &quot;Hiragino Sans GB&quot;, &quot;\\5B8B体&quot;, simsun, &quot;\\9ED1体&quot;, Arial, sans-serif;font-style:normal;font-variant:normal;font-weight:normal;background:rgb(248, 248, 248);font-size:12px;line-height:1.5;overflow:hidden;user-select:none;cursor:default;"><div style="font-stretch:normal;font-family:&quot;\\5FAE软雅黑&quot;, &quot;Microsoft Yahei&quot;, &quot;Helvetica Neue&quot;, &quot;Hiragino Sans GB&quot;, &quot;\\5B8B体&quot;, simsun, &quot;\\9ED1体&quot;, Arial, sans-serif;font-style:normal;font-variant:normal;font-weight:normal;background:rgb(248, 248, 248);font-size:12px;line-height:1.5;overflow:hidden;user-select:none;cursor:default;"><div style="word-break:break-all;"><div style="word-break:break-all;"><div style="font-size:14px;padding:0px;margin:0px;border:0px;word-break:break-all;color:rgb(121, 121, 121);width:100%;border-bottom:1px solid rgb(237, 237, 237);line-height:54px;height:54px;position:relative;background-color:rgb(255, 255, 255);"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;display:inline-block;margin-left:21px;position:absolute;"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;display:inline-block;vertical-align:middle;"><span style="display:inline-block;font-size:1.5em;width:131px;height:22px;cursor:pointer;vertical-align:top;margin-top:16px;"><span></span></span><div style="top:18px;padding:0px;margin:0px;border:0px;word-break:break-all;opacity:0;position:absolute;background-color:rgb(0, 0, 0);cursor:pointer;height:22px;width:131px;"></div></div><div style="height:28px;padding:0px;margin:0px;border:0px;word-break:break-all;width:1px;vertical-align:middle;display:inline-block;position:relative;background:linear-gradient(rgb(255, 255, 255), rgb(231, 231, 231) 30%, rgb(218, 218, 218), rgb(231, 231, 231) 70%, rgb(255, 255, 255));margin-left:15px;"></div></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;margin-left:185px;margin-right:330px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;" title="Redis心得">Redis心得</div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;"></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;display:inline-block;float:right;height:54px;right:20px;position:absolute;top:0px;"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;float:right;height:54px;line-height:54px;"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;display:inline-block;"><span style="margin-left:7px;margin:0px;cursor:pointer;vertical-align:middle;border-color:rgb(51, 126, 213);display:inline-block;padding:7px 17px;border-radius:2px;font-size:12px;background:rgb(57, 141, 238);color:rgb(255, 255, 255);box-sizing:border-box;line-height:28px;background-color:rgb(254, 254, 254);border:1px solid rgb(226, 226, 226);height:28px;font-family:&quot;Microsoft YaHei&quot;, &quot;\\5FAE软雅黑&quot;, &quot;Microsoft JhengHei&quot;, &quot;\\534E文黑体&quot;, arial, sans-serif;position:relative;"><span style="border:0px;margin:0px;padding:0px;display:inline-block;bottom:9px;position:relative;">保存文件到笔记</span></span><div style="word-break:break-all;margin:0px;padding:0px;margin-left:7px;display:inline-block;width:30px;height:26px;border:1px solid rgb(226, 226, 226);line-height:24px;cursor:pointer;"><span style="display:inline-block;vertical-align:top;margin-left:6px;margin-top:7px;width:20px;height:12px;"><span></span></span><div style="top:14px;padding:0px;margin:0px;border:0px;word-break:break-all;opacity:0;position:absolute;background-color:rgb(0, 0, 0);cursor:pointer;height:28px;width:32px;"></div></div></div></div></div><div style="width:100%;padding:0px;margin:0px;border:0px;word-break:break-all;opacity:1;height:6px;top:55px;z-index:504;position:absolute;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(rgba(0, 0, 0, 0.0980392)), to(transparent));"></div></div><div style="display:inline-block;word-break:break-all;overflow:auto;padding:0px;width:1064px;margin:0px;border:0px;padding-top:10px;position:relative;overflow-y:auto;height:509px;"><div style="word-break:break-all;width:620px;margin:0px auto;padding:70px 90px;position:relative;min-height:1000px;background-color:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.0588235) 0px 1px 10px 2px;border:1px solid rgb(229, 229, 229);box-sizing:content-box;"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;display:block;position:relative;width:100%;overflow-x:hidden;height:100%;user-select:text;"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;position:relative;"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;position:relative;font-size:24px;color:rgb(34, 34, 34);font-weight:100;width:600px;margin-bottom:30px;" title="Redis心得">Redis心得</div></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;position:relative;z-index:100;"><div style="min-width:100%;margin-top:9px;padding-left:0px;box-sizing:border-box;border:0px;margin:0px;padding:0px;height:5800px;position:relative;"><div style="font-size: 16px; display: inline-block; min-width: 100%;"><div style="overflow:auto;pointer-events:none;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:keep-all;word-wrap:break-word;font-size:100%;text-size-adjust:100%;line-height:1.75;text-rendering:optimizeLegibility;">
<div style="margin:0px;padding:0px;overflow:visible;pointer-events:none;position:relative;padding-bottom:3px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:keep-all;word-wrap:break-word;"><div style="overflow:visible;display:block;min-height:100%;pointer-events:all;box-sizing:border-box;outline:0px;padding:0px;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;overflow-y:visible;overflow-x:scroll;word-wrap:break-word;">
<div style="font-size:14px;display:block;min-height:100%;pointer-events:all;box-sizing:border-box;outline:0px;overflow:visible;padding:0px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;background-color:inherit;overflow-y:visible;overflow-x:scroll;word-wrap:break-word;"><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:inherit;font-size:22px;font-weight:bold;">阐述</span></div><ul style="margin:0px;background-color:inherit;list-style-type:disc;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;"><li style="background-color:inherit;list-style-position:inside;">为什么使用Redis？</li><li style="background-color:inherit;list-style-position:inside;">使用Redis有什么缺点？</li><li style="background-color:inherit;list-style-position:inside;">单线程的Redis为什么这么快？</li><li style="background-color:inherit;list-style-position:inside;">Redis的数据类型，以及每种数据类型的使用场景</li><li style="background-color:inherit;list-style-position:inside;">Redis的过期策略以及内存淘汰机制</li><li style="background-color:inherit;list-style-position:inside;">Redis和数据库双写一致性问题</li><li style="background-color:inherit;list-style-position:inside;">如何应对缓存穿透和缓存雪崩问题</li><li style="background-color:inherit;list-style-position:inside;">任何解决Redis的并发竞争Key问题</li></ul><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:inherit;font-size:22px;font-weight:bold;">为什么使用Redis</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;">项目中使用Redis，主要从<span style="background-color:#ffffff;color:#333333;font-weight:bold;">性能和并发。</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;">当然，Redis还具备分布式锁等其他功能，如果只是为了分布式这些其他功能，完全还有其他中间件，比如ZooKeeper等代替，并非部署非要使用Redis,</div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;">redis的线程模型是单线程模型，采用的是IO多路复用技术，每个redis-cli产生的socker都会被被监听，当哪一个socker准备好了产生事件，都会把产生事件的socker放到一个队列里面去，通过这个队列有序、同步，每次读取一个套接字处理socker</div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:inherit;font-size:22px;font-weight:bold;">性能</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:#ffffff;color:#333333;">如下图所示，我们在碰到需要执行耗时特别久，且结果不频繁变动的SQL，就特别适合将运行结果放入缓存。这样，后面的请求就去缓存中读取，使得请求能够迅速响应。</span></div><div style="background-color:inherit;padding:5px 0px;line-height:1;"><img src="Redis心得_files/Image.png" type="image/png" data-filename="Image.png" height="240" style="cursor:pointer;background-color:inherit;border:0px;display:inline-block;margin-top:8px;max-width:100%;height:auto;width:620px;" width="620"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;">题外话：迅速影响的标准，根据交互效果不同，这个响应时间没有固定标准。</div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;">在理想状态下，我们页面跳转需要在瞬间解决，<span style="background-color:#ffffff;color:#333333;">对于页内操作则需要在刹那间解决。</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:#ffffff;color:#333333;">另外，超过一弹指的耗时操作要有进度提示，并且可以随时中止或取消，这样才能给用户最好的体验</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:inherit;font-size:22px;font-weight:bold;">并发</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:#ffffff;color:#333333;">如下图所示，在大并发的情况下，所有的请求直接访问数据库，数据库会出现连接异常。</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:#ffffff;color:#333333;">这个时候，就需要使用Redis做一个缓冲操作，让请求先访问到Redis，而不是直接访问数据库。</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;padding:5px 0px;line-height:1;"><img src="Redis心得_files/Image [1].png" type="image/png" data-filename="Image.png" height="309" style="cursor:pointer;background-color:inherit;border:0px;display:inline-block;margin-top:8px;max-width:100%;height:auto;width:555px;" width="555"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:inherit;font-size:22px;font-weight:bold;">使用Redis有什么缺点</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">常见的四个问题</span></div><ul style="margin:0px;background-color:inherit;list-style-type:disc;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;"><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">缓存和数据库双写一致性问题</span></li><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">缓存雪崩问题</span></li><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">缓存击穿问题</span></li><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">缓存的并发竞争问题</span></li></ul><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:#ffffff;color:#333333;">这四个问题，我个人觉得在项目中是常遇见的，具体解决方案，后文给出。</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:inherit;font-size:22px;font-weight:bold;">单线程的Redis为什么这么快</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:#ffffff;color:#333333;">这个问题是对Redis内部机制的一个考察。根据我的面试经验，很多人都不知道Redis是单线程工作模型。所以，这个问题还是应该要复习一下的。</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:inherit;font-weight:bold;">回答：</span></div><ul style="margin:0px;background-color:inherit;list-style-type:disc;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;"><li style="background-color:inherit;list-style-position:inside;">纯内存操作</li><li style="background-color:inherit;list-style-position:inside;">单线程操作，避免了频繁的上下文切换</li><li style="background-color:inherit;list-style-position:inside;">采用了非阻塞I/O多路复用机制</li></ul><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;">打一个比方：<span style="background-color:#ffffff;color:#333333;">小曲在S城开了一家快递店，负责同城快送服务。小曲因为资金限制，雇佣了一批快递员，然后小曲发现资金不够了，只够买一辆车送快递。</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">经营方式一</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">客户每送来一份快递，小曲就让一个快递员盯着，然后快递员开车去送快递。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">慢慢的小曲就发现了这种经营方式存在下述问题：</span></div><ul style="margin:0px;background-color:inherit;list-style-type:disc;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;"><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">几十个快递员基本上时间都花在了抢车上了，大部分快递员都处在闲置状态，谁抢到了车，谁就能去送快递。</span></li><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">随着快递的增多，快递员也越来越多，小曲发现快递店里越来越挤，没办法雇佣新的快递员了。</span></li><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">快递员之间的协调很花时间。</span></li></ul><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">综合上述缺点，小曲痛定思痛，提出了下面的经营方式。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">经营方式二</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">小曲只雇佣一个快递员。然后呢，客户送来的快递，小曲按送达地点标注好，然后依次放在一个地方。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">最后，那个快递员依次的去取快递，一次拿一个，然后开着车去送快递，送好了就回来拿下一个快递。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">上述两种经营方式对比，是不是明显觉得第二种，效率更高，更好呢？</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">在上述比喻中：</span></div><ul style="margin:0px;background-color:inherit;list-style-type:disc;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;"><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">每个快递员→每个线程</span></li><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">每个快递→每个Socket(I/O流)</span></li><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">快递的送达地点→Socket的不同状态</span></li><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">客户送快递请求→来自客户端的请求</span></li><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">小曲的经营方式→服务端运行的代码</span></li><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">一辆车→CPU的核数</span></li></ul><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">于是我们有如下结论：</span></div><ul style="margin:0px;background-color:inherit;list-style-type:disc;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;"><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">经营方式一就是传统的并发模型，每个I/O流（快递）都有一个新的线程（快递员）管理。</span></li><li style="background-color:inherit;text-align:justify;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">经营方式二就是I/O多路复用，只有单个线程（一个快递员），通过跟踪每个I/O流的状态（每个快递的送达地点），来管理多个I/O流</span></li></ul><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">下面类比到真实的Redis线程模型，如图所示：</span></div><div style="background-color:inherit;padding:5px 0px;line-height:1;"><img src="Redis心得_files/Image [2].png" type="image/png" data-filename="Image.png" height="254" style="cursor:pointer;background-color:inherit;border:0px;display:inline-block;margin-top:8px;max-width:100%;height:auto;width:620px;" width="620"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">简单来说，就是我们的Redis-client在操作的时候，会产生具有不同事件类型的Socket。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">在服务端，有一段I/O多路复用程序，将其置入队列之中。然后，文件事件分派器，依次去队列中取，转发到不同的事件处理器中。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">需要说明的是，这个I/O多路复用机制，Redis还提供了Select、Epoll、Evport、Kqueue等多路复用函数库，大家可以自行去了解。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">Redis的数据类型与每种数据类型的使用场景</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">是不是觉得这个问题很基础？我也这么觉得。然而根据面试经验发现，至少百分之八十的人答不上这个问题。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;line-height:1.5999999999999999;font-weight:normal;font-size:14px;text-decoration:none;color:rgb(57, 57, 57);font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">建议，在项目中用到后，再类比记忆，体会更深，不要硬记。基本上，一个合格的程序员，五种类型都会用到。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">String</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">这个没啥好说的，最常规的set/get操作，Value可以是String也可以是数字。一般做一些复杂的计数功能的缓存。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">Hash</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">这里Value存放的是结构化的对象，比较方便的就是操作其中的某个字段。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">我在做单点登录的时候，就是用这种数据结构存储用户信息，以CookieId作为Key，设置30分钟为缓存过期时间，能很好的模拟出类似Session的效果。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">List</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">使用List的数据结构，可以做简单的消息队列的功能。另外还有一个就是，可以利用lrange命令，做基于Redis的分页功能，性能极佳，用户体验好。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">Set</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;">因为Set堆放的是一堆不重复值的集合，所以可以做全局去重功能，为什么不用JVM自带的Set进行去重</div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;">因为我们的系统一般都是集群部署，使用JVM自带SET，比较麻烦，<span style="background-color:#ffffff;color:#333333;">难道为了一个做一个全局去重，再起一个公共服务，太麻烦了。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;">另外，就是利用交集，并集，差集等操作，可以计算共同喜好，全部的喜好，自己独有的喜好等功能</div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">Sorted Set</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;">Sorted Set 多了一个权重参数Score,集合中的元素能够按Score进行排列。</div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;">可以做排行榜应用，取TOP N 操作，Sorted Set 可以用来做延时任务，最后一个应用就是可以做范围查找</div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:inherit;font-size:22px;font-weight:bold;">Redis 的过期策略以及内存淘汰机制</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">这个问题相当重要，到底Redis有没用到家，这个问题就可以看出来。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">比如你Redis只能存5G数据，可是你写了10G，那会删5G的数据。怎么删的，这个问题思考过么？</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">还有，你的数据已经设置了过期时间，但是时间到了，内存占用率还是比较高，有思考过原因么?</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">回答：Redis采用的是定期删除+惰性删除策略。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">为什么不用定时删除策略</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">定时删除，用一个定时器来负责监视Key，过期则自动删除。虽然内存及时释放，但是十分消耗CPU资源。</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;">如果在大并发请求下，CPU要将时间应用在处理请求，而不是删除KEY，因此没有采用这一策略。</div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">定期删除+惰性删除是如何工作？</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;">定期删除，Redis默认每个100ms检查，是否有过期的KEY，有过期KEY责要删除</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;">惰性删除：在获取某个KEY时进行检查，判断是否过期，如果过期就会删除。</div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">采用定期删除+惰性删除就没有其他问题了么？</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;font-size:15px;color:#333333;font-weight:bold;">注意：</span>如果定期删除没有删除KEY，然后也没能及时去获取请求的KEY，也就是说惰性删除也没有生效，这样，Redis的内存会越来越高，那么就应答采用内存淘汰机制。</div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">在redis.conf中有一行配置：</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:inherit;color:#999999;font-weight:bold;">#</span><span style="background-color:inherit;color:#333333;"> maxmemory-policy volatile-lru</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><br style="background-color:inherit;"/></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">该配置就是配内存淘汰策略的：</span></div><div style="font-style:normal;background-color:inherit;white-space:pre-wrap;color:rgb(57, 57, 57);font-weight:normal;font-size:14px;text-decoration:none;line-height:1.75;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;word-break:normal;text-align:justify;"><span style="background-color:#ffffff;color:#333333;font-weight:bold;">allkeys-lru:当内存不足以容纳新写入数据时，在健空间中移除最近最少使用的KEY。</span></div><ul style="margin:0px;background-color:inherit;list-style-type:disc;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;"><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">noeviction：当内存不足以容纳新写入数据时，新写入操作会报错。应该没人用吧。</span></li><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的Key。推荐使用，目前项目在用这种。</span></li><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">allkeys-random：当内存不足以容纳新写入数据时，在键空间中，随机移除某个Key。应该也没人用吧，你不删最少使用Key，去随机删。</span></li><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">volatile-lru：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，移除最近最少使用的Key。这种情况一般是把Redis既当缓存，又做持久化存储的时候才用。不推荐。</span></li><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">volatile-random：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，随机移除某个Key。依然不推荐。</span></li><li style="background-color:inherit;list-style-position:inside;"><span style="background-color:#ffffff;color:#333333;">volatile-ttl：当内存不足以容纳新写入数据时，在设置了过期时间的键空间中，有更早过期时间的 Key优先移除。不推荐。</span></li></ul><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><span style="background-color:inherit;font-size:22px;font-weight:bold;">任何应对缓存穿透和缓存雪崩问题</span></div><div style="background-color:inherit;font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;PingFang SC&quot;, Helvetica, Tahoma, Arial, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, 微软雅黑, SimSun, 宋体, Heiti, 黑体, sans-serif;color:rgb(57, 57, 57);font-weight:normal;font-style:normal;text-decoration:none;line-height:1.75;white-space:pre-wrap;word-break:normal;"><br style="background-color:inherit;"/></div></div>


</div></div></div></div></div></div></div></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;"></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;height:60px;color:rgb(153, 153, 153);font-size:12px;text-align:center;"><p style="border:0px;font-size:100%;vertical-align:baseline;margin:0px;padding:0px;padding-top:19px;">本内容由用户通过“有道云笔记”发布，并不代表有道的立场</p></div></div><div style="background-color:rgb(255, 255, 255);top:55px;font-size:12px;border-left:1px solid rgb(237, 237, 237);border-right:1px solid rgb(237, 237, 237);position:absolute;box-sizing:border-box;right:0px;display:inline-block;user-select:text;word-break:break-all;border:0px;margin:0px;padding:0px;height:524px;"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;position:absolute;top:20px;right:20px;height:80px;width:260px;background-color:rgb(255, 255, 255);"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;width:100%;height:30px;"><img src="Redis心得_files/Image [3].png" type="image/png" data-filename="Image.png" height="30" style="border:0px;margin:0px;padding:0px;position:relative;width:30px;height:30px;border-radius:50%;user-select:none;vertical-align:middle;" width="30"/><p style="text-overflow:ellipsis;padding:0px;margin:0px;border:0px;overflow:hidden;white-space:nowrap;margin-left:10px;display:inline-block;vertical-align:middle;font-size:12px;max-width:220px;line-height:30px;" title="Scarcity_">Scarcity_</p></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;margin-top:16px;width:260px;font-size:12px;color:rgb(137, 137, 137);height:18px;"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;display:inline-block;height:18px;float:left;"><span style="width:14px;height:14px;margin-top:3px;"><span></span></span><span style="border:0px;margin:0px;padding:0px;display:inline-block;vertical-align:top;margin-left:5px;"><span style="border:0px;margin:0px;padding:0px;">(</span><span style="border:0px;margin:0px;padding:0px;">29</span><span style="border:0px;margin:0px;padding:0px;">)</span></span></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;display:inline-block;height:18px;margin-left:10px;"><span style="width:14px;height:14px;margin-top:3px;cursor:pointer;display:inline-block;"><span></span></span><div style="cursor:pointer;background-color:rgb(0, 0, 0);position:absolute;padding:0px;margin:0px;border:0px;opacity:0;word-break:break-all;top:49px;height:14px;width:14px;display:block;"></div><span style="border:0px;margin:0px;padding:0px;display:inline-block;vertical-align:top;margin-left:5px;"><span style="border:0px;margin:0px;padding:0px;">(</span><span style="border:0px;margin:0px;padding:0px;">0</span><span style="border:0px;margin:0px;padding:0px;">)</span></span></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;display:inline-block;height:18px;float:right;"><span style="border:0px;margin:0px;padding:0px;"><span style="border:0px;margin:0px;padding:0px;">分享于 </span><span style="border:0px;margin:0px;padding:0px;">2018.08.01</span></span></div></div></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;width:300px;height:1px;background-color:rgb(237, 237, 237);position:absolute;top:100px;"></div><div style="word-break:break-all;border:0px;padding:0px;margin:98px 0px 0px;overflow:scroll;padding-top:24px;width:300px;font-size:12px;height:317px;"><div style="word-break:break-all;border:0px;margin:0px;padding:0px;margin-left:20px;"><span style="border:0px;margin:0px;padding:0px;font-size:12px;float:left;color:rgb(89, 89, 89);">评论</span><div style="word-break:break-all;border:0px;margin:0px;padding:0px;width:260px;margin-top:20px;"></div></div></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;width:298px;height:80px;position:absolute;bottom:0px;"><img src="Redis心得_files/Image [4].png" type="image/png" data-filename="Image.png" height="80" style="border:0px;margin:0px;padding:0px;width:100%;height:100%;" width="298"/><div style="right:20px;padding:0px;margin:0px;border:0px;word-break:break-all;top:24px;height:32px;cursor:pointer;background-color:rgb(57, 141, 238);position:absolute;border-radius:2px;width:78px;"><p style="border:0px;vertical-align:baseline;margin:0px;padding:0px;color:rgb(255, 255, 255);font-size:14px;text-align:center;line-height:32px;">立即下载</p></div></div></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;"></div><div style="word-break:break-all;border:0px;margin:0px;padding:0px;"></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 