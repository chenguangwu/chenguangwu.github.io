<html>
<head>
  <title>腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4153"/>
<h1>腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/9/19 17:03</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://www.toutiao.com/a6602366177677148676/?tt_from=weixin&utm_campaign=client_share&wxshare_count=1&timestamp=1537318869&app=news_article&utm_source=weixin&iid=41835569894&utm_medium=toutiao_android&group_id=6602366177677148676"><i>https://www.toutiao.com/a6602366177677148676/?tt_from=weixin&amp;utm_campaign=client_share&amp;wxshare_count=1&amp;timestamp=1537318869&amp;app=news_article&amp;utm_source=weixin&amp;iid=41835569894&amp;utm_medium=toutiao_android&amp;group_id=6602366177677148676</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;line-height:1.15;text-size-adjust:100%;"><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-family:&quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif;font-size:12px;line-height:1.5;color:rgb(101, 113, 128);background-color:rgb(255, 255, 255);-webkit-font-smoothing:antialiased;"><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;zoom:1;"><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"><h1 style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;font-size:34px;font-weight:700;line-height:44px;color:rgb(34, 34, 34);">腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍</h1> <div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;margin-top:12px;margin-bottom:20px;font-size:13px;"> <span style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;color:rgb(119, 119, 119);margin-right:2px;">程序员小新人学习</span> <span style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;color:rgb(119, 119, 119);margin-right:2px;">2018-09-18 09:12:46</span></div> <div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;margin-bottom:24px;font-size:16px;line-height:28px;color:rgb(34, 34, 34);word-wrap:break-word;"><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;font-size:16px;line-height:28px;color:rgb(34, 34, 34);word-wrap:break-word;"><blockquote style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:1em 0px;padding:12px 10px;position:relative;font-size:16px;line-height:1.5;color:rgb(153, 153, 153);background:rgb(244, 245, 246);border:1px solid rgb(232, 232, 232);"><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;">近日，腾讯宣布正式开源 Tars 的 Golang 版本 Tars-Go，其并发性能比 gRPC 的高 5 倍。</p></blockquote><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">Tars 是腾讯开源的一款微服务框架，它于去年 4 月份开源，并于今年 6 月捐赠给了 Linux 基金会。Tars 为用户提供了涉及到开发和运维的一整套解决方案，帮助一个产品或者服务快速开发、发布、部署、上线和维护。它集可扩展协议编解码、高性能 RPC 通信框架、名字路由与发现、发布监控、日志统计、配置管理等于一体，通过它可以快速用微服务的方式构建稳定可靠的分布式应用，并实现完整有效的服务治理。经过一年多的发展，目前 Tars 已经被许多企业使用，如阅文集团、虎牙直播、科大讯飞，优品财富、龙图游戏和金太阳教育等。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">9 月 15 日，腾讯宣布正式开源 Tars 的 Golang 版本 Tars-Go。编者从 Tars-Go 的开源公告中了解到其技术架构、性能数据与相关技术细节，本文参考 Tars 开源团队核心成员陈明杰的演讲 PPT 《亿级规模高可用架构源码剖析——腾讯 Go 语言开发框架 TARS-GO》 进行了整理。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">项目地址：<u style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;">https://github.com/TarsCloud/TarsGo</u></p><h1 style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;font-size:24px;margin:36px 0px 22px;font-weight:700;line-height:32px;color:rgb(34, 34, 34);"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">支持服务治理、多语言，只 Tars 一家</strong></h1><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">微服务架构这两年变得格外火热，它已经成为当前最主流的架构模式。提起微服务框架，我们可以自然地举出 Dubbo、gRPC 与 Spring Cloud 等众多的知名项目，依据<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">是否支持服务治理</strong>和<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">是否支持多语言</strong>两个维度可将这些微服务框架分为以下四类：</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/1537233142327d0437412a7.jpg" type="image/jpeg" data-filename="1537233142327d0437412a7.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="321" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><ul style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:20px 30px;list-style:square outside;color:rgb(34, 34, 34);"><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">只有服务调用没有服务治理类的框架</strong>。典型的代表有 gRPC、Thrift 等，他们很好地解决了服务间通信的问题，大部分也支持多语言，但使用这类框架时需要自己去解决服务治理问题。</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">带服务治理但支持单一语言的框架</strong>。典型的代表有 Spring Cloud 和 Dubbo，它们都是用 Java 实现的框架，用户整合多个开源项目一起并能满足服务治理等的需求。</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">Service Mesh。</strong>它支持服务治理，并通过 Sidecar 模式解决框架对多语言支持，业务需要再封装一套通讯组件去解决通讯问题，以及异步调用等问题，同时会增加架构和维护的复杂度。</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">带服务治理并支持多语言的框架</strong>。目前业界比较少，除了 Tars 目前还没有发现其它具有代表性的框架。</li></ul><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">从上面的分析大概可以发现，Tars 是支持服务治理的同时又提供多语言支持的微服务框架，这是 Tars 的独特之处，也是其优势。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">Tars 可以运行在物理机、虚拟机和容器，其协议主打的是基于 IDL 实现的 Tars 协议，它是一种二进制解析协议，与 pb 类似，同时 Tars 还扩展支持其它协议，乃至用户自定义。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">调用方式主要以 RPC 为主，支持同步、异步和单向调用几种方式。在服务治理方面除了支持服务注册、发现等业界常说的能力之外，还提供面对海量访问的一些其它治理能力，如 Set 模型、自动区域感知、过载保护等，语言上除了此次新支持的 Golang，目前已经支持了 C++、Java、NodeJS 与 PHP，同时整体框架可以和 DevOps 很好地协同工作。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">Tars 整体分为三个部分：Registry、服务节点和基础服务集群。</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/1537233142383b1c08d31d2.jpg" type="image/jpeg" data-filename="1537233142383b1c08d31d2.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="287" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">Registry</strong></p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">Registry 是微服务集群的管理和控制节点，提供服务注册和发现等功能。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">服务节点</strong></p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">服务节点是 Tars 运行的原子单元，可以是一个容器也可以是一个虚机或物理机，一个业务服务通过部署多个服务节点来解决容量和容错问题。服务节点上包括一个 node 管理服务和一个或多个业务服务，node 服务对本节点的服务进行统一管理，提供启停、监控服务节点等功能，同时接收业务服务节点上报过来的心跳，上报给 Registry 作为服务发现的数据来源。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">基础服务集群</strong></p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">基础服务集群是为解决微服务治理而设计的一系列服务，服务节点数量不定，为了自身的容错容灾，一般也要求在多个服务器上进行部署，具体的节点数量与业务规模有关，比如，如果业务规模大需要打较多的日志，就需要部署更多的日志服务节点。基础服务主要包括监控统计、配置中心、日志聚合、认证鉴权和分布式调用链等。Tars 具有非常完善的<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">服务治理</strong>能力。</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/1537233142352c2e1b29f32.jpg" type="image/jpeg" data-filename="1537233142352c2e1b29f32.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="308" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">Tars 通过 Registry、服务节点和基础服务集群协同工作，透明完成服务发现/注册、负载均衡、鉴权、分布式跟踪等服务治理相关工作。如框架通过 Registry 来注册 xxxsvr，Client 通过访问 Registry 获取到被调服务的地址信息列表，Client 再根据需要选择合适的负载均衡方式来调用服务。负载均衡支持轮询、hash、权重等多种方式。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">为了更及时地<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">屏蔽故障节点</strong>，Client 根据调用被调服务的异常情况判断是否有故障来更快地进行故障屏蔽。具体策略是，当 Client 调用某个服务器出现调用连续超时超过设置阈值，或者调用的超时比率超过一定百分比阈值，Client 就会对此服务器节点进行屏蔽，让流量分发到正常的节点上去。对屏蔽的服务器节点，每隔一定时间进行重连，如果正常，则进行正常的流量分发。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">随着业务增长，服务的部署难免会跨机房或者地域，常规的负载均衡方式面对跨地区或者跨机房部署的服务会因为网络原因造成延时增大，为了加快服务间的访问速度，减少因建设跨地区、跨机房调用带来的网络资源消耗，减少网络故障带来的影响，Tars 提供<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">自动区域感知</strong>的服务治理功能。</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/153723314229242c0cdd009.jpg" type="image/jpeg" data-filename="153723314229242c0cdd009.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="348" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">通过 Registry 和开发框架配合实现自动区域感知，这样的优势有：</p><ul style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:20px 30px;list-style:square outside;color:rgb(34, 34, 34);"><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">运维简单</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">降低延时减少带宽消耗</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">更强的容灾能力</li></ul><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">此外 Tars 还提供 <strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">Set 模型</strong>。</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/153723314260551cbd122d3.jpg" type="image/jpeg" data-filename="153723314260551cbd122d3.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="303" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">Set 模型是根据业务功能特征对部署进行规范化和标准化，以 Set 为单元进行部署。Set 模型的优点有：</p><ul style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:20px 30px;list-style:square outside;color:rgb(34, 34, 34);"><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">有效防止故障扩散</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">方便进行容量管理</li></ul><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">对于<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">流量控制</strong>，服务发布上线主要面对的问题是“如何做对业务无损的服务变更”与“如何做灰度验证”，在 Tars 中，可通过 Registry 和开发框架配合实现按需进行流量控制，达到无损发布和灰度流量的目的。</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/1537233142323a5b918af8f.jpg" type="image/jpeg" data-filename="1537233142323a5b918af8f.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="397" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">语言支持</strong>方面，除了此前已经支持的 PHP、C++、NodeJS 与 Java，此次还加入了 Golang 支持。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">此外，Tars 还提供一个 OSS 平台，可使运营可视化、Web 化。</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/1537233142570e72773de1a.jpg" type="image/jpeg" data-filename="1537233142570e72773de1a.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="309" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">它主要包含以下特点：</p><ul style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:20px 30px;list-style:square outside;color:rgb(34, 34, 34);"><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">业务管理：包括已部署的服务，以及服务管理、发布管理、服务配置、服务监控、特性监控等</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">运维管理：包括服务部署、扩容、模版管理等</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">提供 Open API ，可定制自己的 OSS 系统</li></ul><h1 style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;font-size:24px;margin:36px 0px 22px;font-weight:700;line-height:32px;color:rgb(34, 34, 34);"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">Tars-Go，Tars Go！</strong></h1><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">多语言支持是 Tars 的一大优势，在此之前 Tars 已经推出了 C++、Java、PHP、NodeJS 版本。Go 语言的协程并发机制使它非常适用于大规模高并发后端服务器程序开发，同时随着容器化技术的飞速发展，诸如 Docker、Kubernetes 与 Etcd 等项目兴起，使得 Go 语言越来越流行，并成为云原生的首选语言。Tars 的 Go 语言版本也因此应运而生，此次 Tars-Go 的推出，在大环境整体逐渐走向云原生的当下，意义非凡。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">此次新推出的 Go 版本 Tars-Go 整体架构主要可以分为三个部分，如下图所示：</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/1537233142706e20e15566d.jpg" type="image/jpeg" data-filename="1537233142706e20e15566d.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="335" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><ul style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:20px 30px;list-style:square outside;color:rgb(34, 34, 34);"><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">左边是 <strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">tars2go 工具</strong>，tars2go 基于巴科斯范式（BNF），这是一种描述程序语言结构的形式化方法，用来对 Tars 文件进行语法和词法分析，生成相应的代码，供客户端和服务端使用。同时它提供 Tars 协议二进制流的编解码功能，将二进制包转成相应的 Go 数据结构。</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">右边部分是<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;"> package tars</strong>，它包含了 <strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">Client</strong> 和<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;"> Server</strong> 两部分的功能：</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">Client 由 Servantproxy、Communicator、ObjProxy、adapterproxy 等逻辑结构组成，这些逻辑结构用来管理 servant，obj 对应到的服务端节点的 ip 端口，和 C++ 的逻辑保持一致。底层使用 net.Conn 来建立具体的连接，并用 SendQueue chan 来控制并发数量。Client 还包含一些 Goroutine，用来做特性监控和 stat 监控上报。</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">Server 使用 package net 的 listener 来管理 TCP 和 UDP 连接，使用多个 Goroutine 进行 accept，并将 accept 之后的 net.Conn 经过 SendQueue chan 交给后端的 Handler 进行处理。Handler 由一堆 woker Goroutine 组成，每个 Goroutine 基于 net.Conn 进行收发包、Tars 协议解码，并经过 dispatcher（由 tars2go 生成） 来调用用户的代码实现，然后将结果编码成二进制流返回给 Client。Server 也包含一些 Goroutine 实现远程日志异步上报等功能，防止同步调用阻塞请求。</li></ul><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">编者了解到，Tars 开源团队在研发 Tars-Go 的过程中经历的对其各个方面的<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">性能调优</strong>改造，Tars-Go 在早先的版本注重于功能的开发和完善，没有体系化地进行压测和性能分析。在业务使用一段时间后，开始注重性能优化。Tars 开源团队对 tars2go 工具先进行了一轮优化，在生成语树的时候生成好了类型信息，避免使用反射进行类型判断，编解码的效率提升了 2 倍，然后对再对整体 servant 进行了一轮轮压测，并进行 CPU profile 性能分析。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">下面是性能提升优化的几个实例：</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">Timer 性能问题</strong></p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">每个请求进来，Tars-Go 会创建一个协程进行处理，因为要处理调用超时，会创建一个 timer，在结束的时候会删掉 timer，当并发量一上来，就会频繁创建和删除 timer，占用服务大量 CPU 时间。</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/153723314265617c30fa5d7.jpg" type="image/jpeg" data-filename="153723314265617c30fa5d7.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="428" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">研发团队在一个 issue 中发现 ，在多 CPU 的场景下，如果存在大量的 timer，性能就会大量损耗，优化方式是每个 p 有自己的 timer，这样可以大幅提升整体并发性能。于是 Tars-Go 将编译环境升级至 1.10.3，从 profile 来看，性能得到了很大的提升，并且基于时间轮询算法实现了自己的 timer，以精度换取性能和效率。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">net 包的 SetDeadline 调用性能问题</strong></p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">为了设置网络连接的读写超时，Tars-Go 使用了 net 包的 SetReadDeadline/SetWriteDeadline 等相关调用，但从 profile 发现，当并发非常大的时候，会导致这两个调用占用了大量的 CPU 时间。为了绕开这两个相关调用，使用了 Sysfd 进行 Socket 读写超时的设置。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">bytes 的 Buffer 带来的性能问题</strong></p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">从下图可以看出，有相当大的一部分时间耗在了 slice 相关的操作上，原来在包的编解码过程中，使用 bytes.Buffer 进行临时存放，当 bytes.Buffer 底层用的 byte slice 大小不够的时候，就会分配一定的内存空间，频繁地分配效率很低，所以导致大包情况下性能下降比较明显。</p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/1537233142671b5fcea24ea.jpg" type="image/jpeg" data-filename="1537233142671b5fcea24ea.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="617" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="452"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">联想到了 Redis 的内存模型和 Linux 的 slab 机制，对于频繁创建销毁的对象，采用预先创建和重复利用的方式。而 Go 本身提供了一种 sync.Pool 机制，供临时对象的复用，以减少 GC，Tars-Go 在此基础上，实现了类似 Linux slab 机制分配的 buffer 管理方案，通过这种方案，性能大幅提高。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;"><strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">其他方面的优化</strong></p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/1537233142734b747e4de6d.jpg" type="image/jpeg" data-filename="1537233142734b747e4de6d.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="306" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">经过上面的性能优化后，<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">Tars-Go 在小包的并发表现提升了 5 倍。</strong></p><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;"><img src="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍_files/1537233142899c045efc474.jpg" type="image/jpeg" data-filename="1537233142899c045efc474.jpg" alt="腾讯Tars开源Go版本Tars-Go，并发性能比gRPC高5倍" height="355" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;border-style:none;max-width:100%;display:block;margin:10px auto;" width="640"/><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;text-align:center;font-size:12px;color:rgb(119, 119, 119);line-height:16px;margin-top:0px;"></p></div><ul style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:20px 30px;list-style:square outside;color:rgb(34, 34, 34);"><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">压测机型：4 核/8线程 CPU 3.3Ghz 主频 16G 内存</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">压测逻辑：客户端带着一定大小的数据给服务端，服务端原样返回给客户端</li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:inherit;">服务端单进程，多个客户端发起测试</li></ul><h1 style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;font-size:24px;margin:36px 0px 22px;font-weight:700;line-height:32px;color:rgb(34, 34, 34);">Tars-Go 编程示例</h1><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">Tars 协议是一个二进制协议，它是与语言无关的 IDL 语言，由工具自动生成服务端和客户端 diamante，下边是一个 Tars 协议的示例：</p><pre style="line-height:1.5;font-family:Consolas, Menlo, Courier, monospace;-webkit-tap-highlight-color:transparent;box-sizing:border-box;white-space:pre-wrap;position:relative;font-size:16px;color:rgb(153, 153, 153);margin:1em 0px;padding:12px 10px;background:rgb(244, 245, 246);border:1px solid rgb(232, 232, 232);">struct LoginInfo {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> 0 require string sid;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> 1 require string code;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>}<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>struct ProfileInfo {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> 0 require string nick;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> 1 require int level;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>}<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>interface TestServant {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> int test(int qq, LoginInfo li, out ProfileInfo pi);<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>}<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/></pre><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">具体编程的时候，首先需要定义一个 Tars 文件，如下所示：<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">定义接口 </strong>Mult ，a 和 b 为入参，c 为出参，均为整型。</p><pre style="line-height:1.5;font-family:Consolas, Menlo, Courier, monospace;-webkit-tap-highlight-color:transparent;box-sizing:border-box;white-space:pre-wrap;position:relative;font-size:16px;color:rgb(153, 153, 153);margin:1em 0px;padding:12px 10px;background:rgb(244, 245, 246);border:1px solid rgb(232, 232, 232);">module Prajna{<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>interface JesseTest{<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> int Mult(int a,int b,out int c);<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>};<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>};<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/></pre><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">接着<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">生成接口代码</strong>。使用 tars2go JesseTest.tars 即可自动生成 pacakge Prajna JesseTest 的 servant 和 Mult 方法的框架实现，业务无需关心实现细节：</p><pre style="line-height:1.5;font-family:Consolas, Menlo, Courier, monospace;-webkit-tap-highlight-color:transparent;box-sizing:border-box;white-space:pre-wrap;position:relative;font-size:16px;color:rgb(153, 153, 153);margin:1em 0px;padding:12px 10px;background:rgb(244, 245, 246);border:1px solid rgb(232, 232, 232);">type JesseTest struct {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> s m.Servant<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> }<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>_func (_obj *JesseTest) Mult(A int32, B int32, C *int32, _opt ...map[string]string) (ret int32, err error) {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> var length int32<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> var have bool<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> var ty byte<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> _os := codec.NewBuffer()<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> err = _os.Write_int32(A, 1)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> if err != nil {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> return ret, err<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> } <br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> err = _os.Write_int32(B, 2)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> if err != nil {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> return ret, err<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> } <br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> var _status map[string]string<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> var _context map[string]string<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> _resp := new(requestf.ResponsePacket)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> err = _obj.s.Taf_invoke(0, &quot;Mult&quot;, _os.ToBytes(), _status, _context, _resp)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> if err != nil {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> return ret, err<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> }<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> _is := codec.NewReader(_resp.SBuffer)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> err = _is.Read_int32(&amp;ret, 0, true)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> if err != nil {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> return ret, err<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> }<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>......<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/></pre><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">最后，<strong style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-weight:700;">实现接口代码</strong>，将入参 a、b相乘后的结果放到 c 返回给客户端：</p><pre style="line-height:1.5;font-family:Consolas, Menlo, Courier, monospace;-webkit-tap-highlight-color:transparent;box-sizing:border-box;white-space:pre-wrap;position:relative;font-size:16px;color:rgb(153, 153, 153);margin:1em 0px;padding:12px 10px;background:rgb(244, 245, 246);border:1px solid rgb(232, 232, 232);">package main<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>import (<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> &quot;tars&quot;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> &quot;Prajna&quot;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>type JesseTestImp struct {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>}<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>func (imp *JesseTestImp) Mult(a int32, b int32, c *int32) (int32, error) {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> tmp := a * b<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> *c = tmp<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> return 0, nil<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>}<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>func main() {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> imp := new(JesseTestImp) //New Imp<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> app := new(Prajna.JesseTest) //New init the A Tars<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> cfg := tars.GetServerConfig() //Get Config File Object<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> app.AddServant(imp, cfg.App+&quot;.&quot;+cfg.Server+&quot;.JesseTestObj&quot;) //Register Servant<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> tars.Run()<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>}<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/></pre><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">之后 go build 就可以进行编译。</p><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">而客户端只需关注出入参，引入由 Tars 文件转化成的包即可完成一次 RPC 调用。</p><pre style="line-height:1.5;font-family:Consolas, Menlo, Courier, monospace;-webkit-tap-highlight-color:transparent;box-sizing:border-box;white-space:pre-wrap;position:relative;font-size:16px;color:rgb(153, 153, 153);margin:1em 0px;padding:12px 10px;background:rgb(244, 245, 246);border:1px solid rgb(232, 232, 232);">package main<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>import (<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> &quot;Prajna&quot;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> &quot;flag&quot;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> &quot;fmt&quot;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> &quot;tars&quot;<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>func main() {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> ip := flag.String(&quot;Ip&quot;, &quot;127.0.0.1&quot;, &quot;Ip address&quot;)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> port := flag.Int(&quot;Port&quot;, 10000, &quot;Port&quot;)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> timeout := flag.Int(&quot;timeout&quot;, 1234, &quot;timeout&quot;)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> flag.Parse()<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> comm := tars.NewCommunicator()<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> obj := fmt.Sprintf(&quot;Prajna.JesseGoServer.JesseTestObj@tcp -h %s -p %d -t 60000&quot;, *ip, *port)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> app := new(Prajna.JesseTest)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> comm.StringToProxy(obj, app)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> app.TarsSetTimeout(*timeout)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> var out, i int32<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> i = 123<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> ret, err := app.Mult(i, i*2, &amp;out)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> if err != nil {<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> fmt.Println(err)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> return<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> }<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/> fmt.Println(ret, out)<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/>}<br style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;"/></pre><p style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;padding:0px;margin:16px 0px;">未来，Linux 基金会将加强 Tars 项目的社区运作机制，让 Tars 的影响力从中国走向国际。</p></div></div>  <div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;display:block;zoom:1;margin-bottom:28px;"><span style="display:table;"></span><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;float:left;"><i style="font-weight:400;-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-size:21px;text-transform:none;display:inline-block;speak:none;font-style:normal;font-variant:normal;line-height:1;text-rendering:auto;-webkit-font-smoothing:antialiased;vertical-align:middle;font-family:tticons;color:rgb(202, 202, 202);"><span style="font-style:normal;font-size:12px;line-height:1;font-weight:400;font-variant:normal;text-transform:none;font-family:tticons;"></span></i> <ul style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;list-style:none;display:inline-block;vertical-align:middle;"><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;display:inline-block;margin-right:8px;font-size:14px;"><span style="font-size:14px;padding-right:10px;color:rgb(224, 224, 224);"></span><a href="https://www.toutiao.com/search/?keyword=%E8%BD%AF%E4%BB%B6" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;background:0px 0px;text-decoration:none;outline:0px;cursor:pointer;transition:color 0.2s ease;color:rgb(64, 101, 153);" target="_blank">软件</a></li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;display:inline-block;margin-right:8px;font-size:14px;"><span style="font-size:14px;padding-right:10px;color:rgb(224, 224, 224);">/</span><a href="https://www.toutiao.com/search/?keyword=Go%E8%AF%AD%E8%A8%80" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;background:0px 0px;text-decoration:none;outline:0px;cursor:pointer;transition:color 0.2s ease;color:rgb(64, 101, 153);" target="_blank">Go语言</a></li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;display:inline-block;margin-right:8px;font-size:14px;"><span style="font-size:14px;padding-right:10px;color:rgb(224, 224, 224);">/</span><a href="https://www.toutiao.com/search/?keyword=PowerPoint" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;background:0px 0px;text-decoration:none;outline:0px;cursor:pointer;transition:color 0.2s ease;color:rgb(64, 101, 153);" target="_blank">PowerPoint</a></li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;display:inline-block;margin-right:8px;font-size:14px;"><span style="font-size:14px;padding-right:10px;color:rgb(224, 224, 224);">/</span><a href="https://www.toutiao.com/search/?keyword=%E8%85%BE%E8%AE%AFQQ" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;background:0px 0px;text-decoration:none;outline:0px;cursor:pointer;transition:color 0.2s ease;color:rgb(64, 101, 153);" target="_blank">腾讯QQ</a></li><li style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;display:inline-block;margin-right:8px;font-size:14px;"><span style="font-size:14px;padding-right:10px;color:rgb(224, 224, 224);">/</span><a href="https://www.toutiao.com/search/?keyword=CPU" style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;background:0px 0px;text-decoration:none;outline:0px;cursor:pointer;transition:color 0.2s ease;color:rgb(64, 101, 153);" target="_blank">CPU</a></li></ul></div> <div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;float:right;"><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;display:inline-block;cursor:pointer;line-height:18px;"><i style="font-variant:normal;-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-size:18px;text-rendering:auto;display:inline-block;speak:none;font-weight:400;font-style:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;width:18px;vertical-align:middle;font-family:tticons;color:rgb(202, 202, 202);"><span style="font-style:normal;font-size:12px;line-height:1;font-weight:400;font-variant:normal;text-transform:none;font-family:tticons;"></span></i><span style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;color:rgb(153, 153, 153);font-size:14px;padding-left:7px;vertical-align:middle;">收藏</span></div> <div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;display:inline-block;margin-left:10px;"><div style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;margin:0px;padding:0px;display:inline-block;cursor:pointer;line-height:18px;"><i style="font-variant:normal;-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-size:14px;text-rendering:auto;display:inline-block;speak:none;font-weight:400;font-style:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;vertical-align:middle;width:14px;margin-right:7px;font-family:tticons;color:rgb(202, 202, 202);"><span style="font-style:normal;font-size:12px;line-height:1;font-weight:400;font-variant:normal;text-transform:none;font-family:tticons;"></span></i><span style="-webkit-tap-highlight-color:transparent;box-sizing:border-box;color:rgb(153, 153, 153);font-size:14px;vertical-align:middle;">举报</span></div> </div></div><span style="display:block;visibility:hidden;font-size:0px;height:0px;clear:both;"></span></div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 