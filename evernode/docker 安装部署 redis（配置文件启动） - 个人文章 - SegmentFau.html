<html>
<head>
  <title>docker 安装部署 redis（配置文件启动） - 个人文章 - SegmentFault 思否</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="10011"/>
<h1>docker 安装部署 redis（配置文件启动） - 个人文章 - SegmentFault 思否</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/5/8 13:40</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://segmentfault.com/a/1190000014091287"><i>https://segmentfault.com/a/1190000014091287</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%; position: relative;"><div style="box-sizing:border-box;font-family:sans-serif;text-size-adjust:100%;font-size:10px;-webkit-tap-highlight-color:transparent;"><div style="box-sizing:border-box;font-family:-apple-system, &quot;Helvetica Neue&quot;, Helvetica, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Microsoft Yahei&quot;, sans-serif;font-size:14px;line-height:1.42858;color:rgb(51, 51, 51);background-color:rgb(255, 255, 255);-webkit-font-smoothing:antialiased;"><div style="box-sizing:border-box;">
            <div style="box-sizing:border-box;background-color:rgb(0, 154, 97);width:100%;position:relative;">
    <div style="box-sizing:border-box;margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px;background-image:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/banner-login/banner-bg.svg);background-position:right -20px;background-repeat:no-repeat;"><span style="display:table;"> </span>
        <div style="box-sizing:border-box;margin-left:-15px;margin-right:-15px;"><span style="display:table;"> </span>
            <div style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;">
                <h1 style="box-sizing:border-box;margin:0.67em 0px;font-family:inherit;font-weight:500;line-height:1.2;font-size:30px;color:rgb(255, 255, 255);margin-top:40px;margin-bottom:20px;">在 SegmentFault，学习技能、解决问题</h1>
                <p style="box-sizing:border-box;margin:0px 0px 10px;margin-bottom:40px;font-size:18px;color:rgb(255, 255, 255);">每个月，我们帮助 1000 万的开发者解决各种各样的技术问题。并助力他们在技术能力、职业生涯、影响力上获得提升。</p>
            </div>
            <div style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;">
                <div style="box-sizing:border-box;margin-top:65px;margin-bottom:40px;"><span style="display:table;"> </span>

                    
                    <a href="https://segmentfault.com/user/register" style="border:1px solid transparent;border-color:rgb(0, 129, 81);outline:0px;text-decoration:none;display:inline-block;box-shadow:rgba(0, 0, 0, 0.0470588) 0px 1px 1px;font-weight:normal;text-align:center;vertical-align:middle;cursor:pointer;box-sizing:border-box;white-space:nowrap;padding:10px 16px;font-size:18px;line-height:1.33;border-radius:6px;user-select:none;margin-bottom:10px;color:rgb(0, 154, 97);background:rgb(255, 255, 255);margin-right:15px;">免费注册</a>
                    <a href="https://segmentfault.com/user/login" style="border:1px solid transparent;background:transparent;box-sizing:border-box;text-decoration:none;padding:10px 16px;outline:0px;font-size:18px;font-weight:normal;vertical-align:middle;cursor:pointer;background-image:none;color:rgb(255, 255, 255);white-space:nowrap;box-shadow:rgba(0, 0, 0, 0.0470588) 0px 1px 1px;text-align:center;line-height:1.33;border-radius:6px;user-select:none;background-color:rgb(0, 154, 97);display:inline-block;border-color:rgb(255, 255, 255);margin-bottom:10px;">立即登录</a>
                <span style="display:table;clear:both;"> </span></div>
            </div>
        <span style="display:table;clear:both;"> </span></div>
    <span style="display:table;clear:both;"> </span></div>
        <i style="font-style:normal;box-sizing:border-box;font-variant:normal;-webkit-font-smoothing:antialiased;text-rendering:auto;font-family:FontAwesome;line-height:1;display:inline-block;font-stretch:normal;font-weight:normal;top:15px;position:absolute;color:rgba(255, 255, 255, 0.247059);cursor:pointer;right:15px;font-size:18px;"><span style="font-size:18px;cursor:pointer;color:rgba(255, 255, 255, 0.247059);font-style:normal;font-variant:normal;font-weight:normal;line-height:1;font-family:FontAwesome;"></span></i>
    </div>

        <div style="box-sizing:border-box;padding:30px 0px 0px;">
        <div style="box-sizing:border-box;margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px;"><span style="display:table;"> </span>
            <div style="box-sizing:border-box;padding-bottom:20px;border-bottom:1px solid rgb(224, 224, 224);">
                <div style="box-sizing:border-box;margin-left:-15px;margin-right:-15px;"><span style="display:table;"> </span>
                    <div style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;float:left;width:100%;">
                        <div style="box-sizing:border-box;color:rgb(153, 153, 153);margin-bottom:-5px;margin-left:0px;">

                            <h1 style="box-sizing:border-box;font-size:24px;margin:0px 0px 15px;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;">
                                <a href="https://segmentfault.com/a/1190000014091287" style="box-sizing:border-box;background:transparent;outline:0px;color:rgb(51, 51, 51);text-decoration:none;"> docker 安装部署 redis（配置文件启动）</a>
                            </h1>

                            <div style="box-sizing:border-box;"><span style="margin-left:0px;font-size:13px;height:22px;line-height:22px;padding:0px 6px;border-radius:11px;font-weight:normal;font-family:&quot;PingFang SC&quot;;margin-right:10px;background-color:rgba(242, 174, 67, 0.247059);color:rgb(242, 174, 67);">原</span>
                                <ul style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;display:inline-block;list-style:none;padding:0px;font-size:0px;margin-right:10px;">
                                                                            <li style="box-sizing:border-box;padding:0px;font-size:13px;display:inline-block;margin-right:5px;margin-bottom:5px;">
                                            <a href="https://segmentfault.com/t/docker/blogs" style="padding:0px 6px;background:transparent;box-sizing:border-box;text-decoration:none;outline:0px;display:inline-block;color:rgb(1, 126, 102);background-color:rgba(1, 126, 102, 0.0784314);height:22px;line-height:22px;font-weight:normal;font-size:13px;text-align:center;">
                                                                                        docker
                                            </a>
                                        </li>
                                                                            <li style="box-sizing:border-box;padding:0px;font-size:13px;display:inline-block;margin-right:0px;margin-bottom:5px;">
                                            <a href="https://segmentfault.com/t/redis/blogs" style="padding:0px 6px;background:transparent;box-sizing:border-box;text-decoration:none;outline:0px;display:inline-block;color:rgb(1, 126, 102);background-color:rgba(1, 126, 102, 0.0784314);height:22px;line-height:22px;font-weight:normal;font-size:13px;text-align:center;">
                                                                                        redis
                                            </a>
                                        </li>
                                                                    </ul>
                                                                                                <div style="box-sizing:border-box;display:inline-block;">
                                    <a href="https://segmentfault.com/u/big_cat" style="box-sizing:border-box;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;margin-right:5px;"><strong style="box-sizing:border-box;font-weight:bold;">big_cat</strong></a>
                                    3月30日发布
                                                                                                        </div>
                            <span style="margin-left:10px;font-size:13px;height:22px;line-height:22px;padding:0px 6px;border-radius:11px;font-weight:normal;font-family:&quot;PingFang SC&quot;;background-color:rgba(242, 174, 67, 0.247059);color:rgb(242, 174, 67);">原</span></div>

                                                        
                        </div>
                    </div>
                    <div style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;">
                        <ul style="box-sizing:border-box;padding-left:0px;list-style:none;margin:0px;color:rgb(153, 153, 153);">
                            <li style="box-sizing:border-box;margin-top:0px;">
                                                            </li>
                            <li style="box-sizing:border-box;margin-top:10px;">
                                <strong style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:normal;">278</strong> 次浏览
                            </li>
                        </ul>
                    </div>
                <span style="display:table;clear:both;"> </span></div>
            </div>
        <span style="display:table;clear:both;"> </span></div>
    </div>

    <div style="box-sizing:border-box;margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px;margin-top:30px;"><span style="display:table;"> </span>
        <div style="box-sizing:border-box;margin-left:-15px;margin-right:-15px;"><span style="display:table;"> </span>
            <div style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;float:left;width:100%;">

                
                <div style="box-sizing:border-box;line-height:1.6;word-wrap:break-word;"><span style="line-height:1.6;display:table;"> </span>
                    
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;font-size:1.75em;margin:1.5em 0px 0px;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:10px;margin-top:0px;">安装 docker</h2>
<pre style="word-wrap:break-word;overflow-x:auto;border-radius:4px;box-sizing:border-box;display:block;color:rgb(51, 51, 51);font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;word-break:break-all;line-height:1.45;margin:1.5em 0px;padding:1em;border:none;font-size:0.93em;max-height:35em;position:relative;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/blueprint.png) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px;overflow:auto;margin-top:1.5em;"><code style="box-sizing:border-box;font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;padding:0px;color:inherit;border-radius:0px;font-size:1em;white-space:inherit;background:none;overflow-wrap:normal;"><span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);">#安装 docker</span>
yum <span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">install</span> docker -y

systemctl start docker.service

</code></pre>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;font-size:1.75em;margin:1.5em 0px 0px;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:10px;">获取 redis 镜像</h2>
<pre style="word-wrap:break-word;overflow-x:auto;border-radius:4px;box-sizing:border-box;display:block;color:rgb(51, 51, 51);font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;word-break:break-all;line-height:1.45;margin:1.5em 0px;padding:1em;border:none;font-size:0.93em;max-height:35em;position:relative;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/blueprint.png) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px;overflow:auto;margin-top:1.5em;"><code style="box-sizing:border-box;font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;padding:0px;color:inherit;border-radius:0px;font-size:1em;white-space:inherit;background:none;overflow-wrap:normal;">docker <span style="box-sizing:border-box;color:rgb(0, 134, 179);">search</span> redis

docker pull <span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">redi</span><span style="box-sizing:border-box;color:rgb(0, 128, 128);">s:latest</span>

docker images
</code></pre>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;font-size:1.75em;margin:1.5em 0px 0px;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:10px;">创建容器</h2>
<p style="box-sizing:border-box;margin:1.5em 0px;">创建存放 redis 容器的目录</p>
<pre style="word-wrap:break-word;overflow-x:auto;border-radius:4px;box-sizing:border-box;display:block;color:rgb(51, 51, 51);font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;word-break:break-all;line-height:1.45;margin:1.5em 0px;padding:1em;border:none;font-size:0.93em;max-height:35em;position:relative;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/blueprint.png) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px;overflow:auto;margin-top:0px;"><code style="box-sizing:border-box;font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;padding:0px;color:inherit;border-radius:0px;font-size:1em;white-space:inherit;background:none;overflow-wrap:normal;"><span style="box-sizing:border-box;color:rgb(153, 153, 153);font-weight:bold;"># 创建存放 redis 容器的目录</span>
mkdir <span style="box-sizing:border-box;">/home/</span>docker<span style="box-sizing:border-box;">/redis/</span>{conf,data} -p
cd <span style="box-sizing:border-box;">/home/</span>docker/redis
</code></pre>
<p style="box-sizing:border-box;margin:1.5em 0px;">获取 redis 的默认配置模版</p>
<pre style="word-wrap:break-word;overflow-x:auto;border-radius:4px;box-sizing:border-box;display:block;color:rgb(51, 51, 51);font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;word-break:break-all;line-height:1.45;margin:1.5em 0px;padding:1em;border:none;font-size:0.93em;max-height:35em;position:relative;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/blueprint.png) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px;overflow:auto;margin-top:0px;"><code style="box-sizing:border-box;font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;padding:0px;color:inherit;border-radius:0px;font-size:1em;white-space:inherit;background:none;overflow-wrap:normal;"># 获取 redis 的默认配置模版
# 这里主要是想设置下 redis 的 <span style="box-sizing:border-box;color:rgb(0, 134, 179);">log</span> / password / appendonly
# redis 的 docker 运行参数提供了 --appendonly yes 但没 password
wget http<span style="box-sizing:border-box;color:rgb(0, 128, 128);">s:</span>//raw.githubusercontent.<span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">com</span>/antirez/redis/<span style="box-sizing:border-box;color:rgb(0, 128, 128);">4.0</span>/redis.<span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">conf</span> -O <span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">conf</span>/redis.<span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">conf</span>

# 直接替换编辑
sed -i <span style="box-sizing:border-box;color:rgb(221, 17, 68);">'s/logfile &quot;&quot;/logfile &quot;access.log&quot;'</span> <span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">conf</span>/redis.<span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">conf</span>
sed -i <span style="box-sizing:border-box;color:rgb(221, 17, 68);">'s/# requirepass foobared/requirepass 123456'</span> <span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">conf</span>/redis.<span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">conf</span>
sed -i <span style="box-sizing:border-box;color:rgb(221, 17, 68);">'s/appendonly no/appendonly yes'</span> <span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">conf</span>/redis.<span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">conf</span>

# 这里可能还需配置一些 bind protected-<span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">mode</span>

</code></pre>
<blockquote style="box-sizing:border-box;padding:10px 20px;margin:1.5em 0px;font-size:1em;border-left:2px solid rgb(0, 154, 97);background:rgb(246, 246, 246);color:rgb(85, 85, 85);"><span style="font-size:1em;color:rgb(85, 85, 85);"></span>protected-mode 是在没有显示定义 bind 地址（即监听全网断） 或者 没有设置密码 requirepass<br style="box-sizing:border-box;"/>时，只允许本地回环 127.0.0.1 访问。 也就是说当开启了 protected-mode 时，如果你既没有显示的定义了 bind<br style="box-sizing:border-box;"/>监听的地址，同时又没有设置 auth 密码。那你只能通过 127.0.0.1 来访问 redis 服务。<span style="font-size:1em;color:rgb(85, 85, 85);"></span></blockquote>
<p style="box-sizing:border-box;margin:1.5em 0px;">创建并运行一个名为 myredis 的容器</p>
<pre style="word-wrap:break-word;overflow-x:auto;border-radius:4px;box-sizing:border-box;display:block;color:rgb(51, 51, 51);font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;word-break:break-all;line-height:1.45;margin:1.5em 0px;padding:1em;border:none;font-size:0.93em;max-height:35em;position:relative;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/blueprint.png) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px;overflow:auto;margin-top:0px;"><code style="box-sizing:border-box;font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;padding:0px;color:inherit;border-radius:0px;font-size:1em;white-space:inherit;background:none;overflow-wrap:normal;"># 创建并运行一个名为 myredis 的容器
docker run \
-<span style="box-sizing:border-box;">p <span style="box-sizing:border-box;color:rgb(0, 128, 128);">6379</span><span style="box-sizing:border-box;color:rgb(153, 0, 115);">:</span><span style="box-sizing:border-box;color:rgb(0, 128, 128);">6379</span> \
</span>-<span style="box-sizing:border-box;">v $PWD/<span style="box-sizing:border-box;color:rgb(153, 0, 115);">data:</span>/data \
</span>-<span style="box-sizing:border-box;">v $PWD/conf/redis.<span style="box-sizing:border-box;color:rgb(153, 0, 115);">conf:</span>/etc/redis/redis.conf \
</span>-<span style="box-sizing:border-box;">-privileged=<span style="box-sizing:border-box;color:rgb(0, 128, 128);">true</span> \
</span>-<span style="box-sizing:border-box;">-name myredis \
</span>-<span style="box-sizing:border-box;">d redis redis-server /etc/redis/redis.conf
</span>
# 命令分解
docker run \
-<span style="box-sizing:border-box;">p <span style="box-sizing:border-box;color:rgb(0, 128, 128);">6379</span><span style="box-sizing:border-box;color:rgb(153, 0, 115);">:</span><span style="box-sizing:border-box;color:rgb(0, 128, 128);">6379</span> \ <span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># 端口映射 宿主机:容器</span>
</span>-<span style="box-sizing:border-box;">v $PWD/<span style="box-sizing:border-box;color:rgb(153, 0, 115);">data:</span>/<span style="box-sizing:border-box;color:rgb(153, 0, 115);">data:</span>rw \ <span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># 映射数据目录 rw 为读写</span>
</span>-<span style="box-sizing:border-box;">v $PWD/conf/redis.<span style="box-sizing:border-box;color:rgb(153, 0, 115);">conf:</span>/etc/redis/redis.<span style="box-sizing:border-box;color:rgb(153, 0, 115);">conf:</span>ro \ <span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># 挂载配置文件 ro 为readonly</span>
</span>-<span style="box-sizing:border-box;">-privileged=<span style="box-sizing:border-box;color:rgb(0, 128, 128);">true</span> \ <span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># 给与一些权限</span>
</span>-<span style="box-sizing:border-box;">-name myredis \ <span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># 给容器起个名字</span>
</span>-<span style="box-sizing:border-box;">d redis redis-server /etc/redis/redis.conf <span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># deamon 运行 服务使用指定的配置文件</span>
</span></code></pre>
<p style="box-sizing:border-box;margin:1.5em 0px;">查看活跃的容器</p>
<pre style="word-wrap:break-word;overflow-x:auto;border-radius:4px;box-sizing:border-box;display:block;color:rgb(51, 51, 51);font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;word-break:break-all;line-height:1.45;margin:1.5em 0px;padding:1em;border:none;font-size:0.93em;max-height:35em;position:relative;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/blueprint.png) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px;overflow:auto;margin-top:0px;"><code style="box-sizing:border-box;font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;padding:0px;color:inherit;border-radius:0px;font-size:1em;white-space:inherit;background:none;overflow-wrap:normal;"><span style="box-sizing:border-box;color:rgb(153, 153, 153);font-weight:bold;"># 查看活跃的容器</span>
docker ps
<span style="box-sizing:border-box;color:rgb(153, 153, 153);font-weight:bold;"># 如果没有 myredis 说明启动失败 查看错误日志</span>
docker logs myredis
<span style="box-sizing:border-box;color:rgb(153, 153, 153);font-weight:bold;"># 查看 myredis 的 ip 挂载 端口映射等信息</span>
docker inspect myredis
<span style="box-sizing:border-box;color:rgb(153, 153, 153);font-weight:bold;"># 查看 myredis 的端口映射</span>
docker port myredis

</code></pre>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;font-size:1.75em;margin:1.5em 0px 0px;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:10px;">外部访问 redis 容器服务</h2>
<pre style="word-wrap:break-word;overflow-x:auto;border-radius:4px;box-sizing:border-box;display:block;color:rgb(51, 51, 51);font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;word-break:break-all;line-height:1.45;margin:1.5em 0px;padding:1em;border:none;font-size:0.93em;max-height:35em;position:relative;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/blueprint.png) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px;overflow:auto;margin-top:1.5em;"><code style="box-sizing:border-box;font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;padding:0px;color:inherit;border-radius:0px;font-size:1em;white-space:inherit;background:none;overflow-wrap:normal;"><span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># redis-cli 访问</span>
docker <span style="box-sizing:border-box;color:rgb(0, 134, 179);">run</span> -<span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">it</span> <span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);">--link myredis:redis --rm redis redis-cli -h redis -p 6379</span>
<span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># -it 交互的虚拟终端</span>
<span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># --rm 退出是删除此容器</span>
</code></pre>
<p style="box-sizing:border-box;margin:1.5em 0px;">配置完成</p>
<h2 style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;font-size:1.75em;margin:1.5em 0px 0px;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:10px;">主从配置</h2>
<p style="box-sizing:border-box;margin:1.5em 0px;">新建容器 redis-slave<br style="box-sizing:border-box;"/>查看 redis master 的内部 ip</p>
<pre style="word-wrap:break-word;overflow-x:auto;border-radius:4px;box-sizing:border-box;display:block;color:rgb(51, 51, 51);font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;word-break:break-all;line-height:1.45;margin:1.5em 0px;padding:1em;border:none;font-size:0.93em;max-height:35em;position:relative;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/blueprint.png) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px;overflow:auto;margin-top:0px;"><code style="box-sizing:border-box;font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;padding:0px;color:inherit;border-radius:0px;font-size:1em;white-space:inherit;background:none;overflow-wrap:normal;">docker inspect redis <span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);">#Networks</span>
可以得到 redis <span style="box-sizing:border-box;color:rgb(51, 51, 51);font-weight:bold;">master</span> <span style="box-sizing:border-box;color:rgb(153, 0, 0);font-weight:bold;">的 ip</span> 地址

修改 redis-<span style="box-sizing:border-box;color:rgb(0, 128, 128);">slave</span> 的配置文件
<span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># 主地址</span>
slaveof <span style="box-sizing:border-box;color:rgb(0, 128, 128);">master</span>-ip <span style="box-sizing:border-box;color:rgb(0, 128, 128);">master</span>-port
<span style="box-sizing:border-box;font-style:italic;color:rgb(153, 153, 136);"># 主认证</span>
masterauth</code></pre>
<p style="box-sizing:border-box;margin:1.5em 0px;">重启 redis-slave</p>
<pre style="word-wrap:break-word;overflow-x:auto;border-radius:4px;box-sizing:border-box;display:block;color:rgb(51, 51, 51);font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;word-break:break-all;line-height:1.45;margin:1.5em 0px;padding:1em;border:none;font-size:0.93em;max-height:35em;position:relative;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/blueprint.png) 0% 0% / 30px rgb(246, 246, 246), 0% 0% / 30px;overflow:auto;margin-top:0px;"><code style="box-sizing:border-box;font-family:&quot;Source Code Pro&quot;, Consolas, Menlo, Monaco, &quot;Courier New&quot;, monospace;padding:0px;color:inherit;border-radius:0px;font-size:1em;white-space:inherit;background:none;overflow-wrap:normal;">docker restart redis-<span style="box-sizing:border-box;color:rgb(0, 128, 128);">slave</span>
</code></pre>
<p style="box-sizing:border-box;margin:1.5em 0px;">登录 redis master 使用 info 命令查看从的状态</p>
<p style="box-sizing:border-box;margin:1.5em 0px;margin-bottom:0px;">如果配置不成功记得检查 redis master 的 bind 和 protected-mode 的设置，看下有没有监听内网地址，否则 redis-slave 没办法通过 redis master 的地址做数据同步</p>

                <span style="line-height:1.6;display:table;clear:both;"> </span></div>
                                                
                <div style="box-sizing:border-box;margin-top:10px;"><span style="display:table;"> </span>
                    <ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;padding-left:0px;list-style:none;margin-left:-5px;float:left;"><li style="box-sizing:border-box;display:inline-block;padding-right:5px;padding-left:5px;"><a href="https://segmentfault.com/a/1190000014091287" style="box-sizing:border-box;background:transparent;text-decoration:none;outline:0px;color:rgb(153, 153, 153);font-size:13px;">3月30日发布</a></li><li style="box-sizing:border-box;position:relative;display:inline-block;padding-left:5px;padding-right:5px;"><a href="#" style="box-sizing:border-box;background:transparent;text-decoration:none;outline:0px;color:rgb(153, 153, 153);font-size:13px;"><i style="font-stretch:normal;box-sizing:border-box;font-style:normal;font-variant:normal;font-weight:normal;display:inline-block;line-height:1;font-family:FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;"><span style="font-style:normal;font-variant:normal;font-weight:normal;line-height:1;font-family:FontAwesome;font-size:inherit;"></span></i></a></li></ul>
                    <div style="box-sizing:border-box;float:right;">
                        <div style="box-sizing:border-box;margin-bottom:20px;"><div style="box-sizing:border-box;float:left;color:rgb(153, 153, 153);font-size:13px;display:block;"><ul style="box-sizing:border-box;list-style:none;display:inline;margin:0px;padding:0px;vertical-align:text-bottom;"><li style="box-sizing:border-box;display:inline-block;margin-right:5px;"><a href="#" style="text-transform:capitalize;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;box-sizing:border-box;background-image:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/social-icons/icon-sn.svg);background-size:auto 56px;vertical-align:middle;background-position:-56px -28px;display:inline-block;height:28px;background-repeat:no-repeat;width:28px;overflow:hidden;text-indent:110%;white-space:nowrap;" title="">新浪微博</a></li><li style="box-sizing:border-box;display:inline-block;margin-right:5px;"><a href="#" style="text-transform:capitalize;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;box-sizing:border-box;background-image:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/social-icons/icon-sn.svg);background-size:auto 56px;vertical-align:middle;background-position:-252px -28px;display:inline-block;height:28px;background-repeat:no-repeat;width:28px;overflow:hidden;text-indent:110%;white-space:nowrap;" title="">微信</a></li><li style="box-sizing:border-box;display:inline-block;margin-right:5px;"><a href="#" style="text-transform:capitalize;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;box-sizing:border-box;background-image:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/social-icons/icon-sn.svg);background-size:auto 56px;vertical-align:middle;background-position:-112px -28px;display:inline-block;height:28px;background-repeat:no-repeat;width:28px;overflow:hidden;text-indent:110%;white-space:nowrap;" title="">Twitter</a></li><li style="box-sizing:border-box;display:inline-block;margin-right:5px;"><a href="#" style="text-transform:capitalize;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;box-sizing:border-box;background-image:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/social-icons/icon-sn.svg);background-size:auto 56px;vertical-align:middle;background-position:-140px -28px;display:inline-block;height:28px;background-repeat:no-repeat;width:28px;overflow:hidden;text-indent:110%;white-space:nowrap;" title="">Facebook</a></li></ul></div><a style="background-image:none;background:transparent;box-sizing:border-box;text-decoration:none;white-space:nowrap;outline:0px;padding:0px;font-weight:normal;vertical-align:middle;cursor:pointer;color:rgb(255, 255, 255);border:none;margin-bottom:0px;text-align:center;font-size:12px;line-height:1.5;border-radius:3px;user-select:none;box-shadow:none;display:inline-block;" type="button"><span style="box-sizing:border-box;background-position:-280px -28px;display:inline-block;background-image:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/social-icons/icon-sn.svg);background-repeat:no-repeat;width:28px;height:28px;vertical-align:middle;background-size:auto 56px;background-color:transparent;" title=""></span></a></div>


                    </div>
                <span style="display:table;clear:both;"> </span></div>
                <div style="box-sizing:border-box;text-align:center;margin-top:10px;"></div>
                                                <div style="box-sizing:border-box;background:url(https://static.segmentfault.com/v-5aec1215/global/css/../img/ad_bg.svg);max-height:90px;display:flex;justify-content:center;margin-top:20px;"></div>
                

                                    <div style="box-sizing:border-box;border-top:1px solid rgb(221, 221, 221);margin-top:40px;margin-bottom:30px;padding-top:30px;">
                        <div style="box-sizing:border-box;margin-left:-15px;margin-right:-15px;"><span style="display:table;"> </span>
                            <div style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;">
                                                                    <h4 style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin-bottom:10px;font-size:18px;margin-top:0px;">你可能感兴趣的文章</h4>
                                    <ul style="box-sizing:border-box;margin-top:0px;margin-bottom:10px;padding-left:0px;list-style:none;">
                                                                                    <li style="box-sizing:border-box;margin-bottom:8px;">
                                                <a href="https://segmentfault.com/a/1190000004478606" style="box-sizing:border-box;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;margin-right:6px;word-break:break-word;" title="使用Docker过程中注意事项">使用Docker过程中注意事项</a>
                                                <small style="box-sizing:border-box;color:rgb(119, 119, 119);font-size:13px;display:inline-block;">
                                                    2 收藏，1.1k
                                                    浏览
                                                </small>
                                            </li>
                                                                                    <li style="box-sizing:border-box;margin-bottom:8px;">
                                                <a href="https://segmentfault.com/a/1190000010131816" style="box-sizing:border-box;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;margin-right:6px;word-break:break-word;" title="Linux_基于Docker搭建Redis集群">Linux_基于Docker搭建Redis集群</a>
                                                <small style="box-sizing:border-box;color:rgb(119, 119, 119);font-size:13px;display:inline-block;">
                                                    26 收藏，3.5k
                                                    浏览
                                                </small>
                                            </li>
                                                                                    <li style="box-sizing:border-box;margin-bottom:8px;">
                                                <a href="https://segmentfault.com/a/1190000009393015" style="box-sizing:border-box;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;margin-right:6px;word-break:break-word;" title="Docker-Compose官方学习笔记（2）起步构建一个多容器app应用">Docker-Compose官方学习笔记（2）起步构建一个多容器app应用</a>
                                                <small style="box-sizing:border-box;color:rgb(119, 119, 119);font-size:13px;display:inline-block;">
                                                    4 收藏，1.2k
                                                    浏览
                                                </small>
                                            </li>
                                                                            </ul>
                                                            </div>
                            <div style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;">
                                                            </div>
                        <span style="display:table;clear:both;"> </span></div>

                    </div>
                                

                <h2 style="box-sizing:border-box;font-family:inherit;font-weight:500;line-height:1.2;color:inherit;margin-top:10px;margin-bottom:10px;font-size:18px;padding-top:20px;border-top:2px solid rgb(204, 204, 204);"></h2>
                
        <div style="box-sizing:border-box;margin-top:-5px;">
                    <div style="box-sizing:border-box;margin-bottom:10px;"><span style="display:table;"> </span>
                <strong style="box-sizing:border-box;font-weight:bold;display:block;font-size:16px;float:left;margin-right:10px;">评论</strong>

                                                    <div style="box-sizing:border-box;position:relative;display:inline-block;vertical-align:middle;float:right;">
                        <a href="#" style="font-size:12px;background:transparent;box-sizing:border-box;text-decoration:none;border-radius:3px;display:inline-block;font-weight:normal;text-align:center;vertical-align:middle;cursor:pointer;user-select:none;border:1px solid transparent;white-space:nowrap;margin-bottom:0px;border-color:rgb(173, 173, 173);color:rgb(51, 51, 51);padding:1px 5px;background-image:none;outline:0px;box-shadow:rgba(0, 0, 0, 0.121569) 0px 3px 5px inset;background-color:rgb(230, 230, 230);line-height:1.5;position:relative;float:left;z-index:2;margin-left:0px;border-bottom-right-radius:0px;border-top-right-radius:0px;">默认排序</a>
                        <a href="#" style="padding:1px 5px;background:transparent;outline:0px;text-decoration:none;box-sizing:border-box;border-radius:3px;margin-bottom:0px;text-align:center;vertical-align:middle;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;display:inline-block;color:rgb(51, 51, 51);box-shadow:rgba(0, 0, 0, 0.0470588) 0px 1px 1px;font-weight:normal;user-select:none;background-color:rgb(255, 255, 255);border-color:rgb(204, 204, 204);position:relative;float:left;line-height:1.5;font-size:12px;margin-left:-1px;border-bottom-left-radius:0px;border-top-left-radius:0px;">时间排序</a>
                    </div>
                            <span style="display:table;clear:both;"> </span></div>
                <div style="border-right-color:initial;box-sizing:border-box;border-bottom-color:initial;border-width:1px 0px 0px;border-bottom-style:initial;border-left-style:initial;background:rgb(255, 255, 255);border-right-style:initial;border-left-color:initial;border-image:initial;box-shadow:none;border-top-style:solid;border-top-color:rgba(0, 0, 0, 0.0901961);">
                                <div style="box-sizing:border-box;">
            </div>
    
        
    

                                    <div style="box-sizing:border-box;background:rgb(250, 250, 250);box-shadow:rgba(0, 0, 0, 0.0901961) 0px 1px 0px 0px;border-radius:2px 2px 0px 0px;padding:15px 20px;border-top:1px solid rgba(0, 0, 0, 0.0901961);margin-top:-1px;">
                <div style="box-sizing:border-box;float:left;">
                    <img src="docker 安装部署 redis（配置文件启动） - 个人文章 - SegmentFau_files/user-128.png" type="image/png" data-filename="user-128.png" height="32" style="box-sizing:border-box;border:0px;vertical-align:middle;border-radius:50%;width:32px;height:32px;" width="32"/>
                </div>
                <div style="box-sizing:border-box;padding-left:47px;">
                    <div style="box-sizing:border-box;">
                        <div style="box-sizing:border-box;position:relative;margin-bottom:0px;">
                            
                            <div style="box-sizing:border-box;text-align:right;margin-top:15px;">
                                
                                
                            </div>
                        </div>
                    </div>
                </div>
            <span style="display:block;clear:both;"></span></div>
                                                        </div>
    </div>


                                    
                
            </div>


            <div style="box-sizing:border-box;position:relative;min-height:1px;padding-left:15px;padding-right:15px;float:left;width:100%;">
                
                
                <div style="box-sizing:border-box;margin-bottom:25px;">
    <img src="docker 安装部署 redis（配置文件启动） - 个人文章 - SegmentFau_files/85517221-5af08f84f28af" type="image/png" data-filename="85517221-5af08f84f28af" height="255" style="box-sizing:border-box;border:0px;vertical-align:middle;" usemap="#gridsMap" width="255"/>
    <map name="gridsMap"><area coords="0,0,17,17" href="https://www.zhihu.com/org/lun-zhi-40/posts" shape="rect" style="box-sizing:border-box;" target="_blank"></area><area coords="0,17,34,34" href="https://www.zhihu.com/org/lun-zhi-40/posts" shape="rect" style="box-sizing:border-box;" target="_blank"></area><area coords="17,0,34,17" href="https://www.zhihu.com/org/lun-zhi-40/posts" shape="rect" style="box-sizing:border-box;" target="_blank"></area><area coords="85,85,187,170" href="https://www.codecasts.com/series/free" shape="rect" style="box-sizing:border-box;" target="_blank"></area><area coords="238,0,255,17" href="http://fuck.sheep3.cn/" shape="rect" style="box-sizing:border-box;" target="_blank"></area><area coords="0,238,17,255" href="https://www.fundebug.com/?utm_source=sf_ad" shape="rect" style="box-sizing:border-box;" target="_blank"></area><area coords="238,238,255,255" href="http://fir.im/dw4u" shape="rect" style="box-sizing:border-box;" target="_blank"></area></map>
    <div style="box-sizing:border-box;text-align:center;"><a href="https://segmentfault.com/sponsor" style="box-sizing:border-box;background:transparent;color:#9E9E9E;text-decoration:none;outline:0px;text-align:center;font-size:12px;">想在上方展示你的广告？</a></div>
    
</div>

                                
                <div style="box-sizing:border-box;margin:0px 0px 25px;border-top:1px solid rgb(238, 238, 238);border:1px solid rgb(221, 221, 221);padding:15px;box-shadow:rgba(0, 0, 0, 0.0470588) 0px 1px 1px 0px;border-radius:3px;padding-top:30px;">
                    <div style="box-sizing:border-box;border-bottom:1px solid rgb(238, 238, 238);padding-bottom:0px;border:0px;">
                                                    
                        
                        <div style="box-sizing:border-box;">
                            <a href="https://segmentfault.com/u/big_cat" style="box-sizing:border-box;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;display:inline-block;">
                                <img src="docker 安装部署 redis（配置文件启动） - 个人文章 - SegmentFau_files/1734075150-552cd4d8c954c_big64" type="image/jpeg" data-filename="1734075150-552cd4d8c954c_big64" height="40" style="box-sizing:border-box;border:0px;vertical-align:middle;border-radius:50%;width:40px;height:40px;float:left;margin-right:10px;" width="40"/>
                            </a>
                            <a href="https://segmentfault.com/u/big_cat" style="text-overflow:ellipsis;background:transparent;color:rgb(0, 154, 97);text-decoration:none;outline:0px;box-sizing:border-box;display:inline-block;width:90px;overflow:hidden;white-space:nowrap;line-height:1;margin-bottom:5px;">
                                <strong style="box-sizing:border-box;font-weight:bold;">big_cat</strong>
                            </a>
                            <p style="box-sizing:border-box;margin:0px 0px 10px;font-size:13px;color:rgb(153, 153, 153);margin-bottom:0px;">
                                <span style="box-sizing:border-box;">217 声望</span>

                            </p>


                        </div>


                    </div>
                    

                </div>
                
                
                                <div style="box-sizing:border-box;margin-bottom:25px;display:block;position:fixed;top:10px;"></div>
 
                <div style="box-sizing:border-box;display:block;padding:10px 0px 10px 10px;background:rgb(255, 255, 255);padding-left:0px;width:255px;top:0px;position:fixed;z-index:1;margin-top:25px;">
                    <div style="margin:0px;box-sizing:border-box;border:1px solid transparent;border-radius:4px;box-shadow:rgba(0, 0, 0, 0.0470588) 0px 1px 1px;background-color:rgb(255, 255, 255);top:40px;line-height:1.5;position:relative;max-width:250px;border-color:rgb(221, 221, 221);">
                        <div style="background-color:rgb(255, 255, 255);box-sizing:border-box;border-bottom:1px solid transparent;border-top-right-radius:3px;border-top-left-radius:3px;color:rgb(51, 51, 51);padding:8px 12px;font-weight:bold;border:none;cursor:pointer;font-size:16px;border-left:1px solid rgb(238, 238, 238);">目录</div>
                        <div style="box-sizing:border-box;padding:0px 12px 10px;max-height:300px;overflow:auto;position:relative;z-index:2;transition:all 0.2s ease;"><span style="display:table;"> </span>
                            <div style="box-sizing:border-box;border-left:1px solid rgb(238, 238, 238);position:relative;padding:0px 18px;top:0px;">
                                <div style="background:rgb(243, 243, 243);box-sizing:border-box;display:block;top:108px;right:0px;position:absolute;z-index:1;border-left:2px solid rgb(0, 154, 97);transition:all 0.2s ease;left:0px;height:27px;"></div>
                                <ul style="box-sizing:border-box;position:relative;z-index:2;padding-left:18px;margin:0px;list-style-type:square;"><li style="box-sizing:border-box;"><a href="https://segmentfault.com/a/1190000014091287#articleHeader0" style="box-sizing:border-box;background:transparent;text-decoration:none;outline:0px;color:rgb(0, 0, 0);display:block;padding:3px 0px;">安装 docker</a></li><li style="box-sizing:border-box;"><a href="https://segmentfault.com/a/1190000014091287#articleHeader1" style="box-sizing:border-box;background:transparent;text-decoration:none;outline:0px;color:rgb(0, 0, 0);display:block;padding:3px 0px;">获取 redis 镜像</a></li><li style="box-sizing:border-box;"><a href="https://segmentfault.com/a/1190000014091287#articleHeader2" style="box-sizing:border-box;background:transparent;text-decoration:none;outline:0px;color:rgb(0, 0, 0);display:block;padding:3px 0px;">创建容器</a></li><li style="box-sizing:border-box;"><a href="https://segmentfault.com/a/1190000014091287#articleHeader3" style="box-sizing:border-box;background:transparent;text-decoration:none;outline:0px;color:rgb(0, 0, 0);display:block;padding:3px 0px;">外部访问 redis 容器服务</a></li><li style="box-sizing:border-box;color:rgb(0, 154, 97);"><a href="https://segmentfault.com/a/1190000014091287#articleHeader4" style="box-sizing:border-box;background:transparent;text-decoration:none;outline:0px;display:block;padding:3px 0px;color:rgb(0, 154, 97);">主从配置</a></li></ul>
                            </div>
                        <span style="display:table;clear:both;"> </span></div>
                    </div>
                </div>

                
            </div>
        <span style="display:table;clear:both;"> </span></div>
    <span style="display:table;clear:both;"> </span></div>
</div></div></div></div>
</div>
</span>
</div></body></html> 