<html>
<head>
  <title>限流和降级（上） | 如何打造平台稳定性能力（一）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1547"/>
<h1>限流和降级（上） | 如何打造平台稳定性能力（一）</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/8/16 10:03</i></td></tr>
<tr><td><b>标签：</b></td><td><i>微信</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&mid=2247484087&idx=2&sn=ba25010647605c010d6fa6d0ce3eedd1&chksm=fdeb30d7ca9cb9c1731a3eb86e33145077eab22f1d7a48cfb544e39dc35fc7db48b989b880ff&mpshare=1&scene=1&srcid=0816w2QZenmubRmmsBy5GaUO#rd"><i>http://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247484087&amp;idx=2&amp;sn=ba25010647605c010d6fa6d0ce3eedd1&amp;chksm=fdeb30d7ca9cb9c1731a3eb86e33145077eab22f1d7a48cfb544e39dc35fc7db48b989b880ff&amp;mpshare=1&amp;scene=1&amp;srcid=0816w2QZenmubRmmsBy5GaUO#rd</i></a></td></tr>
</table>
</div>
<br/>

<div><span style="margin:0px;"><div style="padding:8px 0px;margin:8px auto;max-width:700px;"> <div style="padding:20px 16px 12px;margin:0;background-color:#fff"><div style="margin:0;padding:0"><div style="margin:0;padding:0"><h2 style="font-weight:400;margin:0;padding:0;font-size:22px;line-height:1.4;margin-bottom:14px"> 限流和降级（上） | 如何打造平台稳定性能力（一） </h2><div style="margin:0;padding:0;margin-bottom:22px;line-height:20px;font-size:0;word-wrap:break-word;word-break:break-all"><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);margin-right:0;color:rgba(0,0,0,0.3)">原创：</span><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"> 钟华 </span><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);position:relative"><a style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)"> 阿里巴巴中间件 </a></span><em style="padding:0;font-style:normal;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"></em></div><div style="margin:0;padding:0;overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-family:微软雅黑,sans-serif;font-size:15px;text-align:justify;background-color:rgb(255,255,255);letter-spacing:1px">在整个稳定性体系中，所包含的范围非常广泛，从机房的布线、网络通信、硬件部署、应用架构、数据容灾等方面都与之相关。从共享服务中台的角度看，则更多的是从应用架构设计和中间件平台的维度对平台的稳定性实现更精确化的管理和保障。<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">本期开始，我们将从这个角度介绍阿里巴巴中间件团队多年来为了提升平台稳定性所做出的一系列技术创新和成果，包括限流和降级、流量调度、业务开关、容量压测和评估、全链路压测平台业务一直性平台等。</strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:justify"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-family:微软雅黑,sans-serif;font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-family:微软雅黑,sans-serif;font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"></span></p><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0;padding-left:10px;border-left:3px solid #dbdbdb"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:justify"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;background-color:rgb(255,255,255);font-family:微软雅黑,sans-serif;color:rgb(178,178,178)">第一期：<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">限流和降级</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:justify"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;text-align:justify;font-size:15px;letter-spacing:1px;background-color:rgb(255,255,255);font-family:微软雅黑,sans-serif;color:rgb(178,178,178)">由于第一期的内容篇幅较多，我们将切分为上下两个篇章。</span></p></blockquote><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-right:8px;margin-left:8px;white-space:normal;text-align:justify;line-height:1.75em"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-family:微软雅黑,sans-serif;background:white;color:rgb(36,41,46);font-size:15px;letter-spacing:1px"></span></p><div style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0 auto;white-space:normal;width:546.828px;border-width:initial;border-color:initial;border-style:none"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1rem;margin-bottom:1rem;color:rgb(51,51,51);border-bottom:2px solid rgb(70,118,217);clear:both;border-top-color:rgb(70,118,217);border-right-color:rgb(70,118,217);border-left-color:rgb(70,118,217)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-top:0.3rem;padding-right:0.8rem;padding-left:0.8rem;display:inline-block;color:rgb(255,255,255);border-top-left-radius:10px;font-size:1rem;background-color:rgb(70,118,217)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px">一、限流和降级的产生背景</span></div></div></div><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#24292e"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;background-color:rgb(255,255,255)">先设想一个场景，你开发了一个企业中非常核心的一个服务，日常情况下会有上百个应用调用，如果对服务的调用不加限制的使用，可能会因为某个应用开发的bug 或不合理的设计给服务造成非常大的压力，直接导致所有服务节点全部被请求占满，使得原本非常核心的应用因为访问服务超时而产生了很大的生成事故。从现象来说，所有服务节点看起来运行很繁忙，但从应用方的角度来看，因为服务响应时间过长，实际上该服务并没有提供有效服务。<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">从设置上来说，服务就是给其他应用提供服务的，用户怎么调用服务很难控制，所以必须从服务自身做好保护，否则可能因为一个小的问题造成平台级的故障。</strong></span></span></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#24292e"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;background-color:rgb(255,255,255)"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></strong></span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-left:8px;margin-right:8px"><img src="限流和降级（上）  如何打造平台稳定性能力（一）_files/640.jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important"/></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#24292e"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></span></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#24292e"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;background-color:rgb(255,255,255)">另一个是活动大促的场景，准备好的50台机器资源可以应对预估的100万参与人数，但实际情况是瞬间来了1000万用户，远远超过服务处理能力的访问请求，会使后端的服务器直接满负荷运算，并伴随着大量的资源抢占和上下文切换，使平台处理能力下降到一个极低的程度，影响业务请求的响应时间。类似的还有因为一个社会热点，应用端出现用户请求陡增的情况。</span></span></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#24292e"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></span></p><div style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0 auto;white-space:normal;width:546.828px;border-width:initial;border-color:initial;border-style:none"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1rem;margin-bottom:1rem;color:rgb(51,51,51);border-bottom:2px solid rgb(70,118,217);clear:both;border-top-color:rgb(70,118,217);border-right-color:rgb(70,118,217);border-left-color:rgb(70,118,217)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-top:0.3rem;padding-right:0.8rem;padding-left:0.8rem;display:inline-block;color:rgb(255,255,255);border-top-left-radius:10px;font-size:1rem;background-color:rgb(70,118,217)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px">二、限流的作用和前期准备</span></div></div></div><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">限流的作用相当于电路上的保险丝，当过载的时候掐掉一点流量，让系统有能力集中资源以较快的深度处理 平台处理能力范围内 的业务请求。</span></strong><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">也就是让上面提到的大促场景中，仅让1000万用户中的100万用户进入后端的处理流程中，将其余900万用户的请求通过队列或直接阻挡在平台处理单元之外的方式，保障平台在处理能力范围内对100万的用户请求进行处理。</span></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-left:8px;margin-right:8px"><img src="限流和降级（上）  如何打造平台稳定性能力（一）_files/640 [1].jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important"/></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0;padding-left:10px;border-left:3px solid #dbdbdb"><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255);color:rgb(178,178,178)">平台要具备限流能力，需要配备好</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255);color:rgb(0,0,0)">压测和监控</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255);color:rgb(178,178,178)">能力。</span></p></blockquote><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">通过压测，我们可以知道服务实例的部署最大能满足多少的业务请求。但传统的压力测试方法都是采用模拟的数据，从实践的角度来看，这些压测数据与在实际生产环境中所表现的指标还是有比较大的偏差，也就是说，采用模拟数据进行压力测试的方式并不能准确测量出平台的能力峰值。</span><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">阿里巴巴中间件团队经过内部5年+的全生态沉淀，开发出的针对分布式场景，可</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">模拟海量用户的真实业务场景的性能测试产品PTS，能更方便和准确的对服务的容量进行评估，这在“如何打造系统稳定平台”之后的章节中会详细介绍。</span></strong></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">在掌握服务的容量后，接下来就是针对服务资源的使用情况进行监控，通过资源监控的指标与之前所获取的服务能力进行比较，如果超过服务处理上限则启动限流。通过CPU、内存和磁盘IO等资源的使用情况来判断系统目前的负载往往是不准确的。<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">因为很多情况下系统本身的处理能力出于什么样的水位跟这些操作系统资源的使用情况没有一个清晰的对应关系，所以在实际生产中，都会通过服务的QPS作为限流的关键判断指标。</strong></span></p><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin:auto 8px;white-space:normal;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><div style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0 auto;white-space:normal;width:546.828px;border-width:initial;border-color:initial;border-style:none"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1rem;margin-bottom:1rem;color:rgb(51,51,51);border-bottom:2px solid rgb(70,118,217);clear:both;border-top-color:rgb(70,118,217);border-right-color:rgb(70,118,217);border-left-color:rgb(70,118,217)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-top:0.3rem;padding-right:0.8rem;padding-left:0.8rem;display:inline-block;color:rgb(255,255,255);border-top-left-radius:10px;font-size:1rem;background-color:rgb(70,118,217)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px">三、阿里巴巴是如何做限流管控的</span></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:1.75em;text-align:justify;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">对于平台限流的实现，先从一个典型服务化应用架构的角度来看。用户的请求首先会通过前端接入层（一般采用<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">Nginx</span>），分发到后端的应用集群上，应用集群中主要负责用户的前端交互以及业务需求对后端服务集群中的服务进行服务调用。为了避免出现远超过系统处理负载上限的访问请求，同时又能很好的兼顾安全问题，通过一些安全策略防止对平台的恶意攻击，所以最优的限流拦截点在前端接入层面，因为一旦让“洪流”进入到系统的下层，对于系统的冲击以及限流的难度都会加大。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:1.75em;text-align:justify"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-left:8px;margin-right:8px"><img src="限流和降级（上）  如何打造平台稳定性能力（一）_files/640 [2].jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:1.75em;text-align:justify"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:1.75em;text-align:justify;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">阿里巴巴是通过在 Nginx 上实现的扩展组件 TMD（taobao missile defense淘宝导弹防御系统）实现了接入层限流的主要工作，TMD<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">系统可通过域名类限流、cookie限流、黑名单以及一些安全策略等很好的实现了在接入层的限流措施。</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:1.75em;text-align:justify;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:1.75em;text-align:justify;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">TMD系统包含了淘宝技术团队开发的开源模块 nginx-http-sysguard，主要用于当访问负载和内存达到一定的<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46)">阈值</span>时，会执行相应的动作，比如直接返回503、504或者其他url请求返回代码，一直等到内存或者负载回到<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46)">阈值</span>的范围内，站点才恢复可用。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:1.75em;text-align:justify;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;line-height:1.75em;text-align:justify;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">在模块 nginx-http-sysguard基础上，<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">淘宝<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">TMD系统给用户提供了可视化的配置管理界面，方便用户针对不同的业务场景实现不同的限流规则。如果来自单台机器持续访问淘宝平台上的一个URL页面，可在<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">TMD</span>中设置规则：访问频率大雨180次/秒，则进行IP访问频率限速或cookie访问频率限速。正是有了<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">TMD </span>这样配置灵活、操作方便的规则配置界面，运维人员可以针对所发现的异常请求以及实时的处理状态，设置出各种保护措施，保障平台在面对大流量时具备一定的自我保护能力，在平台接入层外部惊涛骇浪的访问洪流下，平台接入蹭内部保持稳定、健康的运行状态。</span></span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:justify;line-height:1.75em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:justify;line-height:1.75em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">在接入层实现了限流后，一定会有部分用户的请求得不到系统正常的处理，所以平台一般会给用户返回限流页面，在一定程度上减少用户因为请求没有成功处理的失落体验，限流页面的风格会与网站、app的设计风格统一，页面也会包含跳转引导界面，以形成用户体验和业务处理流程的闭环。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:justify;line-height:1.75em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1rem;margin-bottom:1rem;white-space:normal;color:rgb(51,51,51);border-bottom:2px solid rgb(70,118,217);clear:both;border-top-color:rgb(70,118,217);border-right-color:rgb(70,118,217);border-left-color:rgb(70,118,217)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-top:0.3rem;padding-right:0.8rem;padding-left:0.8rem;display:inline-block;color:rgb(255,255,255);border-top-left-radius:10px;font-size:1rem;background-color:rgb(70,118,217)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px">四、TMD平台在服务层面临的挑战</span></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">TMD平台能很好的实现在平台接入层的限流功能，但对于服务层就无能为力了。对于实现服务的限流控制，传统的实现方式通常用spring的aop机制，对需要限流的接口定义一个advice拦截器，示例代码如下：</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;padding:16px;border-radius:2px;background-color:rgb(250,250,250);overflow:auto;font-size:13px;line-height:21px;tab-size:4;color:rgb(89,89,89);border-width:1px;border-style:solid;border-color:rgb(232,232,232);letter-spacing:0.7px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-family:Consolas,Menlo,Courier,monospace;margin-right:8px;margin-left:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;letter-spacing:0.7px">&lt;bean id=&quot;spuServiceAdvisor&quot;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">   class=&quot;org.springframework.aop.suppport.RegexpMethodPointcutAdvisor&quot;&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    &lt;property name=&quot;partners&quot;&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        &lt;list&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>            &lt;value&gt;com.taobao.item.service.SpuService.*&lt;/value&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        &lt;/list&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        &lt;/property&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        &lt;propetry name=&quot;advise&quot;&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>            &lt;ref bean=&quot;spuServiceApiAdvice&quot; /&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        &lt;/property&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    &lt;/bean&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    &lt;bean id=&quot;spuServiceApiAdvice&quot; /&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        class=&quot;com.taobao.trade.buy.web.buy.util.monitor.advice.SpuServiceApiAdvice&quot; /&gt;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">其中的 SuperServiceApiAdvice</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46)"></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)">类实现MethodBeforeAdvice接口，重写before方法，那么在调用指定的接口或者方法前会计算当前thread count或qps，如果当前的线程数大于所设置的最大线程数阈值，则返回访问限流的异常信息。示例代码如下：</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;padding:16px;border-radius:2px;background-color:rgb(250,250,250);overflow:auto;font-size:13px;line-height:21px;tab-size:4;color:rgb(89,89,89);border-width:1px;border-style:solid;border-color:rgb(232,232,232);letter-spacing:0.7px"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-right:8px;margin-left:8px;font-family:Consolas,Menlo,Courier,monospace">@Override<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>protected void invokeBeforeMethodForFlowControl(MonitorStore monitorStore) throws FlowControlException{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    long newThreadCnt = monitorStore<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    .getStoreDataInfo(getMonitorNmae(),getKey()).getThreadCnt()<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    .get();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    if(newThreadCnt &gt; MonitorParam.MAX_THREAD_COUT_FIVE){<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>       throw new FlowControlException(<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>       &quot;SpuServiceApiAdvice access control, threadcnt=&quot;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>               + newThreadCnt);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>}</p></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:rgb(255,255,255);color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify"></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:rgb(255,255,255);color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;white-space:normal;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:rgb(255,255,255);color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify">这套流控技术方案是可行的，实现起来也非常简单，但在实际应用场景中还是会发现不少问题，比如：</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;background-color:rgb(255,255,255);color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0;padding-left:10px;border-left:3px solid #dbdbdb"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left;line-height:1.75em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;text-align:justify;background-color:rgb(255,255,255);letter-spacing:1px;color:rgb(178,178,178)">1. 如果一个应用需要对100个接口进行限流，那么对应地也就需要配置100个advice和编写100个拦截器，如果是成百上千的应用呢？</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left;line-height:1.75em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;letter-spacing:1px;color:rgb(178,178,178)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(178,178,178);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"> 2. 限流阀值是硬编码形式，无法动态调整，当然你也可以动态调整（比如定义成一个静态变量，然后通过curl去调整），</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(178,178,178);background-color:rgb(255,255,255);font-size:15px;letter-spacing:1px;text-align:justify">但当限流开关达到一定量级后你会发现这是一件非常痛苦的事，很难维护管理；</span></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left;line-height:1.75em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;text-align:justify;background-color:rgb(255,255,255);letter-spacing:1px;color:rgb(178,178,178)"> 3. 限流手段太过单一，无法对特殊场景实现多样化的限流；</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left;line-height:1.75em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;text-align:justify;background-color:rgb(255,255,255);letter-spacing:1px;color:rgb(178,178,178)"> 4. 没有一个统一的监控平台，无法监控当前的限流情况；</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;text-align:left;line-height:1.75em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;text-align:justify;background-color:rgb(255,255,255);letter-spacing:1px;color:rgb(178,178,178)"> 5. 限流算法简单，当在双十一这种特殊场景，会看到毛刺现象，需要一种更平滑的限流算法；</span></p></blockquote><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-bottom:16px;color:rgb(36,41,46);text-align:justify;line-height:1.75em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(36,41,46);font-size:15px;letter-spacing:1px;text-align:justify;background-color:rgb(255,255,255)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;color:rgb(0,82,255)">那么我们是如何解决以上的问题？解决的过程中有哪些新的思考？阿里巴巴是否有将这类解决方案开源贡献给社区？我们将在下一篇“如何打造平台稳定性能力”系列文章中为大家解读。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;white-space:normal;text-align:justify;line-height:1.75em;margin-left:8px;margin-right:8px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(217,33,66);font-size:15px;letter-spacing:1px">» 8月26日，Aliware Open Source 将首次在成都举办 Apache Dubbo 的meetup活动，Dubbo 、Sentinel和 Nacos 的小哥哥和小姐姐都会在现场进行技术分享，欢迎成都的朋友报名参加我们的活动喔，公众号后台发送“</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;letter-spacing:1px;color:rgb(0,0,0)">成都meetup</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(217,33,66);font-size:15px;letter-spacing:1px">”，获取报名链接。</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;margin-right:8px;margin-left:8px;white-space:normal;text-align:justify;line-height:1.75em"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><div style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0 auto;white-space:normal;color:rgb(51,51,51)"><div style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;margin-top:20px;margin-bottom:10px;margin-left:20.2969px;text-align:center;box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;display:inline-block;border-width:1px;border-style:solid;border-color:rgb(62,62,62);border-radius:0;background-color:rgb(70,118,217);word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;margin-top:3px;margin-bottom:-5px;background-color:rgb(255,255,255);transform:translate3d(-3px,0,0);box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;padding:5px;display:inline-block;border-width:1px;border-style:solid;border-color:rgb(62,62,62);border-radius:0;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;display:flex;justify-content:center;box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;padding-right:5px;padding-left:5px;font-size:14px;color:rgb(63,63,63);word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;clear:both;min-height:1em;box-sizing:border-box !important;word-wrap:break-word !important">今日推文</p></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51);text-align:center"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;color:rgb(178,178,178);font-size:14px;box-sizing:border-box !important;word-wrap:break-word !important">点击下方图片即可阅读</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51)"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;color:rgb(178,178,178);font-size:14px;box-sizing:border-box !important;word-wrap:break-word !important"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></span></p><h2 style="font-weight:400;margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-right:8px;margin-bottom:14px;margin-left:8px;font-size:22px;white-space:normal;color:rgb(51,51,51)"><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:15px;color:rgb(0,82,255);box-sizing:border-box !important;word-wrap:break-word !important">» </span></strong><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;letter-spacing:0.544px;box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:15px;color:rgb(0,82,255);box-sizing:border-box !important;word-wrap:break-word !important">里程碑 | Apache RocketMQ 正式开源分布式事务消息</span></strong></h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><a href="http://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247484003&amp;idx=1&amp;sn=8b9b084f463c6a0bd0ce04d9ca670079&amp;chksm=fdeb3003ca9cb915a7933c5981bbee47e849d9f2d401101ee6a7fbe21b1e0b8989c8af5021b8&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank"><span style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;top:auto;left:auto;margin:0;right:auto;bottom:auto"><img src="限流和降级（上）  如何打造平台稳定性能力（一）_files/640 [3].jpg" type="image/jpeg" data-filename="640.jpg" style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;width:547px;margin:0;top:auto;left:auto;right:auto;bottom:auto"/></span></a><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></div></div></div><ul style="margin:0;padding:0"></ul><div style="margin:0;padding:0;padding-top:15px"><a href="https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247484087&amp;idx=2&amp;sn=ba25010647605c010d6fa6d0ce3eedd1&amp;chksm=fdeb30d7ca9cb9c1731a3eb86e33145077eab22f1d7a48cfb544e39dc35fc7db48b989b880ff&amp;mpshare=1&amp;scene=1&amp;srcid=0816w2QZenmubRmmsBy5GaUO##" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)">阅读原文</a></div></div></div></div></span>
</div></body></html> 