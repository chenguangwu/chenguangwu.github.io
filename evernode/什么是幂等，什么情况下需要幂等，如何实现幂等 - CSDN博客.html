<html>
<head>
  <title>什么是幂等，什么情况下需要幂等，如何实现幂等 - CSDN博客</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="4311"/>
<h1>什么是幂等，什么情况下需要幂等，如何实现幂等 - CSDN博客</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/9/7 10:03</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://blog.csdn.net/yuhaiyang_1/article/details/81040967"><i>https://blog.csdn.net/yuhaiyang_1/article/details/81040967</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="outline:0px;box-sizing:border-box;"><div style="box-sizing:inherit;outline:0px;background:url(&quot;https://csdnimg.cn/release/phoenix/themes/skin-yellow/images/bg.png&quot;) repeat;font-family:&quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:1.57143;color:rgb(51, 51, 51);"><div style="outline:0px;box-sizing:border-box;"><span style="box-sizing:inherit;outline:0px;"><div style="box-sizing:inherit;outline:0px;background:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.05) 0px 2px 4px 0px;">
	<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;border-bottom:1px solid rgb(224, 224, 224);padding-top:16px;z-index:9;background-color:rgb(255, 255, 255);">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;margin-bottom:8px;">
				<span style="border-radius:50%;display:inline-block;width:26px;height:26px;line-height:26px;text-align:center;font-size:12px;outline:0px;box-sizing:inherit;border:1px solid rgb(231, 244, 223);color:rgb(134, 202, 94);margin-right:8px;margin-top:4px;float:left;">转</span>				<h1 style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:24px;word-break:break-all;">什么是幂等，什么情况下需要幂等，如何实现幂等</h1>
			</div>
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;padding-bottom:14px;position:relative;">
				<div style="color:rgb(133, 133, 133);width:88%;height:24px;box-sizing:inherit;outline:0px;padding:0px;margin:0px;overflow:hidden;">
																				<span style="box-sizing:inherit;outline:0px;margin-right:14px;">2018年07月14日 10:08:06</span>
						<span style="box-sizing:inherit;outline:0px;margin-right:14px;">阅读数：407</span>
												
														<span style="box-sizing:inherit;outline:0px;margin-right:14px;margin-bottom:8px;font-size:12px;">
								<span style="box-sizing:inherit;outline:0px;margin-right:14px;color:rgb(77, 77, 77);">标签：</span>
																<a href="http://so.csdn.net/so/search/s.do?q=%E5%B9%82%E7%AD%89&amp;t=blog" style="text-align:center;cursor:pointer;text-decoration:none;outline:0px;box-sizing:inherit;display:inline-block;border:1px solid rgb(204, 204, 204);color:rgb(77, 77, 77);padding:0px 8px;margin-bottom:4px;border-radius:100px;word-break:break-all;line-height:24px;min-width:24px;height:24px;margin-right:8px;" target="_blank">幂等																</a>
							<span style="background-color:rgb(255, 255, 255);outline:0px;box-sizing:inherit;letter-spacing:0px;line-height:20px;cursor:pointer;font-size:12px;top:0px;right:101px;width:45px;display:inline-block;color:rgb(51, 153, 234);margin-right:0px;">更多</span></span>
																					<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:12px;margin-top:6px;margin-bottom:0px;">
								<span style="box-sizing:inherit;outline:0px;margin-right:14px;color:rgb(77, 77, 77);">个人分类：</span>
																<a href="https://blog.csdn.net/yuhaiyang_1/article/category/7767806" style="box-sizing:inherit;outline:0px;text-decoration:none;cursor:pointer;display:inline-block;margin-right:24px;color:rgb(121, 165, 229);word-break:break-all;" target="_blank">分布式																</a>
							</div>
																								</div>
				<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;position:absolute;top:0px;right:0px;">
														</div>
			</div>
			
		</div>
	</div>
	<div style="box-sizing:inherit;outline:0px;display:block;position:relative;padding-top:16px;">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;word-break:break-all;">
								            
						<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;word-break:break-all;">
                <p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;"><span style="outline:0px;box-sizing:border-box;word-break:break-all;color:rgb(85,85,85);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;background-color:rgb(255,255,255);">在微服务架构下，我们在完成一个订单流程时经常遇到下面的场景：</span><br style="outline:0px;box-sizing:border-box;word-break:break-all;"/></p><pre style="white-space:pre-wrap;color:rgb(0, 0, 0);outline:0px;padding:8px;margin:0px 0px 24px;position:relative;box-sizing:border-box;word-wrap:break-word;overflow-x:auto;font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;line-height:22px;word-break:break-all;"><code style="line-height:22px;font-family:Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;outline:0px;border-radius:4px;display:block;font-size:14px;box-sizing:border-box;overflow-x:auto;white-space:pre;word-wrap:normal;padding:8px;word-break:break-all;">一个订单创建接口，第一次调用超时了，然后调用方重试了一次
在订单创建时，我们需要去扣减库存，这时接口发生了超时，调用方重试了一次
当这笔订单开始支付，在支付请求发出之后，在服务端发生了扣钱操作，接口响应超时了，调用方重试了一次
一个订单状态更新接口，调用方连续发送了两个消息，一个是已创建，一个是已付款。但是你先接收到已付款，然后又接收到了已创建
在支付完成订单之后，需要发送一条短信，当一台机器接收到短信发送的消息之后，处理较慢。消息中间件又把消息投递给另外一台机器处理</code></pre><br style="outline:0px;box-sizing:border-box;word-break:break-all;"/><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">以上问题，就是在单体架构转成微服务架构之后，带来的问题。当然不是说单体架构下没有这些问题，在单体架构下同样要避免重复请求。但是出现的问题要比这少得多。<a style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;border-bottom:1px solid rgb(204,204,204);background-color:transparent;" target="_blank"></a></p><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">为了解决以上问题，就需要保证接口的幂等性，接口的幂等性实际上就是<span style="outline:0px;box-sizing:border-box;word-break:break-all;font-weight:700;">接口可重复调用，在调用方多次调用的情况下，接口最终得到的结果是一致的</span>。有些接口可以天然的实现幂等性，比如查询接口，对于查询来说，你查询一次和两次，对于系统来说，没有任何影响，查出的结果也是一样。</p><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">除了查询功能具有天然的幂等性之外，增加、更新、删除都要保证幂等性。那么如何来保证幂等性呢？</p><h3 style="font-size:20px;word-break:break-all;outline:0px;padding:0px;margin:8px 0px 16px;box-sizing:border-box;color:rgb(85,85,85);font-weight:700;line-height:1.5;font-family:Georgia, sans;background-color:rgb(255,255,255);"><a name="t0" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a><a name="t0" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;" target="_blank"></a><a style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;font-weight:400;" target="_blank"></a>全局唯一ID</h3><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">如果使用全局唯一ID，就是根据业务的操作和内容生成一个全局ID，在执行操作前先根据这个全局唯一ID是否存在，来判断这个操作是否已经执行。如果不存在则把全局ID，存储到存储系统中，比如数据库、redis等。如果存在则表示该方法已经执行。</p><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">从工程的角度来说，使用全局ID做幂等可以作为一个业务的基础的微服务存在，在很多的微服务中都会用到这样的服务，在每个微服务中都完成这样的功能，会存在工作量重复。另外打造一个高可靠的幂等服务还需要考虑很多问题，比如一台机器虽然把全局ID先写入了存储，但是在写入之后挂了，这就需要引入全局ID的超时机制。</p><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">使用全局唯一ID是一个通用方案，可以支持插入、更新、删除业务操作。但是这个方案看起来很美但是实现起来比较麻烦，下面的方案适用于特定的场景，但是实现起来比较简单。</p><h3 style="font-size:20px;word-break:break-all;outline:0px;padding:0px;margin:8px 0px 16px;box-sizing:border-box;color:rgb(85,85,85);font-weight:700;line-height:1.5;font-family:Georgia, sans;background-color:rgb(255,255,255);"><a name="t1" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a><a name="t1" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;" target="_blank"></a><a style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;font-weight:400;" target="_blank"></a>去重表</h3><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">这种方法适用于在业务中有唯一标的插入场景中，比如在以上的支付场景中，如果一个订单只会支付一次，所以订单ID可以作为唯一标识。这时，我们就可以建一张去重表，并且把唯一标识作为唯一索引，在我们实现时，把创建支付单据和写入去去重表，放在一个事务中，如果重复创建，数据库会抛出唯一约束异常，操作就会回滚。</p><h3 style="font-size:20px;word-break:break-all;outline:0px;padding:0px;margin:8px 0px 16px;box-sizing:border-box;color:rgb(85,85,85);font-weight:700;line-height:1.5;font-family:Georgia, sans;background-color:rgb(255,255,255);"><a name="t2" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a><a name="t2" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;" target="_blank"></a><a style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;font-weight:400;" target="_blank"></a>插入或更新</h3><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">这种方法插入并且有唯一索引的情况，比如我们要关联商品品类，其中商品的ID和品类的ID可以构成唯一索引，并且在数据表中也增加了唯一索引。这时就可以使用InsertOrUpdate操作。在mysql数据库中如下：</p><table style="display:table;font-size:14px;font-style:inherit;font-variant:inherit;word-break:break-all;box-sizing:border-box;outline:0px;border-collapse:collapse;border-spacing:0px;font-weight:inherit;width:100%;text-align:left;margin-bottom:24px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);margin-left:0px;color:rgb(79,79,79);border-style:none;table-layout:fixed;"><tbody style="outline:0px;box-sizing:border-box;border:0px;word-break:break-all;"><tr style="border-right-color:initial;word-break:break-all;outline:0px;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;box-sizing:border-box;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(249,249,249);"><td style="font-weight:normal;word-break:break-all;outline:0px;padding:8px;margin:0px;box-sizing:border-box;text-align:left;border:1px solid rgb(221, 221, 221);font-size:14px;color:rgb(79, 79, 79);line-height:22px;"><pre style="overflow-x:auto;word-break:break-all;outline:0px;padding:8px;margin:0px 0px 24px;position:relative;white-space:pre-wrap;word-wrap:break-word;box-sizing:border-box;font-family:'Input Mono', 'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:14px;line-height:1.6;color:rgb(102,102,102);border-style:none;text-align:right;background:rgb(41,41,41);"></pre><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;">1</div><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;">2</div><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;">3</div><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;">4</div></td><td style="text-align:left;word-break:break-all;outline:0px;padding:8px;margin:0px;font-weight:normal;box-sizing:border-box;border:1px solid rgb(221, 221, 221);font-size:14px;color:rgb(79, 79, 79);line-height:22px;border-style:none;vertical-align:middle;"><pre style="word-wrap:break-word;word-break:break-all;outline:0px;padding:8px;margin:0px 0px 24px;position:relative;white-space:pre-wrap;box-sizing:border-box;overflow-x:auto;font-family:'Input Mono', 'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:14px;line-height:1.6;color:rgb(234,234,234);border-style:none;background:rgb(0,0,0);"></pre><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">insert</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">into</span> goods_category (goods_id,category_id,create_time,update_time)</div><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">values</span>(#{goodsId},#{categoryId},<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">now</span>(),<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">now</span>())</div><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">on</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">DUPLICATE</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">KEY</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">UPDATE</span></div><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;">update_time=<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">now</span>()</div></td></tr></tbody></table><h3 style="font-size:20px;word-break:break-all;outline:0px;padding:0px;margin:8px 0px 16px;box-sizing:border-box;color:rgb(85,85,85);font-weight:700;line-height:1.5;font-family:Georgia, sans;background-color:rgb(255,255,255);"><a name="t3" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a><a name="t3" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;" target="_blank"></a><a style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;font-weight:400;" target="_blank"></a>多版本控制</h3><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">这种方法适合在更新的场景中，比如我们要更新商品的名字，这时我们就可以在更新的接口中增加一个版本号，来做幂等</p><table style="display:table;font-size:14px;font-style:inherit;font-variant:inherit;word-break:break-all;box-sizing:border-box;outline:0px;border-collapse:collapse;border-spacing:0px;font-weight:inherit;width:100%;text-align:left;margin-bottom:24px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);margin-left:0px;color:rgb(79,79,79);border-style:none;table-layout:fixed;"><tbody style="outline:0px;box-sizing:border-box;border:0px;word-break:break-all;"><tr style="border-right-color:initial;word-break:break-all;outline:0px;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;box-sizing:border-box;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(249,249,249);"><td style="font-weight:normal;word-break:break-all;outline:0px;padding:8px;margin:0px;box-sizing:border-box;text-align:left;border:1px solid rgb(221, 221, 221);font-size:14px;color:rgb(79, 79, 79);line-height:22px;"><pre style="overflow-x:auto;word-break:break-all;outline:0px;padding:8px;margin:0px 0px 24px;position:relative;white-space:pre-wrap;word-wrap:break-word;box-sizing:border-box;font-family:'Input Mono', 'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:14px;line-height:1.6;color:rgb(102,102,102);border-style:none;text-align:right;background:rgb(41,41,41);"></pre><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;">1</div></td><td style="text-align:left;word-break:break-all;outline:0px;padding:8px;margin:0px;font-weight:normal;box-sizing:border-box;border:1px solid rgb(221, 221, 221);font-size:14px;color:rgb(79, 79, 79);line-height:22px;border-style:none;vertical-align:middle;"><pre style="word-wrap:break-word;word-break:break-all;outline:0px;padding:8px;margin:0px 0px 24px;position:relative;white-space:pre-wrap;box-sizing:border-box;overflow-x:auto;font-family:'Input Mono', 'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:14px;line-height:1.6;color:rgb(234,234,234);border-style:none;background:rgb(0,0,0);"></pre><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;word-break:break-all;color:rgb(122,166,218);"><span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">boolean</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;color:rgb(112,192,177);">updateGoodsName</span><span style="outline:0px;box-sizing:border-box;word-break:break-all;color:rgb(231,140,69);">(<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">int</span> id,String newName,<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">int</span> version)</span></span>;</div></td></tr></tbody></table><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">在实现时可以如下</p><table style="display:table;font-size:14px;font-style:inherit;font-variant:inherit;word-break:break-all;box-sizing:border-box;outline:0px;border-collapse:collapse;border-spacing:0px;font-weight:inherit;width:100%;text-align:left;margin-bottom:24px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);margin-left:0px;color:rgb(79,79,79);border-style:none;table-layout:fixed;"><tbody style="outline:0px;box-sizing:border-box;border:0px;word-break:break-all;"><tr style="border-right-color:initial;word-break:break-all;outline:0px;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;box-sizing:border-box;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(249,249,249);"><td style="font-weight:normal;word-break:break-all;outline:0px;padding:8px;margin:0px;box-sizing:border-box;text-align:left;border:1px solid rgb(221, 221, 221);font-size:14px;color:rgb(79, 79, 79);line-height:22px;"><pre style="overflow-x:auto;word-break:break-all;outline:0px;padding:8px;margin:0px 0px 24px;position:relative;white-space:pre-wrap;word-wrap:break-word;box-sizing:border-box;font-family:'Input Mono', 'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:14px;line-height:1.6;color:rgb(102,102,102);border-style:none;text-align:right;background:rgb(41,41,41);"></pre><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;">1</div></td><td style="text-align:left;word-break:break-all;outline:0px;padding:8px;margin:0px;font-weight:normal;box-sizing:border-box;border:1px solid rgb(221, 221, 221);font-size:14px;color:rgb(79, 79, 79);line-height:22px;border-style:none;vertical-align:middle;"><pre style="word-wrap:break-word;word-break:break-all;outline:0px;padding:8px;margin:0px 0px 24px;position:relative;white-space:pre-wrap;box-sizing:border-box;overflow-x:auto;font-family:'Input Mono', 'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:14px;line-height:1.6;color:rgb(234,234,234);border-style:none;background:rgb(0,0,0);"></pre><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">update</span> goods <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">set</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">name</span>=#{newName},<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">version</span>=#{<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">version</span>} <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">where</span><span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">id</span>=#{<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">id</span>} <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">and</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">version</span>&lt;${<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">version</span>}</div></td></tr></tbody></table><h3 style="font-size:20px;word-break:break-all;outline:0px;padding:0px;margin:8px 0px 16px;box-sizing:border-box;color:rgb(85,85,85);font-weight:700;line-height:1.5;font-family:Georgia, sans;background-color:rgb(255,255,255);"><a name="t4" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;"></a><a name="t4" style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;" target="_blank"></a><a style="outline:0px;cursor:pointer;box-sizing:border-box;color:rgb(78, 161, 219);text-decoration:none;word-break:break-all;font-weight:400;" target="_blank"></a>状态机控制</h3><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">这种方法适合在有状态机流转的情况下，比如就会订单的创建和付款，订单的付款肯定是在之前，这时我们可以通过在设计状态字段时，使用int类型，并且通过值类型的大小来做幂等，比如订单的创建为0，付款成功为100。付款失败为99</p><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">在做状态机更新时，我们就这可以这样控制</p><table style="display:table;font-size:14px;font-style:inherit;font-variant:inherit;word-break:break-all;box-sizing:border-box;outline:0px;border-collapse:collapse;border-spacing:0px;font-weight:inherit;width:100%;text-align:left;margin-bottom:24px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);margin-left:0px;color:rgb(79,79,79);border-style:none;table-layout:fixed;"><tbody style="outline:0px;box-sizing:border-box;border:0px;word-break:break-all;"><tr style="border-right-color:initial;word-break:break-all;outline:0px;border-width:1px 0px 0px;border-right-style:initial;border-bottom-style:initial;border-left-style:initial;box-sizing:border-box;border-bottom-color:initial;border-left-color:initial;border-image:initial;border-top-style:solid;border-top-color:rgb(221, 221, 221);background-color:rgb(249,249,249);"><td style="font-weight:normal;word-break:break-all;outline:0px;padding:8px;margin:0px;box-sizing:border-box;text-align:left;border:1px solid rgb(221, 221, 221);font-size:14px;color:rgb(79, 79, 79);line-height:22px;"><pre style="overflow-x:auto;word-break:break-all;outline:0px;padding:8px;margin:0px 0px 24px;position:relative;white-space:pre-wrap;word-wrap:break-word;box-sizing:border-box;font-family:'Input Mono', 'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:14px;line-height:1.6;color:rgb(102,102,102);border-style:none;text-align:right;background:rgb(41,41,41);"></pre><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;">1</div></td><td style="text-align:left;word-break:break-all;outline:0px;padding:8px;margin:0px;font-weight:normal;box-sizing:border-box;border:1px solid rgb(221, 221, 221);font-size:14px;color:rgb(79, 79, 79);line-height:22px;border-style:none;vertical-align:middle;"><pre style="word-wrap:break-word;word-break:break-all;outline:0px;padding:8px;margin:0px 0px 24px;position:relative;white-space:pre-wrap;box-sizing:border-box;overflow-x:auto;font-family:'Input Mono', 'PT Mono', Consolas, Monaco, Menlo, monospace;font-size:14px;line-height:1.6;color:rgb(234,234,234);border-style:none;background:rgb(0,0,0);"></pre><div style="outline:0px;padding:0px;margin:0px;box-sizing:border-box;word-break:break-all;"><span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">update</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;color:rgb(185,202,74);">`order`</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">set</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">status</span>=#{<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">status</span>} <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">where</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">id</span>=#{<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">id</span>} <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">and</span> <span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">status</span>&lt;#{<span style="outline:0px;box-sizing:border-box;word-break:break-all;background:rgb(0,102,170);color:rgb(195,151,216);">status</span>}</div></td></tr></tbody></table><p style="color:rgb(85,85,85);word-break:break-all;outline:0px;padding:0px;margin:0px 0px 16px;font-size:16px;box-sizing:border-box;font-weight:400;line-height:32px;text-align:justify;background-color:rgb(255,255,255);font-family:Lato, 'PingFang SC', 'Microsoft YaHei', sans-serif;">以上就是保证接口幂等性的一些方法。</p>            </div>
                <span style="display:block;height:0px;visibility:hidden;clear:both;"> </span></div>
				
        	</div>
	
</div></span></div></div></div></div><br/></div></span>
</div></body></html> 