<html>
<head>
  <title>再有人问你synchronized是什么，就把这篇文章发给他。</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="5483"/>
<h1>再有人问你synchronized是什么，就把这篇文章发给他。</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/8/28 10:56</i></td></tr>
<tr><td><b>标签：</b></td><td><i>微信</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://mp.weixin.qq.com/s?__biz=MzIxNjA5MTM2MA==&mid=2652434918&idx=1&sn=4c62fae0ef098454089a3362426882f0&chksm=8c620e69bb15877f040401ac03ffab73d2a62faf0aa8fed5371bd0a0ca12f2c0adaee531eeef&mpshare=1&scene=1&srcid=0828CfUB0faQLibHHexz7pVQ#rd"><i>http://mp.weixin.qq.com/s?__biz=MzIxNjA5MTM2MA==&amp;mid=2652434918&amp;idx=1&amp;sn=4c62fae0ef098454089a3362426882f0&amp;chksm=8c620e69bb15877f040401ac03ffab73d2a62faf0aa8fed5371bd0a0ca12f2c0adaee531eeef&amp;mpshare=1&amp;scene=1&amp;srcid=0828CfUB0faQLibHHexz7pVQ#rd</i></a></td></tr>
</table>
</div>
<br/>

<div><span style="margin:0px;"><div style="padding:8px 0px;margin:8px auto;max-width:700px;"> <div style="padding:20px 16px 12px;margin:0;background-color:#fff"><div style="margin:0;padding:0"><div style="margin:0;padding:0"><h2 style="font-weight:400;margin:0;padding:0;font-size:22px;line-height:1.4;margin-bottom:14px"> 再有人问你synchronized是什么，就把这篇文章发给他。 </h2><div style="margin:0;padding:0;margin-bottom:22px;line-height:20px;font-size:0;word-wrap:break-word;word-break:break-all"><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"><span style="margin:0;padding:0;color:#576b95">Hollis</span></span><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);position:relative"><a style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)"> Java编程 </a></span><em style="padding:0;font-style:normal;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"></em></div><div style="margin:0;padding:0;overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0;padding-left:10px;border-left:3px solid #dbdbdb"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(136,136,136);font-size:14px">来自：Hollis（微信号：hollischuang）</span></p></blockquote><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em">在<a href="https://mp.weixin.qq.com/s?__biz=MzIxNjA5MTM2MA==&amp;mid=2652434841&amp;idx=1&amp;sn=cbd9a98d35a8f6f64821e811b35ea2b3&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">再有人问你Java内存模型是什么，就把这篇文章发给他</a>中我们曾经介绍过，Java语言为了解决并发编程中存在的原子性、可见性和有序性问题，提供了一系列和并发处理相关的关键字，比如synchronized、volatile、final、concurren包等。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">在《深入理解Java虚拟机》中，有这样一段话：</p><blockquote style="max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0;padding-left:10px;border-left:3px solid #dbdbdb;line-height:inherit;padding:15px 15px 15px 1rem;font-size:0.9em;margin-top:1em;margin-bottom:1em;color:rgb(129,145,152);border-left-width:6px;border-left-color:rgb(220,230,240);background:rgb(242,247,251);overflow:auto"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>关键字在需要原子性、可见性和有序性这三种特性的时候都可以作为其中一种解决方案，看起来是“万能”的。的确，大部分并发控制操作都能使用synchronized来完成。</p></blockquote><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">海明威在他的《午后之死》说过的：“冰山运动之雄伟壮观，是因为他只有八分之一在水面上。”</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">对于程序员来说，<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>只是个关键字而已，用起来很简单。之所以我们可以在处理多线程问题时可以不用考虑太多，就是因为这个关键字帮我们屏蔽了很多细节。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">那么，本文就围绕<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>展开，主要介绍其用法、原理，以及如何提供原子性、可见性和有序性保障的等。</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0);font-size:medium"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-left:0.8em;float:left"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:2.5em;display:inline-block;vertical-align:bottom;overflow:hidden !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640.png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;vertical-align:middle;height:auto !important"/></strong></div><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:0.5em;display:inline-block;vertical-align:top;font-size:24px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:17px">synchronized的用法</span></strong></div></div></div><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [1].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:557.778px;float:left;display:inline-block;vertical-align:middle;background-color:rgb(160,160,160);height:auto !important"/></div></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>是Java提供的一个并发控制的关键字。主要有两种用法，分别是同步方法和同步代码块。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:inherit;font-size:inherit">也就是说，</span><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:inherit;font-size:inherit">既可以修饰方法也可以修饰代码块。代码如下：</span></p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;color:inherit;line-height:inherit;margin-top:0;margin-bottom:0;padding:0"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0;font-family:Consolas,Inconsolata,Courier,monospace;border-radius:0;color:rgb(169,183,198);background:rgb(40,43,46);padding:0.5em;display:block !important;word-wrap:normal !important;overflow:auto !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">/**<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/> * @author Hollis 18/08/04.<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/> */</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">public</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">class</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(165,218,45);word-wrap:inherit !important;word-break:inherit !important">SynchronizedDemo</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>     <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">//同步方法</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span> synchronized <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">void</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(165,218,45);word-wrap:inherit !important;word-break:inherit !important">doSth</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(255,152,35);word-wrap:inherit !important;word-break:inherit !important"></span>)</span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        System.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">out</span>.println(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(238,220,112);word-wrap:inherit !important;word-break:inherit !important">&quot;Hello World&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">//同步代码块</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">void</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(165,218,45);word-wrap:inherit !important;word-break:inherit !important">doSth1</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(255,152,35);word-wrap:inherit !important;word-break:inherit !important"></span>)</span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        synchronized (SynchronizedDemo.class){<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>            System.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">out</span>.println(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(238,220,112);word-wrap:inherit !important;word-break:inherit !important">&quot;Hello World&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>}<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">被<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>修饰的代码块及方法，在同一时间，只能被单个线程访问。</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0);font-size:medium"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-left:0.8em;float:left"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:2.5em;display:inline-block;vertical-align:bottom;overflow:hidden !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [2].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;vertical-align:middle;height:auto !important"/></strong></div><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:0.5em;display:inline-block;vertical-align:top;font-size:24px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:17px">synchronized的实现原理</span></strong></div></div></div><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [3].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:557.778px;float:left;display:inline-block;vertical-align:middle;background-color:rgb(160,160,160);height:auto !important"/></div></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>，是Java中用于解决并发情况下数据同步访问的一个很重要的关键字。当我们想要保证一个共享资源在同一时间只会被一个线程访问到时，我们可以在代码中使用<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>关键字对类或者对象加锁。<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">在<a href="http://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&amp;mid=2650120537&amp;idx=1&amp;sn=f56201217c0ca6fde45ee12965b56296&amp;chksm=f36bbc78c41c356ee363367addcdc0b311afb2f9df86a7ee20d21348b3332fd64f273d6028ca&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">深入理解多线程（一）——Synchronized的实现原理</a>中我曾经介绍过其实现原理，为了保证知识的完整性，这里再简单介绍一下，详细的内容请去原文阅读。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">我们对上面的代码进行<a href="http://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&amp;mid=2650120609&amp;idx=1&amp;sn=5659f96310963ad57d55b48cee63c788&amp;chksm=f36bbc80c41c3596a1e4bf9501c6280481f1b9e06d07af354474e6f3ed366fef016df673a7ba&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">反编译</a>，可以得到如下代码：</p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;color:inherit;line-height:inherit;margin-top:0;margin-bottom:0;padding:0"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;line-height:18px;font-size:14px;letter-spacing:0;font-family:Consolas,Inconsolata,Courier,monospace;border-radius:0;color:rgb(169,183,198);background:rgb(40,43,46);padding:0.5em;display:block !important;word-wrap:normal !important;overflow:auto !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span> synchronized <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">void</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(165,218,45);word-wrap:inherit !important;word-break:inherit !important">doSth</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(255,152,35);word-wrap:inherit !important;word-break:inherit !important">()</span></span>;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    descriptor: ()V<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    flags: ACC_PUBLIC, ACC_SYNCHRONIZED<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    Code:<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">stack</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">2</span>, locals=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">1</span>, args_size=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">1</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">0</span>: getstatic     #<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">2</span>                  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">// Field java/lang/System.out:Ljava/io/PrintStream;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">3</span>: ldc           #<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">3</span>                  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">// String Hello World</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">5</span>: invokevirtual #<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">4</span>                  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">8</span>: <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">return</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">public</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">void</span> doSth1();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    descriptor: ()V<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    flags: ACC_PUBLIC<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    Code:<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">stack</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">2</span>, locals=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">3</span>, args_size=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">1</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">0</span>: ldc           #<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">5</span>                  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">// class com/hollis/SynchronizedTest</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">2</span>: dup<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">3</span>: astore_1<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">4</span>: monitorenter<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">5</span>: getstatic     #<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">2</span>                  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">// Field java/lang/System.out:Ljava/io/PrintStream;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>         <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">8</span>: ldc           #<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">3</span>                  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">// String Hello World</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">10</span>: invokevirtual #<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">4</span>                  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(128,128,128);word-wrap:inherit !important;word-break:inherit !important">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">13</span>: aload_1<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">14</span>: monitorexit<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">15</span>: <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">goto</span>          <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">23</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">18</span>: astore_2<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">19</span>: aload_1<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">20</span>: monitorexit<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">21</span>: aload_2<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">22</span>: athrow<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(174,135,250);word-wrap:inherit !important;word-break:inherit !important">23</span>: <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;color:rgb(248,35,117);word-wrap:inherit !important;word-break:inherit !important">return</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">通过反编译后代码可以看出：</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">对于同步方法，JVM采用<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">ACC_SYNCHRONIZED</code>标记符来实现同步。 </p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">对于同步代码块。JVM采用<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorenter</code>、<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorexit</code>两个指令来实现同步。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">在The Java® Virtual Machine Specification中有关于同步方法和同步代码块的实现原理的介绍，我翻译成中文如下：</p><blockquote style="max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0;padding-left:10px;border-left:3px solid #dbdbdb;line-height:inherit;padding:15px 15px 15px 1rem;font-size:0.9em;margin-top:1em;margin-bottom:1em;color:rgb(129,145,152);border-left-width:6px;border-left-color:rgb(220,230,240);background:rgb(242,247,251);overflow:auto"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit">方法级的同步是隐式的。同步方法的常量池中会有一个<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">ACC_SYNCHRONIZED</code>标志。当某个线程要访问某个方法的时候，会检查是否有<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">ACC_SYNCHRONIZED</code>，如果有设置，则需要先获得监视器锁，然后开始执行方法，方法执行之后再释放监视器锁。这时如果其他线程来请求执行方法，会因为无法获得监视器锁而被阻断住。值得注意的是，如果在方法执行过程中，发生了异常，并且方法内部并没有处理该异常，那么在异常被抛到方法外面之前监视器锁会被自动释放。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit">同步代码块使用<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorenter</code>和<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorexit</code>两个指令实现。可以把执行<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorenter</code>指令理解为加锁，执行<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorexit</code>理解为释放锁。 每个对象维护着一个记录着被锁次数的计数器。未被锁定的对象的该计数器为0，当一个线程获得锁（执行<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorenter</code>）后，该计数器自增变为 1 ，当同一个线程再次获得该对象的锁的时候，计数器再次自增。当同一个线程释放锁（执行<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorexit</code>指令）的时候，计数器再自减。当计数器为0的时候。锁将被释放，其他线程便可以获得锁。</p></blockquote><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">无论是<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">ACC_SYNCHRONIZED</code>还是<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorenter</code>、<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorexit</code>都是基于Monitor实现的，在Java虚拟机(HotSpot)中，Monitor是基于C++实现的，由ObjectMonitor实现。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">ObjectMonitor类中提供了几个方法，如<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">enter</code>、<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">exit</code>、<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">wait</code>、<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">notify</code>、<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">notifyAll</code>等。<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">sychronized</code>加锁的时候，会调用objectMonitor的enter方法，解锁的时候会调用exit方法。（关于Monitor详见<a href="http://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&amp;mid=2650120784&amp;idx=1&amp;sn=3436c978f0d7ab3bb672d03689518902&amp;chksm=f36bbf71c41c36672a3a6a7edebe0b913f2f5cf33d75d594d228f086ec7bdb9e253ab0beeae4&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">深入理解多线程（四）—— Moniter的实现原理</a>）</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0);font-size:medium"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-left:0.8em;float:left"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:2.5em;display:inline-block;vertical-align:bottom;overflow:hidden !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [4].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;vertical-align:middle;height:auto !important"/></strong></div><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:0.5em;display:inline-block;vertical-align:top;font-size:24px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:17px">synchronized与原子性</span></strong></div></div></div><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [5].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:557.778px;float:left;display:inline-block;vertical-align:middle;background-color:rgb(160,160,160);height:auto !important"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:inherit;font-size:inherit;letter-spacing:0">原子性是指一个操作是不可中断的，要全部执行完成，要不就都不执行。</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">我们在<a href="http://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&amp;mid=2650121739&amp;idx=1&amp;sn=7b60f56d408457f34d5fc0b200ed32bb&amp;chksm=f36bbb2ac41c323c000e2a51e76c627d17f4759d3a54c520a073506ef3de0c46e196f11cd287&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">Java的并发编程中的多线程问题到底是怎么回事儿</a>中分析过：</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">线程是CPU调度的基本单位。CPU有时间片的概念，会根据不同的调度算法进行线程调度。当一个线程获得时间片之后开始执行，在时间片耗尽之后，就会失去CPU使用权。所以在多线程场景下，由于时间片在线程间轮换，就会发生原子性问题。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">在Java中，为了保证原子性，提供了两个高级的字节码指令<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorenter</code>和<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorexit</code>。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">前面介绍过，这两个字节码指令，在Java中对应的关键字就是<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">通过<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorenter</code>和<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorexit</code>指令，可以保证被<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>修饰的代码在同一时间只能被一个线程访问，在锁未释放之前，无法被其他线程访问到。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">因此，在Java中可以使用<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>来保证方法和代码块内的操作是原子性的。</strong></p><blockquote style="max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:0;padding-left:10px;border-left:3px solid #dbdbdb;line-height:inherit;padding:15px 15px 15px 1rem;font-size:0.9em;margin-top:1em;margin-bottom:1em;color:rgb(129,145,152);border-left-width:6px;border-left-color:rgb(220,230,240);background:rgb(242,247,251);overflow:auto"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit">线程1在执行<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">monitorenter</code>指令的时候，会对Monitor进行加锁，加锁后其他线程无法获得锁，除非线程1主动解锁。即使在执行过程中，由于某种原因，比如CPU时间片用完，线程1放弃了CPU，但是，他并没有进行解锁。而由于<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>的锁是可重入的，下一个时间片还是只能被他自己获取到，还是会继续执行代码。直到所有代码执行完。这就保证了原子性。</p></blockquote><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0);font-size:medium"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-left:0.8em;float:left"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:2.5em;display:inline-block;vertical-align:bottom;overflow:hidden !important"><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [6].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;vertical-align:middle;height:auto !important"/></div><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:0.5em;display:inline-block;vertical-align:top;font-size:24px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:17px">synchronized与可见性</span></div></div></div><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [7].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:557.778px;float:left;display:inline-block;vertical-align:middle;background-color:rgb(160,160,160);height:auto !important"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:inherit;font-size:inherit;letter-spacing:0">可见性是指当多个线程访问同一个变量时，一个线程修改了这个变量的值，其他线程能够立即看得到修改的值。</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">我们在<a href="https://mp.weixin.qq.com/s?__biz=MzIxNjA5MTM2MA==&amp;mid=2652434841&amp;idx=1&amp;sn=cbd9a98d35a8f6f64821e811b35ea2b3&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">再有人问你Java内存模型是什么，就把这篇文章发给他</a>中分析过：</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">Java内存模型规定了所有的变量都存储在主内存中，每条线程还有自己的工作内存，线程的工作内存中保存了该线程中是用到的变量的主内存副本拷贝，线程对变量的所有操作都必须在工作内存中进行，而不能直接读写主内存。不同的线程之间也无法直接访问对方工作内存中的变量，线程间变量的传递均需要自己的工作内存和主存之间进行数据同步进行。所以，就可能出现线程1改了某个变量的值，但是线程2不可见的情况。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">前面我们介绍过，被<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>修饰的代码，在开始执行时会加锁，执行完成后会进行解锁。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">而为了保证可见性，有一条规则是这样的：对一个变量解锁之前，必须先把此变量同步回主存中。这样解锁后，后续线程就可以访问到被修改后的值。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">所以，synchronized关键字锁住的对象，其值是具有可见性的。</strong></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0);font-size:medium"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-left:0.8em;float:left"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:2.5em;display:inline-block;vertical-align:bottom;overflow:hidden !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [8].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;vertical-align:middle;height:auto !important"/></strong></div><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:0.5em;display:inline-block;vertical-align:top;font-size:24px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:17px">synchronized与有序性</span></strong></div></div></div><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [9].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:557.778px;float:left;display:inline-block;vertical-align:middle;background-color:rgb(160,160,160);height:auto !important"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:inherit;font-size:inherit;letter-spacing:0">有序性即程序执行的顺序按照代码的先后顺序执行。</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">我们在<a href="https://mp.weixin.qq.com/s?__biz=MzIxNjA5MTM2MA==&amp;mid=2652434841&amp;idx=1&amp;sn=cbd9a98d35a8f6f64821e811b35ea2b3&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">再有人问你Java内存模型是什么，就把这篇文章发给他</a>中分析过：</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">除了引入了时间片以外，由于处理器优化和指令重排等，CPU还可能对输入代码进行乱序执行，比如load-&gt;add-&gt;save 有可能被优化成load-&gt;save-&gt;add 。这就是可能存在有序性问题。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">这里需要注意的是，<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>是无法禁止指令重排和处理器优化的。也就是说，<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>无法避免上述提到的问题。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">那么，为什么还说<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>也提供了有序性保证呢？</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">这就要再把有序性的概念扩展一下了。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">Java程序中天然的有序性可以总结为一句话：如果在本线程内观察，所有操作都是天然有序的。如果在一个线程中观察另一个线程，所有操作都是无序的。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">以上这句话也是《深入理解Java虚拟机》中的原句，但是怎么理解呢？周志明并没有详细的解释。这里我简单扩展一下，这其实和<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">as-if-serial语义</code>有关。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">as-if-serial</code>语义的意思指：不管怎么重排序（编译器和处理器为了提高并行度），单线程程序的执行结果都不能被改变。编译器和处理器无论如何优化，都必须遵守<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">as-if-serial</code>语义。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">这里不对<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">as-if-serial语义</code>详细展开了，简单说就是，<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">as-if-serial语义</code>保证了单线程中，指令重排是有一定的限制的，而只要编译器和处理器都遵守了这个语义，那么就可以认为单线程程序是按照顺序执行的。当然，实际上还是有重排的，只不过我们无须关心这种重排的干扰。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">所以呢，由于<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>修饰的代码，同一时间只能被同一线程访问。那么也就是单线程执行的。所以，可以保证其有序性。</strong></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0,0,0);font-size:medium"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-left:0.8em;float:left"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:2.5em;display:inline-block;vertical-align:bottom;overflow:hidden !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [10].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;vertical-align:middle;height:auto !important"/></strong></div><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:0.5em;display:inline-block;vertical-align:top;font-size:24px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:17px">synchronized与锁优化</span></strong></div></div></div><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640 [11].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:557.778px;float:left;display:inline-block;vertical-align:middle;background-color:rgb(160,160,160);height:auto !important"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:inherit;font-size:inherit;letter-spacing:0">前面介绍了</span><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;letter-spacing:0;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:inherit;font-size:inherit;letter-spacing:0">的用法、原理以及对并发编程的作用。是一个很好用的关键字。</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>其实是借助Monitor实现的，在加锁时会调用objectMonitor的<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">enter</code>方法，解锁的时候会调用<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">exit</code>方法。事实上，只有在JDK1.6之前，synchronized的实现才会直接调用ObjectMonitor的<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">enter</code>和<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">exit</code>，这种锁被称之为重量级锁。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">所以，在JDK1.6中出现对锁进行了很多的优化，进而出现轻量级锁，偏向锁，锁消除，适应性自旋锁，锁粗化(自旋锁在1.4就有，只不过默认的是关闭的，jdk1.6是默认开启的)，这些操作都是为了在线程之间更高效的共享数据 ，解决竞争问题。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">关于自旋锁、锁粗化和锁消除可以参考<a href="http://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg==&amp;mid=2650121186&amp;idx=1&amp;sn=248d37be27d3bbeb103464b2a96a0ae4&amp;chksm=f36bbec3c41c37d59277ac8539a616b65ec44637f341325056e98323e8780e09c6e4f7cc7a85&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">深入理解多线程（五）—— Java虚拟机的锁优化技术</a>，关于轻量级锁和偏向锁，已经在排期规划中，后面会有文章单独介绍。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:inherit;color:inherit;line-height:inherit;margin-top:1.5em;margin-bottom:1.5em">好啦，关于<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>关键字，我们介绍了其用法、原理、以及如何保证的原子性、顺序性和可见性，同时也扩展的留下了锁优化相关的资料及思考。后面我们会继续介绍<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">volatile</code>关键字以及他和<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:inherit;line-height:inherit;padding:2px 4px;border-radius:4px;margin-right:2px;margin-left:2px;color:rgb(199,37,78);background:rgb(249,242,244)">synchronized</code>的区别等。敬请期待。</p></div><hr style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(51,51,51)"/><p style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;clear:both;min-height:1em;color:rgb(51,51,51);font-size:17px;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:justify;white-space:normal;background-color:rgb(255,255,255);widows:1;outline:none;font-family:微软雅黑;line-height:25.6px;letter-spacing:0.476px;box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:14px;letter-spacing:0.476px;box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;letter-spacing:0.476px;box-sizing:border-box !important;word-wrap:break-word !important">●</span>编号</span><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:14px;letter-spacing:0.476px;box-sizing:border-box !important;word-wrap:break-word !important">773</span><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:14px;letter-spacing:0.476px;box-sizing:border-box !important;word-wrap:break-word !important">，输入编号直达本文</span><br style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important"/></p><p style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;clear:both;min-height:1em;color:rgb(51,51,51);font-size:17px;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:justify;white-space:normal;background-color:rgb(255,255,255);widows:1;outline:none;font-family:微软雅黑;line-height:25.6px;letter-spacing:0.476px;box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:14px;box-sizing:border-box !important;word-wrap:break-word !important">●输入m获取文章目录</span></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(51,51,51)"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:10px;margin-bottom:10px;text-align:center;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;padding-right:1em;padding-left:1em;display:inline-block;word-wrap:break-word !important"><span style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;padding:0.3em 0.5em;display:inline-block;border-radius:0.5em;font-size:14.08px;color:rgb(255,255,255);background-color:rgb(249,110,87);word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:16px;box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important">推荐↓↓↓</strong></span></div></span></div><div style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:-1em;padding:20px 10px 10px;border-width:1px;border-style:solid;border-color:rgb(192,200,209);background-color:rgb(239,239,239);word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;text-align:left;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;clear:both;min-height:1em;outline:none;text-align:center;box-sizing:border-box !important;word-wrap:break-word !important"><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/640.jpg" type="image/jpeg" data-filename="640.jpg" style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;height:auto !important;border-width:0;border-style:initial;border-color:initial;font-family:微软雅黑;font-size:13px;background-color:rgb(255,255,255);box-sizing:border-box !important;word-wrap:break-word !important;visibility:visible !important;width:auto !important" width="auto"/></p><p style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;clear:both;min-height:1em;outline:none;text-align:center;box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;color:rgb(64,118,0);box-sizing:border-box !important;word-wrap:break-word !important">Web开发</strong></p></div></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(51,51,51);text-align:center"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:15px;box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;line-height:25.6px;white-space:pre-wrap;box-sizing:border-box !important;word-wrap:break-word !important">更多推荐</span></strong><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important">《</strong></span><a href="https://mp.weixin.qq.com/s?__biz=MzIxNjA5MTM2MA==&amp;mid=2652433904&amp;idx=2&amp;sn=71bb42696ab0b9e47bb60d5750022151&amp;chksm=8c62127fbb159b69f0838c9f47786f0ef615cd0f918ded865361f44b5d8ddde122f46f5e5f34&amp;scene=21#wechat_redirect" style="margin:0;padding:0;text-decoration:none;max-width:100% !important;-webkit-box-sizing:border-box !important;color:rgb(69,154,233);-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0;font-size:15px;box-sizing:border-box !important;word-wrap:break-word !important" target="_blank"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;color:rgb(255,169,0);box-sizing:border-box !important;word-wrap:break-word !important">18个技术类微信公众号</span></strong><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;color:rgb(255,169,0);box-sizing:border-box !important;word-wrap:break-word !important"></span></strong><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important"></strong></span></a><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;font-size:15px;box-sizing:border-box !important;word-wrap:break-word !important"><strong style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;box-sizing:border-box !important;word-wrap:break-word !important">》</strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(51,51,51)"><span style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;color:rgb(136,136,136);font-size:14px;box-sizing:border-box !important;word-wrap:break-word !important">涵盖：程序人生、算法与数据结构、黑客技术与网络安全、大数据技术、前端开发、Java、Python、Web开发、安卓开发、iOS开发、C/C++、.NET、Linux、数据库、运维等。</span></p></div><a href="https://mp.weixin.qq.com/s?__biz=MzIxNjA5MTM2MA==&amp;mid=2652434918&amp;idx=1&amp;sn=4c62fae0ef098454089a3362426882f0&amp;chksm=8c620e69bb15877f040401ac03ffab73d2a62faf0aa8fed5371bd0a0ca12f2c0adaee531eeef&amp;mpshare=1&amp;scene=1&amp;srcid=0828CfUB0faQLibHHexz7pVQ##" style="text-decoration:none;display:block;-webkit-tap-highlight-color:rgba(0,0,0,0);color:#333;border:1px solid #eaeaea;margin:20px 0;padding:1.17em 0;border-width:0;position:relative"><div style="margin:0;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center;padding:0;font-size:14px"><div style="margin:0;padding:0;-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;box-flex:1;flex:1;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal"><p style="margin:0;padding:0">文章转载自公众号</p></div><div style="margin:0;padding:0;font-size:14px;color:#888;padding-left:1em;white-space:nowrap"><span style="display:inline-block;background-color:#fff;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%;overflow:hidden;vertical-align:middle;margin:0;padding:0;width:20px;height:20px;margin-right:.2em"><img src="再有人问你synchronized是什么，就把这篇文章发给他。_files/0.jpg" type="image/jpeg" data-filename="0.jpg" alt="Hollis" style="display:block;width:100%;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%;background-color:#eee;margin:0;padding:0;height:100% !important"/></span><strong style="margin:0;padding:0;display:inline-block;vertical-align:middle;font-weight:400;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal;max-width:8em;color:#000"> Hollis </strong></div></div></a></div><ul style="margin:0;padding:0"></ul></div></div></div></span>
</div></body></html> 