<html>
<head>
  <title>Spring Boot 优雅重启知多少</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="10149"/>
<h1>Spring Boot 优雅重启知多少</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/5/24 13:40</i></td></tr>
<tr><td><b>标签：</b></td><td><i>微信</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://mp.weixin.qq.com/s?__biz=MzAxNjM2MTk0Ng==&mid=2247484288&idx=2&sn=5fe3a92f876fcc6b3d54087c66097409&chksm=9bf4b335ac833a23d3ed7f5d0757515cff9f5feb57cf2376ecf31a93fd38739203ad329a509d&mpshare=1&scene=1&srcid=0524ZHRPT9d0R4EwaX0DwqgK#rd"><i>http://mp.weixin.qq.com/s?__biz=MzAxNjM2MTk0Ng==&amp;mid=2247484288&amp;idx=2&amp;sn=5fe3a92f876fcc6b3d54087c66097409&amp;chksm=9bf4b335ac833a23d3ed7f5d0757515cff9f5feb57cf2376ecf31a93fd38739203ad329a509d&amp;mpshare=1&amp;scene=1&amp;srcid=0524ZHRPT9d0R4EwaX0DwqgK#rd</i></a></td></tr>
</table>
</div>
<br/>

<div><span style="margin:0px;"><div style="padding:8px 0px;margin:8px auto;max-width:700px;"> <div style="background-color:#fff;padding:20px 16px 12px;margin:0"><div style="margin:0;padding:0"><h2 style="font-weight:400;margin:0;padding:0;font-size:22px;line-height:1.4;margin-bottom:14px"></h2><div style="margin:0;padding:0;margin-bottom:22px;line-height:20px;font-size:0"><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;color:rgba(0,0,0,0.3)">尹吉欢</span><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;position:relative"><a style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)"> Java架构沉思录 </a></span><em style="padding:0;font-style:normal;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;color:rgba(0,0,0,0.3)"></em></div><div lang="=&quot;en&quot;" style="margin:0;padding:0;overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51);text-align:center"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(127,127,127);font-size:14px;line-height:24.5px">点击上方“</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:24.5px;color:rgb(87,107,149);font-size:15px">Java架构沉思录</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(127,127,127);font-size:14px;line-height:24.5px">”，选择“置顶公众号”。</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:14px"></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51);text-align:center"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(127,127,127);font-size:14px">有内涵、有价值的文章第一时间送达！</span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51)"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(127,127,127);font-size:14px"></span></p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1.2em;margin-bottom:1.2em;font-size:1em;font-family:Consolas,Inconsolata,Courier,monospace;line-height:1.2em"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-right:0.15em;margin-left:0.15em;padding:0.5em 0.7em;font-size:0.85em;font-family:Consolas,Inconsolata,Courier,monospace;overflow:auto;border-radius:3px;border-width:1px;border-style:solid;border-color:rgb(204,204,204);display:block !important">作者：尹吉欢 转载自公众号：猿天地</code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">项目在重新发布的过程中，如果有的请求处理时间比较长，还没执行完成，此时重启的话就会导致请求中断，影响业务功能，优雅重启可以保证在停止的时候，不接收外部的新的请求，等待未完成的请求执行完成，这样可以保证数据的完整性。</p><h1 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1.5em;margin-bottom:1.5em;font-weight:bold;font-size:1.6em;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:break-word !important">Spring Boot 1.X</span></h1><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> java.util.concurrent.Executor;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> java.util.concurrent.ThreadPoolExecutor;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> java.util.concurrent.TimeUnit;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.apache.catalina.connector.Connector;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.slf4j.Logger;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.slf4j.LoggerFactory;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.boot.context.embedded.ConfigurableEmbeddedServletContainer;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.boot.context.embedded.EmbeddedServletContainerCustomizer;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.boot.context.embedded.tomcat.TomcatConnectorCustomizer;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.boot.context.embedded.tomcat.TomcatEmbeddedServletContainerFactory;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.context.ApplicationListener;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.context.annotation.Bean;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.context.annotation.Configuration;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.context.event.ContextClosedEvent;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(128,128,128);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">/**<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/> * Spring Boot1.X Tomcat容器优雅停机<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/> * <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@author</span> yinjihuan<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/> *<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/> */</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Configuration</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">class</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">ShutdownConfig</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(128,128,128);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">/**<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     * 用于接受shutdown事件<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     * <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@return</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     */</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Bean</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span> GracefulShutdown <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">gracefulShutdown</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(255,152,35);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">()</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">return</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">new</span> GracefulShutdown();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(128,128,128);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">/**<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     * 用于注入 connector<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     * <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@return</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     */</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Bean</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span> EmbeddedServletContainerCustomizer <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">tomcatCustomizer</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(255,152,35);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">()</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">return</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">new</span> EmbeddedServletContainerCustomizer() {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Override</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">void</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">customize</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(255,152,35);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">(ConfigurableEmbeddedServletContainer container)</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (container <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">instanceof</span> TomcatEmbeddedServletContainerFactory) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    ((TomcatEmbeddedServletContainerFactory) container).addConnectorCustomizers(gracefulShutdown());<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        };<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">private</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">static</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">class</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">GracefulShutdown</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">implements</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">TomcatConnectorCustomizer</span>, <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">ApplicationListener</span>&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">ContextClosedEvent</span>&gt; </span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">private</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">static</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">final</span> Logger log = LoggerFactory.getLogger(GracefulShutdown.class);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">private</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">volatile</span> Connector connector;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">private</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">final</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">int</span> waitTime = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">120</span>;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Override</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">void</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">customize</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(255,152,35);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">(Connector connector)</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.connector = connector;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Override</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">void</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">onApplicationEvent</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(255,152,35);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">(ContextClosedEvent event)</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.connector.pause();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            Executor executor = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.connector.getProtocolHandler().getExecutor();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (executor <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">instanceof</span> ThreadPoolExecutor) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">try</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    ThreadPoolExecutor threadPoolExecutor = (ThreadPoolExecutor) executor;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    log.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;shutdown start&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    threadPoolExecutor.shutdown();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    log.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;shutdown end&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (!threadPoolExecutor.awaitTermination(waitTime, TimeUnit.SECONDS)) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                        log.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Tomcat 进程在&quot;</span> + waitTime + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;秒内无法结束，尝试强制结束&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    log.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;shutdown success&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                } <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">catch</span> (InterruptedException ex) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    Thread.currentThread().interrupt();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>}<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><h1 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1.5em;margin-bottom:1.5em;font-weight:bold;font-size:1.6em;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:break-word !important">Spring Boot 2.X</span></h1><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> java.util.concurrent.Executor;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> java.util.concurrent.ThreadPoolExecutor;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> java.util.concurrent.TimeUnit;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.apache.catalina.connector.Connector;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.slf4j.Logger;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.slf4j.LoggerFactory;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.boot.web.embedded.tomcat.TomcatConnectorCustomizer;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.boot.web.servlet.server.ServletWebServerFactory;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.context.ApplicationListener;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.context.annotation.Bean;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.context.annotation.Configuration;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">import</span> org.springframework.context.event.ContextClosedEvent;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(128,128,128);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">/**<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/> * Spring Boot2.X Tomcat容器优雅停机<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/> * <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@author</span> yinjihuan<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/> *<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/> */</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Configuration</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">class</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">ShutdownConfig</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(128,128,128);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">/**<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     * 用于接受shutdown事件<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     * <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@return</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     */</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Bean</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span> GracefulShutdown <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">gracefulShutdown</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(255,152,35);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">()</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">return</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">new</span> GracefulShutdown();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Bean</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span> ServletWebServerFactory <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">servletContainer</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(255,152,35);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">()</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>      TomcatServletWebServerFactory tomcat = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">new</span> TomcatServletWebServerFactory();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>      tomcat.addConnectorCustomizers(gracefulShutdown());<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">return</span> tomcat;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">private</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">static</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">class</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">GracefulShutdown</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">implements</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">TomcatConnectorCustomizer</span>, <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">ApplicationListener</span>&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">ContextClosedEvent</span>&gt; </span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">private</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">static</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">final</span> Logger log = LoggerFactory.getLogger(GracefulShutdown.class);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">private</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">volatile</span> Connector connector;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">private</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">final</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">int</span> waitTime = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">120</span>;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Override</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">void</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">customize</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(255,152,35);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">(Connector connector)</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.connector = connector;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@Override</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">void</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(165,218,45);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">onApplicationEvent</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(255,152,35);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">(ContextClosedEvent event)</span></span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.connector.pause();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            Executor executor = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.connector.getProtocolHandler().getExecutor();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (executor <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">instanceof</span> ThreadPoolExecutor) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">try</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    ThreadPoolExecutor threadPoolExecutor = (ThreadPoolExecutor) executor;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    log.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;shutdown start&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    threadPoolExecutor.shutdown();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    log.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;shutdown end&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (!threadPoolExecutor.awaitTermination(waitTime, TimeUnit.SECONDS)) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                        log.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Tomcat 进程在&quot;</span> + waitTime + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;秒内无法结束，尝试强制结束&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    log.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;shutdown success&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                } <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">catch</span> (InterruptedException ex) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    Thread.currentThread().interrupt();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>}<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">重启服务脚本：</p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important">NG=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;zh_CN.UTF-8&quot;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>pid=`ps ax | grep fangjia-youfang-web | grep java | head -1 | awk <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">'{print $1}'</span>`<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">echo</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(98,151,85);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">$pid</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(128,128,128);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">#kill $pid</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>curl -X POST http://127.0.0.1:8086/shutdown?token=认证信息<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">while</span> [[ <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(98,151,85);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">$pid</span> != <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;&quot;</span> ]]; <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">do</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">echo</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">'服务停止中...'</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    sleep 1<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    pid=`ps ax | grep fangjia-youfang-web | grep java | head -1 | awk <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">'{print $1}'</span>`<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">done</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">echo</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">'服务停止成功,开始重启服务...'</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>java -jar xxx.jar<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">在重启之前首先发送重启命令到endpoint，或者用kill 进程ID的方式，千万不要用kill -9。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">然后循环检测进程是否存在，如果服务正常停止了，进程也就不存在了，如果进程还在，证明还有未处理完的请求，停止1秒，继续检测。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">关于重启服务，建议用kill方式，这样就不用依赖spring-boot-starter-actuator，如果用endpoint方式，则需要控制好权限，不然随时都有可能被人重启了，可以用security来控制权限，我这边是自己用过滤器来控制的。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">如果用actuator方式重启的话需要配置启用重启功能:<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:break-word !important"/>1.x配置如下：</p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important">endpoints.shutdown.enabled=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">true</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">2.x配置就比较多了，默认只暴露了几个常用的，而且访问地址也有变化，比如health, 以前是直接访问/health,现在需要 /actuator/health才能访问。我们可以通过配置来兼容之前的访问地址。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">shutdown默认是不暴露的，可以通过配置暴露并开始，配置如下：</p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">#访问路径，配置后就和1.x版本路径一样</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>management.endpoints.web.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">base</span>-path=/<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"># 暴露所有，也可以暴露单个或多个</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>management.endpoints.web.exposure.include=*<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"># 开启shutdown</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>management.endpoint.shutdown.enabled=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">true</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">文档请参考：https://docs.spring.io/spring-boot/docs/2.0.2.RELEASE/reference/htmlsingle/#production-ready</p><h1 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1.5em;margin-bottom:1.5em;font-weight:bold;font-size:1.6em;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:break-word !important">如何测试</span></h1><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">测试的话我们可以写一个简单的接口，在接口中等待，然后执行脚本停止项目，如果正常的话会输出服务停止中，等到你的接口执行完成，进程才会消失掉，但是如果超过了你配置的等待时间就会强行退出。</p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(91,218,237);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">@GetMapping(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;/hello&quot;</span>)</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span> String hello() {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    System.<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">out</span>.println(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;req.........&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">try</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        Thread.sleep(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">1000</span> * <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">60</span> * <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">3</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    } <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">catch</span> (InterruptedException e) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        e.printStackTrace();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">return</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;hello&quot;</span>;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>}<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><h1 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:1.5em;margin-bottom:1.5em;font-weight:bold;font-size:1.6em;white-space:normal"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:break-word !important">需要注意的问题</span></h1><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">如果你的项目中有用到其他的线程池，比如Spring的ThreadPoolTaskExecutor，不熟悉的同学可以参考我的这篇文章《Spring Boot Async异步执行》</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">在发送停止命令后如果ThreadPoolTaskExecutor有线程还没处理完的话，这个时候进程是不会自动关闭的。这个时候我们需要对线程池进行关闭处理，增加代码如下：</p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important">AsyncTaskExecutePool asyncTaskExecutePool = event.getApplicationContext().getBean(AsyncTaskExecutePool.class);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>Executor executors = asyncTaskExecutePool.getAsyncExecutor();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">try</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (executors <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">instanceof</span> ThreadPoolTaskExecutor) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>           ThreadPoolTaskExecutor threadPoolExecutor = (ThreadPoolTaskExecutor) executors;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>           log.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Async shutdown start&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>           threadPoolExecutor.setWaitForTasksToCompleteOnShutdown(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">true</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>           threadPoolExecutor.setAwaitTerminationSeconds(waitTime);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>           threadPoolExecutor.shutdown();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>      }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>} <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">catch</span> (<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">Exception</span> ex) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>     Thread.currentThread().interrupt();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>}<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">ThreadPoolTaskExecutor只有shutdown方法，没有awaitTermination方法，通过查看源码，在shutdown之前设置setWaitForTasksToCompleteOnShutdown和setAwaitTerminationSeconds同样能实现awaitTermination。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">源码如下：</p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">public</span> void shutdown() {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (logger.isInfoEnabled()) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            logger.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Shutting down ExecutorService&quot;</span> + (<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.beanName != <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">null</span> ? <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot; '&quot;</span> + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.beanName + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;'&quot;</span> : <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;&quot;</span>));<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.executor != <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">null</span>) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.waitForTasksToCompleteOnShutdown) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.executor.shutdown();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">else</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">for</span> (Runnable remainingTask : <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.executor.shutdownNow()) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    cancelRemainingTask(remainingTask);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            awaitTerminationIfNecessary(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.executor);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">当waitForTasksToCompleteOnShutdown为true的时候就直接调用executor.shutdown();，最后执行awaitTerminationIfNecessary方法。</p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">private</span> void awaitTerminationIfNecessary(ExecutorService executor) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.awaitTerminationSeconds &gt; <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">0</span>) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">try</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (!executor.awaitTermination(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.awaitTerminationSeconds, TimeUnit.SECONDS)) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (logger.isWarnEnabled()) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                        logger.warn(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Timed out while waiting for executor&quot;</span> +<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                                (<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.beanName != <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">null</span> ? <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot; '&quot;</span> + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.beanName + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;'&quot;</span> : <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;&quot;</span>) + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot; to terminate&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">catch</span> (InterruptedException ex) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (logger.isWarnEnabled()) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                    logger.warn(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Interrupted while waiting for executor&quot;</span> +<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                            (<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.beanName != <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(174,135,250);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">null</span> ? <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot; '&quot;</span> + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">this</span>.beanName + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;'&quot;</span> : <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;&quot;</span>) + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot; to terminate&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                Thread.currentThread().interrupt();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>    }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">awaitTerminationIfNecessary中会判断属性awaitTerminationSeconds 如果与值的话就执行关闭等待检测逻辑，跟我们处理tomcat关闭的代码是一样的。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">发现这样做之后好像没什么效果，于是我换了一种写法，直接通过获取ThreadPoolTaskExecutor中的ThreadPoolExecutor来执行关闭逻辑：</p><pre style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-top:0;margin-bottom:0;padding:0;background-color:rgb(255,255,255);font-size:16px;letter-spacing:0.544px;text-align:justify;color:rgb(62,62,62);line-height:inherit;word-wrap:break-word !important"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;margin-right:2px;margin-left:2px;padding:0.5em;font-size:14px;color:rgb(169,183,198);line-height:18px;border-radius:0;background:rgb(40,43,46);font-family:Consolas,Inconsolata,Courier,monospace;display:block;overflow-x:auto;letter-spacing:0;word-wrap:normal !important;word-break:normal !important;overflow-y:auto !important">AsyncTaskExecutePool asyncTaskExecutePool = event.getApplicationContext().getBean(AsyncTaskExecutePool.class);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>Executor executors = asyncTaskExecutePool.getAsyncExecutor();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">try</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (executors instanceof ThreadPoolTaskExecutor) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            ThreadPoolTaskExecutor threadPoolExecutor = (ThreadPoolTaskExecutor) executors;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">log</span>.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Async shutdown start&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            threadPoolExecutor.getThreadPoolExecutor().shutdown();<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">log</span>.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Async shutdown end&quot;</span>+threadPoolExecutor.getThreadPoolExecutor().isTerminated());<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">if</span> (!threadPoolExecutor.getThreadPoolExecutor().awaitTermination(waitTime, TimeUnit.SECONDS)) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>                <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">log</span>.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Tomcat 进程在&quot;</span> + waitTime + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;秒内无法结束，尝试强制结束&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>            <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">log</span>.info(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(238,220,112);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">&quot;Async shutdown success&quot;</span>);<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>       }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>} <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:rgb(248,35,117);line-height:inherit;word-wrap:inherit !important;word-break:inherit !important">catch</span> (Exception ex) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>      Thread.currentThread().interrupt(); <br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/>}<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;font-size:inherit;color:inherit;line-height:inherit;word-wrap:inherit !important;word-break:inherit !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:1.5em;margin-bottom:1.5em;white-space:normal;min-height:1em">这种方式也没用达到我想要的效果，当我发出kill命令之后，直接就退出了，其实我有一个后台线程在ThreadPoolTaskExecutor中运行，通过输出的日志看到，只要调用了shutdown，isTerminated方法返回的就是true,说已经关闭了，这块还没找到原因，有研究出来的小伙伴还请分享出来。</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal;color:rgb(51,51,51)"><div style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:8.5px;margin-bottom:8.5px;padding:8.5px;width:518.4px;text-align:center"><div style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding:10px;box-shadow:rgba(159,160,160,0.498) 0 0 10px;display:inline-block;vertical-align:top"><div style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding:7px;box-shadow:rgba(0,0,0,0.29) 0 0 10px inset"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:17px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:18px"><strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important">Java架构沉思录</strong></span></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:17px">一码不扫，何扫天下<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;border-color:rgb(51,51,51);border-style:none;border-width:0"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><img src="Spring Boot 优雅重启知多少_files/640.jpg" type="image/jpeg" data-filename="640.jpg" border="0" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;vertical-align:middle;visibility:visible !important;width:258px !important" title="undefined" width="258"/></div></div></div></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;white-space:normal;min-height:1em;color:rgb(51,51,51)"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal;color:rgb(51,51,51);text-align:center"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:-webkit-flex;justify-content:center;width:650px"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:160px"><img src="Spring Boot 优雅重启知多少_files/640.png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:block;visibility:visible !important;width:160px !important" width="100%"/></div><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:-18px;margin-bottom:-28px;color:rgb(63,62,63);letter-spacing:1px;line-height:50px">推荐阅读</div><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;width:160px"><img src="Spring Boot 优雅重启知多少_files/640 [1].png" type="image/png" data-filename="640.png" style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;display:block;visibility:visible !important;width:160px !important" width="100%"/></div></div></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:17px"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></div><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:2.2em"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:10px;margin-bottom:10px;min-height:17px;line-height:29.75px"><a href="http://mp.weixin.qq.com/s?__biz=MzAxNjM2MTk0Ng==&amp;mid=2247484261&amp;idx=1&amp;sn=f0a028c128d0dc538da8293b881de1bc&amp;chksm=9bf4b3d0ac833ac6c7899e6088abc129e136069b9d6ff94151c9ae76693138d6fbf5e32d1e1a&amp;scene=21#wechat_redirect" style="margin:0;padding:0;text-decoration:none;max-width:100% !important;-webkit-box-sizing:border-box !important;color:rgb(87,107,149);-webkit-tap-highlight-color:rgba(0,0,0,0);box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">什么是一致性哈希算法</a><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:10px;margin-bottom:10px;min-height:17px;line-height:29.75px"><a href="http://mp.weixin.qq.com/s?__biz=MzAxNjM2MTk0Ng==&amp;mid=2247484239&amp;idx=1&amp;sn=2b6404c23b450cbf202925cc1f430112&amp;chksm=9bf4b3faac833aeca69b8c66249293cfa5b358161b4ef79406b4972f213eac679e6ec5580606&amp;scene=21#wechat_redirect" style="margin:0;padding:0;text-decoration:none;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(87,107,149);-webkit-tap-highlight-color:rgba(0,0,0,0)" target="_blank">MySQL在并发场景下的优化手段</a><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-top:10px;margin-bottom:10px;min-height:17px;line-height:29.75px"><a href="http://mp.weixin.qq.com/s?__biz=MzAxNjM2MTk0Ng==&amp;mid=2247484283&amp;idx=1&amp;sn=36fbef86f889d39cbbcdab1c4c566f9b&amp;chksm=9bf4b3ceac833ad80989a51d1c8f8e9b65b0f85df79250de56be96206edaeae83502809db006&amp;scene=21#wechat_redirect" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important" target="_blank">缓存的正确使用方式，你都会了吗</a></p></li></ul><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></div><a href="https://mp.weixin.qq.com/s?__biz=MzAxNjM2MTk0Ng==&amp;mid=2247484288&amp;idx=2&amp;sn=5fe3a92f876fcc6b3d54087c66097409&amp;chksm=9bf4b335ac833a23d3ed7f5d0757515cff9f5feb57cf2376ecf31a93fd38739203ad329a509d&amp;mpshare=1&amp;scene=1&amp;srcid=0524ZHRPT9d0R4EwaX0DwqgK##" style="text-decoration:none;display:block;padding:.75em 1em 0;-webkit-tap-highlight-color:rgba(0,0,0,0);color:#333;border:1px solid #eaeaea;margin:20px 0"><p style="margin:0;padding:0;position:relative;padding-bottom:.5em;font-size:15px">内容转载自公众号</p><div style="margin:0;padding:10px 0;display:flex;-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;align-items:center"><div style="margin:0;padding:0"><span style="display:inline-block;background-color:#fff;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%;overflow:hidden;vertical-align:middle;margin:0;width:27px;height:27px;padding:0;margin-right:.5em"><img src="Spring Boot 优雅重启知多少_files/0.jpg" type="image/jpeg" data-filename="0.jpg" alt="猿天地" style="display:block;width:100%;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%;background-color:#eee;margin:0;padding:0;height:100% !important"/></span></div><div style="margin:0;padding:0;-webkit-box-flex:1;-webkit-flex:1;-ms-flex:1;box-flex:1;flex:1;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal"> 猿天地 </div><div style="margin:0;padding:0;font-size:14px;color:#888;padding-left:1em;white-space:nowrap">了解更多</div></div></a></div><ul style="margin:0;padding:0"></ul></div></div></span>
</div></body></html> 