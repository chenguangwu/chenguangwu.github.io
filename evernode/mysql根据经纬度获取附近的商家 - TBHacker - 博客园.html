<html>
<head>
  <title>mysql根据经纬度获取附近的商家 - TBHacker - 博客园</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="11725"/>
<h1>mysql根据经纬度获取附近的商家 - TBHacker - 博客园</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/2/19 9:32</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://www.cnblogs.com/jiqing9006/p/8954831.html"><i>https://www.cnblogs.com/jiqing9006/p/8954831.html</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div><div style="font-family:&quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color:rgb(0, 0, 0);background:url(&quot;/Skins/coffee/images/bg_body.gif&quot;) left top;font-size:14px;line-height:1.5;text-size-adjust:none;"><div style="min-width:auto;"><div style="min-width:auto;text-align:left;"><div style="background:transparent;text-align:left;overflow-x:hidden;"><div style="background:url(&quot;/Skins/coffee/images/bg_left.gif&quot;) left top repeat-x rgb(254, 254, 242);"><div><div style="text-overflow:ellipsis;overflow:hidden;word-break:break-all;"><div><h1 style="margin:0px;padding:0px;font-weight:bold;float:left;line-height:1.5;width:100%;clear:both;font-size:14px;padding-left:5px;"><a href="https://www.cnblogs.com/jiqing9006/p/8954831.html" style="margin:0px;padding:0px;color:rgb(7, 93, 179);text-decoration:none;">mysql根据经纬度获取附近的商家</a>
		</h1>
		<div style="clear:both;margin:0px;padding:0px;"></div>
		<div style="margin:0px;padding:5px 2px 5px 5px;line-height:1.5;color:rgb(0, 0, 0);font-size:13px;margin-top:5px;">
			<div style="margin-bottom:20px;word-break:break-word;margin:0px;padding:0px;"><p style="margin:10px auto;text-indent:0px;padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:0.95rem;font-family:&quot;lucida grande&quot;, &quot;lucida sans unicode&quot;, lucida, helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;">创建geo表</p>
<pre style="margin-top:10px;margin-bottom:10px;white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;"><code style="display:block;overflow-x:auto;padding:0.5em;background:rgb(40, 44, 52);color:rgb(171, 178, 191);line-height:1.5;margin:auto;vertical-align:middle;font-family:&quot;Courier New&quot;, sans-serif;font-size:12px;border:1px solid rgb(204, 204, 204);border-radius:3px;height:auto;"><span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">create</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">table</span> geo(
    geo_id <span style="color:rgb(230, 192, 123);margin:0px;padding:0px;line-height:1.5;">INT</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">NOT</span> <span style="color:rgb(86, 182, 194);margin:0px;padding:0px;line-height:1.5;">NULL</span> AUTO_INCREMENT,
    lng <span style="color:rgb(230, 192, 123);margin:0px;padding:0px;line-height:1.5;">float</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">NOT</span> <span style="color:rgb(86, 182, 194);margin:0px;padding:0px;line-height:1.5;">NULL</span>,
    lat <span style="color:rgb(230, 192, 123);margin:0px;padding:0px;line-height:1.5;">float</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">NOT</span> <span style="color:rgb(86, 182, 194);margin:0px;padding:0px;line-height:1.5;">NULL</span>,
    <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">name</span> <span style="color:rgb(230, 192, 123);margin:0px;padding:0px;line-height:1.5;">VARCHAR</span>(<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">100</span>) <span style="color:rgb(86, 182, 194);margin:0px;padding:0px;line-height:1.5;">NULL</span>,
    PRIMARY <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">KEY</span> ( geo_id )
);</code></pre>
<pre style="margin-top:10px;margin-bottom:10px;white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;"><code style="display:block;overflow-x:auto;padding:0.5em;background:rgb(40, 44, 52);color:rgb(171, 178, 191);line-height:1.5;margin:auto;vertical-align:middle;font-family:&quot;Courier New&quot;, sans-serif;font-size:12px;border:1px solid rgb(204, 204, 204);border-radius:3px;height:auto;"><span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INSERT</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INTO</span> <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`geo`</span>(<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lng`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lat`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`name`</span>) <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">VALUES</span> (<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">118.302416</span>,<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">33.958887</span>,<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">&quot;实验小学&quot;</span>);
<span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INSERT</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INTO</span> <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`geo`</span>(<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lng`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lat`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`name`</span>) <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">VALUES</span> (<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">118.303997</span>,<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">33.95188</span>,<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">&quot;宿迁市人民医院&quot;</span>);
<span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INSERT</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INTO</span> <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`geo`</span>(<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lng`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lat`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`name`</span>) <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">VALUES</span> (<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">118.302991</span>,<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">33.935828</span>,<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">&quot;宿迁学院&quot;</span>);
<span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INSERT</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INTO</span> <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`geo`</span>(<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lng`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lat`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`name`</span>) <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">VALUES</span> (<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">118.28215</span>,<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">33.959307</span>,<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">&quot;金陵名府&quot;</span>);
<span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INSERT</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INTO</span> <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`geo`</span>(<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lng`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lat`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`name`</span>) <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">VALUES</span> (<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">118.290081</span>,<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">33.925404</span>,<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">&quot;润园&quot;</span>);
<span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INSERT</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">INTO</span> <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`geo`</span>(<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lng`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`lat`</span>, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`name`</span>) <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">VALUES</span> (<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">118.354751</span>,<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">33.959007</span>,<span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">&quot;国际馆&quot;</span>);</code></pre>
<p style="margin:10px auto;text-indent:0px;padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:0.95rem;font-family:&quot;lucida grande&quot;, &quot;lucida sans unicode&quot;, lucida, helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;">下面是google给的解决方案（基于公里km）。</p>
<pre style="margin-top:10px;margin-bottom:10px;white-space:pre-wrap;overflow-wrap:break-word;margin:0px;padding:0px;"><code style="display:block;overflow-x:auto;padding:0.5em;background:rgb(40, 44, 52);color:rgb(171, 178, 191);line-height:1.5;margin:auto;vertical-align:middle;font-family:&quot;Courier New&quot;, sans-serif;font-size:12px;border:1px solid rgb(204, 204, 204);border-radius:3px;height:auto;"><span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">SELECT</span>  
  geo_id, <span style="color:rgb(152, 195, 121);margin:0px;padding:0px;line-height:1.5;">`name`</span>,(  
    <span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">6371</span> * <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">acos</span> (  
      <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">cos</span> ( <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">radians</span>(<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">33.958887</span>) )  
      * <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">cos</span>( <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">radians</span>( lat ) )  
      * <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">cos</span>( <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">radians</span>( lng ) - <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">radians</span>(<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">118.302416</span>) )  
      + <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">sin</span> ( <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">radians</span>(<span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">33.958887</span>) )  
      * <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">sin</span>( <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">radians</span>( lat ) )  
    )  
  ) <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">AS</span> distance  
<span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">FROM</span> geo
<span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">HAVING</span> distance &lt; <span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">20</span>  
<span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">ORDER</span> <span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">BY</span> distance 
<span style="color:rgb(198, 120, 221);margin:0px;padding:0px;line-height:1.5;">LIMIT</span> <span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">0</span> , <span style="margin:0px;padding:0px;line-height:1.5;color:rgb(209, 154, 102);">20</span>；</code></pre>
<p style="margin:10px auto;text-indent:0px;padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:0.95rem;font-family:&quot;lucida grande&quot;, &quot;lucida sans unicode&quot;, lucida, helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;">其中33.958887是纬度，118.302416是经度。</p>
<p style="margin:10px auto;text-indent:0px;padding:0px;line-height:1.5;color:rgb(0, 0, 0);font-size:0.95rem;font-family:&quot;lucida grande&quot;, &quot;lucida sans unicode&quot;, lucida, helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;"><img src="mysql根据经纬度获取附近的商家 - TBHacker - 博客园_files/422101-20180426201904213-1032104069.png" type="image/png" data-filename="422101-20180426201904213-1032104069.png" height="187" style="border:0px;max-width:300px;height:auto;margin:0px;padding:0px;" width="527"/></p></div></div></div></div></div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 