<html>
<head>
  <title>或许你不知道的10条SQL技巧</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="9175"/>
<h1>或许你不知道的10条SQL技巧</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/11/27 14:18</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://mp.weixin.qq.com/s/dGcgts4NNTmVQNRT-j2MZw"><i>https://mp.weixin.qq.com/s/dGcgts4NNTmVQNRT-j2MZw</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="text-size-adjust:100%;line-height:1.6;"><div style="font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;line-height:inherit;background-color:rgb(255, 255, 255);"><div><div style="background-color:rgb(255, 255, 255);font-size:16px;word-wrap:break-word;"><div style="background-color:rgb(255, 255, 255);"><div>
                
                <h2 style="margin:0px;padding:0px;font-weight:400;font-size:24px;margin-bottom:14px;line-height:1.4;padding-bottom:10px;border-bottom:1px solid rgb(231, 231, 235);">
                    或许你不知道的10条SQL技巧                                    </h2>
                <div style="margin:0px;padding:0px;margin-bottom:18px;line-height:20px;font-size:0px;position:relative;z-index:1;">
                                        <span style="font-size:15px;margin:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;padding:1px 0.5em;border:1px solid rgb(158, 158, 158);color:rgb(140, 140, 140);border-radius:20% 50%;line-height:1.1;max-width:none;">原创</span>
                                                            <em style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;color:rgb(140, 140, 140);max-width:none;font-style:normal;">2017-07-16</em>

                                        <em style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;color:rgb(140, 140, 140);max-width:none;font-style:normal;">58沈剑</em>
                                        <a href="https://mp.weixin.qq.com/s/dGcgts4NNTmVQNRT-j2MZw##" style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;max-width:none;display:inline-block;">架构师之路</a>
                    

                    
                </div>
                
                
                
                
                                                
                                                                
                
                <div style="margin:0px;padding:0px;overflow:hidden;color:rgb(62, 62, 62);min-height:350px;position:relative;">
                    

                    

                    
                    
                    <p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">这几天在写索引，想到一些有意思的</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;">TIPS</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">，希望大家有收获。</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">一、一些常见的</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;">SQL</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">实践</span></strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">1</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）负向条件查询不能使用索引</span></span></strong></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from order where status<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">!=</span>0 and
stauts<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">!=</span>1</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">not in/not exists</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">都不是好习惯</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">可以优化为</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">in</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">查询：</span></span></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from order where status <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">in</span>(2,3)</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">2</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）前导模糊查询不能使用索引</span></span></strong></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from order where desc like <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">'%XX'</span></span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">而非前导模糊查询则可以：</span></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from order where desc like <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">'XX%'</span></span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">3</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）数据区分度不大的字段不宜使用索引</span></span></strong></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">sex</span>=1</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">原因：性别只有男，女，每次过滤掉的数据很少，不宜使用索引。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">经验上，能过滤</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">80%</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">数据时就可以使用索引。对于订单状态，如果状态值很少，不宜使用索引，如果状态值很多，能够过滤大量数据，则应该建立索引。</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">4</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）在属性上进行计算不能命中索引</span></span></strong></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:12px;"><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(62, 62, 62);font-family:Calibri;">select * from order where <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">YEAR(date) </span>&lt;
= </span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;">'2017'</span></span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">即使</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">date</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">上建立了索引，也会全表扫描，</span></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">可优化为值计算：</span></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from order where date &lt; =
CURDATE()</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">或者：</span></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from order where date &lt; = '2017-01-01'</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">二、并非周知的</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;">SQL</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">实践</span></strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">5</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）如果业务大部分是单条查询，使用</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">Hash</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">索引性能更好，例如用户中心</span></span></strong></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where uid=?</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where
login_name=?</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">原因：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">B-Tree</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">索引的时间复杂度是</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">O(log(n))</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">Hash</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">索引的时间复杂度是</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">O(1)</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">6</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）允许为</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">null</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">的列，查询有潜在大坑</span></span></strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">单列索引不存</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">null</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">值，复合索引不存全为</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">null</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">的值，如果列允许为</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">null</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">，可能会得到“不符合预期”的结果集</span></span></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where name <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">!=</span> 'shenjian'</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">如果</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">name</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">允许为</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">null</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">，索引不存储</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">null</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">值，结果集中不会包含这些记录。</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">所以，请使用not null约束以及默认值。</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">7</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）复合索引最左前缀，并不是值</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">SQL</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">语句的</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">where</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">顺序要和复合索引一致</span></span></strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">用户中心建立了</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">(login_name, passwd)</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">的复合索引</span></span></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">login_name=? and
passwd=?</span></span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">passwd=? and login_name=?</span></span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">都能够命中索引</span></strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where login_name=?</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">也能命中索引</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">，满足<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">复合索引</span>最左前缀</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where passwd=?</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">不能命中索引</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">，不满足<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">复合索引</span>最左前缀</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">8</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）使用</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">ENUM</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">而不是字符串</span></span></strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">ENUM保存</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">的是</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">TINYINT</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">，别在枚举中搞一些“中国”“北京”“技术部”这样的字符串，字符串空间又大，效率又低。</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:18px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">三、小众但有用的</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;">SQL</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;">实践</span></strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">9</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）如果明确知道只有一条结果返回，</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">limit 1</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">能够提高效率</span></span></strong></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where login_name=?</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">可以优化为：</span></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from user where login_name=? limit
1</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">原因：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">你知道只有一条结果，但数据库并不知道，明确告诉它，让它主动停止游标移动</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">10</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）把计算放到业务层而不是数据库层，除了节省数据的</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">CPU</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">，还有意想不到的查询缓存优化效果</span></span></strong></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">select * from order where date &lt; =
CURDATE()</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">这不是一个好的</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">SQL</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">实践，应该优化为：</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">$curDate = date('Y-m-d');</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">$res = mysql_query(</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:12px;">    'select * from order
where date &lt; = $curDate');</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">原因：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;"></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">释放了数据库的</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">CPU</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">多次调用，传入的</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">SQL</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">相同，才可以利用查询缓存</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">（</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">11</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">）强制类型转换会全表扫描</span></span></strong></p><ul style="margin:0px;padding:0px;padding-left:30px;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:disc;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:Calibri;font-size:12px;">select * from user where phone=13800001234</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">你以为会命中</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">phone</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">索引么？大错特错</span></span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">了，这个语句究竟要怎么改？</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">末了，再加一条，不要使用</span><span lang="EN-US" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;">select *（潜台词，文章的SQL都不合格 =_=）</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">，只返回需要的列，能够大大的节省数据传输量，与数据库的内存使用量哟。</span></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:Calibri;font-size:14px;"> </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-family:宋体;font-size:14px;">思路比结论重要，希望有收获，帮忙<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 76, 0);font-family:宋体;font-size:14px;">转</span>一下。</span></p>
                </div>
                
                
                
                                
                

                
                                
                                
                                            </div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 