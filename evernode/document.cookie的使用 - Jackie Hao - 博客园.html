<html>
<head>
  <title>document.cookie的使用 - Jackie Hao - 博客园</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6121"/>
<h1>document.cookie的使用 - Jackie Hao - 博客园</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/10/10 10:22</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://www.cnblogs.com/Jackie-sky/p/3672544.html"><i>http://www.cnblogs.com/Jackie-sky/p/3672544.html</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12px;font-family:&quot;black verdana&quot;;line-height:150%;"><div style="font-family:&quot;PingFang SC&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;line-height:150%;font-size:14px;"><div style="font-family:verdana;word-wrap:break-word;background:transparent;"><div style="font-family:verdana;word-wrap:break-word;background:url(&quot;images/bg_left_border.gif&quot;) right top repeat-y;"><div style="font-family:verdana;word-wrap:break-word;background:url(&quot;images/line.gif&quot;) left top repeat-y;"><div style="font-family:verdana;word-wrap:break-word;"><div style="font-family:verdana;word-wrap:break-word;"><div style="font-family:verdana;word-wrap:break-word;font-size:14px;background:url(&quot;images/post_line.gif&quot;) left bottom repeat-x;line-height:1.6;"><div style="font-family:verdana;word-wrap:break-word;word-break:break-word;"><p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">设置cookie<br/>每个cookie都是一个名/值对，可以把下面这样一个字符串赋值给document.cookie：<br/>document.cookie=&quot;userId=828&quot;;<br/>如果要一次存储多个名/值对，可以使用分号加空格（; ）隔开，例如： </span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">document.cookie=&quot;userId=828; </span></span><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">userName=hulk&quot;; </span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">在cookie的名或值中不能使用分号（;）、逗号（,）、等号（=）以及空格。</span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">在cookie的名中做</span></span><span style="color:#000000;font-size:medium;">到这点很容易，但要保存的值是不确定的。如何来存储这些值呢？</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">方法是用escape()函数进行编</span><span style="color:#000000;font-size:medium;">码，它能将一些特殊符号使用十六进制表示，例如空格将会编码为“20%”，从而可以存储于</span><span style="color:#000000;font-size:medium;">cookie值中，而且使用此种方案还可以避免中文乱码的出现。例如： </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">document.cookie=&quot;str=&quot;+escape(&quot;I love ajax&quot;); </span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">相当于： document.cookie=&quot;str=I%20love%20ajax&quot;; </span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">当使用escape()编码后，在取出值以后需要使用unescape()进行解码才能得到原来的cookie值，</span></span><span style="color:#000000;font-size:medium;">这在前面已经介绍过。 尽管document.cookie看上去就像一个属性，可以赋不同的值。但它和一般的属性不一样，改变</span><span style="color:#000000;font-size:medium;">它的赋值并不意味着丢失原来的值，例如连续执行下面两条语句： </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">document.cookie=&quot;userId=828&quot;; </span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">document.cookie=&quot;userName=hulk&quot;; </span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">这时浏览器将维护两个cookie，分别是userId和userName，因此给document.cookie赋值更像执</span></span><span style="color:#000000;font-size:medium;">行类似这样的语句：</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">document.addCookie(&quot;userId=828&quot;);</span></span><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;"><br/>document.addCookie(&quot;userName=hulk&quot;);</span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">事实上，浏览器就是按照这样的方式来设置cookie的，如果要改变一个cookie的值，只需重新赋</span></span><span style="color:#000000;font-size:medium;">值，例如： </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">document.cookie=&quot;userId=929&quot;;<br/>这样就将名为userId的cookie值设置为了929。</span></span></p>
<p style="margin:10px auto;text-indent:0px;"> </p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">获取cookie的值 </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">下面介绍如何获取cookie的值。cookie的值可以由document.cookie直接获得： </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">var strCookie=document.cookie; </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">这将获得以分号隔开的多个名/值对所组成的字符串，这些名/值对包括了该域名下的所有cookie</span><span style="color:#000000;font-size:medium;">。例如： </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;<br/>&lt;!--<br/>document.cookie=&quot;userId=828&quot;;<br/>document.cookie=&quot;userName=hulk&quot;;<br/>var strCookie=document.cookie;<br/>alert(strCookie);<br/>//--&gt;<br/>&lt;/script&gt;</span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">由此可见，只能够一次获取所有的cookie值，而不能指定cookie</span></span><span style="color:#000000;font-size:medium;">名称来获得指定的值，这正是处理cookie值最麻烦的一部分。</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">用户必须自己分析这个字符串，来</span><span style="color:#000000;font-size:medium;">获取指定的cookie值，例如，要获取userId的值，可以这样实现：</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;<br/>&lt;!--<br/>//设置两个cookie<br/>document.cookie=&quot;userId=828&quot;;<br/>document.cookie=&quot;userName=hulk&quot;;<br/>//获取cookie字符串<br/>var strCookie=document.cookie;<br/>//将多cookie切割为多个名/值对<br/>var arrCookie=strCookie.split(&quot;; &quot;);<br/>var userId;<br/>//遍历cookie数组，处理每个cookie对<br/>for(var i=0;i&lt;arrCookie.length;i++){<br/>             var arr=arrCookie[i].split(&quot;=&quot;);<br/>             //找到名称为userId的cookie，并返回它的值<br/>             if(&quot;userId&quot;==arr[0]){<br/>                    userId=arr[1];<br/>                    break;<br/>             }<br/>}<br/>alert(userId);<br/>//--&gt;<br/>&lt;/script&gt;</span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">这样就得到了单个cookie的值</span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">用类似的方法，可以获取一个或多个cookie的值，其主要的技巧仍然是字符串和数组的相关操作</span><span style="color:#000000;font-size:medium;">。</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">给cookie设置终止日期 到现在为止，所有的cookie都是单会话cookie，即浏览器关闭后这些cookie将会丢失，事实上这</span><span style="color:#000000;font-size:medium;">些cookie仅仅是存储在内存中，而没有建立相应的硬盘文件。</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">在实际开发中，cookie常常需要长期保存，例如保存用户登录的状态。这可以用下面的选项来实</span></span><span style="color:#000000;font-size:medium;">现： </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">document.cookie=&quot;userId=828; </span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">expires=GMT_String&quot;; </span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">其中GMT_String是以GMT格式表示的时间字符串，这条语句就是将userId这个cookie设置为</span></span><span style="color:#000000;font-size:medium;">GMT_String表示的过期时间，超过这个时间，cookie将消失，不可访问。例如：</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">如果要将cookie</span><span style="color:#000000;font-size:medium;">设置为10天后过期，可以这样实现： </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt; </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">&lt;!-- //获取当前时间 </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">var date=new Date(); </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">var expireDays=10; //将date设置为10天以后的时间 </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">date.setTime(date.getTime()+expireDays*24*3600*1000); //将userId和userName两个cookie设置为10天后过期 </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">document.cookie=&quot;userId=828; userName=hulk; </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">expire=&quot;+date.toGMTString(); //--&gt; </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">&lt;/script&gt;</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">删除cookie<br/>为了删除一个cookie，可以将其过期时间设定为一个过去的时间，例如：</span></span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;<br/>&lt;!--<br/>//获取当前时间<br/>var date=new Date();<br/>//将date设置为过去的时间<br/>date.setTime(date.getTime()-10000);<br/>//将userId这个cookie删除<br/>document.cookie=&quot;userId=828; expire=&quot;+date.toGMTString();<br/>//--&gt;<br/>&lt;/script&gt;</span></span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">指定可访问cookie的路径 默认情况下，如果在某个页面创建了一个cookie，那么该页面所在目录中的其他页面也可以访问</span></span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">该cookie。如果这个目录下还有子目录，则在子目录中也可以访问。</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">例如在</span><a href="http://www.xxxx.com/html/a.html" style="color:rgb(85, 85, 85);text-decoration:none;"><span style="color:#000000;font-size:medium;">www.xxxx.com/html/a.html</span></a><span style="color:#000000;font-size:medium;">中所创建的cookie，可以被</span><a href="http://www.xxxx.com/html/b.html" style="color:rgb(85, 85, 85);text-decoration:none;"><span style="color:#000000;font-size:medium;">www.xxxx.com/html/b.html</span></a><span style="color:#000000;font-size:medium;">或</span><a href="http://www.xxx.com/" style="color:rgb(85, 85, 85);text-decoration:none;"><span style="color:#000000;font-size:medium;">www.xxx.com/</span></a><span style="color:#000000;font-size:medium;"> html/ some/c.html所访问，但不能被</span><a href="http://www.xxxx.com/d.html" style="color:rgb(85, 85, 85);text-decoration:none;"><span style="color:#000000;font-size:medium;">www.xxxx.com/d.html</span></a><span style="color:#000000;font-size:medium;">访问。 </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">为了控制cookie可以访问的目录，需要使用path参数设置cookie，语法如下：<br/>document.cookie=&quot;name=value; path=cookieDir&quot;;<br/>其中cookieDir表示可访问cookie的目录。例如：<br/>document.cookie=&quot;userId=320; path=/shop&quot;;<br/>就表示当前cookie仅能在shop目录下使用。<br/>如果要使cookie在整个网站下可用，可以将cookie_dir指定为根目录，例如：<br/>document.cookie=&quot;userId=320; path=/&quot;;</span></p>
<p style="margin:10px auto;text-indent:0px;"> </p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">指定可访问cookie的主机名 和路径类似，主机名是指同一个域下的不同主机，例如：</span><a href="http://www.google.com/" style="color:rgb(85, 85, 85);text-decoration:none;"><span style="color:#000000;font-size:medium;">www.google.com</span></a><span style="color:#000000;font-size:medium;">和gmail.google.com就</span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">是两个不同的主机名。默认情况下，一个主机中创建的cookie在另一个主机下是不能被访问的，</span><span style="color:#000000;font-size:medium;">但可以通过domain参数来实现对其的控制，其语法格式为： document.cookie=&quot;name=value; </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">domain=cookieDomain&quot;; </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">以google为例，要实现跨主机访问，可以写为： </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">document.cookie=&quot;name=value;</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">domain=.google.com&quot;; </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">这样，所有google.com下的主机都可以访问该cookie。</span></p>
<p style="margin:10px auto;text-indent:0px;"> </p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;"><span style="color:#000000;font-size:medium;">综合示例：构造通用的cookie处理函数 cookie的处理过程比较复杂，并具有一定的相似性。因此可以定义几个函数来完成cookie的通用</span></span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">操作，从而实现代码的复用。下面列出了常用的cookie操作及其函数实现。 </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">1．添加一个cookie：addCookie(name,value,expireHours) 该函数接收3个参数：cookie名称，cookie值，以及在多少小时后过期。</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">这里约定expireHours为</span><span style="color:#000000;font-size:medium;">0时不设定过期时间，即当浏览器关闭时cookie自动消失。该函数实现如下： </span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;<br/>&lt;!--<br/>function addCookie(name,value,expireHours){<br/>             var cookieString=name+&quot;=&quot;+escape(value);<br/>             //判断是否设置过期时间<br/>             if(expireHours&gt;0){<br/>                    var date=new Date();<br/>                    date.setTime(date.getTime+expireHours*3600*1000);<br/>                    cookieString=cookieString+&quot;; expire=&quot;+date.toGMTString();<br/>             }<br/>             document.cookie=cookieString;<br/>}<br/>//--&gt;<br/>&lt;/script&gt;</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">2．获取指定名称的cookie值：getCookie(name)<br/>该函数返回名称为name的cookie值，如果不存在则返回空，其实现如下：<br/>&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;<br/>&lt;!--<br/>function getCookie(name){<br/>             var strCookie=document.cookie;<br/>             var arrCookie=strCookie.split(&quot;; &quot;);<br/>             for(var i=0;i&lt;arrCookie.length;i++){<br/>                   var arr=arrCookie[i].split(&quot;=&quot;);<br/>                   if(arr[0]==name)return arr[1];<br/>             }<br/>             return &quot;&quot;;<br/>}<br/>//--&gt;<br/>&lt;/script&gt;</span></p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">3．删除指定名称的cookie：deleteCookie(name)<br/>该函数可以删除指定名称的cookie，其实现如下：<br/>&lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;<br/>&lt;!--<br/>function deleteCookie(name){<br/>              var date=new Date();<br/>              date.setTime(date.getTime()-10000);<br/>              document.cookie=name+&quot;=v; expire=&quot;+date.toGMTString();<br/>}<br/>//--&gt;<br/>&lt;/script&gt;</span></p>
<p style="margin:10px auto;text-indent:0px;"> </p>
<p style="margin:10px auto;text-indent:0px;"><span style="color:#000000;font-size:medium;">原文出处：
<a href="http://blog.csdn.net/sws8327/article/details/2090768" style="color:rgb(85, 85, 85);text-decoration:none;" target="_blank">
http://blog.csdn.net/sws8327/article/details/2090768</a>
</span></p></div></div></div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 