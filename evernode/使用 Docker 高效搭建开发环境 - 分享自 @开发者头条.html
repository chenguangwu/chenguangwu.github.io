<html>
<head>
  <title>使用 Docker 高效搭建开发环境 - 分享自 @开发者头条</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="10396"/>
<h1>使用 Docker 高效搭建开发环境 - 分享自 @开发者头条</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/4/30 0:37</i></td></tr>
<tr><td><b>标签：</b></td><td><i>开发者头条</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://toutiao.io/k/20bf8l"><i>https://toutiao.io/k/20bf8l</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:16px;line-height:1.42857143;margin:0;padding:10px;overflow-x:hidden;overflow-y:auto;word-wrap:break-word;word-break:normal;-webkit-font-smoothing:antialiased;color:#58666e;background-color:transparent"> <div> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">女主宣言</strong> </p> <p style="text-align:left;line-height:1.7em"> Docker 作为轻量级的基于容器的解决方案，它对系统侵入性低，容易移植，天生就适合做复杂业务部署和开发环境搭建，今天给大家带来的是我司开发是如何使用 Docker 高效搭建开发环境的。本文最先发布于 OpsDev，转载已获取作者授权。 </p> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">PS：丰富的一线技术、多元化的表现形式，尽在“<span>HULK一线技术杂谈</span>”，点关注哦！</strong> </p> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">前言</strong> </p> <p style="text-align:left;line-height:1.7em"> 作为一个平时喜欢折腾的开发人员，我喜欢尝试各种环境，使用感兴趣的各种开源软件。 </p> <p style="text-align:left;line-height:1.7em"> <span>同时，我也是有一些相对的小洁癖，很喜欢Linux中权限最小化原则，我也不喜欢自己的环境中有太多不知道的东西。</span> </p> <p style="text-align:left;line-height:1.7em"> 做了多年的Web开发，我接触到的环境大致如下： </p> <ol> <li> <p style="text-align:left;line-height:1.7em"> 操作系统从CentOS 5到CentOS 7； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> Web server从apache到Nginx； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 开发语言从最初的php5.2到php7，又到现在主要使用Go，马上还会开始接触C++； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 数据库从Mysql5.1到现在的5.7，前阵子又开始折腾mariadb； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> cache选型从memcache到redis； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 队列用过kafka，去年开始大量使用NSQ； </p> </li> </ol> <p style="text-align:left;line-height:1.7em"> 公司虽然有专门负责部署、运维这些服务的同学，但我在开发的时候，还是喜欢自己来搭建这些东西，因为这样通常可以对使用到的服务有更多的认识，也能帮助自己使用的更好。 </p> <p style="text-align:left;line-height:1.7em"> 今天我就来和大家分享下我是如何高效的搭建好自己的开发环境的。 </p> <p style="text-align:left;line-height:1.7em"> 1 </p> <span> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">搭建前说明</strong> </p> </span> <p style="text-align:left;line-height:1.7em"> 这里先说明一点，对每个开源软件，我几乎都是自己编译部署的，而不会使用类似yum install这种方式，也很少直接下载官方编译好的二进制包，这都是为了能多深入了解用到的开源软件。 </p> <p style="text-align:left;line-height:1.7em"> 但一些依赖的动态库文件，如zlib等，还有编译工具，如gcc、make等，我都是通过方便的yum install这种方式直接安装的，否则会累死。 </p> <p style="text-align:left;line-height:1.7em"> 2 </p> <span> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">传统做法</strong> </p> </span> <p style="text-align:left;line-height:1.7em"> 我在很长的一段时间内，都是把每个软件的编译、安装过程写成一个脚本，之后再需要用的时候直接运行脚本即可，但这样的方式，通常会遇到下面这些问题： </p> <ol> <li> <p style="text-align:left;line-height:1.7em"> 脚本只能在我当时的操作系统环境下运行。记得当时购买过不同服务商的vps，虽然不同vps我都使用同样的Linux发行版，但脚本通常都不能一键跑完。这也是没办法，因为每个vps服务商都会制作自己的操作系统镜像版本。 </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 操作系统升级，如CentOS5 - 6，或是换为Ubuntu，这样基本上脚本都跑不了。 </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 软件升级，如Mysql5.2 - 5.6，构建工具改为cmake，依赖库改变或升级。 </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 如果某个软件依赖的公共库版本和其它软件不同，且公共库升级后和旧版不兼容，那你就只能为这个软件单独编译公共库了，如果只是普通的公共库还好，但如果是所需要的编译工具版本不同，那可就惨了。 </p> </li> </ol> <p style="text-align:left;line-height:1.7em"> 上面这些问题，如果你想每个发行版维护一个脚本，那会累死，因为一旦你每次想升级一个软件，难道每个发行版都要编译一遍吗？这就变成了收获价值很低的体力劳动了。 </p> <p style="text-align:left;line-height:1.7em"> 由于喜欢折腾的个性，我对操作系统的升级以及软件包版本的升级又经常发生，所以一直以来，我都在寻找一个好方法，能很方便的维护好自己的开发环境，尽量做到只=新东西只为它工作一次，最后我找到了docker，目前我都是用它来搭建自己的开发环境的。 </p> <p style="text-align:left;line-height:1.7em"> 3 </p> <span> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">Docker做法</strong> </p> </span> <p style="text-align:left;line-height:1.7em"> 先概括介绍下我的方法： </p> <ol> <li> <p style="text-align:left;line-height:1.7em"> 让每个软件运行在容器中，因为运行的容器环境是可以固定下来的，所以编译安装脚本写一个就可以了。 </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 代码使用数据卷的方式加载到需要的容器中。 </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 因为是开发环境，所以网络方面使用最简单的--net=host。 </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 将镜像的创建、容器的启动维护在git项目中，并抽象出统一的构建过程，很方面的做到新软件接入，新机器部署。 </p> </li> </ol> <p style="text-align:left;line-height:1.7em"> 下面用实例来说明吧： </p> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">示例Nginx环境构建</strong> </p> <p style="text-align:left;line-height:1.7em"> 我将构建过程放到git中： </p> <p style="text-align:left;line-height:1.7em"> <span>https://gitee.com/andals/docker-nginx</span> </p> <p style="text-align:left;line-height:1.7em"> Readme中记录了构建所需要执行的脚本命令，大家访问上面的网址就可以看到，这里我简单介绍下项目的结构： </p> <img src="使用 Docker 高效搭建开发环境 - 分享自 @开发者头条_files/480652006df9b2f8fb1c9ef50b65160e" type="image/jpeg" data-filename="480652006df9b2f8fb1c9ef50b65160e" style="max-width:100%;display:block;margin:10px auto 20px;height:auto;vertical-align:middle;border:0"/> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">DockerFile说明</strong> </p> <p style="text-align:left;line-height:1.7em"> Dockerfile结构如下： </p> <img src="使用 Docker 高效搭建开发环境 - 分享自 @开发者头条_files/5f356b413725cc11aa6bfc5a58e53555" type="image/jpeg" data-filename="5f356b413725cc11aa6bfc5a58e53555" style="max-width:100%;display:block;margin:10px auto 20px;height:auto;vertical-align:middle;border:0"/> <p style="text-align:left;line-height:1.7em"> 整个构建框架为： </p> <ol> <li> <p style="text-align:left;line-height:1.7em"> 把构建需要的包（pkg目录中）放到镜像中； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 把构建脚本放到镜像中； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 执行构建脚本； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 容器启动时，执行init.sh，里面启动相应的服务。 </p> </li> </ol> <p style="text-align:left;line-height:1.7em"> Readme.md中记录了执行构建的命令和容器运行命令，示例运行如下： </p> <img src="使用 Docker 高效搭建开发环境 - 分享自 @开发者头条_files/62d9024b1628d188652313225192e16c" type="image/jpeg" data-filename="62d9024b1628d188652313225192e16c" style="max-width:100%;display:block;margin:10px auto 20px;height:auto;vertical-align:middle;border:0"/> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">说明：</strong> </p> <ul> <li> <p style="text-align:left;line-height:1.7em"> --volumes-from=data-home这个就是我放置代码的数据卷，我喜欢把代码放到$HOME下面； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> /data/Nginx中放置Nginx的conf、log等，每个软件运行时的conf、log、data等我都统一放置在/data下面； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 启动容器时使用--net=host，作为开发环境简单实用； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 我就是通过这种方法完成了开发环境的构建，不再有多余的重复工作，并且新机器部署开发环境效率极高。 </p> </li> </ul> <p style="text-align:left;line-height:1.7em"> 4 </p> <span> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">辅助工具dockerbox</strong> </p> </span> <p style="text-align:left;line-height:1.7em"> 使用docker环境后，有个问题，就是没有办法很方便的和软件交互。 </p> <p style="text-align:left;line-height:1.7em"> 这是因为软件都执行在容器中，比如重启Nginx吧，需要下面这几步： </p> <ol> <li> <p style="text-align:left;line-height:1.7em"> 找到Nginx这个容器； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 进入Nginx这个容器； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 在容器里面再执行reload. </p> </li> </ol> <p style="text-align:left;line-height:1.7em"> 也可以是： </p> <ol> <li> <p style="text-align:left;line-height:1.7em"> 找到Nginx这个容器； </p> </li> <li> <p style="text-align:left;line-height:1.7em"> 使用docker exec. </p> </li> </ol> <p style="text-align:left;line-height:1.7em"> 但无论哪种方式，都比原先直接执行命令麻烦的多。 </p> <p style="text-align:left;line-height:1.7em"> 另外，有时也需要进入容器中，查看服务的运行情况。 </p> <p style="text-align:left;line-height:1.7em"> 为了方便的做这些事情，我开发了一个工具dockerbox，可以很方便的做到这些事情。 </p> <p style="text-align:left;line-height:1.7em"> dockerbox的详情及使用方法请见： </p> <p style="text-align:left;line-height:1.7em"> <span>https://github.com/ligang1109/dockerbox</span> </p> <img src="使用 Docker 高效搭建开发环境 - 分享自 @开发者头条_files/dcdd2146c91e5cc91cacbb385df65153" type="image/jpeg" data-filename="dcdd2146c91e5cc91cacbb385df65153" style="max-width:100%;display:block;margin:10px auto 20px;height:auto;vertical-align:middle;border:0"/> <p style="text-align:left;line-height:1.7em"> 5 </p> <span> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">配置开机运行</strong> </p> </span> <p style="text-align:left;line-height:1.7em"> 最后再说下如何配置开机启动。 </p> <p style="text-align:left;line-height:1.7em"> 我使用虚拟机搭建的开发环境，所以配置这个会省事好多， </p> <img src="使用 Docker 高效搭建开发环境 - 分享自 @开发者头条_files/31baff9d11153455a477822385a6df89" type="image/jpeg" data-filename="31baff9d11153455a477822385a6df89" style="max-width:100%;display:block;margin:10px auto 20px;height:auto;vertical-align:middle;border:0"/> <p style="text-align:left;line-height:1.7em"> dbox请参考dockerbox的使用方法。 </p> <p style="text-align:left;line-height:1.7em"> 6 </p> <span> <p style="text-align:left;line-height:1.7em"> <strong style="font-weight:bold">结束语</strong> </p> </span> <p style="text-align:left;line-height:1.7em"> 上面说的是我现在使用的开发环境搭建方法，有兴趣爱折腾的同学不妨试试看，如果你有更好的方法，也希望能分享给我。 </p> <p style="text-align:left;line-height:1.7em"> 生命不息，折腾不止:-D </p> <p style="text-align:left;line-height:1.7em"> HULK一线技术杂谈 </p> <p style="text-align:left;line-height:1.7em"> 由360云平台团队打造的技术分享公众号，内容涉及<span>云计算</span>、<span>数据库</span>、<span>大数据</span>、<span>监控</span>、<span>泛前端</span>、<span>自动化测试</span>等众多技术领域，通过夯实的技术积累和丰富的一线实战经验，为你带来最有料的技术分享 </p> <img src="使用 Docker 高效搭建开发环境 - 分享自 @开发者头条_files/eeb57b36b7595855b2fdf41ed5aa4884" type="image/gif" data-filename="eeb57b36b7595855b2fdf41ed5aa4884" style="max-width:100%;display:block;margin:10px auto 20px;height:auto;vertical-align:middle;border:0"/> </div> </div></span>
</div></body></html> 