<html>
<head>
  <title>Java生成图片时使用BufferedImage的构造方法，让图片不失真 - T_zm_cross的专栏 - CSDN博客</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="12631"/>
<h1>Java生成图片时使用BufferedImage的构造方法，让图片不失真 - T_zm_cross的专栏 - CSDN博客</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2019/7/30 18:32</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://blog.csdn.net/T_zm_cross/article/details/51852727"><i>https://blog.csdn.net/T_zm_cross/article/details/51852727</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="box-sizing:border-box;outline:0px;"><div style="-webkit-font-smoothing:antialiased;min-width:1200px;box-sizing:inherit;outline:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:14px;line-height:1.57143;background-color:rgb(245, 246, 247);color:rgb(51, 51, 51);"><div style="box-sizing:border-box;outline:0px;"><span style="box-sizing:inherit;outline:0px;"><div style="background:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.05) 0px 2px 4px 0px;box-sizing:inherit;outline:0px;">
    <div style="border-bottom:1px solid rgb(224, 224, 224);padding-top:16px;z-index:9;background-color:rgb(255, 255, 255);box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
        <div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
            <div style="margin-bottom:8px;box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
                <span style="display:inline-block;width:26px;height:26px;line-height:26px;text-align:center;font-size:12px;border-radius:50%;color:rgb(134, 202, 94);border:1px solid rgb(231, 244, 223);margin-top:4px;margin-right:8px;box-sizing:inherit;outline:0px;float:left;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;">转</span>                <h1 style="font-size:24px;overflow-wrap:break-word;box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;">Java生成图片时使用BufferedImage的构造方法，让图片不失真</h1>
            </div>
            <div style="padding-bottom:14px;position:relative;box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
                <div style="color:rgb(133, 133, 133);width:88%;height:24px;overflow:hidden;box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
                                                                                                                        <span style="margin-right:14px;box-sizing:inherit;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;">2016年07月07日 17:35:16</span>
                    <a href="https://me.csdn.net/T_zm_cross" style="color:rgb(120, 165, 241);margin-right:14px;box-sizing:inherit;outline:0px;text-decoration:none;cursor:pointer;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;" target="_blank">t_zm_cross</a>
                    <span style="margin-right:14px;box-sizing:inherit;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;">阅读数 21053</span>
                                    </div>
                <div style="position:absolute;top:0px;right:0px;box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
                                    </div>
            </div>
        </div>
    </div>
    <div style="position:relative;padding-top:16px;box-sizing:inherit;outline:0px;display:block;margin:0px;padding:0px;">
                <div style="overflow-wrap:break-word;box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
                                    
                                        
                <div style="overflow-wrap:break-word;position:relative;min-height:70px;box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">
                                            
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;"><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>在一次做考试系统的时候，有一个场景是考生开考前需要通过系统做拍照并进行脸部信息的比对；脸部信息的计算使用FACE++(旷视科技)的接口，但是发现查看拍照的照片信息是，考生的照片显示十分模糊，对比度变低，有验证的泛红！经过检查发现报错在Oracle 数据库的blob 字段直接查看信息是正常的，再看看在程序里生成的图片缓存文件是模糊的图像；查看生成图片的代码，十分简单，如下：</p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;">//生成图片返回图片路径</p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;">public static String createImg(byte[] bytes,String imgName,String path){<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>StringBuilder fullPath = new StringBuilder(imgFile(path)).append(File.separator).append(imgName).append(&quot;.&quot;+ImgType);<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>File img = null;<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>try {<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>img = new File(fullPath.toString());<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>ByteArrayInputStream bais = new ByteArrayInputStream(bytes);<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>BufferedImage bi =ImageIO.read(bais);      <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>ImageIO.write(bi, ImgType, img);//<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>bais.close();<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>} catch (Exception e) {<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>e.printStackTrace();<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>}<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>return filePath+File.separator+imgName+&quot;.&quot;+ImgType;<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
}<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/></p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;">代码中只是简单的将图片的二进制信息写成了图片。</p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;"><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span></p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;"><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>网上了解了一下图片生成的问题，在二进制转换成BufferedImage 对象时可以生成的图片指定BGR 颜色模型；查看BufferedImage 的API 发现有一个构造函数是需要传如图片的宽度、高度和预定义图像类型 <span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;color:#ff0000;">BufferedImage(int width, int height, int imageType) ；</span></p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;">代码修改后，图片正常显示！代码如下：</p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;">public static String createImg(byte[] bytes,String imgName,String path){<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>StringBuilder fullPath = new StringBuilder(imgFile(path)).append(File.separator).append(imgName).append(&quot;.&quot;+ImgType);<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>File img = null;<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>try {<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>img = new File(fullPath.toString());<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>ByteArrayInputStream bais = new ByteArrayInputStream(bytes);<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>BufferedImage bi =ImageIO.read(bais);      <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>saveJpgImage(bi,fullPath.toString());<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>bais.close();<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>} catch (Exception e) {<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>e.printStackTrace();<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>}<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>return filePath+File.separator+imgName+&quot;.&quot;+ImgType;<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
}<br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span><br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
public static void saveJpgImage(BufferedImage image,  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>String filePath) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>BufferedImage bufferedImage = new BufferedImage(image.getWidth(), image  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>.getHeight(), BufferedImage.TYPE_3BYTE_BGR);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>bufferedImage.getGraphics().drawImage(image, 0, 0, null);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>saveImage(bufferedImage, ImgType, filePath);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
} <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
public static void saveImage(BufferedImage image, String format,  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>String filePath) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>try {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>ImageIO.write(image, format, new File(filePath));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>} catch (Exception e) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>throw new RuntimeException(e);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/><span style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;"></span>}  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
} <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/></p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;">-------------------------------------------------------------------------------</p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;">以下是网上找到别人生成各种类型的图片的最终效果对比！</p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;">package test;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.awt.Color;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.awt.Font;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.awt.Graphics2D;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.awt.RenderingHints;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.awt.image.BufferedImage;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.io.BufferedOutputStream;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.io.ByteArrayOutputStream;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.io.File;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.io.FileOutputStream;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import javax.imageio.ImageIO;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import java.util.Iterator;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import javax.imageio.*;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import javax.imageio.stream.*;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import org.junit.Before;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
import org.junit.Test;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
/** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
 * 加载png格式图片，使用不同方式转为png或者jpg格式的性能对比。 <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
 * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
public class PngJpgImagePerTest {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private static String PNG = &quot;png&quot;;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private static String JPG = &quot;jpg&quot;;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private static String SimpleSavePNG = &quot;__SimpleSavePNG.png&quot;;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private static String Convert2ArrayAndSavePNG = &quot;__Convert2ArrayAndSavePNG.png&quot;;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private static String NewImageSavePNG = &quot;__NewPNG.png&quot;;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private static String NewImageSaveJPG = &quot;__NewJPG.jpg&quot;;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private static String SaveJPG = &quot;__JPG_quality.jpg&quot;;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * 保存文件。 <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public static void save2File(String filePath, byte[] data) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        BufferedOutputStream bufferOutput = null;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        try {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            bufferOutput = new BufferedOutputStream(new FileOutputStream(  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                    new File(filePath)), 1024);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            bufferOutput.write(data);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            bufferOutput.flush();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        } catch (Exception e) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            throw new RuntimeException(e);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        } finally {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            if (bufferOutput != null) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                try {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                    bufferOutput.close();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                } catch (Exception e) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                    throw new RuntimeException(e);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * load image <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public static BufferedImage loadImage(String filePath) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        try {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            return ImageIO.read(new File(filePath));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        } catch (Exception e) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            throw new RuntimeException(e);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * simple save use ImageIO.write <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public static void saveImage(BufferedImage image, String format,  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            String filePath) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        try {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            ImageIO.write(image, format, new File(filePath));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        } catch (Exception e) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            throw new RuntimeException(e);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * convert to byte array. <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public static byte[] convert2bytes(BufferedImage image, String format) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        try {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            ByteArrayOutputStream bout = new ByteArrayOutputStream(1024);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            ImageIO.write(image, format, bout);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            byte[] data = bout.toByteArray();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            return data;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        } catch (Exception e) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            throw new RuntimeException(e);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * create new buffer image and save using png format. <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public static void savePngImage(BufferedImage image, String format,  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            String filePath) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        BufferedImage bufferedImage = new BufferedImage(image.getWidth(), image  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                .getHeight(), BufferedImage.TYPE_3BYTE_BGR);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        bufferedImage.getGraphics().drawImage(image, 0, 0, null);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        saveImage(bufferedImage, PNG, filePath);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * create new buffer image and save using jpg format. <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public static void saveJpgImage(BufferedImage image, String format,  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            String filePath) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        BufferedImage bufferedImage = new BufferedImage(image.getWidth(), image  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                .getHeight(), BufferedImage.TYPE_3BYTE_BGR);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        bufferedImage.getGraphics().drawImage(image, 0, 0, null);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        saveImage(bufferedImage, JPG, filePath);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * save jpg with specified quality. 为了图片质量，quality的值不能太低。 <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public static void saveImageUsingJPGWithQuality(BufferedImage image,  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            String filePath, float quality) throws Exception {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        BufferedImage newBufferedImage = new BufferedImage(image.getWidth(),  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                image.getHeight(), BufferedImage.TYPE_3BYTE_BGR);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        newBufferedImage.getGraphics().drawImage(image, 0, 0, null);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        Iterator&lt;ImageWriter&gt; iter = ImageIO  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                .getImageWritersByFormatName(&quot;jpeg&quot;);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        ImageWriter imageWriter = iter.next();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        ImageWriteParam iwp = imageWriter.getDefaultWriteParam();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        iwp.setCompressionMode(ImageWriteParam.MODE_EXPLICIT);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        iwp.setCompressionQuality(quality);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        File file = new File(filePath);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        FileImageOutputStream fileImageOutput = new FileImageOutputStream(file);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        imageWriter.setOutput(fileImageOutput);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        IIOImage iio_image = new IIOImage(newBufferedImage, null, null);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        imageWriter.write(null, iio_image, iwp);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        imageWriter.dispose();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public static void drawString(Graphics2D g2, String value, int x, int y) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        Font font = new Font(&quot;Arial&quot;, Font.BOLD, 16);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        g2.setColor(Color.BLACK);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        g2.setFont(font);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        g2.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING,  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                RenderingHints.VALUE_TEXT_ANTIALIAS_ON);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        g2.drawString(value, x, y);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private String sourceFilePath;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private BufferedImage sourceImage;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private int loop;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private float quality;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    @Before  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public void setup() {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        sourceFilePath = &quot;E:\\allencode\\ImgTest\\stat.png&quot;;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        sourceImage = loadImage(sourceFilePath);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        loop = 10;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        quality = 0.8F;  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        Graphics2D g2 = sourceImage.createGraphics();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        draw(g2);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    private void draw(Graphics2D g2) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        drawString(g2, &quot;Allen Hello world.&quot;, 500, 200);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * ImageIO.write存储图片时主要的性能消耗在计算上。 <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    @Test  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public void test_01() {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        StringBuilder sb = new StringBuilder();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        for (int i = 0; i &lt; loop; i++) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long start = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            saveImage(sourceImage, PNG, sourceFilePath + SimpleSavePNG);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long end = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot; saveImage = &quot; + (end - start));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long convertStart = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            byte[] pngData = convert2bytes(sourceImage, PNG);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long convertEnd = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot; convert = &quot; + (convertEnd - convertStart));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long saveStart = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            save2File(sourceFilePath + Convert2ArrayAndSavePNG, pngData);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long saveEnd = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot; save = &quot; + (saveEnd - saveStart));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot;\n&quot;);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        System.out.println(sb);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * ImageIO.write和新建一个BufferedImage，采用jpg或png保存的比较。 <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    @Test  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public void test_02() {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        StringBuilder sb = new StringBuilder();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        for (int i = 0; i &lt; loop; i++) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long start = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            saveImage(sourceImage, PNG, sourceFilePath + SimpleSavePNG);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long end = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot; saveImage = &quot; + (end - start));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            start = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            savePngImage(sourceImage, &quot;png&quot;, sourceFilePath + NewImageSavePNG);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            end = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot; savePngImage = &quot; + (end - start));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            start = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            saveJpgImage(sourceImage, &quot;jpg&quot;, sourceFilePath + NewImageSaveJPG);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            end = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot; saveJpgImage = &quot; + (end - start));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot;\n&quot;);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        System.out.println(sb);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    /** <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * ImageIO.write存储图片和保存jpg的时间对比。 <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
     * */  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    @Test  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    public void test_03() throws Exception {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        StringBuilder sb = new StringBuilder();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        for (int i = 0; i &lt; loop; i++) {  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long pngStart = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            saveImage(sourceImage, PNG, sourceFilePath + SimpleSavePNG);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long pngEnd = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot; saveImage = &quot; + (pngEnd - pngStart));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long jpgStart = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            saveImageUsingJPGWithQuality(sourceImage, sourceFilePath + SaveJPG,  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
                    quality);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            long jpgEnd = System.currentTimeMillis();  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot; JPGWithQuality = &quot; + (jpgEnd - jpgStart));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot; % = &quot; + (pngEnd - pngStart) * 1D / (jpgEnd - jpgStart));  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
            sb.append(&quot;\n&quot;);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
        System.out.println(sb);  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
    }  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/>
}  <br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/></p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;"><br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/></p>
<p style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;padding:0px;margin:0px 0px 16px;font-family:&quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif;font-size:16px;color:rgb(77, 77, 77);font-weight:400;line-height:26px;overflow-x:auto;"><br style="overflow-wrap:break-word;box-sizing:border-box;outline:0px;margin:0px;padding:0px;"/></p>
                                    </div>
                    <span style="display:block;height:0px;visibility:hidden;clear:both;"></span></div>
    </div>
</div></span></div></div></div></div><br/></div></span>
</div></body></html> 