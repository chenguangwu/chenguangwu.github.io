<html>
<head>
  <title>modify request url in zuul filter(9.21)</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="15177"/>
<h1>modify request url in zuul filter(9.21)</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2020/4/27 15:41</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://www.jianshu.com/p/b8c59a1ba445"><i>https://www.jianshu.com/p/b8c59a1ba445</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px; display: inline-block;"><div style="box-sizing:border-box;font-family:sans-serif;line-height:1.15;text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"><div style="box-sizing:border-box;color:rgb(64, 64, 64);font-size:14px;font-family:-apple-system, BlinkMacSystemFont, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Segoe UI&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height:1.42857;font-feature-settings:&quot;tnum&quot;;background-color:rgb(255, 255, 255);font-variant:tabular-nums;"><div style="box-sizing:border-box;"><div style="box-sizing:border-box;background-color:rgb(249, 249, 249);"><div style="box-sizing:content-box;justify-content:center;align-items:flex-start;font-size:16px;"><div style="box-sizing:border-box;flex-shrink:0;"><div style="box-sizing:border-box;background-color:rgb(255, 255, 255);border-radius:4px;"><h1 style="box-sizing:border-box;margin-top:0px;margin-bottom:0.5em;color:rgb(64, 64, 64);font-weight:700;text-rendering:optimizelegibility;font-size:30px;word-break:break-word;">modify request url in zuul filter(9.21)</h1><div style="box-sizing:border-box;display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;font-size:13px;"><div style="box-sizing:border-box;display:flex;align-items:center;"><a href="https://www.jianshu.com/u/9a316c32b7f1" rel="noopener noreferrer" style="box-sizing:border-box;color:inherit;text-decoration:none;background-color:transparent;outline:none;cursor:pointer;transition:color 0.3s ease 0s;touch-action:manipulation;" target="_blank"><img src="modify request url in zuul filter(9.21)_files/webp.webp" type="image/webp" data-filename="webp.webp" alt="" height="46" style="box-sizing:border-box;vertical-align:middle;display:block;border-radius:50%;border:1px solid rgb(238, 238, 238);min-width:48px;min-height:48px;width:48px;height:48px;" width="46"/></a><div style="box-sizing:border-box;margin-left:8px;"><div style="box-sizing:border-box;display:flex;align-items:center;margin-bottom:6px;"><span style="box-sizing:border-box;font-size:16px;font-weight:500;margin-right:8px;"><a href="https://www.jianshu.com/u/9a316c32b7f1" rel="noopener noreferrer" style="box-sizing:border-box;color:inherit;text-decoration:none;background-color:transparent;outline:none;cursor:pointer;transition:color 0.3s ease 0s;touch-action:manipulation;" target="_blank">星期六1111</a></span></div><div style="box-sizing:border-box;display:flex;color:rgb(150, 150, 150);"><span style="box-sizing:border-box;margin-right:10px;">2017.09.22 09:13:24</span><span style="box-sizing:border-box;margin-right:10px;">字数 989</span><span style="box-sizing:border-box;">阅读 557</span></div></div></div></div><div style="box-sizing:border-box;display:block;font-weight:400;line-height:1.8;margin-bottom:20px;"><h4 style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(64, 64, 64);font-weight:600;text-rendering:optimizelegibility;font-size:20px;">问题描述</h4>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:20px;word-break:break-word;">昨天刚学习了zuul,今天就遇到了一个问题是这样的，filter文件是这样的</p>
<div style="box-sizing:border-box;position:relative;overflow:hidden;"><pre style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;margin-top:0px;margin-bottom:20px;overflow:auto;overflow-wrap:normal;word-break:break-all;white-space:pre;overflow-x:scroll;overscroll-behavior-x:contain;border-radius:4px;z-index:0;padding:1em;line-height:1.5;color:rgb(204, 204, 204);background:rgb(45, 45, 45);position:relative;text-align:left;word-spacing:normal;tab-size:4;hyphens:none;margin:0.5em 0px;padding-left:3.8em;"><code style="box-sizing:border-box;font-size:1em;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:0px;border:none;vertical-align:unset;white-space:inherit;color:inherit;background-color:transparent;position:relative;background:none;text-align:left;word-spacing:normal;word-break:normal;overflow-wrap:normal;line-height:1.5;tab-size:4;hyphens:none;"><span style="box-sizing:border-box;color:rgb(204, 153, 205);">public</span> <span style="box-sizing:border-box;color:rgb(204, 153, 205);">class</span> <span style="box-sizing:border-box;color:rgb(248, 197, 85);">SimpleFilter</span> <span style="box-sizing:border-box;color:rgb(204, 153, 205);">extends</span> <span style="box-sizing:border-box;color:rgb(248, 197, 85);">ZuulFilter</span> <span style="box-sizing:border-box;color:rgb(204, 204, 204);">{</span>
    <span style="box-sizing:border-box;color:rgb(204, 204, 204);">@Override</span>
    <span style="box-sizing:border-box;color:rgb(204, 153, 205);">public</span> <span style="box-sizing:border-box;color:rgb(248, 197, 85);">String</span> <span style="box-sizing:border-box;color:rgb(240, 141, 73);">filterType</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span> <span style="box-sizing:border-box;color:rgb(204, 204, 204);">{</span>
        <span style="box-sizing:border-box;color:rgb(204, 153, 205);">return</span> <span style="box-sizing:border-box;color:rgb(126, 198, 153);">&quot;pre&quot;</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
    <span style="box-sizing:border-box;color:rgb(204, 204, 204);">}</span>
    <span style="box-sizing:border-box;color:rgb(204, 204, 204);">@Override</span>
    <span style="box-sizing:border-box;color:rgb(204, 153, 205);">public</span> <span style="box-sizing:border-box;color:rgb(204, 153, 205);">int</span> <span style="box-sizing:border-box;color:rgb(240, 141, 73);">filterOrder</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span> <span style="box-sizing:border-box;color:rgb(204, 204, 204);">{</span>
        <span style="box-sizing:border-box;color:rgb(204, 153, 205);">return</span> <span style="box-sizing:border-box;color:rgb(240, 141, 73);">0</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
    <span style="box-sizing:border-box;color:rgb(204, 204, 204);">}</span>
    <span style="box-sizing:border-box;color:rgb(204, 204, 204);">@Override</span>
    <span style="box-sizing:border-box;color:rgb(204, 153, 205);">public</span> <span style="box-sizing:border-box;color:rgb(204, 153, 205);">boolean</span> <span style="box-sizing:border-box;color:rgb(240, 141, 73);">shouldFilter</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span> <span style="box-sizing:border-box;color:rgb(204, 204, 204);">{</span>
        <span style="box-sizing:border-box;color:rgb(204, 153, 205);">return</span> <span style="box-sizing:border-box;color:rgb(240, 141, 73);">true</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
    <span style="box-sizing:border-box;color:rgb(204, 204, 204);">}</span>
    <span style="box-sizing:border-box;color:rgb(204, 204, 204);">@Override</span>
    <span style="box-sizing:border-box;color:rgb(204, 153, 205);">public</span> <span style="box-sizing:border-box;color:rgb(248, 197, 85);">Object</span> <span style="box-sizing:border-box;color:rgb(240, 141, 73);">run</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span> <span style="box-sizing:border-box;color:rgb(204, 204, 204);">{</span>
        <span style="box-sizing:border-box;color:rgb(248, 197, 85);">RequestContext</span> ctx <span style="box-sizing:border-box;color:rgb(103, 205, 204);">=</span> <span style="box-sizing:border-box;color:rgb(248, 197, 85);">RequestContext</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">getCurrentContext</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
        <span style="box-sizing:border-box;color:rgb(248, 197, 85);">HttpServletRequest</span> request <span style="box-sizing:border-box;color:rgb(103, 205, 204);">=</span> ctx<span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">getRequest</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
            <span style="box-sizing:border-box;color:rgb(248, 197, 85);">String</span> uri <span style="box-sizing:border-box;color:rgb(103, 205, 204);">=</span> request<span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">getRequestURI</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">toString</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
            <span style="box-sizing:border-box;color:rgb(204, 153, 205);">if</span> <span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span>uri<span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">contains</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(126, 198, 153);">&quot;/api/users&quot;</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span> <span style="box-sizing:border-box;color:rgb(204, 204, 204);">{</span>
                <span style="box-sizing:border-box;color:rgb(248, 197, 85);">String</span> newUri <span style="box-sizing:border-box;color:rgb(103, 205, 204);">=</span> uri<span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">replaceAll</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(126, 198, 153);">&quot;/users/\\d*&quot;</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">,</span> <span style="box-sizing:border-box;color:rgb(126, 198, 153);">&quot;/users/&quot;</span> <span style="box-sizing:border-box;color:rgb(103, 205, 204);">+</span> <span style="box-sizing:border-box;color:rgb(240, 141, 73);">2</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
                ctx<span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">set</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(126, 198, 153);">&quot;requestURI&quot;</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">,</span> newUri<span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
            <span style="box-sizing:border-box;color:rgb(204, 204, 204);">}</span>
            log<span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">info</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(248, 197, 85);">String</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">format</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(126, 198, 153);">&quot;%s requestssss to %s&quot;</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">,</span> request<span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">getMethod</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">,</span> request<span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">getRequestURL</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">.</span><span style="box-sizing:border-box;color:rgb(240, 141, 73);">toString</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">(</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">)</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
        <span style="box-sizing:border-box;color:rgb(204, 153, 205);">return</span> <span style="box-sizing:border-box;color:rgb(204, 153, 205);">null</span><span style="box-sizing:border-box;color:rgb(204, 204, 204);">;</span>
    <span style="box-sizing:border-box;color:rgb(204, 204, 204);">}</span>
<span style="box-sizing:border-box;color:rgb(204, 204, 204);">}</span>
<span style="box-sizing:border-box;position:absolute;pointer-events:none;top:0px;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid rgb(153, 153, 153);user-select:none;"><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">2</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">4</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">6</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">8</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">10</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">12</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">14</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">16</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">18</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">20</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">22</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">24</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">26</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">28</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">30</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">32</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">34</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">36</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">38</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">40</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">42</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">44</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">46</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">48</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">50</span><span style="box-sizing:border-box;"></span></span><span style="box-sizing:border-box;pointer-events:none;display:block;"><span style="color:rgb(153, 153, 153);display:block;padding-right:0.8em;text-align:right;box-sizing:border-box;">52</span><span style="box-sizing:border-box;"></span></span></span></code></pre></div>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:20px;word-break:break-word;">我想要完成的目标是将我的URL从<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">local:8888 /user-center/api/users/1 最终变成localhost:8085/api/user/2</code></p>
<h4 style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(64, 64, 64);font-weight:600;text-rendering:optimizelegibility;font-size:20px;">矛盾点</h4>
<ul style="box-sizing:border-box;padding-left:0px;margin:0px 0px 20px 20px;list-style:none;word-break:break-word;list-style-type:disc;">
<li style="box-sizing:border-box;line-height:30px;">我们的思路是我们的路由从 <code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">local:8888 /user-center/api/users/1</code>先变成<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">localhost:8085/api/user/1</code>,接着再变为<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">localhost:8085/api/user/2</code>发往后台</li>
<li style="box-sizing:border-box;line-height:30px;">事实上这种情况下我们的发往后台的url变成了 <code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">localhost:8085/api/user/1</code>我们使用set()方法是可以更换url的，但为什么这里会失败</li>
</ul>
<h4 style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(64, 64, 64);font-weight:600;text-rendering:optimizelegibility;font-size:20px;">解决思路</h4>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:20px;word-break:break-word;">Q1:RequestContext.getCurrentContext(). getRequest()获取的值是什么，我们修改的这个url是否是对的？<br style="box-sizing:border-box;"/>
A1: 根据网上的文档发现：</p>
<ul style="box-sizing:border-box;padding-left:0px;margin:0px 0px 20px 20px;list-style:none;word-break:break-word;list-style-type:disc;">
<li style="box-sizing:border-box;line-height:30px;">
<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">RequestContext.getCurrentContext()</code>：获取的是用户发送给zuul的所有请求内容。</li>
<li style="box-sizing:border-box;line-height:30px;">
<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">RequestContext.getCurrentContext(). getRequest()</code>获取的值是用户发送的原生url请求，即<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">local:8888 /user-center/api/users/1</code>,而且这个值永远不变的，所以我们set的方法就做的事就是将在这个原生的url上基础上进行路由替换，替换后的路由是<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">local:8888/user-center/api/users/2</code>被发往了后台。</li>
<li style="box-sizing:border-box;line-height:30px;">
<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">RequestContext.getCurrentContext().get(&quot;{key}&quot;)</code>：这个api是为了获取当前请求的内容而不是原始的请求内容。</li>
</ul>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:20px;word-break:break-word;">Q2:那么看起来好像我们的set方法没有任何的作用一样，到底set方法啊起作用了吗？<br style="box-sizing:border-box;"/>
A2: 查询文档知道Zuul让我们自己定义过滤器，并可以让我们指定过滤器执行的顺序，但它内部自己还定义了一系列的过滤器，它内部自己默认的过滤器也会执行, 执行时候过滤器按照从小到大的顺序执行。我们知道zuul定义了四种类型的过滤器：</p>
<ul style="box-sizing:border-box;padding-left:0px;margin:0px 0px 20px 20px;list-style:none;word-break:break-word;list-style-type:disc;">
<li style="box-sizing:border-box;line-height:30px;">pre：可以在请求被路由之前调用。</li>
<li style="box-sizing:border-box;line-height:30px;">routing：在路由请求时候被调用。</li>
<li style="box-sizing:border-box;line-height:30px;">post：在routing和error过滤器之后被调用。</li>
<li style="box-sizing:border-box;line-height:30px;">error：处理请求时发生错误时被调用。</li>
</ul>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:20px;word-break:break-word;">所以这个这个路由转化的过程是没有进行，还是被它内部的filter执行过了，但是执行的时机出了问题？</p>
<br style="box-sizing:border-box;"/>
<div style="box-sizing:border-box;width:100%;margin:0px;padding-bottom:25px;text-align:center;font-size:0px;">
<div style="box-sizing:border-box;position:relative;z-index:95;background-color:transparent;transition:background-color 0.1s linear 0s;margin:0px auto;max-width:700px;max-height:740px;">
<div style="box-sizing:border-box;z-index:90;padding-bottom:105.80000000000001%;"></div>
<div style="box-sizing:border-box;position:absolute;top:0px;left:0px;width:100%;height:100%;overflow:hidden;"><img src="modify request url in zuul filter(9.21)_files/webp [1].webp" type="image/webp" data-filename="webp.webp" height="722" style="box-sizing:border-box;vertical-align:middle;max-width:100%;width:auto;height:auto;border:0px;transition:all 0.15s linear 0s;z-index:95;opacity:1;cursor:zoom-in;" width="682"/></div>
</div>
<div style="box-sizing:border-box;min-width:20%;max-width:80%;min-height:43px;display:inline-block;padding:10px;margin:0px auto;border-bottom:1px solid rgb(238, 238, 238);font-size:13px;color:rgb(153, 153, 153);">核心过滤器的总结.png</div>
</div>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:20px;word-break:break-word;">问题的结论：仔细看看内部的这些过滤器，我们发现pre 的最后一个过滤器<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">PreDecorationFiter</code>它的具体操作内容就是为当前请求做一些预处理,也就是将我们的请求进行转化。我们的代码中filerOder是0，也就是说我们的filter会在请求的转化<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">PreDecorationFiter</code>之前执行，好了，问题就在这里了，我们用set方法修改了url,在执行到<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">PreDecorationFiter</code>的时候，它在原生的request 基础上处理请求，将我们之前的操作覆盖，所以最终发送给backend的请求就是没有经过set的请求。</p>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:20px;word-break:break-word;">Q3:怎么解决这个问题？<br style="box-sizing:border-box;"/>
A3:我们需要改变两个地方：</p>
<ul style="box-sizing:border-box;padding-left:0px;margin:0px 0px 20px 20px;list-style:none;word-break:break-word;list-style-type:disc;">
<li style="box-sizing:border-box;line-height:30px;">通过RequestContext.getCurrentContext().get(&quot;requestURI&quot;)获取当时的uri，requestURI属性在<code style="box-sizing:border-box;font-size:12px;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;padding:2px 4px;border:none;vertical-align:middle;white-space:pre-wrap;color:rgb(199, 37, 78);background-color:rgb(242, 242, 242);">PreDecorationFiter</code>时会被赋值，在这之前它是没有值的。</li>
<li style="box-sizing:border-box;line-height:30px;">在oeder 为5的时候会进行转化，所以我们需要把set方法的执行放在5之后，比如：return filterOrder函数的返回值为6.</li>
</ul>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:20px;word-break:break-word;">反思：感觉自己昨天一天学习zuul的时候，学的还是太浅，只是把zuul的demo跑起来，知道它大致的思路流程和怎么用，并没有把相关的细节搞明白。</p>
<h4 style="box-sizing:border-box;margin-top:0px;margin-bottom:16px;color:rgb(64, 64, 64);font-weight:600;text-rendering:optimizelegibility;font-size:20px;">action</h4>
<p style="box-sizing:border-box;margin-top:0px;margin-bottom:20px;word-break:break-word;">学习新知识的时候不要浅尝辄止，不仅要知道怎么用，还要知道为什么，去官网要看看细节和原理性的东西。</p>
</div><div style="box-sizing:border-box;"></div><div style="box-sizing:border-box;justify-content:space-between;font-size:14px;color:rgb(150, 150, 150);user-select:none;display:flex;align-items:center;"><div style="box-sizing:border-box;display:flex;align-items:center;"><div style="box-sizing:border-box;display:flex;align-items:center;margin-right:12px;"><div style="box-sizing:border-box;touch-action:manipulation;cursor:pointer;user-select:none;display:flex;align-items:center;justify-content:center;width:40px;height:40px;color:rgb(150, 150, 150);border:1px solid rgb(238, 238, 238);border-radius:50%;font-size:18px;"><i style="box-sizing:border-box;display:inline-block;color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;vertical-align:-0.125em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased;"><span style="color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;display:none;"></span><span style="box-sizing:border-box;overflow:hidden;line-height:1;display:inline-block;"><span style="box-sizing:border-box;"></span></span></i></div><span style="box-sizing:border-box;touch-action:manipulation;cursor:pointer;user-select:none;margin-left:8px;">1人点赞<i style="box-sizing:border-box;display:inline-block;color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;vertical-align:-0.125em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased;font-size:12px;"><span style="color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;font-size:12px;display:none;"></span><span style="box-sizing:border-box;overflow:hidden;line-height:1;display:inline-block;"><span style="box-sizing:border-box;"></span></span></i></span></div><div style="box-sizing:border-box;display:flex;align-items:center;"><div style="box-sizing:border-box;touch-action:manipulation;cursor:pointer;user-select:none;display:flex;align-items:center;justify-content:center;width:40px;height:40px;color:rgb(150, 150, 150);border:1px solid rgb(238, 238, 238);border-radius:50%;font-size:18px;"><i style="box-sizing:border-box;display:inline-block;color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;vertical-align:-0.125em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased;"><span style="color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;display:none;"></span><span style="box-sizing:border-box;overflow:hidden;line-height:1;display:inline-block;"><span style="box-sizing:border-box;"></span></span></i></div></div></div><div style="box-sizing:border-box;display:flex;align-items:center;"><a href="https://www.jianshu.com/nb/14768175" rel="noopener noreferrer" style="box-sizing:border-box;color:inherit;text-decoration:none;background-color:transparent;outline:none;cursor:pointer;transition:color 0.3s ease 0s;touch-action:manipulation;display:flex;align-items:center;margin-right:12px;" target="_blank"><i style="box-sizing:border-box;display:inline-block;color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;vertical-align:-0.125em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased;font-size:16px;"><span style="color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;font-size:16px;display:none;"></span><span style="box-sizing:border-box;overflow:hidden;line-height:1;display:inline-block;"><span style="box-sizing:border-box;"></span></span></i><span style="box-sizing:border-box;margin-left:8px;">Daily summary</span></a><div style="box-sizing:border-box;display:flex;align-items:center;"><div style="box-sizing:border-box;display:flex;align-items:center;justify-content:center;width:40px;height:40px;color:rgb(150, 150, 150);border:1px solid rgb(238, 238, 238);border-radius:50%;font-size:18px;cursor:pointer;"><i style="box-sizing:border-box;display:inline-block;color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;vertical-align:-0.125em;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased;"><span style="color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;display:none;"></span><span style="box-sizing:border-box;overflow:hidden;line-height:1;display:inline-block;"><span style="box-sizing:border-box;"></span></span></i></div></div></div></div><div style="box-sizing:border-box;width:100%;height:1px;margin:16px 0px;background-color:rgb(238, 238, 238);margin-top:24px;margin-bottom:24px;"></div><div style="box-sizing:border-box;display:flex;flex-direction:column;align-items:center;margin:40px 0px 32px;"><div style="box-sizing:border-box;font-size:16px;font-weight:500;margin-bottom:16px;">&quot;小礼物走一走，来简书关注我&quot;</div><span style="box-sizing:border-box;color:rgb(102, 102, 102);margin-top:24px;">还没有人赞赏，支持一下</span></div><div style="box-sizing:border-box;display:flex;align-items:center;background-color:rgb(250, 250, 250);border-radius:4px;padding:12px 16px;"><a href="https://www.jianshu.com/u/9a316c32b7f1" rel="noopener noreferrer" style="box-sizing:border-box;color:inherit;text-decoration:none;background-color:transparent;outline:none;cursor:pointer;transition:color 0.3s ease 0s;touch-action:manipulation;" target="_blank"><img src="modify request url in zuul filter(9.21)_files/webp [2].webp" type="image/webp" data-filename="webp.webp" alt="" height="48" style="box-sizing:border-box;vertical-align:middle;border-radius:50%;border:1px solid rgb(238, 238, 238);min-width:50px;min-height:50px;width:50px;height:50px;" width="48"/></a><div style="box-sizing:border-box;flex-grow:1;margin:0px 12px;overflow:hidden;"><div style="box-sizing:border-box;display:flex;align-items:center;margin-bottom:2px;"><a href="https://www.jianshu.com/u/9a316c32b7f1" rel="noopener noreferrer" style="box-sizing:border-box;color:inherit;text-decoration:none;background-color:transparent;outline:none;cursor:pointer;transition:color 0.3s ease 0s;touch-action:manipulation;flex-shrink:0;font-size:16px;font-weight:500;margin-right:6px;" target="_blank" title="星期六1111">星期六1111</a><span style="box-sizing:border-box;font-size:14px;color:rgb(102, 102, 102);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;" title="爱幻想的程序媛走在路上，边走边沉淀。。。">爱幻想的程序媛走在路上，边走边沉淀。。。</span></div><div style="box-sizing:border-box;font-size:14px;color:rgb(150, 150, 150);"><span style="box-sizing:border-box;margin-right:12px;">总资产2 (约0.21元)</span><span style="box-sizing:border-box;margin-right:12px;">共写了6.2W字</span><span style="box-sizing:border-box;margin-right:12px;">获得87个赞</span><span style="box-sizing:border-box;margin-right:0px;">共73个粉丝</span></div></div></div></div></div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 