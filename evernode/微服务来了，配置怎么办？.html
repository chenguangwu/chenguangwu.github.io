<html>
<head>
  <title>微服务来了，配置怎么办？</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="6325"/>
<h1>微服务来了，配置怎么办？</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/4/28 13:51</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://mp.weixin.qq.com/s/VnE84oB5MVjPVM4jB1lq6w"><i>https://mp.weixin.qq.com/s/VnE84oB5MVjPVM4jB1lq6w</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%; position: relative;"><div style="text-size-adjust:100%;line-height:1.6;"><div style="font-family:&quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;line-height:inherit;background-color:rgb(255, 255, 255);"><div><div style="background-color:rgb(255, 255, 255);font-size:16px;word-wrap:break-word;"><div style="background-color:rgb(255, 255, 255);"><div>
                
                <h2 style="margin:0px;padding:0px;font-weight:400;font-size:24px;margin-bottom:14px;line-height:1.4;padding-bottom:10px;border-bottom:1px solid rgb(231, 231, 235);">
                    微服务来了，配置怎么办？                                    </h2>
                <div style="margin:0px;padding:0px;margin-bottom:18px;line-height:20px;font-size:0px;position:relative;z-index:1;">
                                        <span style="font-size:15px;margin:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;padding:1px 0.5em;border:1px solid rgb(158, 158, 158);color:rgb(140, 140, 140);border-radius:20% 50%;line-height:1.1;max-width:none;">原创</span>
                                                            <em style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;color:rgb(140, 140, 140);max-width:none;font-style:normal;">2017-11-09</em>

                                        <em style="margin:0px;padding:0px;display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;color:rgb(140, 140, 140);max-width:none;font-style:normal;">郝炎峰</em>
                                        <a href="https://mp.weixin.qq.com/s/VnE84oB5MVjPVM4jB1lq6w##" style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:16px;max-width:none;display:inline-block;">EAWorld</a>
                    


                    
                </div>
                                
                
                
                
                                                
                                                                
                
                <div style="margin:0px;padding:0px;overflow:hidden;color:rgb(62, 62, 62);min-height:350px;position:relative;">
                    

                    

                    
                    
                    <p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;white-space:normal;font-size:15px;color:rgb(136, 136, 136);line-height:1.6;">转载本文需注明出处：微信公众号EAWorld，违者必究。</strong>感谢Fighter168、宋顺、许二虎、朱江等大牛对本文的帮助。</span></strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(136, 136, 136);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640" type="image/webp" data-filename="640" height="436" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">配置管理是个简单的小话题，程序员都已经非常熟悉，咋就跟微服务挂上钩了呢？</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">前些年没提微服务架构的时候，大家也都会做配置管理相关的事情，比如我接触过的很多项目都做有配置，做得有好有坏。大多是手工作坊，修改配置、重启服务... … 好像也能凑合。其实不论有没有微服务，把配置管理好的手段和方法都差不多，只是微服务架构重分布式的特点凸显了这个问题的重要性，再不管好配置，还想继续凑合就行不通了。本文目的是跟大家一起梳理配置管理的一些思路和方法，一起打好微服务架构的基础。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;color:rgb(62, 62, 62);font-size:16px;white-space:normal;background-color:rgb(255, 255, 255);"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px;transform:translate3d(0px, 0px, 0px);text-align:center;"><div style="display:inline-block;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;padding:10px;width:603px;border-width:1px;border-style:solid;border-color:rgb(192, 200, 209);background-color:rgb(239, 239, 239);"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;"><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;text-align:left;"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:16px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(0, 0, 0);">目录：</span></strong></span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);">一、什么是配置</strong><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:16px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">二、配置与程序的关系</strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:16px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">三、配置管理的四个维度</strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:16px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">四、静态配置管理</strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:16px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">五、动态配置管理</strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:16px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">六、总结回顾</strong></span></p></div></div></div></div></div></div></div><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;color:rgb(62, 62, 62);font-size:16px;white-space:normal;line-height:25.6px;"><div style="margin-bottom:0.5em;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;margin-top:0.5em;padding:0px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:black;line-height:1.2;text-align:center;"><div style="margin-bottom:-1px;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;padding:0px;display:inline-block;border-bottom-width:6px;border-bottom-style:solid;border-color:rgb(95, 156, 239);color:rgb(95, 156, 239);"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:4px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:20px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:4px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:20px;">一、什么是配置</span></p></div></div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(62, 62, 62);font-size:16px;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [1]" type="image/webp" data-filename="640" height="267" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">配置是独立于程序的变量①，配置通常有各种形态，有配置文件、数据库表、系统环境变量、进程启动参数等。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">一般我们会把配置按程序启动为分界线，分为两类：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [2]" type="image/webp" data-filename="640" height="355" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">运行前的配置</span></strong></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">运行前的配置，通常是指与环境相关的一些配置，比如数据源、邮件服务器地址，不同的环境有不同的值。还有一类比如安全控制类的，例如weblogic服务启动时，会要求输入启动账号密码等。把程序与环境相关的参数设置好之后，才可以在对应的环境上正常启动运行。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">运行时的配置</span></strong></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">运行时的配置，通常就是一些可以动态调整的参数，程序会根据不同的参数值产生不同的行为，计算结果可能不一样。一般运行时的配置调整，最好是能够做到动态的热更新，不需要重启动服务才能生效。大致分两种：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ol style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:decimal;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">技术运维相关的参数，如线程池大小、队列长度，调整为不同的值会有不一样的性能表现。 </span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">业务相关的参数，比如贷款系统贷款额度调整，贷款利率调整。</span></p></li></ol><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;color:rgb(62, 62, 62);font-size:16px;white-space:normal;line-height:25.6px;"><div style="margin-bottom:0.5em;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;margin-top:0.5em;padding:0px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:black;line-height:1.2;text-align:center;"><div style="margin-bottom:-1px;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;padding:0px;display:inline-block;border-bottom-width:6px;border-bottom-style:solid;border-color:rgb(95, 156, 239);color:rgb(95, 156, 239);"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:4px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:20px;">二、配置与程序的关系</span></p></div></div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(62, 62, 62);font-size:16px;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [3]" type="image/webp" data-filename="640" height="314" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">配置管理的前提是程序与配置要分离，如果是写死代码的话，配置管理也就无从谈起了。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">其次就是一套程序支持多套配置，这是针对静态配置来说的，一套程序，不同的配置值，适应不同的环境。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">运行时，程序是稳定的，配置是可变的 ，还需要将配置持久化保存，不要放到虚机和容器的内部存储中，避免虚机、容器重启动后配置丢失，还原成镜像的最初状态。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [4]" type="image/webp" data-filename="640" height="331" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">参见上图，<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">介质+配置=部署包</strong>这个公式主要是针对静态配置说的。介质就是程序，配置就是适合环境的配置值，两者组合成的部署包就成了某个适合具体环境安装部署的部署包，有了这个环境部署包，我们就可以非常方便的把部署包安装到对应的环境中。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;font-size:16px;white-space:normal;color:rgb(62, 62, 62);line-height:25.6px;"><div style="margin-bottom:0.5em;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;margin-top:0.5em;padding:0px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:black;line-height:1.2;text-align:center;"><div style="margin-bottom:-1px;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;padding:0px;display:inline-block;border-bottom-width:6px;border-bottom-style:solid;border-color:rgb(95, 156, 239);color:rgb(95, 156, 239);"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:4px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:20px;">三、配置管理的四个维度</span></p></div></div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:16px;white-space:normal;color:rgb(62, 62, 62);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:16px;white-space:normal;color:rgb(62, 62, 62);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;color:rgb(0, 0, 0);">配置是需要治理的，配置管理的过程中，我们需要考虑下面这四个维度。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [5]" type="image/webp" data-filename="640" height="382" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">多环境管理，维护好环境与配置的关系，即不同环境不同配置（静态配置相关）</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">影响范围控制，运行时配置变更后，会影响单点还是集群，是只影响一个应用，还是会影响多个不同的应用（动态配置相关）</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">配置管理过程需要有权限控制，严格的话配置变化还需要有流程审核才能发布。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">配置变更操作需要审计，要知道什么人、什么时间修改了哪些配置。每次修改发布都要留痕，也就是有多版本，一旦修改出了问题，可以进行回退操作，恢复到修改之前的状态。</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;color:rgb(62, 62, 62);font-size:16px;white-space:normal;line-height:25.6px;"><div style="margin-bottom:0.5em;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;margin-top:0.5em;padding:0px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:black;line-height:1.2;text-align:center;"><div style="margin-bottom:-1px;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;padding:0px;display:inline-block;border-bottom-width:6px;border-bottom-style:solid;border-color:rgb(95, 156, 239);color:rgb(95, 156, 239);"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:4px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:20px;">四、静态配置管理</span></p></div></div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(62, 62, 62);font-size:16px;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">先来看一个反例，一些企业比如金融行业，非常重视上线过程的流程和操作合规性的，但现状是没有技术手段支撑，全是手工操作，开发人员和运维人员都很痛苦，整个上线周期很长，非常容易出问题。</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [6]" type="image/webp" data-filename="640" height="332" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">见上图，功能开发结束后，开发人员为了上线，先要准备一堆文档，比如操作手册，要求写成运维人员不需要思考，完全机械化的按步骤复制、粘贴就能完成操作的状态。比如在什么目录下某个文件里面，配置数据源，然后在负载均衡什么目录下配置Ip端口等等。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">先写个半个月文档，然后评审，接下来再演练，反复进行好多次，最后才能上线。开发工作量和上线过程的工作量几乎到了1:1 效率非常低下。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">那么推荐的做法是要<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">流程和技术并重</strong>，通过自动化的手段，将介质和配置组合，打出适合某环境安装的部署包，更方便的部署到开发环境。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [7]" type="image/webp" data-filename="640" height="427" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">见上图，集成过程中设置好配置值，编译后可以直接注入配置作出部署包，如果有自动化部署服务能力的话，就能够自动的吧部署包发布到对应的环境中了。即便是没有自动化部署，一个已经配置好的应用部署包，手工操作起来也是很简单的事情，解压到合适的位置就好了。下面推荐两个静态配置管理的方案供大家参考：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 122, 170);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">方案一：Spring Profiles</span></strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">Spring Profiles</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">②是Spring推出的功能，提供了应用程序在不同环境中使用不同配置的能力。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">比如在spring boot应用中的用法。如果使用properties文件存储配置时，可以为每个环境分别设置一个配置文件。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [8]" type="image/webp" data-filename="640" height="106" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;color:rgb(0, 0, 0);">如果项目中使用了yml格式的配置文件的话，不同环境的profile需要在同一个配置文件里面定义，示例如下：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;color:rgb(0, 0, 0);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;color:rgb(0, 0, 0);"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [9]" type="image/webp" data-filename="640" height="261" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;color:rgb(0, 0, 0);"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">定义好后不同profiles的配置后，在Spring boot应用启动时，可以通过参数指定激活某个profile，然后Spring boot程序就会加载对应profile下的配置值，启动参数激活方式示例如下：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [10]" type="image/webp" data-filename="640" height="36" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 122, 170);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">方案二：AutoConfig + SCM</strong></span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">AutoConfig</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">③： 阿里系的一个开源工具，提供了在build时刻基于文件进行配置注入的能力。类似于Maven Filtering，但其使用方式与开发应用所采用的技术框架无关，具备良好的通用性。（AutoConfig源码库地址：</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;text-decoration:underline;color:rgb(136, 136, 136);">https://github.com/webx/citrus-tool/tree/master/antx/autoconfig</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">）</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [11]" type="image/webp" data-filename="640" height="97" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">参见上图，AutoConfig 配置注入主要分三个步骤。有了模板和配置元数据的定义再加上配置值，就可以通过命令把配置值注入到目标文件里面。工具非常强大，针对的是目标文件，不依赖编译框架。在编译中或者编译后都可以执行，还可以注入压缩包内的配置文件。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">配置模板抽取：</span></strong></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">application.yml</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"> 源配置文件示例</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [12]" type="image/webp" data-filename="640" height="148" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">application.template</strong> 是根据application.yml抽取出来的配置模板。其中${}内的字符就是配置项名称。示例如下：</p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [13]" type="image/webp" data-filename="640" height="151" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">配置元数据定义</span></strong></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">auto-conf.xml</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"> 即配置元数据定义文件，文件中主要包<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">配置项的定义</strong>和<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">注入脚本定义</strong>两部分内容。示例如下：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [14]" type="image/webp" data-filename="640" height="322" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">配置文件注入</strong></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">通过命令行注入配置文件示例如下：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [15]" type="image/webp" data-filename="640" height="56" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">SCM</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">④： 普元自建的一个配置管理服务，支持对应用在交付过程中的不同阶段和环境的配置进行统一管理。我们反复再强调，配置管理是软件交付过程中的非常重要的环节。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">如果说没有软件配置管理的话，项目将是个什么样子？开发人员没定义或者乱定义，测试人员不会装不会配，上线的运维人员更是一头雾水。这种状态下，想要成功上线，就只能回到严格控制流程，逼开发写文档，逼测试演练，逼运维转型机器人。大家都干着枯燥无味的事情。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">那么SCM的作用就是要<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">支撑软件配置的协作化管理</strong> ，通过SCM提供的能力，可以让开发人员在设计过程中，规范的定义配置项，并设置好默认值。测试人员负责设置测试环境需要使用的配置值，运维人员负责生产环境的配置值，做好这些后，持续集成和交付服务可以快捷的编译出部署包并安装到目标环境里。SCM在配置版本、环境、角色、权限、流程等配置管理的多个维度均提供了相应的能力支撑。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [16]" type="image/webp" data-filename="640" height="373" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">上图是是我们的DevOps产品中的一个CI、CD示意图。开发、测试、运维人员，通过门户UI去设置不同环境的不同配置值，然后发起编译、打包、部署操作，后台就由各服务自动的进行源码编译、配置注入、自动部署等操作。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">开发人员不用写那些一堆上线操作手册了，只需要定义配置项，设置默认值。测试人员、运维人员也都设置自己维护环境的对应配置，评审都是在线进行，审核通过，点个按钮就自动部署。总之能让机器代劳的工作，尽量少让人手工干。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">SCM服务的主要概念模型如下图：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [17]" type="image/webp" data-filename="640" height="665" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">一个业务系统可以由多个组件（微服务）</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">组件是部署的最小单元</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">一个组件可以定义多个配置项</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">一个配置项对应不用环境可以有不同值（每次环境配置提交均全量留痕，打部署包时可按需选择）</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">在我们DevOps产品门户中已有环境配置管理的应用，组件部署设计中配置项设置相关的页面截图如下：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [18]" type="image/webp" data-filename="640" height="438" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">静态配置管理的两个方案对比如下：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">Spring Profile方案</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">：</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">说明：Spring体系能力，能够与Maven、Jenkins集成。适合一般项目中使用。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">优势：配置简单，使用方便</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">劣势：环境配置存放到代码库中，权限不好控，安全性一般；技术框架有限制（Spring），灵活程度略低（依赖Maven编译）</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">SCM + AutoConfig方案</strong>：</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">说明：更体系化的配置管理整体方案，更适合企业整体规划。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">优势：完善的配置权限管理；不限制技术框架；针对的是目标文件，更灵活。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">劣势：需要开发维护SCM服务</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;color:rgb(62, 62, 62);font-size:16px;white-space:normal;line-height:25.6px;"><div style="margin-bottom:0.5em;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;margin-top:0.5em;padding:0px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:black;line-height:1.2;text-align:center;"><div style="margin-bottom:-1px;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;padding:0px;display:inline-block;border-bottom-width:6px;border-bottom-style:solid;border-color:rgb(95, 156, 239);color:rgb(95, 156, 239);"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:4px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:20px;">五、动态配置管理</span></p></div></div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(62, 62, 62);font-size:16px;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">首先看图回顾一下前面提到了动态配置的一些要点： </span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [19]" type="image/webp" data-filename="640" height="320" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">动态配置通常包含，业务运营配置，和技术运维配置。动态配置管理，通常就需要考虑右边这三个维度，影响范围、权限控制、审计很多版本，最后还有一个隐含的要求就是要支持热更新。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">那么传统动态配置管理的方案和微服务架构下的管理方式思路基本一致。主要是这三个方面：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">状态统一管理</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">中心配置仓库</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">配置推送和拉取</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">传统模式和微服务架构的区别就是，以前分布式程度低，很多情况都是手工维护。比如应用状态管理、集群配置都是手工维护的。很少有做配置修改审计和回滚的。微服务架构下，我们需要更加灵活，快速变化。那么应用需要自动注册发现，应用很分散，审计的需求加强了，异常回退的需求也来了。那么久需要适应微服务架构下的配置管理方案，示意图如下：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [20]" type="image/webp" data-filename="640" height="344" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">我们的微服务平台配置中心是选用了携程开源的Apollo<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:13px;text-indent:32px;">①</span>，也是功能非常强大，需要的能力基本都是现成的。Apollo配置中心能够方便的与注册中心集成。我们的微服务平台是基于Spring Cloud，而Apollo也是能够跟Spring Cloud这套环境很好融合。Apollo的主要概念模型如下：</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [21]" type="image/webp" data-filename="640" height="417" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="640"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><ul style="margin:0px;padding:0px;padding-left:2.2em;max-width:100%;box-sizing:border-box;word-wrap:break-word;list-style-type:square;"><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">App</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">：应用</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">Cluster</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">：集群</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">Namespace</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">：名称控件（可以类比为文件）</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">Item</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">：Namespace下的配置项，每个Item是一个key, value组合</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">Release</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">：Namespace发布的配置，每个发布包含发布时该Namespace的所有配置</span></p></li><li style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">Commit</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">：Namespace下的配置更改记录</span></p></li></ul><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">基于Apollo配置中心，我们的微服务平台管理门户中可以方便的管理各微服务应用中的配置，通过管理门户统一控制配置权限，每个配置项修改分为保存、发布两个动作，发布过程可以支持流程审核。配置项值变更多版本记录，可以回滚到某个历史版本。见下图：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [22]" type="image/webp" data-filename="640" height="427" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;font-size:16px;white-space:normal;color:rgb(62, 62, 62);line-height:25.6px;"><div style="margin-bottom:0.5em;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;margin-top:0.5em;padding:0px;border-bottom-width:1px;border-bottom-style:solid;border-bottom-color:black;line-height:1.2;text-align:center;"><div style="margin-bottom:-1px;margin:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word !important;padding:0px;display:inline-block;border-bottom-width:6px;border-bottom-style:solid;border-color:rgb(95, 156, 239);color:rgb(95, 156, 239);"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:4px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:20px;">六、总结回顾</span></p></div></div></div><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;font-size:16px;white-space:normal;color:rgb(62, 62, 62);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">最后，我们用一张图⑥来总结回顾一下：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [23]" type="image/webp" data-filename="640" height="342" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">本文讲的配置管理，主要就以<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">运行前的静态配置</strong>和<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">运行时的动态配置</strong>入手展开的。配置管理的前提，就是程序和配置要分离。静态配置考虑多环境，要管理配置和环境的关系，动态配置要考虑变更影响范围。两者都需要考虑的是权限、审计、多版本等内容。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;">那我们要做好配置管理，需要在不同的阶段，配合一些手段来逐步实现。首先是<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">定规范</strong>要求程序和配置分离，然后<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">统一打法</strong>选合适的技术框架，让配置定义、加载、热更新等方式尽量统一，最后<strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">平台化</strong>做规范化的集中配置管理。</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:0em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;">参考资料：</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:13px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);">①</span> <strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">开源配置中心Apollo的设计与实现</strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:13px;text-decoration:underline;">http://www.infoq.com/cn/articles/open-source-configuration-center-apollo</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:13px;">② <strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">Spring boot profiles</strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:13px;text-decoration:underline;">https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:13px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:14px;">③</span><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:14px;"> AutoConfig工具使用指南</span></strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:13px;text-decoration:underline;">http://blog.csdn.net/fighterandknight/article/details/70245905</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:13px;">④</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:13px;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5MDEzMzg5Nw==&amp;mid=2660392944&amp;idx=1&amp;sn=47788f9dcaf9b167826257040b7ca372&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:underline;max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"> </span><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">DevOps之软件配置协作化管理</strong></a></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);font-size:13px;">⑤<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(0, 0, 0);"> </span></span><a href="http://mp.weixin.qq.com/s?__biz=MzI5MDEzMzg5Nw==&amp;mid=2660394363&amp;idx=1&amp;sn=e064f8fdebee56e20461e238c346f5d6&amp;chksm=f742479dc035ce8bd6d82a921a632ad0ec36d20577b8a4b68531d29f44047930b616e008da17&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:underline;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:13px;text-indent:2em;" target="_blank"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">基</strong><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;">于微服务的企业应用架构设计范式</strong></a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;background-color:white;color:rgb(62, 62, 62);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;background-color:white;color:rgb(62, 62, 62);">推荐阅读：</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;text-indent:2em;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5MDEzMzg5Nw==&amp;mid=2660396123&amp;idx=1&amp;sn=b0f42f11f9cd9f0fa1c3b2b454516781&amp;chksm=f7424ebdc035c7ab72be1a46b7f8d855a354495d9ef81566b1a3d9d6ef9503611f9d1c438f49&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;">微服务编排之道</span></a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;text-indent:2em;"><a href="https://mp.weixin.qq.com/s?__biz=MzI5MDEzMzg5Nw==&amp;mid=2660395901&amp;idx=1&amp;sn=3a2bdcd8a4034c1cbc6d320a8bac773e&amp;chksm=f742499bc035c08d1afe2894faea16e6f3673ad807a065822d49f466ef1699b62f5830c3fc44&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;">微服务的4个设计原则和19个解决方案</span></a></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;text-indent:2em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5MDEzMzg5Nw==&amp;mid=2660395161&amp;idx=1&amp;sn=5c2c80b0e3882550d4c2d20efa46c784&amp;chksm=f7424a7fc035c36908bf620978810f2bc0aa2eb891beaf8bd52f1e05367be49a33a0702f920b&amp;scene=21#wechat_redirect" style="margin:0px;padding:0px;color:rgb(96, 127, 166);text-decoration:none;max-width:100%;box-sizing:border-box;word-wrap:break-word;" target="_blank">微服务的持续集成，四步“构建”一个代码世界</a></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(62, 62, 62);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(62, 62, 62);">关于作者：</span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(62, 62, 62);font-size:16px;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;">        郝炎峰，</span>现任普元 SOA&amp;云计算产品部 产品架构师。主要负责普元流程产品的核心架构设计与产品版本发展规划，先后参与了国家电网BPM、BAM平台、浦发银行新一代流程平台等大型平台项目建设与实施 。</span></p><p style="min-height:1em;margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;line-height:35px;padding:0px;color:rgb(62, 62, 62);font-size:16px;white-space:normal;clear:both;background-color:white;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:12px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;line-height:18px;font-family:微软雅黑, sans-serif;"><img src="微服务来了，配置怎么办？_files/640 [24]" type="image/webp" data-filename="640" height="427" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;font-size:12px;visibility:visible !important;width:auto !important;" width="auto"/></span></strong></span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><img src="微服务来了，配置怎么办？_files/640 [25]" type="image/webp" data-filename="640" height="121" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;float:left;width:121px !important;visibility:visible !important;" width="121"/><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(62, 62, 62);background-color:rgb(255, 255, 255);">关于EAWorld</span></strong><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;color:rgb(62, 62, 62);background-color:rgb(255, 255, 255);">：</span>微服务，DevOps，数据治理，移动架构原创技术分享，</span><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;">长按二维码关注</span></strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></p><blockquote style="padding:0px;margin:0px;padding-left:10px;border-left:3px solid rgb(219, 219, 219);max-width:100%;box-sizing:border-box;word-wrap:break-word;"><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;">10月-11月，PWorld系列技术趴还将继续上演。目前，11月26日将在上海举行PWorld MeetUP“自服务的大数据治理行业实战分享”已启动报名，到场即有机会获得主题相关的技术书籍，戳“阅读原文”可直达报名页面，并了解更多详情~</span></p></blockquote><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:15px;"></span></strong></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;"><img src="微服务来了，配置怎么办？_files/640 [26]" type="image/webp" data-filename="640" height="397" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;height:auto !important;width:auto !important;visibility:visible !important;" width="670"/></p>
                </div>
                
                
                
                                
                

                
                                
                
                            </div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 