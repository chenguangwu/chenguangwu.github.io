<html>
<head>
  <title>oracle中wm_concat 字符串缓冲区太小解决方案 - JaremyShort的博客 - CSDN博客</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600718 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3126"/>
<h1>oracle中wm_concat 字符串缓冲区太小解决方案 - JaremyShort的博客 - CSDN博客</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/11/21 14:19</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://blog.csdn.net/yh910420/article/details/79964653"><i>https://blog.csdn.net/yh910420/article/details/79964653</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;"><div style="outline:0px;box-sizing:border-box;"><div style="box-sizing:inherit;outline:0px;font-family:&quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:1.57143;background-color:rgb(245, 246, 247);color:rgb(51, 51, 51);-webkit-font-smoothing:antialiased;"><div style="outline:0px;box-sizing:border-box;"><span style="box-sizing:inherit;outline:0px;"><div style="box-sizing:inherit;outline:0px;background:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.05) 0px 2px 4px 0px;">
	<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;border-bottom:1px solid rgb(224, 224, 224);padding-top:16px;z-index:9;background-color:rgb(255, 255, 255);">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;">
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;margin-bottom:8px;">
				<span style="color:rgb(134, 202, 94);padding:0px;margin:0px;outline:0px;box-sizing:inherit;margin-right:8px;text-align:center;border-radius:50%;width:26px;height:26px;font-size:12px;line-height:26px;display:inline-block;border:1px solid rgb(231, 244, 223);margin-top:4px;float:left;">转</span>				<h1 style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:24px;word-wrap:break-word;">oracle中wm_concat 字符串缓冲区太小解决方案</h1>
			</div>
			<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;padding-bottom:14px;position:relative;">
				<div style="color:rgb(133, 133, 133);width:88%;height:24px;box-sizing:inherit;outline:0px;padding:0px;margin:0px;overflow:hidden;">
																				<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;">2018年04月16日 18:52:11</span>
					<a href="https://me.csdn.net/yh910420" style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;text-decoration:none;cursor:pointer;color:rgb(120, 165, 241);margin-right:14px;" target="_blank">JaremyS</a>
						<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;">阅读数：1706</span>
						
														<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;margin-bottom:8px;font-size:12px;">
								<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;color:rgb(77, 77, 77);">标签：</span>
																<a href="http://so.csdn.net/so/search/s.do?q=wm_concat&amp;t=blog" style="text-align:center;margin:0px;outline:0px;box-sizing:inherit;display:inline-block;line-height:21px;border-radius:100px;color:rgb(77, 77, 77);padding:0px 8px;margin-bottom:4px;border:1px solid rgb(204, 204, 204);word-wrap:break-word;min-width:24px;height:21px;text-decoration:none;cursor:pointer;margin-right:8px;" target="_blank">wm_concat																</a>
							<span style="top:0px;padding:0px;margin:0px;outline:0px;box-sizing:inherit;cursor:pointer;background-color:rgb(255, 255, 255);font-size:12px;right:101px;width:45px;display:inline-block;line-height:20px;letter-spacing:0px;color:rgb(51, 153, 234);margin-right:0px;">更多</span></span>
																					<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-size:12px;margin-top:6px;margin-bottom:0px;">
								<span style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;margin-right:14px;color:rgb(77, 77, 77);">个人分类：</span>
																<a href="https://blog.csdn.net/yh910420/article/category/7344795" style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;text-decoration:none;cursor:pointer;display:inline-block;margin-right:24px;color:rgb(121, 165, 229);word-wrap:break-word;" target="_blank">Oracle																</a>
							</div>
																								</div>
				<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;position:absolute;top:0px;right:0px;">
														</div>
			</div>
		</div>
	</div>
	<div style="box-sizing:inherit;outline:0px;margin:0px;padding:0px;display:block;position:relative;padding-top:16px;">
		<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;word-wrap:break-word;">
								            
						<div style="box-sizing:inherit;outline:0px;padding:0px;margin:0px;font-family:-apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;word-wrap:break-word;">
                <p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;word-wrap:break-word;">转载自：https://blog.csdn.net/zym1550974736/article/details/69400400    感谢，特此记录</p><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;word-wrap:break-word;"><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/></p><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;word-wrap:break-word;"></p><p style="font-size:16px;word-wrap:break-word;outline:0px;padding:0px;margin:0px 0px 16px;box-sizing:border-box;color:rgb(79, 79, 79);font-weight:400;line-height:26px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">今天在项目中执行sql时遇到一个问题，执行</p><pre style="margin:0px 0px 24px;word-wrap:break-word;overflow-y:hidden;overflow-x:auto;box-sizing:border-box;outline:0px;color:rgb(0, 0, 0);position:relative;white-space:pre-wrap;font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;line-height:22px;padding:8px 16px 4px 56px;background-color:rgb(246, 248, 250);border:none;"><code style="font-size:14px;background:rgb(40, 44, 52);outline:0px;margin:0px;color:rgb(171, 178, 191);box-sizing:border-box;display:block;border-radius:4px;line-height:22px;overflow-x:auto;white-space:pre;font-family:&quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;padding:8px;word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;">select</span></span> wmsys.wm_concat(p_codes) codes <span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;">from</span></span> t_rel <span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;">where</span></span> id=<span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(152, 195, 121);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(152, 195, 121);word-wrap:break-word;">'123'</span></span></code></pre><ul style="outline:0px;list-style:none;box-sizing:border-box;padding:0px;margin:0px 0px 24px;word-wrap:break-word;"><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-wrap:break-word;padding:0px 8px;margin:0px;list-style:none;color:rgb(153,153,153);">1</li></ul><p style="font-size:16px;word-wrap:break-word;outline:0px;padding:0px;margin:0px 0px 16px;box-sizing:border-box;color:rgb(79, 79, 79);font-weight:400;line-height:26px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">这样一个语句时报这样的错误：</p><p style="font-size:16px;word-wrap:break-word;outline:0px;padding:0px;margin:0px 0px 16px;box-sizing:border-box;color:rgb(79, 79, 79);font-weight:400;line-height:26px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">numeric or value error: character string buffer too small(数字或值错误：字符缓冲区太小)</p><p style="font-size:16px;word-wrap:break-word;outline:0px;padding:0px;margin:0px 0px 16px;box-sizing:border-box;color:rgb(79, 79, 79);font-weight:400;line-height:26px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">经查明，wm_concat函数拼接的字符串不能超过4000字节，否则会报错。</p><hr style="border-right:none;word-wrap:break-word;outline:0px;margin:24px 0px;padding:0px;border-top:none;box-sizing:border-box;border-left:none;border-image:initial;border-bottom:1px solid rgb(204, 204, 204);color:rgb(69,69,69);font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"/><ul style="outline:0px;box-sizing:border-box;padding:0px;margin:0px 0px 24px;word-wrap:break-word;list-style:none;color:rgb(69,69,69);font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);"><li style="outline:0px;padding:0px;box-sizing:border-box;margin:8px 0px 0px 32px;list-style-type:disc;word-wrap:break-word;"><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;word-wrap:break-word;">解决方案：</p><p style="outline:0px;padding:0px;box-sizing:border-box;margin:0px 0px 16px;font-size:16px;color:rgb(79, 79, 79);font-weight:400;line-height:26px;word-wrap:break-word;">更改sql如下：</p></li></ul><pre style="margin:0px 0px 24px;word-wrap:break-word;overflow-y:hidden;overflow-x:auto;box-sizing:border-box;outline:0px;color:rgb(0, 0, 0);position:relative;white-space:pre-wrap;font-family:Consolas, Inconsolata, Courier, monospace;font-size:14px;line-height:22px;padding:8px 16px 4px 56px;background-color:rgb(246, 248, 250);border:none;"><code style="font-size:14px;background:rgb(40, 44, 52);outline:0px;margin:0px;color:rgb(171, 178, 191);box-sizing:border-box;display:block;border-radius:4px;line-height:22px;overflow-x:auto;white-space:pre;font-family:&quot;Source Code Pro&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Anonymous Pro&quot;, &quot;Droid Sans Mono&quot;, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;padding:8px;word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;">select</span></span></span><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"> <span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(97, 174, 238);word-wrap:break-word;">XMLAGG</span>(<span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;">XMLELEMENT(E, p_codes || </span></span><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(152, 195, 121);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(152, 195, 121);word-wrap:break-word;">','</span></span></span></span><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;">)).<span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(97, 174, 238);word-wrap:break-word;">EXTRACT</span>(</span><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(152, 195, 121);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(152, 195, 121);word-wrap:break-word;">'//text()'</span></span></span></span><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;">).<span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(97, 174, 238);word-wrap:break-word;">getclobval</span>(<span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"></span>) codes </span><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;">from</span></span></span><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"> t_rel </span><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(198, 120, 221);word-wrap:break-word;">where</span></span></span><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"> vote_id</span>=<span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(152, 195, 121);word-wrap:break-word;"><span style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;color:rgb(152, 195, 121);word-wrap:break-word;">'123'</span></span></code></pre><ul style="outline:0px;list-style:none;box-sizing:border-box;padding:0px;margin:0px 0px 24px;word-wrap:break-word;"><li style="outline:0px;box-sizing:border-box;list-style-type:disc;word-wrap:break-word;padding:0px 8px;margin:0px;list-style:none;color:rgb(153,153,153);">1</li></ul><p style="font-size:16px;word-wrap:break-word;outline:0px;padding:0px;margin:0px 0px 16px;box-sizing:border-box;color:rgb(79, 79, 79);font-weight:400;line-height:26px;font-family:'-apple-system', 'SF UI Text', Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif, SimHei, SimSun;background-color:rgb(255,255,255);">注意，该sql拼接字符串末尾会多一个,符号，可用substr函数或在后台截掉。</p><br style="outline:0px;margin:0px;padding:0px;box-sizing:border-box;word-wrap:break-word;"/>            </div>
                <span style="display:block;height:0px;visibility:hidden;clear:both;"></span></div>
									
					
					</div>
	
</div></span></div></div></div></div>
</div>
</span>
</div></body></html> 