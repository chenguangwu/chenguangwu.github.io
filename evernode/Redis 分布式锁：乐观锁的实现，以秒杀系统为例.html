<html>
<head>
  <title>Redis 分布式锁：乐观锁的实现，以秒杀系统为例</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2402"/>
<h1>Redis 分布式锁：乐观锁的实现，以秒杀系统为例</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2018/6/1 16:56</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2019/1/27 12:56</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="https://mp.weixin.qq.com/s/WI0frOlYNxKWrZ6qKa3Gvg"><i>https://mp.weixin.qq.com/s/WI0frOlYNxKWrZ6qKa3Gvg</i></a></td></tr>
</table>
</div>
<br/>

<div><span>
  <div>
<div style="font-size: 16px; display: inline-block; min-width: 100%;position: relative;"><div style="text-size-adjust:100%;line-height:1.6;"><div style="font-family:-apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color:rgb(51, 51, 51);letter-spacing:0.034em;background-color:rgb(255, 255, 255);"><div><div style="word-wrap:break-word;"><div style="background-color:rgb(255, 255, 255);"><div><div lang="=&quot;en&quot;" style="overflow:hidden;color:rgb(51, 51, 51);font-size:17px;word-wrap:break-word;text-align:justify;">
                    

                    

                    
                    
                    <p style="min-height:1em;margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background-color:rgb(255, 255, 255);padding:0px;font-size:16px;white-space:normal;caret-color:rgb(62, 62, 62);color:rgb(62, 62, 62);clear:both;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:14px;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 41, 65);widows:1;line-height:22.4px;">（点击</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;widows:1;line-height:22.4px;color:rgb(0, 128, 255);">上方公众号</span><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(255, 41, 65);widows:1;line-height:22.4px;">，可快速关注）</span></span></p><p style="min-height:1em;margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(62, 62, 62);padding:0px;font-size:16px;white-space:normal;caret-color:rgb(62, 62, 62);clear:both;background-color:rgb(255, 255, 255);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><blockquote style="border-left:3px solid rgb(219, 219, 219);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding-left:10px;padding:0px;font-size:16px;white-space:normal;caret-color:rgb(62, 62, 62);color:rgb(62, 62, 62);background-color:rgb(255, 255, 255);"><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:14px;widows:1;">来源：Evankaka</span></p><p style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;font-size:14px;widows:1;">blog.csdn.net/Evankaka/article/details/70570200</span></p></blockquote><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(204, 0, 0);background-color:rgb(255, 251, 0);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">乐观锁</span></strong></span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">大多数是基于数据版本（version）的记录机制实现的。即为数据增加一个版本标识，在基于数据库表的版本解决方案中，一般是通过为数据库表增加一个”version”字段来实现读取出数据时，将此版本号一同读出，之后更新时，对此版本号加1。此时，将提交数据的版本号与数据库表对应记录的当前版本号进行比对，如果提交的数据版本号大于数据库当前版本号，则予以更新，否则认为是过期数据。</span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">redis中可以使用watch命令会监视给定的key，当exec时候如果监视的key从调用watch后发生过变化，则整个事务会失败。也可以调用watch多次监视多个key。这样就可以对指定的key加乐观锁了。注意watch的key是对整个连接有效的，事务也一样。如果连接断开，监视和事务都会被自动清除。当然了exec，discard，unwatch命令都会清除连接中的所有监视。</span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(204, 0, 0);background-color:rgb(255, 251, 0);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">Redis事务</span></strong></span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;outline:0px;word-break:break-all;"/><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">Redis中的事务(transaction)是一组命令的集合。事务同命令一样都是Redis最小的执行单位，一个事务中的命令要么都执行，要么都不执行。Redis事务的实现需要用到 MULTI 和 EXEC 两个命令，事务开始的时候先向Redis服务器发送 MULTI 命令，然后依次发送需要在本次事务中处理的命令，最后再发送 EXEC 命令表示事务命令结束。</span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">Redis的事务是下面4个命令来实现 </span></strong><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></span></strong></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">1.multi，开启Redis的事务，置客户端为事务态。 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;outline:0px;word-break:break-all;"/>2.exec，提交事务，执行从multi到此命令前的命令队列，置客户端为非事务态。 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;outline:0px;word-break:break-all;"/>3.discard，取消事务，置客户端为非事务态。 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;outline:0px;word-break:break-all;"/>4.watch,监视键值对，作用时如果事务提交exec时发现监视的监视对发生变化，事务将被取消。 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;outline:0px;word-break:break-all;"/><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;outline:0px;word-break:break-all;"/></span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">下面笔者简单实现一个用redis乐观锁实现的秒杀系统</span></strong></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></span></strong></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(79, 79, 79);"></span></p><div style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;color:rgb(51, 51, 51);"><pre style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;margin-top:0px;margin-bottom:0px;background-image:none;background-color:initial;"><code style="border-radius:4px;margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;margin-right:0.15em;margin-left:0.15em;padding:6.66667px;font-size:0.85em;background:rgb(40, 44, 52);color:rgb(171, 178, 191);display:block;overflow-x:auto;white-space:nowrap;">package com.github.distribute.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">lock</span>.redis;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>import java.util.List;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>import java.util.Set;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>import java.util.concurrent.ExecutorService;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>import java.util.concurrent.Executors;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>import redis.clients.jedis.Jedis;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>import redis.clients.jedis.Transaction;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/><span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:161px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">/** <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>* redis乐观锁实例  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>* @author linbingwen <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>* <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>*/</span>  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:43px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">public</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">class</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:131px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">OptimisticLockTest</span> {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:491px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">public</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">static</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">void</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">main</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:94px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);">String[] args</span>) throws InterruptedException </span>{  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>        <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:30px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">long</span> starTime=System.currentTimeMillis();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>         <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>        initPrduct();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>        initClient();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>        printResult();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>          <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">long</span> endTime=System.currentTimeMillis();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">long</span> Time=endTime-starTime;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       System.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">out</span>.println(<span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:116px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;程序运行时间： &quot;</span>+Time+<span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:30px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;ms&quot;</span>);     <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>     <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   <span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:112px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">/** <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>    * 输出结果 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>    */</span>  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:242px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">public</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">static</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">void</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:80px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">printResult</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:0px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"></span>) </span>{  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       Jedis jedis = RedisUtil.getInstance().getJedis();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       Set&lt;String&gt; <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">set</span> = jedis.smembers(<span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:88px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;clientList&quot;</span>);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:21px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">int</span> i = <span style="color:rgb(209, 154, 102);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:8px;text-decoration-style:solid;text-decoration-color:rgb(209, 154, 102);">1</span>;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:21px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">for</span> (String <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">value</span> : <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:21px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">set</span>) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           System.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">out</span>.println(<span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:28px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;第&quot;</span> + i++ + <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:94px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;个抢到商品，&quot;</span>+<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">value</span> + <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot; &quot;</span>);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       RedisUtil.returnResource(jedis);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   <span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:192px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">/* <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>    * 初始化顾客开始抢商品 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>    */</span>  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:234px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">public</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">static</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">void</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:72px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">initClient</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:0px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"></span>) </span>{  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       ExecutorService cachedThreadPool = Executors.newCachedThreadPool();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:21px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">int</span> clientNum = <span style="color:rgb(209, 154, 102);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(209, 154, 102);">10000</span>;<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:117px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">// 模拟客户数目  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:21px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">for</span> (<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:21px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">int</span> i = <span style="color:rgb(209, 154, 102);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:8px;text-decoration-style:solid;text-decoration-color:rgb(209, 154, 102);">0</span>; i &lt; clientNum; i++) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           cachedThreadPool.execute(<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">new</span> ClientThread(i));  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       cachedThreadPool.shutdown();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>         <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">while</span>(<span style="color:rgb(86, 182, 194);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:30px;text-decoration-style:solid;text-decoration-color:rgb(86, 182, 194);">true</span>){    <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:16px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">if</span>(cachedThreadPool.isTerminated()){    <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   System.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">out</span>.println(<span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:148px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;所有的线程都结束了！&quot;</span>);    <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">break</span>;    <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               }    <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">try</span> {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   Thread.sleep(<span style="color:rgb(209, 154, 102);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(209, 154, 102);">1000</span>);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               } <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">catch</span> (InterruptedException e) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   e.printStackTrace();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               }      <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           }    <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   <span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:152px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">/** <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>    * 初始化商品个数 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>    */</span>  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:234px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">public</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">static</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">void</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:72px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">initPrduct</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:0px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"></span>) </span>{  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:21px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">int</span> prdNum = <span style="color:rgb(209, 154, 102);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(209, 154, 102);">100</span>;<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:90px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">// 商品个数  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       String key = <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:59px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;prdNum&quot;</span>;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       String clientList = <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:88px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;clientList&quot;</span>;<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:170px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">// 抢购到商品的顾客列表  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       Jedis jedis = RedisUtil.getInstance().getJedis();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:14px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">if</span> (jedis.exists(key)) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           jedis.del(key);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>         <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:14px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">if</span> (jedis.exists(clientList)) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           jedis.del(clientList);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       jedis.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">set</span>(key, String.valueOf(prdNum));<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:77px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">// 初始化  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       RedisUtil.returnResource(jedis);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>}  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/><span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:161px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">/** <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>* 顾客线程 <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>*  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>* @author linbingwen <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>* <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>*/</span>  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">class</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:89px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">ClientThread</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:73px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">implements</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:58px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">Runnable</span> {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   Jedis jedis = <span style="color:rgb(86, 182, 194);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(86, 182, 194);">null</span>;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   String key = <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:59px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;prdNum&quot;</span>;<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:90px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">// 商品主键  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   String clientList = <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:88px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;clientList&quot;</span>;<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:211px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;"><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">///</span>/ 抢购到商品的顾客列表主键  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   String clientName;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:212px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">public</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:89px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">ClientThread</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:51px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">int</span> num</span>) </span>{  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       clientName = <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:49px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;编号=&quot;</span> + num;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   <span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:132px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"><span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:44px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">public</span> <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:30px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">void</span> <span style="color:rgb(97, 174, 238);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(97, 174, 238);">run</span>(<span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background:rgba(0, 0, 0, 0);display:inline;width:0px;text-decoration-style:solid;text-decoration-color:rgb(171, 178, 191);"></span>) </span>{  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:21px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">try</span> {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           Thread.sleep((<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">int</span>)(Math.random()*<span style="color:rgb(209, 154, 102);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(209, 154, 102);">5000</span>));<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:117px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">// 随机睡眠一下  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       } <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">catch</span> (InterruptedException e1) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">while</span> (<span style="color:rgb(86, 182, 194);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(86, 182, 194);">true</span>) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           System.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">out</span>.println(<span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:49px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;顾客:&quot;</span> + clientName + <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:81px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;开始抢商品&quot;</span>);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           jedis = RedisUtil.getInstance().getJedis();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">try</span> {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               jedis.watch(key);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">int</span> prdNum = Integer.parseInt(jedis.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">get</span>(key));<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:117px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">// 当前商品个数  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:16px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">if</span> (prdNum &gt; <span style="color:rgb(209, 154, 102);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:8px;text-decoration-style:solid;text-decoration-color:rgb(209, 154, 102);">0</span>) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   Transaction transaction = jedis.multi();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   transaction.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">set</span>(key, String.valueOf(prdNum - <span style="color:rgb(209, 154, 102);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:7px;text-decoration-style:solid;text-decoration-color:rgb(209, 154, 102);">1</span>));  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   List&lt;Object&gt; result = transaction.exec();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:14px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">if</span> (result == <span style="color:rgb(86, 182, 194);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:30px;text-decoration-style:solid;text-decoration-color:rgb(86, 182, 194);">null</span> || result.isEmpty()) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                       System.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">out</span>.println(<span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:102px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;悲剧了，顾客:&quot;</span> + clientName + <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:94px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;没有抢到商品&quot;</span>);<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:357px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">// 可能是watch-key被外部修改，或者是数据操作被驳回  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   } <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">else</span> {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                       jedis.sadd(clientList, clientName);<span style="background:rgba(0, 0, 0, 0);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(92, 99, 112);padding:0px;display:inline;width:143px;text-decoration-style:solid;text-decoration-color:rgb(92, 99, 112);font-style:italic;">// 抢到商品记录一下  </span><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                       System.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">out</span>.println(<span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:102px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;好高兴，顾客:&quot;</span> + clientName + <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:68px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;抢到商品&quot;</span>);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                       <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">break</span>;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               } <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:29px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">else</span> {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   System.<span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:22px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">out</span>.println(<span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:162px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;悲剧了，库存为0，顾客:&quot;</span> + clientName + <span style="color:rgb(152, 195, 121);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:94px;text-decoration-style:solid;text-decoration-color:rgb(152, 195, 121);">&quot;没有抢到商品&quot;</span>);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>                   <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">break</span>;  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           } <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:37px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">catch</span> (Exception e) {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               e.printStackTrace();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           } <span style="color:rgb(198, 120, 221);margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;padding:0px;background:rgba(0, 0, 0, 0);display:inline;width:51px;text-decoration-style:solid;text-decoration-color:rgb(198, 120, 221);">finally</span> {  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               jedis.unwatch();  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>               RedisUtil.returnResource(jedis);  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>           }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>       }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>   }  <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/> <br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/>}</code></pre></div><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);text-align:center;"><img src="Redis 分布式锁：乐观锁的实现，以秒杀系统为例_files/640" type="image/webp" data-filename="640" height="320" style="outline:0px;margin:0px;visibility:visible !important;box-sizing:border-box;word-wrap:break-word !important;height:auto !important;padding:0px;word-break:break-all;cursor:zoom-in;color:rgb(79, 79, 79);max-width:100%;width:auto !important;" width="276"/></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">和上文的使用悲观锁相比，乐观锁的实现更加的简单，并发性能也会更好。</span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"/></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;">本文源码请在这里下载：</span></p><p style="margin:0px;padding:0px;max-width:100%;clear:both;box-sizing:border-box;word-wrap:break-word;min-height:1em;color:rgb(51, 51, 51);"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:14px;">https://github.com/appleappleapple/DistributeLearning</span></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="margin:0px;padding:0px;clear:both;min-height:1em;max-width:100%;box-sizing:border-box;word-wrap:break-word;white-space:normal;"><br style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box;word-wrap:break-word;"/></p><p style="min-height:1em;margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background-color:rgb(255, 255, 255);padding:0px;font-size:16px;white-space:normal;color:rgb(62, 62, 62);clear:both;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255, 169, 0);font-size:15px;">看完本文有收获？请转发分享给更多人</span></p><p style="min-height:1em;margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;line-height:25.6px;padding:0px;font-size:16px;white-space:normal;color:rgb(62, 62, 62);background-color:rgb(255, 255, 255);clear:both;text-align:center;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;font-size:15px;"><strong style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;"><span style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255, 169, 0);">关注「数据分析与开发」，提升数据技能</span></strong></span></p><p style="min-height:1em;margin:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;background-color:rgb(255, 255, 255);padding:0px;font-size:16px;white-space:normal;color:rgb(62, 62, 62);clear:both;text-align:center;"><img src="Redis 分布式锁：乐观锁的实现，以秒杀系统为例_files/640 [1]" type="image/webp" data-filename="640" height="550" style="margin:0px;padding:0px;max-width:100%;box-sizing:border-box !important;word-wrap:break-word !important;height:auto !important;visibility:visible !important;width:auto !important;" width="auto"/></p>
                </div></div></div></div></div></div></div></div>
</div>
</span>
</div></body></html> 