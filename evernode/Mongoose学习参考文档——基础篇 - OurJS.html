<html>
<head>
  <title>Mongoose学习参考文档——基础篇 - OurJS</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601935 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="12136"/>
<h1>Mongoose学习参考文档——基础篇 - OurJS</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2016/7/5 11:18</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://ourjs.com/detail/53ad24edb984bb4659000013"><i>http://ourjs.com/detail/53ad24edb984bb4659000013</i></a></td></tr>
</table>
</div>
<br/>

<div><span><div style="-evernote-webclip:true"><br/><div style="font-size: 16px"><div style="font-size:100%;"><div style="font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;font-size:14px;line-height:20px;color:rgb(51, 51, 51);background-color:rgb(255, 255, 255);overflow-y:scroll;"><div><div><div style="box-sizing:border-box;overflow:hidden;"><div style="font-size:16px;line-height:1.4em;overflow:visible;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:12771px;"> <h2 style="font-size:31.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">Mongoose学习参考文档</h2><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">前言：本学习参考文档仅供参考，如有问题，师请雅正</p><h2 style="font-size:31.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">一、快速通道</h2><h3 style="font-size:24.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.1 名词解释</h3><ul style="padding:0px;margin:0px 0px 10px 25px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:123px;"><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:41px;"><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:41px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>  ：  一种以文件形式存储的数据库模型骨架，不具备数据库的操作能力</p></li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:41px;"><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:41px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>   ：  由<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>发布生成的模型，具有抽象属性和行为的数据库操作对</p></li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;"><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>  ：  由<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>创建的实体，他的操作也会影响数据库</p></li></ul><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">注意：</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">1.本学习文档采用严格命名方式来区别不同对象，例如：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var PersonSchema;   //Person的文本属性
    var PersonModel;    //Person的数据库模型
    var PersonEntity;   //Person实体</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:46px;">2.<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>的关系请牢记，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>生成<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>创造<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>都可对数据库操作造成影响，但<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>比<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>更具操作性。</p><h2 style="font-size:31.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.2 准备工作</h2><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">1.首先你必须安装<a href="http://www.mongodb.org/" rel="nofollow" style="color:rgb(0, 136, 204);text-decoration:none;border:0px none rgb(0, 136, 204);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" target="_blank">MongoDB</a>和<a href="http://nodejs.org/" rel="nofollow" style="color:rgb(0, 136, 204);text-decoration:none;border:0px none rgb(0, 136, 204);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" target="_blank">NodeJS</a></p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">2.在项目只能够创建一个数据库连接，如下:</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:40px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var mongoose = require('mongoose');    //引用mongoose模块
    var db = mongoose.createConnection('localhost','test'); //创建一个数据库连接</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">3.打开本机<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">localhost</code>的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">test</code>数据库时，我们可以监测是否有异常</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:80px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    db.on('error',console.error.bind(console,'连接错误:'));
    db.once('open',function(){
      //一次打开记录
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">注意：</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　成功开启数据库后，就可以执行数据库相应操作，假设以下代码都在回调中处理</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">4.定义一个<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code></p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var PersonSchema = new mongoose.Schema({
      name:String   //定义一个属性name，类型为String
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">5.将该<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>发布为<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code></p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:80px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var PersonModel = db.model('Person',PersonSchema);
    //如果该Model已经发布，则可以直接通过名字索引到，如下：
    //var PersonModel = db.model('Person');
    //如果没有发布，上一段代码将会异常</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">6.用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>创建<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code></p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var personEntity = new PersonModel({name:'Krouky'});
    //打印这个实体的名字看看
    console.log(personEntity.name); //Krouky</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">7.我们甚至可以为此<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>创建方法</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:140px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    //为Schema模型追加speak方法
    PersonSchema.methos.speak = function(){
      console.log('我的名字叫'+this.name);
    }
    var PersonModel = db.model('Person',PersonSchema);
    var personEntity = new PersonModel({name:'Krouky'});
    personEntity.speak();//我的名字叫Krouky</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">8.<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>是具有具体的数据库操作<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">CRUD</code>的</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    personEntity.save();  //执行完成后，数据库就有该数据了</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">9.如果要执行查询，需要依赖<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>，当然<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>也是可以做到的</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    PersonModel.find(function(err,persons){
      //查询到的所有person
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">注意：</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　1. 具体的如何配置<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>以及<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>的相关操作，我们会在后面进行</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　2. <code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>都有能影响数据库的操作，但仍有区别，后面我们也会做解释</p><h2 style="font-size:31.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">二、新手指引</h2><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<em style="font-style:italic;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">如果您还不清楚<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Mongoose</code>是如何工作的，请参看第一章快速通道快速浏览他的用法吧</em></p><h3 style="font-size:24.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1. Schema——纯洁的数据库原型</h3><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.1 什么是Schema</h4><ul style="padding:0px;margin:0px 0px 10px 25px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:41px;"><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;">我理解<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>仅仅只是一断代码，他书写完成后程序依然无法使用，更无法通往数据库端</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:20px;">他仅仅只是数据库模型在程序片段中的一种表现，或者是数据属性模型</li></ul><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.2 如何定义Schema</h4><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:120px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var BlogSchema = new Schema({
      title:String,
      author:String
      //new Schema()中传入一个JSON对象，该对象形如 xxx:yyyy ,
      /xxx是一个字符串，定义了属性，yyy是一个Schema.Type，定义了属性类型
    });</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.3 什么是Schema.Type</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:46px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema.Type</code>是由<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Mongoose</code>内定的一些数据类型，基本数据类型都在其中，他也内置了一些<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Mongoose</code>特有的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema.Type</code>。当然，你也可以自定义<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema.Type</code>，只有满足<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema.Type</code>的类型才能定义在<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>内。</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.4 Schema.Types</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">NodeJS</code>中的基本数据类型都属于<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema.Type</code>，另外<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Mongoose</code>还定义了自己的类型</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:440px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    //举例：
    var ExampleSchema = new Schema({
      name:String,
      binary:Buffer,
      living:Boolean,
      updated:Date,
      age:Number,
      mixed:Schema.Types.Mixed, //该混合类型等同于nested
      _id:Schema.Types.ObjectId,  //主键
      _fk:Schema.Types.ObjectId,  //外键
      array:[],
      arrOfString:[String],
      arrOfNumber:[Number],
      arrOfDate:[Date],
      arrOfBuffer:[Buffer],
      arrOfBoolean:[Boolean],
      arrOfMixed:[Schema.Types.Mixed],
      arrOfObjectId:[Schema.Types.ObjectId]
      nested:{
        stuff:String,
      }
    });</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.5 关于Buffer</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Buffer</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">ArrayBuffer</code>是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Nodejs</code>两种隐藏的对象，相关内容请查看<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">NodeJS-API</code></p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.6 关于Mixed</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:46px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema.Types.Mixed</code>是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Mongoose</code>定义个混合类型，该混合类型如果未定义具体形式。因此,如果定义具体内容，就直接使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">{}</code>来定义，以下两句等价</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:40px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var AnySchema = new Schema({any:{}});
    var AnySchema = new Schema({any:Schema.Types.Mixed});</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　混合类型因为没有特定约束，因此可以任意修改，一旦修改了原型，则必须调用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">markModified()</code></p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    person.anything = {x:[3,4,{y:'change'}]}
    person.markModified('anything');//传入anything，表示该属性类型发生变化
    person.save();</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.7 关于ObjectId</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:45px;">　　主键，一种特殊而且非常重要的类型，每个<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>都会默认配置这个属性，属性名为<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">_id</code>，除非自己定义，方可覆盖</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:80px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var mongoose = require('mongoose');
    var ObjectId = mongoose.Schema.Types.ObjectId;
    var StudentSchema = new Schema({}); //默认会有_id:ObjectId
    var TeacherSchema = new Schema({id:ObjectId});//只有id:ObjectId</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:44px;">　　该类型的值由系统自己生成，从某种意义上几乎不会重复，生成过程比较复杂，有兴趣的朋友可以查看源码。</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.8 关于Array</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Array</code>在<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">JavaScript</code>编程语言中并不是数组，而是集合，因此里面可以存入不同的值，以下代码等价：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:80px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var ExampleSchema1 = new Schema({array:[]});
    var ExampleSchema2 = new Schema({array:Array});
    var ExampleSchema3 = new Schema({array:[Schema.Types.Mixed]});
    var ExampleSchema4 = new Schema({array:[{}]});</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">1.9 附言</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:46px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>不仅定义了<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">文档结构</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">使用性能</code>，还可以有<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">扩展插件</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">实例方法</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">静态方法</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">复合索引</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">文档生命周期钩子</code></p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>可以定义插件，并且插件具有良好的可拔插性，请有兴趣的读者继续往后阅读或者查阅官方资料。</p><h3 style="font-size:24.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2. Schema的扩展</h3><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.1 实例方法</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　有的时候，我们创造的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>不仅要为后面的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>提供公共的属性，还要提供公共的方法。</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　下面例子比快速通道的例子更加高级，可以进行高级扩展：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:100px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var PersonSchema = new Schema({name:String,type:String});
    //查询类似数据
    PersonSchema.methods.findSimilarTypes = function(cb){
      return this.model('Person').find({type:this.type},cb);
    }</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　使用如下：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:100px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var PersonModel = mongoose.model('Person',PersonSchema);
    var krouky = new PersonModel({name:'krouky',type:'前端工程师'});<br style="border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;"/>    krouky.findSimilarTypes(function(err,persons){
      //persons中就能查询到其他前端工程师
    });</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.2 静态方法</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　静态方法在<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>层就能使用，如下：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:140px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">  PersonSchema.statics.findByName = function(name,cb){
    this.find({name:new RegExp(name,'i'),cb});
  }
  var PersonModel = mongoose.model('Person',PersonSchema);
  PersonModel.findByName('krouky',function(err,persons){
    //找到所有名字叫krouky的人
  });</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.3 索引</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:45px;">　　索引或者复合索引能让搜索更加高效，默认索引就是主键索引<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">ObjectId</code>，属性名为<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">_id</code>， <em style="font-style:italic;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">索引会作为一个专题来讲解</em></p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.4 虚拟属性</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>中如果定义了虚拟属性，那么该属性将不写入数据库，例如：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:200px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var PersonSchema = new Schema({
      name:{
        first:String,
        last:String
      }
    });
    var PersonModel = mongoose.model('Person',PersonSchema);
    var krouky = new PersonModel({
      name:{first:'krouky',last:'han'}
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　如果每次想使用全名就得这样</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    console.log(krouky.name.first + ' ' + krouky.name.last);</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　显然这是很麻烦的，我们可以定义<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">虚拟属性</code>：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    PersonSchema.virtual('name.full').get(function(){
      return this.name.first + ' ' + this.name.last;
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　那么就能用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">krouky.name.full</code>来调用全名了，反之如果知道full，也可以反解<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">first</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">last</code>属性</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:180px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    PersonSchema.virtual('name.full').set(function(name){
      var split = name.split(' ');
      this.name.first = split[0];
      this.name.last = split[1];
    });
    var PersonModel = mongoose.model('Person',PersonSchema);
    var krouky = new PersonModel({});
    krouky.name.full = 'krouky han';//会被自动分解
    console.log(krouky.name.first);//krouky</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.5 配置项</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　在使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">new Schema(config)</code>时，我们可以追加一个参数<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">options</code>来配置<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>的配置，形如：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var ExampleSchema = new Schema(config,options);</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　或者使用</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:40px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var ExampleSchema = new Schema(config);
    ExampleSchema.set(option,value);</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　可供配置项有：<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">safe</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">strict</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">capped</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">versionKey</code>、<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">autoIndex</code></p><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.5.1 safe——安全属性（默认安全）</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　一般可做如下配置：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    new Schema({...},{safe:true});</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　当然我们也可以这样</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    new Schema({...},{safe:{j:1,w:2,wtimeout:10000}});</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">j</code>表示做1份日志，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">w</code>表示做2个副本（尚不明确），超时时间10秒</p><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.5.2 strict——严格配置（默认启用）</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　确保<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>的值存入数据库前会被自动验证，如果你没有充足的理由，请不要停用，例子：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:80px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var ThingSchema = new Schema({a:String});
    var ThingModel = db.model('Thing',SchemaSchema);
    var thing = new Thing({iAmNotInTheThingSchema:true});
    thing.save();//iAmNotInTheThingSchema这个属性将无法被存储</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　如果取消严格选项，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">iAmNotInTheThingSchema</code>将会被存入数据库</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　该选项也可以在构造实例时使用，例如：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var ThingModel = db.model('Thing');
    var thing1 = new ThingModel(doc,true);  //启用严格
    var thing2 = new ThingModel(doc,false); //禁用严格</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">注意：</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">strict</code>也可以设置为<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">throw</code>，表示出现问题将会抛出错误</p><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.5.3 shardKey</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　需要<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">mongodb</code>做分布式，才会使用该属性</p><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.5.4 capped——上限设置</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　如果有数据库的批量操作，该属性能限制一次操作的量，例如：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    new Schema({...},{capped:1024});  //一次操作上线1024条数据</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　当然该参数也可是JSON对象，包含size、max、autiIndexId属性</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    new Schema({...},{capped:{size:1024,max:100,autoIndexId:true}});</code></pre><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.5.5 versionKey——版本锁</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　版本锁是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Mongoose</code>默认配置（__v属性）的，如果你想自己定制，如下：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    new Schema({...},{versionKey:'__someElse'});</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　此时存入数据库的版本锁就不是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">__v</code>属性，而是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">__someElse</code>，相当于是给版本锁取名字。</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　具体怎么存入都是由<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Mongoose</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">MongoDB</code>自己决定，当然，这个属性你也可以去除</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">  new Schema({...},{versionKey:false});</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　除非你知道你在做什么，并且你知道这样做的后果</p><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">2.5.6 autoIndex——自动索引</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　<em style="font-style:italic;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">该内容将在索引章节单独讲解</em></p><h3 style="font-size:24.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">3. Documents</h3><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Document</code>是与<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">MongoDB</code>文档一一对应的模型，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Document</code>可等同于<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>，具有属性和操作性</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">注意：</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Document</code>的`CRUD都必须经过严格验证的，参看2.5.2 Schema的strict严格配置</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">3.1 查询</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　查询内容过多，专题讲解</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">3.2 更新</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　有许多方式来更新文件，以下是常用的传统方式：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:80px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    PersonModel.findById(id,function(err,person){
      person.name = 'MDragon';
      person.save(function(err){});
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:45px;">　　这里，利用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>模型查询到了<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">person</code>对象，该对象属于<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>，可以有<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">save操作，如果使用</code>Model`操作，需注意：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:140px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    PersonModel.findById(id,function(err,person){
      person.name = 'MDragon';
      var _id = person._id; //需要取出主键_id
      delete person._id;    //再将其删除
      PersonModel.update({_id:_id},person,function(err){});
      //此时才能用Model操作，否则报错
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:45px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">update</code>第一个参数是查询条件，第二个参数是更新的对象，但不能更新主键，这就是为什么要删除主键的原因。</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:45px;">　　当然这样的更新很麻烦，可以使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">$set</code>属性来配置，这样也不用先查询，如果更新的数据比较少，可用性还是很好的：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    PersonModel.update({_id:_id},{$set:{name:'MDragon'}},function(err){});</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:46px;">　　需要注意，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Document</code>的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">CRUD</code>操作都是异步执行，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">callback</code>第一个参数必须是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">err</code>，而第二个参数各个方法不一样，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">update</code>的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">callback</code>第二个参数是更新的数量，如果要返回更新后的对象，则要使用如下方法</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    Person.findByIdAndUpdate(_id,{$set:{name:'MDragon'}},function(err,person){
      console.log(person.name); //MDragon
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:45px;">　　类似的方法还有<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">findByIdAndRemove</code>，如同名字，只能根据id查询并作<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">update</code>/<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">remove</code>操作，操作的数据仅一条</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">3.3 新增</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　如果是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>，使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">save</code>方法，如果是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>，使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">create</code>方法</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:120px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    //使用Entity来增加一条数据
    var krouky = new PersonModel({name:'krouky'});
    krouky.save(callback);
    //使用Model来增加一条数据
    var MDragon = {name:'MDragon'};
    PersonModel.create(MDragon,callback);</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:92px;">　　两种新增方法区别在于，如果使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>新增时，传入的对象只能是纯净的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">JSON</code>对象，不能是由<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>创建的实体，原因是：由<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>创建的实体<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">krouky</code>虽然打印是只有<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">{name:'krouky'}</code>，但是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">krouky</code>属于<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>，包含有<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>属性和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>数据库行为模型。如果是使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>创建的对象，传入时一定会将隐藏属性也存入数据库，虽然<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">3.x</code>追加了默认严格属性，但也不必要增加操作的报错</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">3.4 删除</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　和新增一样，删除也有2种方式，但<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>都使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">remove</code>方法</p><h3 style="font-size:24.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">4.Sub Docs</h3><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　如同<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">SQL</code>数据库中2张表有主外关系，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Mongoose</code>将2个<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Document</code>的嵌套叫做<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Sub-Docs</code>（子文档）</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　简单的说就是一个<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Document</code>嵌套另外一个<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Document</code>或者<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Documents</code>:</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:120px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var ChildSchema1 = new Schema({name:String});
    var ChildSchema2 = new Schema({name:String});
    var ParentSchema = new Schema({
      children1:ChildSchema1,   //嵌套Document
      children2:[ChildSchema2]  //嵌套Documents
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Sub-Docs</code>享受和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Documents</code>一样的操作，但是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Sub-Docs</code>的操作都由父类去执行</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:120px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var ParentModel = db.model('Parent',parentSchema);
    var parent = new ParentModel({
      children2:[{name:'c1'},{name:'c2'}]
    });
    parent.children2[0].name = 'd';
    parent.save(callback);</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:46px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">parent</code>在执行保存时，由于包含<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">children2</code>，他是一个数据库模型对象，因此会先保存<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">chilren2[0]</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">chilren2[1]</code>。</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　如果子文档在更新时出现错误，将直接报在父类文档中，可以这样处理：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:160px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    ChildrenSchema.pre('save',function(next){
      if('x' === this.name) return next(new Error('#err:not-x'));
      next();
    });
    var parent = new ParentModel({children1:{name:'not-x'}});
    parent.save(function(err){
      console.log(err.message); //#err:not-x
    });</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">4.1 查询子文档</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　如果<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">children</code>是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">parent</code>的子文档，可以通过如下方法查询到<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">children</code></p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:20px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var child = parent.children.id(id);</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">4.2 新增、删除、更新</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:44px;">　　子文档是父文档的一个属性，因此按照属性的操作即可，不同的是在新增父类的时候，子文档是会被先加入进去的。</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　如果<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">ChildrenSchema</code>是临时的一个子文档，不作为数据库映射集合，可以这样：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:120px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var ParentSchema = new Schema({
      children:{
        name:String
      }
    });
    //其实就是匿名混合模式</code></pre><h3 style="font-size:24.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">5.Model</h3><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">5.1 什么是Model</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:45px;">　　<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>模型，是经过<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>构造来的，除了<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>定义的数据库骨架以外，还具有数据库行为模型，他相当于管理数据库属性、行为的类</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">5.2 如何创建Model</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　你必须通过<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Schema</code>来创建，如下：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:140px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    //先创建Schema
    var TankSchema = new Schema({
      name:'String',
      size:'String' 
    });
    //通过Schema创建Model
    var TankModel = mongoose.model('Tank',TankSchema);</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">5.2 操作Model</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　该模型就能直接拿来操作，具体查看<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">API</code>，例如：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:40px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var tank = {'something',size:'small'};
    TankModel.create(tank);</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">注意：</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:45px;">　　你可以使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>来创建<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>实体是一个特有<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>具体对象，但是他并不具备<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>的方法，只能用自己的方法。</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">  //通过Model创建Entity
  var tankEntity = new TankModel('someother','size:big');
  tankEntity.save();</code></pre><h3 style="font-size:24.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">6.Query</h3><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:45px;">　　查询是数据库中运用最多也是最麻烦的地方，这里对<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Query</code>解读的并不完善，仅仅是自己的一点领悟而已。</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">6.1 查询的方式</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　通常有2种查询方式，一种是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">直接查询</code>，一种是<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">链式查询</code>（2种查询都是自己命名的）</p><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">6.1.1 直接查询</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　在查询时带有回调函数的，称之为直接查询，查询的条件往往通过<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">API</code>来设定，例如：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:60px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    PersonModel.findOne({'name.last':'dragon'},'some select',function(err,person){
      //如果err==null，则person就能取到数据
    });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　具体的查询参数，请查询<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">API</code></p><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">6.1.2 链式查询</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　在查询时候，不带回调，而查询条件通过<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">API</code>函数来制定，例如：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:100px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var query = PersonModel.findOne({'name.last':'dragon'});
    query.select('some select');
    query.exec(function(err,pserson){
    //如果err==null，则person就能取到数据
  });</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:46px;">　　这种方式相对直接查询，分的比较明细，如果不带<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">callback</code>，则返回<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">query</code>，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">query</code>没有执行的预编译查询语句，该<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">query</code>对象执行的方法都将返回自己，只有在执行<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">exec</code>方法时才执行查询，而且必须有回调。</p><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　因为<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">query</code>的操作始终返回自身，我们可以采用更形象的链式写法</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:180px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    Person
      .find({ occupation: /host/ })
      .where('name.last').equals('Ghost')
      .where('age').gt(17).lt(66)
      .where('likes').in(['vaporizing', 'talking'])
      .limit(10)
      .sort('-occupation')
      .select('name occupation')
      .exec(callback);</code></pre><h3 style="font-size:24.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">7.Validation</h3><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:44px;">　　数据的存储是需要验证的，不是什么数据都能往数据库里丢或者显示到客户端的，数据的验证需要记住以下规则：</p><ul style="padding:0px;margin:0px 0px 10px 25px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:104px;"><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;">验证始终定义在<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">SchemaType</code>中</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:20px;">验证是一个内部中间件</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;">验证是在一个<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Document</code>被保存时默认启用的，除非你关闭验证</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;">验证是异步递归的，如果你的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">SubDoc</code>验证失败，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Document</code>也将无法保存</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;">验证并不关心错误类型，而通过<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">ValidationError</code>这个对象可以访问</li></ul><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">7.1 验证器</h4><ol style="padding:0px;margin:0px 0px 10px 25px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:84px;"><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">required</code> 非空验证</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">min</code>/<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">max</code> 范围验证（边值验证）</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">enum</code>/<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">match</code> 枚举验证/匹配验证</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;"><code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">validate</code> 自定义验证规则</li></ol><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　以下是综合案例：</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:380px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var PersonSchema = new Schema({
      name:{
        type:'String',
        required:true //姓名非空
      },
      age:{
        type:'Nunmer',
        min:18,       //年龄最小18
        max:120     //年龄最大120
      },
      city:{
        type:'String',
        enum:['北京','上海']  //只能是北京、上海人
      },
      other:{
        type:'String',
        validate:[validator,err]  //validator是一个验证函数，err是验证失败的错误信息
      }
    });</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">7.2 验证失败</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　如果验证失败，则会返回<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">err</code>信息，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">err</code>是一个对象该对象属性如下</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:140px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    err.errors                //错误集合（对象）
    err.errors.color          //错误属性(Schema的color属性)
    err.errors.color.message  //错误属性信息
    err.errors.path             //错误属性路径
    err.errors.type             //错误类型
    err.name                //错误名称
    err.message                 //错误消息</code></pre><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　一旦验证失败，<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Model</code>和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">Entity</code>都将具有和<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">err</code>一样的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">errors</code>属性</p><h3 style="font-size:24.5px;margin:10px 0px;font-weight:700;line-height:40px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">8.Middleware中间件</h3><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">8.1 什么是中间件</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　中间件是一种控制函数，类似插件，能控制流程中的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">init</code>、validate<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">、</code>save<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">、</code>remove`方法</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">8.2 中间件的分类</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　中间件分为两类</p><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">8.2.1 Serial串行</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:23px;">　　串行使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">pre</code>方法，执行下一个方法使用<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">next</code>调用</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:100px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var schema = new Schema(...);
    schema.pre('save',function(next){
      //做点什么
      next();
    });</code></pre><h5 style="font-size:14px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">8.2.2 Parallel并行</h5><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　并行提供更细粒度的操作</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:120px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    var schema = new Schema(...);
    schema.pre('save',function(next,done){
      //下一个要执行的中间件并行执行
      next();
      doAsync(done);
    });</code></pre><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">8.3 中间件特点</h4><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:44px;">　　一旦定义了中间件，就会在全部中间件执行完后执行其他操作，使用中间件可以雾化模型，避免异步操作的层层迭代嵌套</p><h4 style="font-size:17.5px;margin:10px 0px;font-weight:700;line-height:20px;color:inherit;text-rendering:optimizeLegibility;font-family:inherit;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;">8.4 使用范畴</h4><ol style="padding:0px;margin:0px 0px 10px 25px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:81px;"><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:20px;">复杂的验证</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:21px;">删除有主外关联的<code style="padding:2px 4px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:rgb(221, 17, 68);border-radius:3px;white-space:nowrap;border:1px solid rgb(225, 225, 232);background-color:rgb(247, 247, 249);background-image:none;box-shadow:none;">doc</code></li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:20px;">异步默认</li><li style="line-height:20px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:745px;height:20px;">某个特定动作触发异步任务，例如触发自定义事件和通知</li></ol><p style="margin:0px 0px 10px;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;">　　例如，可以用来做自定义错误处理</p><pre style="white-space:pre-wrap;padding:9.5px;font-size:14px;color:rgb(51, 51, 51);border-radius:4px;display:block;margin:0px 0px 10px;line-height:20px;word-break:break-all;word-wrap:break-word;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;border:;background-color:rgb(245, 245, 245);border-left-width:4px;border-left-style:solid;border-left-color:rgb(108, 226, 108);clear:left;background-image:none;box-shadow:none;width:746px;height:140px;"><code style="padding:0px;font-family:Monaco, Menlo, Consolas, 'Courier New', monospace;font-size:12px;color:inherit;border-radius:3px;white-space:pre-wrap;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">    schema.pre('save',function(next){
      var err = new Eerror('some err');
      next(err);
    });
    entity.save(function(err){
      console.log(err.message); //some err
    });</code></pre> <div style="border:1px solid rgb(239, 239, 239);margin:24px 0px 14px;clear:left;background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:768px;height:0px;"> <ins style="display:block;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:768px;height:0px;"></ins>  </div>  <div style="clear:left;font-size:18px;margin:14px 0;border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;width:770px;height:22px;"> <b style="border:0px none rgb(51, 51, 51);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;">原文地址： <a href="http://cnodejs.org/topic/504b4924e2b84515770103dd?utm_source=ourjs.com" style="color:rgb(0, 136, 204);text-decoration:none;border:0px none rgb(0, 136, 204);background-color:rgba(0, 0, 0, 0);background-image:none;box-shadow:none;" target="_blank">cnodejs.org</a> </b> </div>  </div></div></div></div></div></div></div><br/></div></span>
</div></body></html> 