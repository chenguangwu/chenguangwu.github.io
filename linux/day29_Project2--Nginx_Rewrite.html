<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Nginx Rewrite</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="ULE____课程笔记说明.html">ULE    课程笔记说明</a></p>

<p><a href="软件包.html">软件包</a></p>

<p><a href="day1___bash.html">day1   bash</a></p>

<p><a href="day2___文件管理.html">day2   文件管理</a></p>

<p><a href="day3___用户管理-文件权限.html">day3   用户管理/文件权限</a></p>

<ol>
<li><a href="day3___用户管理-文件权限--用户组管理.html">用户组管理</a></li>
<li><a href="day3___用户管理-文件权限--文件基本权限（1）.html">文件基本权限（1）</a></li>
</ol>
<p><a href="day4___权限-软件包管理.html">day4   权限/软件包管理</a></p>

<ol>
<li><a href="day4___权限-软件包管理--文件高级权限（2）.html">文件高级权限（2）</a></li>
<li><a href="day4___权限-软件包管理--软件包管理（1）.html">软件包管理（1）</a></li>
<ol>
<li><a href="day4___权限-软件包管理--软件包管理（1）--软件包管理概述.html">软件包管理概述</a></li>
<li><a href="day4___权限-软件包管理--软件包管理（1）--rpm管理RPM包.html">rpm管理RPM包</a></li>
<li><a href="day4___权限-软件包管理--软件包管理（1）--yum管理RPM包.html">yum管理RPM包</a></li>
</ol>
</ol>
<p><a href="day5___软件包管理-SHELL.html">day5   软件包管理/SHELL</a></p>

<ol>
<li><a href="day5___软件包管理-SHELL--软件包管理（2）.html">软件包管理（2）</a></li>
<li><a href="day5___软件包管理-SHELL--Bash_Shell基础.html">Bash Shell基础</a></li>
</ol>
<p><a href="day6___进程管理-管道-重定向.html">day6   进程管理/管道/重定向</a></p>

<ol>
<li><a href="day6___进程管理-管道-重定向--进程管理.html">进程管理</a></li>
<li><a href="day6___进程管理-管道-重定向--管道、重定向.html">管道、重定向</a></li>
</ol>
<p><a href="day7___存储管理（1）.html">day7   存储管理（1）</a></p>

<ol>
<li><a href="day7___存储管理（1）--存储基础知识.html">存储基础知识</a></li>
<li><a href="day7___存储管理（1）--基本分区管理.html">基本分区管理</a></li>
<li><a href="day7___存储管理（1）--逻辑卷管理LVM.html">逻辑卷管理LVM</a></li>
</ol>
<p><a href="day8___存储管理（2）.html">day8   存储管理（2）</a></p>

<ol>
<li><a href="day8___存储管理（2）--交换分区swap.html">交换分区swap</a></li>
<li><a href="day8___存储管理（2）--Mount挂载详解.html">Mount挂载详解</a></li>
<li><a href="day8___存储管理（2）--Autofs自动挂载.html">Autofs自动挂载</a></li>
<li><a href="day8___存储管理（2）--Ext3-4文件系统.html">Ext3/4文件系统</a></li>
<li><a href="day8___存储管理（2）--文件链接原理.html">文件链接原理</a></li>
</ol>
<p><a href="day9___存储管理（3）.html">day9   存储管理（3）</a></p>

<ol>
<li><a href="day9___存储管理（3）--磁盘限额.html">磁盘限额</a></li>
<li><a href="day9___存储管理（3）--磁盘阵列RAID.html">磁盘阵列RAID</a></li>
<li><a href="day9___存储管理（3）--文件查找.html">文件查找</a></li>
<li><a href="day9___存储管理（3）--文件打包及压缩.html">文件打包及压缩</a></li>
</ol>
<p><a href="day10_kernel-Modules.html">day10 kernel/Modules</a></p>

<ol>
<li><a href="day10_kernel-Modules--kernel基本概念.html">kernel基本概念</a></li>
<li><a href="day10_kernel-Modules--Kernel升级.html">Kernel升级</a></li>
<li><a href="day10_kernel-Modules--增加内核模块.html">增加内核模块</a></li>
<li><a href="day10_kernel-Modules--硬件驱动安装.html">硬件驱动安装</a></li>
</ol>
<p><a href="day11_系统启动-故障修复.html">day11 系统启动/故障修复</a></p>

<ol>
<li><a href="day11_系统启动-故障修复--系统引导流程.html">系统引导流程</a></li>
<li><a href="day11_系统启动-故障修复--常见故障处理.html">常见故障处理</a></li>
</ol>
<p><a href="day12_Cron-Network.html">day12 Cron/Network</a></p>

<ol>
<li><a href="day12_Cron-Network--计划任务cron.html">计划任务cron</a></li>
<li><a href="day12_Cron-Network--网络基础.html">网络基础</a></li>
</ol>
<p><a href="day13_Rsyslog.html">day13 Rsyslog</a></p>

<ol>
<li><a href="day13_Rsyslog--日志管理基础.html">日志管理基础</a></li>
<li><a href="day13_Rsyslog--集中式日志管理.html">集中式日志管理</a></li>
<li><a href="day13_Rsyslog--日志logrotate.html">日志logrotate</a></li>
</ol>
<p><a href="day14_SSHD-DHCP-NTP.html">day14 SSHD/DHCP/NTP</a></p>

<ol>
<li><a href="day14_SSHD-DHCP-NTP--服务概述.html">服务概述</a></li>
<li><a href="day14_SSHD-DHCP-NTP--SSHD.html">SSHD</a></li>
<li><a href="day14_SSHD-DHCP-NTP--DHCP.html">DHCP</a></li>
<li><a href="day14_SSHD-DHCP-NTP--NTPD.html">NTPD</a></li>
</ol>
<p><a href="day15_Vsftpd-NFS-CIFS.html">day15 Vsftpd/NFS/CIFS</a></p>

<ol>
<li><a href="day15_Vsftpd-NFS-CIFS--Vsftpd.html">Vsftpd</a></li>
<li><a href="day15_Vsftpd-NFS-CIFS--NAS之：_NFS.html">NAS之： NFS</a></li>
<li><a href="day15_Vsftpd-NFS-CIFS--NAS之：_CIFS.html">NAS之： CIFS</a></li>
</ol>
<p><a href="day16_DNS.html">day16 DNS</a></p>

<ol>
<li><a href="day16_DNS--DNS基本概念.html">DNS基本概念</a></li>
<li><a href="day16_DNS--Master_正向区-反向区.html">Master: 正向区/反向区</a></li>
<li><a href="day16_DNS--Slave___正向区-反向区.html">Slave:   正向区/反向区</a></li>
<li><a href="day16_DNS--DNS区域传输限制.html">DNS区域传输限制</a></li>
<li><a href="day16_DNS--根提示区、Forward.html">根提示区、Forward</a></li>
<li><a href="day16_DNS--Client使用DNS解析.html">Client使用DNS解析</a></li>
<li><a href="day16_DNS--扩展：_子域授权.html">扩展： 子域授权</a></li>
<li><a href="day16_DNS--扩展：_DNS_Round_Robin.html">扩展： DNS Round Robin</a></li>
</ol>
<p><a href="day17_Apache-Mail.html">day17 Apache/Mail</a></p>

<ol>
<li><a href="day17_Apache-Mail--常见WEB服务器.html">常见WEB服务器</a></li>
<li><a href="day17_Apache-Mail--Apache_基本配置.html">Apache 基本配置</a></li>
<li><a href="day17_Apache-Mail--Apache_虚拟主机.html">Apache 虚拟主机</a></li>
<li><a href="day17_Apache-Mail--Apache_访问控制.html">Apache 访问控制</a></li>
<li><a href="day17_Apache-Mail--Apache_Alias.html">Apache Alias</a></li>
<li><a href="day17_Apache-Mail--Apache_LAMP_(rpm).html">Apache LAMP (rpm)</a></li>
<li><a href="day17_Apache-Mail--Mail_Postfix.html">Mail: Postfix</a></li>
<li><a href="day17_Apache-Mail--部署邮件系统.html">部署邮件系统</a></li>
</ol>
<p><a href="day18_SHELL1.html">day18 SHELL1</a></p>

<ol>
<li><a href="day18_SHELL1--Bash_Shell.html">Bash Shell</a></li>
<li><a href="day18_SHELL1--Shell变量.html">Shell变量</a></li>
<li><a href="day18_SHELL1--Shell条件测试.html">Shell条件测试</a></li>
<li><a href="day18_SHELL1--流程控制：if.html">流程控制：if</a></li>
</ol>
<p><a href="day19_SHELL2.html">day19 SHELL2</a></p>

<ol>
<li><a href="day19_SHELL2--模式匹配：case.html">模式匹配：case</a></li>
<li><a href="day19_SHELL2--Shell循环：for.html">Shell循环：for</a></li>
<li><a href="day19_SHELL2--Shell循环：while_until.html">Shell循环：while until</a></li>
<li><a href="day19_SHELL2--Shell数组变量.html">Shell数组变量</a></li>
<li><a href="day19_SHELL2--day2作业.html">day2作业</a></li>
</ol>
<p><a href="day20_SHELL3.html">day20 SHELL3</a></p>

<ol>
<li><a href="day20_SHELL3--Shell_函数.html">Shell 函数</a></li>
<ol>
<li><a href="day20_SHELL3--Shell_函数--shell脚本的相互调用.html">shell脚本的相互调用</a></li>
</ol>
<li><a href="day20_SHELL3--影响程序的Shell命令.html">影响程序的Shell命令</a></li>
<li><a href="day20_SHELL3--expect.html">expect</a></li>
<li><a href="day20_SHELL3--正则表达式RE.html">正则表达式RE</a></li>
</ol>
<p><a href="day21_SHELL4.html">day21 SHELL4</a></p>

<ol>
<li><a href="day21_SHELL4--文本处理：grep.html">文本处理：grep</a></li>
<li><a href="day21_SHELL4--文本处理：sed.html">文本处理：sed</a></li>
<ol>
<li><a href="day21_SHELL4--文本处理：sed--文本处理：sed（随堂笔记）.html">文本处理：sed（随堂笔记）</a></li>
</ol>
<li><a href="day21_SHELL4--文本处理：awk.html">文本处理：awk</a></li>
<ol>
<li><a href="day21_SHELL4--文本处理：awk--文件处理：awk（随堂笔记）.html">文件处理：awk（随堂笔记）</a></li>
</ol>
</ol>
<p><a href="day22_SHELL5.html">day22 SHELL5</a></p>

<ol>
<li><a href="day22_SHELL5--进程锁.html">进程锁</a></li>
<li><a href="day22_SHELL5--并行进程.html">并行进程</a></li>
<li><a href="day22_SHELL5--使用sleep.html">使用sleep</a></li>
<li><a href="day22_SHELL5--Shell案例.html">Shell案例</a></li>
</ol>
<p><a href="mysql_5.6(new).html">mysql 5.6(new)</a></p>

<ol>
<li><a href="mysql_5.6(new)--mysql_概述.html">mysql 概述</a></li>
<li><a href="mysql_5.6(new)--mysql_的安装.html">mysql 的安装</a></li>
<li><a href="mysql_5.6(new)--mysql_的并发处理.html">mysql 的并发处理</a></li>
<li><a href="mysql_5.6(new)--mysql_的引擎.html">mysql 的引擎</a></li>
<li><a href="mysql_5.6(new)--数据库范式.html">数据库范式</a></li>
</ol>
<p><a href="day23_MySQL1.html">day23 MySQL1</a></p>

<ol>
<li><a href="day23_MySQL1--MySQL基础.html">MySQL基础</a></li>
<li><a href="day23_MySQL1--MySQL安装.html">MySQL安装</a></li>
<li><a href="day23_MySQL1--MySQL数据库操作.html">MySQL数据库操作</a></li>
<li><a href="day23_MySQL1--MySQL存储引擎.html">MySQL存储引擎</a></li>
<li><a href="day23_MySQL1--MySQL数据类型.html">MySQL数据类型</a></li>
<ol>
<li><a href="day23_MySQL1--MySQL数据类型--MySQL_5.5.html">MySQL 5.5</a></li>
<li><a href="day23_MySQL1--MySQL数据类型--MySQL_5.6.html">MySQL 5.6</a></li>
</ol>
<li><a href="day23_MySQL1--MySQL表操作.html">MySQL表操作</a></li>
<li><a href="day23_MySQL1--mysql运算符.html">mysql运算符</a></li>
</ol>
<p><a href="day24_MySQL2.html">day24 MySQL2</a></p>

<ol>
<li><a href="day24_MySQL2--MySQL数据操作.html">MySQL数据操作</a></li>
<li><a href="day24_MySQL2--MySQL单表查询.html">MySQL单表查询</a></li>
<li><a href="day24_MySQL2--MySQL索引.html">MySQL索引</a></li>
<li><a href="day24_MySQL2--mysql触发器.html">mysql触发器</a></li>
<li><a href="day24_MySQL2--MySQL视图.html">MySQL视图</a></li>
<li><a href="day24_MySQL2--mysql_存储过程与函数.html">mysql 存储过程与函数</a></li>
<li><a href="day24_MySQL2--mysql_流程控制.html">mysql 流程控制</a></li>
</ol>
<p><a href="day25_MySQL3.html">day25 MySQL3</a></p>

<ol>
<li><a href="day25_MySQL3--MySQL多表查询.html">MySQL多表查询</a></li>
<li><a href="day25_MySQL3--MySQL数据库分区.html">MySQL数据库分区</a></li>
<li><a href="day25_MySQL3--MySQL安全机制.html">MySQL安全机制</a></li>
<li><a href="day25_MySQL3--MySQL日志管理.html">MySQL日志管理</a></li>
<li><a href="day25_MySQL3--MySQL事务与隔离级别.html">MySQL事务与隔离级别</a></li>
<li><a href="day25_MySQL3--MySQL数据备份.html">MySQL数据备份</a></li>
<ol>
<li><a href="day25_MySQL3--MySQL数据备份--mysqldump与mysqlhotcopy.html">mysqldump与mysqlhotcopy</a></li>
<li><a href="day25_MySQL3--MySQL数据备份--基于snapshot备份.html">基于snapshot备份</a></li>
<li><a href="day25_MySQL3--MySQL数据备份--xtrabackup.html">xtrabackup</a></li>
<li><a href="day25_MySQL3--MySQL数据备份--innobackupex.html">innobackupex</a></li>
<li><a href="day25_MySQL3--MySQL数据备份--mysqlbackup.html">mysqlbackup</a></li>
</ol>
</ol>
<p><a href="day26_MySQL4.html">day26 MySQL4</a></p>

<ol>
<li><a href="day26_MySQL4--MySQL复制技术.html">MySQL复制技术</a></li>
<li><a href="day26_MySQL4--MySQL读写分离.html">MySQL读写分离</a></li>
<ol>
<li><a href="day26_MySQL4--MySQL读写分离--MySQL_Proxy.html">MySQL Proxy</a></li>
<li><a href="day26_MySQL4--MySQL读写分离--Amoeba.html">Amoeba</a></li>
</ol>
</ol>
<p><a href="day27_MySQL5.html">day27 MySQL5</a></p>

<ol>
<li><a href="day27_MySQL5--LNMP环境搭建.html">LNMP环境搭建</a></li>
<li><a href="day27_MySQL5--MySQL集群技术.html">MySQL集群技术</a></li>
</ol>
<p><a href="memcached_(new).html">memcached (new)</a></p>

<ol>
<li><a href="memcached_(new)--memcache简介与工作原理.html">memcache简介与工作原理</a></li>
<li><a href="memcached_(new)--Memcache的应用.html">Memcache的应用</a></li>
<li><a href="memcached_(new)--memcache_session.html">memcache_session</a></li>
</ol>
<p><a href="day28_Project1.html">day28 Project1</a></p>

<ol>
<li><a href="day28_Project1--Nginx_基本配置.html">Nginx 基本配置</a></li>
<li><a href="day28_Project1--Nginx_虚拟主机.html">Nginx 虚拟主机</a></li>
<li><a href="day28_Project1--Nginx_访问控制.html">Nginx 访问控制</a></li>
<li><a href="day28_Project1--Nginx_查看状态.html">Nginx 查看状态</a></li>
<li><a href="day28_Project1--Nginx_LNMP.html">Nginx LNMP</a></li>
<li><a href="day28_Project1--Nginx_Upstream.html">Nginx Upstream</a></li>
<li><a href="day28_Project1--项目一：_Nginx实现基本LB.html">项目一： Nginx实现基本LB</a></li>
</ol>
<p><a href="day29_Project2.html">day29 Project2</a></p>

<ol>
<li><a href="day29_Project2--项目安排.html">项目安排</a></li>
<li><a href="day29_Project2--Nginx_Rewrite.html">Nginx Rewrite</a></li>
<li><a href="day29_Project2--Tomcat_JSP.html">Tomcat JSP</a></li>
<li><a href="day29_Project2--Tomcat_虚拟主机.html">Tomcat 虚拟主机</a></li>
<li><a href="day29_Project2--Nginx_模块.html">Nginx 模块</a></li>
<ol>
<li><a href="day29_Project2--Nginx_模块--限速模块.html">限速模块</a></li>
<li><a href="day29_Project2--Nginx_模块--限线程数.html">限线程数</a></li>
<li><a href="day29_Project2--Nginx_模块--隐藏版本号.html">隐藏版本号</a></li>
<li><a href="day29_Project2--Nginx_模块--访问控制模块.html">访问控制模块</a></li>
<li><a href="day29_Project2--Nginx_模块--增加第三方模块.html">增加第三方模块</a></li>
</ol>
</ol>
<p><a href="day30_Project3.html">day30 Project3</a></p>

<ol>
<li><a href="day30_Project3--网络安全：_iptables.html">网络安全： iptables</a></li>
<li><a href="day30_Project3--七层过滤(选讲).html">七层过滤(选讲)</a></li>
</ol>
<p><a href="day31_Project4.html">day31 Project4</a></p>

<ol>
<li><a href="day31_Project4--项目介绍.html">项目介绍</a></li>
<li><a href="day31_Project4--代理服务器：_Squid.html">代理服务器： Squid</a></li>
<li><a href="day31_Project4--代理服务器：_Nginx.html">代理服务器： Nginx</a></li>
</ol>
<p><a href="day32_Project5.html">day32 Project5</a></p>

<ol>
<li><a href="day32_Project5--智能DNS：view.html">智能DNS：view</a></li>
<li><a href="day32_Project5--内容分发网络：CDN.html">内容分发网络：CDN</a></li>
</ol>
<p><a href="day33_Project6.html">day33 Project6</a></p>

<ol>
<li><a href="day33_Project6--Puppet简介.html">Puppet简介</a></li>
<li><a href="day33_Project6--Puppet部署.html">Puppet部署</a></li>
<li><a href="day33_Project6--实例：File资源.html">实例：File资源</a></li>
<li><a href="day33_Project6--实例：创建模块test1.html">实例：创建模块test1</a></li>
<li><a href="day33_Project6--实例：创建模块httpd.html">实例：创建模块httpd</a></li>
<li><a href="day33_Project6--Puppet命名规范.html">Puppet命名规范</a></li>
<li><a href="day33_Project6--Puppet资源.html">Puppet资源</a></li>
<ol>
<li><a href="day33_Project6--Puppet资源--file.html">file</a></li>
<li><a href="day33_Project6--Puppet资源--group.html">group</a></li>
<li><a href="day33_Project6--Puppet资源--user.html">user</a></li>
<li><a href="day33_Project6--Puppet资源--exec.html">exec</a></li>
<li><a href="day33_Project6--Puppet资源--cron.html">cron</a></li>
<li><a href="day33_Project6--Puppet资源--yumrepo.html">yumrepo</a></li>
<li><a href="day33_Project6--Puppet资源--package.html">package</a></li>
<li><a href="day33_Project6--Puppet资源--service.html">service</a></li>
</ol>
<li><a href="day33_Project6--资源的依赖关系.html">资源的依赖关系</a></li>
<li><a href="day33_Project6--notify_subscribe.html">notify subscribe</a></li>
<li><a href="day33_Project6--Puppet部署Nginx.html">Puppet部署Nginx</a></li>
<li><a href="day33_Project6--Puppet部署MySQL.html">Puppet部署MySQL</a></li>
<li><a href="day33_Project6--Master自动签发证书.html">Master自动签发证书</a></li>
<li><a href="day33_Project6--Puppet_Dashboard.html">Puppet Dashboard</a></li>
<li><a href="day33_Project6--Puppet_Git.html">Puppet Git</a></li>
<li><a href="day33_Project6--Puppet_Cobbler.html">Puppet Cobbler</a></li>
</ol>
<p><a href="day34_Project7.html">day34 Project7</a></p>

<ol>
<li><a href="day34_Project7--项目介绍.html">项目介绍</a></li>
<li><a href="day34_Project7--MRTG.html">MRTG</a></li>
<li><a href="day34_Project7--nagios.html">nagios</a></li>
<ol>
<li><a href="day34_Project7--nagios--基本概念.html">基本概念</a></li>
<li><a href="day34_Project7--nagios--部署监控中心.html">部署监控中心</a></li>
<li><a href="day34_Project7--nagios--监控本地主机.html">监控本地主机</a></li>
<li><a href="day34_Project7--nagios--监控远程主机.html">监控远程主机</a></li>
<li><a href="day34_Project7--nagios--nagios配置文件.html">nagios配置文件</a></li>
<li><a href="day34_Project7--nagios--nagios_插件.html">nagios 插件</a></li>
<li><a href="day34_Project7--nagios--性能分析图表.html">性能分析图表</a></li>
<li><a href="day34_Project7--nagios--nagios报警机制.html">nagios报警机制</a></li>
<li><a href="day34_Project7--nagios--管理工具nagiosql.html">管理工具nagiosql</a></li>
<li><a href="day34_Project7--nagios--大型环境监控规划.html">大型环境监控规划</a></li>
</ol>
</ol>
<p><a href="day35_Project8.html">day35 Project8</a></p>

<ol>
<li><a href="day35_Project8--cacti.html">cacti</a></li>
<ol>
<li><a href="day35_Project8--cacti--cacti简介.html">cacti简介</a></li>
<li><a href="day35_Project8--cacti--安装cacti.html">安装cacti</a></li>
<li><a href="day35_Project8--cacti--监控本地Linux服务器.html">监控本地Linux服务器</a></li>
<li><a href="day35_Project8--cacti--监控远程Linux服务器.html">监控远程Linux服务器</a></li>
<li><a href="day35_Project8--cacti--添加模块监控应用.html">添加模块监控应用</a></li>
<li><a href="day35_Project8--cacti--添加插件增加功能.html">添加插件增加功能</a></li>
<li><a href="day35_Project8--cacti--整合nagios+cacti.html">整合nagios+cacti</a></li>
</ol>
<li><a href="day35_Project8--Ganglia部署.html">Ganglia部署</a></li>
<ol>
<li><a href="day35_Project8--Ganglia部署--Ganglia简介.html">Ganglia简介</a></li>
<li><a href="day35_Project8--Ganglia部署--Ganglia部署.html">Ganglia部署</a></li>
</ol>
</ol>
<p><a href="day36_Project9.html">day36 Project9</a></p>

<ol>
<li><a href="day36_Project9--Splunk简介.html">Splunk简介</a></li>
<li><a href="day36_Project9--Splunk安装.html">Splunk安装</a></li>
<li><a href="day36_Project9--Splunk本地日志导入.html">Splunk本地日志导入</a></li>
<li><a href="day36_Project9--Splunk远程Apache日志导入.html">Splunk远程Apache日志导入</a></li>
<li><a href="day36_Project9--Splunk生成报表与视图.html">Splunk生成报表与视图</a></li>
<li><a href="day36_Project9--Splunk应用扩展.html">Splunk应用扩展</a></li>
</ol>
<p><a href="day37_Project10.html">day37 Project10</a></p>

<ol>
<li><a href="day37_Project10--PXE批量部署Linux.html">PXE批量部署Linux</a></li>
<ol>
<li><a href="day37_Project10--PXE批量部署Linux--实现网络安装.html">实现网络安装</a></li>
<li><a href="day37_Project10--PXE批量部署Linux--Kickstart自动安装.html">Kickstart自动安装</a></li>
<li><a href="day37_Project10--PXE批量部署Linux--Kickstart配置详解.html">Kickstart配置详解</a></li>
</ol>
</ol>
<p><a href="day38_Project11.html">day38 Project11</a></p>

<ol>
<li><a href="day38_Project11--Mail基础.html">Mail基础</a></li>
<li><a href="day38_Project11--部署邮件系统.html">部署邮件系统</a></li>
<ol>
<li><a href="day38_Project11--部署邮件系统--基本环境.html">基本环境</a></li>
<li><a href="day38_Project11--部署邮件系统--MTA_Postfix.html">MTA Postfix</a></li>
<li><a href="day38_Project11--部署邮件系统--SMTP_Authentication.html">SMTP Authentication</a></li>
<ol>
<li><a href="day38_Project11--部署邮件系统--SMTP_Authentication--Courier-Authlib.html">Courier-Authlib </a></li>
<li><a href="day38_Project11--部署邮件系统--SMTP_Authentication--Cyrus-SASL.html">Cyrus-SASL</a></li>
</ol>
<li><a href="day38_Project11--部署邮件系统--MDA_Maildrop.html">MDA Maildrop</a></li>
<li><a href="day38_Project11--部署邮件系统--Webmail-ExtMail.html">Webmail-ExtMail</a></li>
<li><a href="day38_Project11--部署邮件系统--Management_ExtMan.html">Management ExtMan </a></li>
<li><a href="day38_Project11--部署邮件系统--MRA_Courier-IMAP.html">MRA Courier-IMAP</a></li>
<li><a href="day38_Project11--部署邮件系统--Apache.html">Apache</a></li>
<li><a href="day38_Project11--部署邮件系统--内容、病毒过滤.html">内容、病毒过滤</a></li>
<li><a href="day38_Project11--部署邮件系统--测试.html">测试</a></li>
<ol>
<li><a href="day38_Project11--部署邮件系统--测试--测试SMTP认证.html">测试SMTP认证</a></li>
<li><a href="day38_Project11--部署邮件系统--测试--测试Courier-authlib.html">测试Courier-authlib</a></li>
</ol>
<li><a href="day38_Project11--部署邮件系统--Mail_Error.html">Mail Error</a></li>
</ol>
</ol>
<p><a href="day39_Project12.html">day39 Project12</a></p>

<ol>
<li><a href="day39_Project12--Postfix队列.html">Postfix队列</a></li>
<li><a href="day39_Project12--Extmail模板修改.html">Extmail模板修改</a></li>
<li><a href="day39_Project12--客户端Outlook.html">客户端Outlook</a></li>
</ol>
<p><a href="day40_ULE_Exam.html">day40 ULE Exam</a></p>

</div>
<div class="page"><h1><b><u>Nginx Rewrite</u></b></h1><br /><br /><strong><span style="color:#0000ff;">Nginx地址重写 rewrite<br /></span></strong><br />========================================================<br /><br /><br /><span style="background-color:#00ff00;">一、什么是Rewrite</span><br />	Rewrite对称URL Rewrite，即URL重写，就是把传入Web的请求重定向到其他URL的过程。<br /><br />1. URL Rewrite最常见的应用是<span style="color:#ff0000;">URL伪静态化</span>，是将动态页面显示为静态页面方式的一种技术。比如<br /><a href="http://www.123.com/news/index.asp?id=123">http://www.123.com/news/index.php?id=123</a> 使用URLRewrite 转换后可以显示为 <a href="http://www.123.com/news/123.html">http://www.<br />123.com/news/123.html</a>对于追求完美主义的网站设计师，就算是网页的地址也希望看起来尽量简洁<br />124. 明快。形如<a href="http://www.123.com/news/index.asp?id=123的网页地址，自然是毫无美感可言，而用">http://www.123.com/news/index.php?id=123的网页地址，自然是毫无美感可言，<br />125. 而用</a>UrlRewrite技术，你可以轻松把它显示为 <a href="http://www.123.com/news/123.html。">http://www.123.com/news/123.html。</a><br />理论上，搜索引擎更喜欢静态页面形式的网页，搜索引擎对静态页面的评分一般要高于动态页面。所<br />以，UrlRewrite可以让我们网站的网页更容易被搜索引擎所收录。<br /><br />2. 从安全角度上讲，如果在url中暴露太多的参数，无疑会造成一定量的信息泄漏，可能会被一些黑客<br />利用，对你的系统造成一定的破坏，所以静态化的url地址可以给我们带来更高的安全性。<br /><br />3. 实现网站地址跳转。<br /><br /><br /><span style="background-color:#00ff00;">二、Rewrite相关指令</span><br />Nginx Rewrite相关指令有<span style="color:#ff0000;">if、rewrite、set、return</span>等。<br /><br /><span style="color:#ff0000;">if</span> 的语法 应用于server和location环境内<br /><br />if (condition) { … }<br /><br />if 可以支持如下条件判断匹配符号<br />~ 					为区分大小写匹配<br />~* 				为不区分大小写匹配<br />!~和!~*		分别为区分大小写不匹配及不区分大小写不匹配<br />-f 和!-f 			用来判断是否存在文件<br />-d 和!-d 		用来判断是否存在目录<br />-e 和!-e 		用来判断是否存在文件或目录<br />-x 和!-x 		用来判断文件是否可执行<br /><br /><span style="color:#0000ff;">在匹配过程中可以引用一些Nginx的全局变量，更多的变量请参考</span><br /><a href="http://wiki.nginx.org/NginxHttpCoreModule">http://wiki.nginx.org/NginxHttpCoreModule</a> 的 Variables 部分<br />$args							请求中的参数;<br />$document_root			针对当前请求的根路径设置值;<br /><span style="color:#ff0000;">$host</span>							请求信息中的"Host"，如果请求中没有Host行，则等于设置的服务器名;<br />$limit_rate					对连接速率的限制;<br />$request_method		请求的方法，比如"GET"、"POST"等;<br />$remote_addr				客户端地址;<br />$remote_port				客户端端口号;<br />$remote_user				客户端用户名，认证用;<br /><span style="color:#ff0000;">$request_filename	</span>	当前请求的文件路径名（带root指定的路径，<span style="color:#ff0000;">即网站的主目录</span>）<br /><span style="color:#ff0000;">$request_uri			</span>	当前请求的文件路径名（不带root指定的路径）<br />$query_string				与$args相同;<br />$scheme						所用的协议，比如<a href="http或者是https">http或者是https</a><br />$server_protocol			请求的协议版本，"HTTP/1.0"或"HTTP/1.1";<br />$server_addr 				服务器地址，如果没有用listen指明服务器地址，使用这个变量将发起一次系统调用<br />以取得地址(造成资源浪费);<br />$server_name				请求到达的服务器名;<br />$document_uri 			与$uri一样，URI地址;<br />$server_port 				请求到达的服务器端口号;<br /><br /><br /><span style="background-color:#00ff00;">三、Rewrite匹配参考示例</span><br /><span style="color:#ff0000;">例1 匹配访问的url地址是否是个目录</span><br />if (-d $request_filename) {<br />…;<br />}<br /><br /><span style="color:#ff0000;">例2 匹配访问的地址是否以www开头</span><br />if ($host ~* ^www) {<br />…;<br />}<br /><br /><br /><span style="background-color:#00ff00;">四、Rewrite flag</span><br />rewrite 指令根据表达式来重定向URI，或者修改字符串。可以应用于server,location, if环境下<br />每行rewrite指令最后应该根一个<span style="color:#ff0000;">flag标记</span>，支持的flag标记有：<br /><span style="color:#ff0000;">last </span>					相当于Apache里的[L]标记，表示完成rewrite<br /><span style="color:#ff0000;">break</span> 				本条规则匹配完成后，终止匹配，不再匹配后面的规则<br /><span style="color:#ff0000;">redirect </span>			返回302临时重定向，浏览器地址会显示跳转后的URL地址<br /><span style="color:#ff0000;">permanent</span> 		返回301永久重定向，浏览器地址会显示跳转后URL地址<br />last和break标记的区别在于，last标记在本条rewrite规则执行完后，会对其所在的<span style="color:#ff0000;">server { … }</span> <br />标签重新发起请求，而break标记则在本条规则匹配完成后，停止匹配，不再做后续的匹配。另有些<br />时候必须使用last，比如在使用alias指令时，而使用proxy_pass指令时则必须使用break。<br /><br /><br /><span style="background-color:#00ff00;">五、Rewrite匹配参考示例</span><br /><span style="color:#ff0000;">例3：以下这段rewrite会导致死循环</span><br />location /abc/ {<br />	rewrite “^/abc/(.*)\.html$” /abc/index.html last;<br />}<br /><br />我们应该将上面的last改成break以避免死循环。<br />redirect 和 permanent区别则是返回的不同方式的重定向，对于客户端来说一般状态下是没有区别<br />的。而对于搜索引擎，相对来说301的重定向更加友好，如果我们把一个地址采用301跳转方式跳转<br />的话，搜索引擎会把老地址的相关信息带到新地址，同时在搜索引擎索引库中彻底废弃掉原先的老地<br />址。使用302重定向时，搜索引擎(特别是google)有时会查看跳转前后哪个网址更直观，然后决定显<br />示哪个，如果它觉的跳转前的URL更好的话，也许地址栏不会更改，那么很有可能出现URL劫持的现<br />像。我们在做URI重写时，有时会发现URI中含有相关参数，如果需要将这些参数保存下来，并且在重<br />写过程中重新引用，我们可以用到<span style="color:#ff0000;"> () </span>和<span style="color:#ff0000;"> $N</span> 的方式来解决。<br /><br /><span style="color:#ff0000;">例4： www.51zhichang.com ==&gt; www.wyzc.com</span><br />if ( $host ~* 51zhichang.com ) {<br />	rewrite .*	 http://www.wyzc.com <span style="color:#ff0000;">permanent</span>;<br />}<br /><br /><br /><span style="color:#ff0000;">例5：当用户访问网址为www.tianyun.com/2013/a/1.html，将其重写为<br />www.tianyun.com/2014/a/1.html</span><br />location ~ ^/2013 {<br />     rewrite ^/2013(.*)$ /2014/$1 permanent;<br />}<br /><br /><br /><span style="color:#ff0000;">例6：用户访问的网址为</span><a href="http://www.test.com/php/abc.html">www.test.com/php/abc.html</a><span style="color:#ff0000;"> 重写后真实地址是</span><br /><a href="http://www.test.com/php/login.php?user=abc">www.test.com/php/login.php?user=abc</a><br />location ~* /php/.*\.html$ {<br />	rewrite .* /php/login.php?user=abc last;<br />}<br /><br />location ~* /php/.*\.html$ {<br />	rewrite ^/php/(.*)\.html$ /php/login.php?user=$1 last;<br />}<br /><br /><span style="color:#ff0000;">例7：用户访问地址为/uplook/11-22-33.html重写后真实地址为/uplook/11/22/33.html</span><br />location /uplook/ {<br />	rewrite /uplook/([0-9]+)-([0-9]+)-([0-9]+).html /uplook/$1/$2/$3.html break;<br />}<br /><br /><br /><span style="color:#0000ff;">set 指令是用于定义一个变量，并且赋值。应用于server,location,if环境。</span><br />语法格式为: set　$变量名 变量值<br /><br /><span style="color:#ff0000;">例8：当访问任意目录下的whoami.html 都重定向到 /who.html</span><br />location ~* .*/whoami\.html$ {<br />	set $who 'who.html';<br />	rewrite .* /$who break;<br />}<br /><br /><span style="color:#0000ff;">return 指令用于返回状态码给客户端，应用于server，location，if环境。</span><br /><span style="color:#ff0000;">例9：如果访问的.sh结尾的文件则返回403操作拒绝错误</span><br />location ~* .*\.sh$ {<br />	return 403;<br />}<br /><br /><span style="color:#ff0000;">例10：实现域名跳转</span><br />if ($<a href="http_host">http_host</a> ~* tianyun\.com){ <br />    rewrite   .* <a href="http://www.uplooking.com">http://www.uplooking.com</a> break;<br />}   <br />http://www.tianyun/a/c/index.html<br /><br />if ($<a href="http_host">http_host</a> ~* tianyun\.com){ <br />	rewrite   .* <a href="http://www.uplooking.com$request_uri">http://www.uplooking.com$request_uri</a> break;<br />} <br /><br /><span style="color:#ff0000;">例11：URL伪静态化</span><br />当用户访问http://www.tianyun.com/login/tianyun.html，将其重写为<br />http://192.168.1.4/login.php?user=tianyun<br />location /login/ {<br />           rewrite ^/login/(.*)\.html$ /login.php?user=$1 <span style="color:#ff0000;">last</span>;<br />          }<br /><br /><br /><br /><span style="background-color:#00ff00;">六、last,break详解</span><br />		location /break/ {<br />             rewrite .* /test/break.html break;<br />        }   <br /><br />        location /last/ {<br />             rewrite .* /test/last.html last;<br />        }   <br /><br />        location /test/ {<br />             rewrite .* /test/test.html break;<br />        }   <br /><br />[root@root html]# echo 'break' &gt; test/break.html<br />[root@root html]# echo 'last' &gt; test/last.html<br />[root@root html]# echo 'test...' &gt; test/test.html<br /><br />http://192.168.10.33/break/1.html<br />http://192.168.10.33/last/1.html<br /><br /><br /><br /><span style="background-color:#00ff00;">课后练习</span><br />1. 配置虚拟主机*.test.com 。当客户端访问任意 <span style="color:#ff0000;">XXX.test.com</span>时都能匹配此主机并将<br />地址重写成 <a href="http://www.test.com/XXX/">www.test.com/XXX/</a> （注意，实验之前你应该保证 XXX.test.com都<br />能正常解析）<br />修改主配置文件，配置虚拟主机　*.test.com<br />书写if语句，判断如果以test.com结尾的由进行url重写<br />将 test.com 之前的内容保存于一个变量domain中<br />将原地址重写成 <a href="http://www.test.com/$domain/">www.test.com/$domain/</a><br />[root@root html]# mkdir jack alice<br />[root@root html]# echo jack.... &gt; jack/index.html<br />[root@root html]# echo alice...&gt; alice/index.html<br /><br /><span style="color:#ff0000;">a. DNS实现泛解析</span><br />*.test.com					网站IP		<br /><br /><span style="color:#ff0000;">b. nginx Rewrite</span><br />if ($<a href="http_host">http_host</a> ~* "^www\.tianyun\.com$" ) {<br />      break;<br />   }<br /><br />if ($<a href="http_host">http_host</a> ~* "^(.*)\.tianyun\.com$" ) {<br />      set $user $1;<br />      rewrite .* <a href="http://www.tianyun.com/$user">http://www.tianyun.com/$user</a><span style="color:#ff0000;"> last</span>;<br />   }<br /><br /><br />2. 当用户访问服务器　<a href="http://www.test.com/page-uid-123.html">http://www.test.com/page-uid-123.html</a> 时服务器自动将<br />地址重写成 <a href="http://www.test.com/page.php?uid=123，当访问">http://www.test.com/page.php?uid=123，当访问</a><br /><a href="http://www.test.com/page-username-123.html重写成">http://www.test.com/page-username-123.html重写成</a> <a href="http://www.test.com/page.php?">http://www.test.com/page.php?</a><br />username=123 。其中123.html可能是任意文件名 XXX.html<br />配置主配置文件并书写rewrite规则<br />使用location语句。<br />在Rewrite中将username和uid字段保存下来，并以变量$1方式引用。<br />将XXX.html字段保存下来，并以变量$2方式引用。<br /><br />3. 当用户访问服务器　<a href="http://www.test.com/today-pic-112.html">http://www.test.com/today-pic-112.html</a> 时服务器自动将<br />地址重写成 <a href="http://www.test.com/today/pic/112.html。（注意，此处today">http://www.test.com/today/pic/112.html。（注意，此处today</a> pic 可以更换<br />成其他任意字母，112可以更换成其他任意数字）<br />配置主配置文件并书写rewrite规则<br />配置以html结尾的文件做rewrite<br />将today pic 112 字段分别保存下来并以$1 $2 $3方式引用<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></div></div>
</body></html>