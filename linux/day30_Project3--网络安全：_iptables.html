<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>网络安全： iptables</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="ULE____课程笔记说明.html">ULE    课程笔记说明</a></p>

<p><a href="软件包.html">软件包</a></p>

<p><a href="day1___bash.html">day1   bash</a></p>

<p><a href="day2___文件管理.html">day2   文件管理</a></p>

<p><a href="day3___用户管理-文件权限.html">day3   用户管理/文件权限</a></p>

<ol>
<li><a href="day3___用户管理-文件权限--用户组管理.html">用户组管理</a></li>
<li><a href="day3___用户管理-文件权限--文件基本权限（1）.html">文件基本权限（1）</a></li>
</ol>
<p><a href="day4___权限-软件包管理.html">day4   权限/软件包管理</a></p>

<ol>
<li><a href="day4___权限-软件包管理--文件高级权限（2）.html">文件高级权限（2）</a></li>
<li><a href="day4___权限-软件包管理--软件包管理（1）.html">软件包管理（1）</a></li>
<ol>
<li><a href="day4___权限-软件包管理--软件包管理（1）--软件包管理概述.html">软件包管理概述</a></li>
<li><a href="day4___权限-软件包管理--软件包管理（1）--rpm管理RPM包.html">rpm管理RPM包</a></li>
<li><a href="day4___权限-软件包管理--软件包管理（1）--yum管理RPM包.html">yum管理RPM包</a></li>
</ol>
</ol>
<p><a href="day5___软件包管理-SHELL.html">day5   软件包管理/SHELL</a></p>

<ol>
<li><a href="day5___软件包管理-SHELL--软件包管理（2）.html">软件包管理（2）</a></li>
<li><a href="day5___软件包管理-SHELL--Bash_Shell基础.html">Bash Shell基础</a></li>
</ol>
<p><a href="day6___进程管理-管道-重定向.html">day6   进程管理/管道/重定向</a></p>

<ol>
<li><a href="day6___进程管理-管道-重定向--进程管理.html">进程管理</a></li>
<li><a href="day6___进程管理-管道-重定向--管道、重定向.html">管道、重定向</a></li>
</ol>
<p><a href="day7___存储管理（1）.html">day7   存储管理（1）</a></p>

<ol>
<li><a href="day7___存储管理（1）--存储基础知识.html">存储基础知识</a></li>
<li><a href="day7___存储管理（1）--基本分区管理.html">基本分区管理</a></li>
<li><a href="day7___存储管理（1）--逻辑卷管理LVM.html">逻辑卷管理LVM</a></li>
</ol>
<p><a href="day8___存储管理（2）.html">day8   存储管理（2）</a></p>

<ol>
<li><a href="day8___存储管理（2）--交换分区swap.html">交换分区swap</a></li>
<li><a href="day8___存储管理（2）--Mount挂载详解.html">Mount挂载详解</a></li>
<li><a href="day8___存储管理（2）--Autofs自动挂载.html">Autofs自动挂载</a></li>
<li><a href="day8___存储管理（2）--Ext3-4文件系统.html">Ext3/4文件系统</a></li>
<li><a href="day8___存储管理（2）--文件链接原理.html">文件链接原理</a></li>
</ol>
<p><a href="day9___存储管理（3）.html">day9   存储管理（3）</a></p>

<ol>
<li><a href="day9___存储管理（3）--磁盘限额.html">磁盘限额</a></li>
<li><a href="day9___存储管理（3）--磁盘阵列RAID.html">磁盘阵列RAID</a></li>
<li><a href="day9___存储管理（3）--文件查找.html">文件查找</a></li>
<li><a href="day9___存储管理（3）--文件打包及压缩.html">文件打包及压缩</a></li>
</ol>
<p><a href="day10_kernel-Modules.html">day10 kernel/Modules</a></p>

<ol>
<li><a href="day10_kernel-Modules--kernel基本概念.html">kernel基本概念</a></li>
<li><a href="day10_kernel-Modules--Kernel升级.html">Kernel升级</a></li>
<li><a href="day10_kernel-Modules--增加内核模块.html">增加内核模块</a></li>
<li><a href="day10_kernel-Modules--硬件驱动安装.html">硬件驱动安装</a></li>
</ol>
<p><a href="day11_系统启动-故障修复.html">day11 系统启动/故障修复</a></p>

<ol>
<li><a href="day11_系统启动-故障修复--系统引导流程.html">系统引导流程</a></li>
<li><a href="day11_系统启动-故障修复--常见故障处理.html">常见故障处理</a></li>
</ol>
<p><a href="day12_Cron-Network.html">day12 Cron/Network</a></p>

<ol>
<li><a href="day12_Cron-Network--计划任务cron.html">计划任务cron</a></li>
<li><a href="day12_Cron-Network--网络基础.html">网络基础</a></li>
</ol>
<p><a href="day13_Rsyslog.html">day13 Rsyslog</a></p>

<ol>
<li><a href="day13_Rsyslog--日志管理基础.html">日志管理基础</a></li>
<li><a href="day13_Rsyslog--集中式日志管理.html">集中式日志管理</a></li>
<li><a href="day13_Rsyslog--日志logrotate.html">日志logrotate</a></li>
</ol>
<p><a href="day14_SSHD-DHCP-NTP.html">day14 SSHD/DHCP/NTP</a></p>

<ol>
<li><a href="day14_SSHD-DHCP-NTP--服务概述.html">服务概述</a></li>
<li><a href="day14_SSHD-DHCP-NTP--SSHD.html">SSHD</a></li>
<li><a href="day14_SSHD-DHCP-NTP--DHCP.html">DHCP</a></li>
<li><a href="day14_SSHD-DHCP-NTP--NTPD.html">NTPD</a></li>
</ol>
<p><a href="day15_Vsftpd-NFS-CIFS.html">day15 Vsftpd/NFS/CIFS</a></p>

<ol>
<li><a href="day15_Vsftpd-NFS-CIFS--Vsftpd.html">Vsftpd</a></li>
<li><a href="day15_Vsftpd-NFS-CIFS--NAS之：_NFS.html">NAS之： NFS</a></li>
<li><a href="day15_Vsftpd-NFS-CIFS--NAS之：_CIFS.html">NAS之： CIFS</a></li>
</ol>
<p><a href="day16_DNS.html">day16 DNS</a></p>

<ol>
<li><a href="day16_DNS--DNS基本概念.html">DNS基本概念</a></li>
<li><a href="day16_DNS--Master_正向区-反向区.html">Master: 正向区/反向区</a></li>
<li><a href="day16_DNS--Slave___正向区-反向区.html">Slave:   正向区/反向区</a></li>
<li><a href="day16_DNS--DNS区域传输限制.html">DNS区域传输限制</a></li>
<li><a href="day16_DNS--根提示区、Forward.html">根提示区、Forward</a></li>
<li><a href="day16_DNS--Client使用DNS解析.html">Client使用DNS解析</a></li>
<li><a href="day16_DNS--扩展：_子域授权.html">扩展： 子域授权</a></li>
<li><a href="day16_DNS--扩展：_DNS_Round_Robin.html">扩展： DNS Round Robin</a></li>
</ol>
<p><a href="day17_Apache-Mail.html">day17 Apache/Mail</a></p>

<ol>
<li><a href="day17_Apache-Mail--常见WEB服务器.html">常见WEB服务器</a></li>
<li><a href="day17_Apache-Mail--Apache_基本配置.html">Apache 基本配置</a></li>
<li><a href="day17_Apache-Mail--Apache_虚拟主机.html">Apache 虚拟主机</a></li>
<li><a href="day17_Apache-Mail--Apache_访问控制.html">Apache 访问控制</a></li>
<li><a href="day17_Apache-Mail--Apache_Alias.html">Apache Alias</a></li>
<li><a href="day17_Apache-Mail--Apache_LAMP_(rpm).html">Apache LAMP (rpm)</a></li>
<li><a href="day17_Apache-Mail--Mail_Postfix.html">Mail: Postfix</a></li>
<li><a href="day17_Apache-Mail--部署邮件系统.html">部署邮件系统</a></li>
</ol>
<p><a href="day18_SHELL1.html">day18 SHELL1</a></p>

<ol>
<li><a href="day18_SHELL1--Bash_Shell.html">Bash Shell</a></li>
<li><a href="day18_SHELL1--Shell变量.html">Shell变量</a></li>
<li><a href="day18_SHELL1--Shell条件测试.html">Shell条件测试</a></li>
<li><a href="day18_SHELL1--流程控制：if.html">流程控制：if</a></li>
</ol>
<p><a href="day19_SHELL2.html">day19 SHELL2</a></p>

<ol>
<li><a href="day19_SHELL2--模式匹配：case.html">模式匹配：case</a></li>
<li><a href="day19_SHELL2--Shell循环：for.html">Shell循环：for</a></li>
<li><a href="day19_SHELL2--Shell循环：while_until.html">Shell循环：while until</a></li>
<li><a href="day19_SHELL2--Shell数组变量.html">Shell数组变量</a></li>
<li><a href="day19_SHELL2--day2作业.html">day2作业</a></li>
</ol>
<p><a href="day20_SHELL3.html">day20 SHELL3</a></p>

<ol>
<li><a href="day20_SHELL3--Shell_函数.html">Shell 函数</a></li>
<ol>
<li><a href="day20_SHELL3--Shell_函数--shell脚本的相互调用.html">shell脚本的相互调用</a></li>
</ol>
<li><a href="day20_SHELL3--影响程序的Shell命令.html">影响程序的Shell命令</a></li>
<li><a href="day20_SHELL3--expect.html">expect</a></li>
<li><a href="day20_SHELL3--正则表达式RE.html">正则表达式RE</a></li>
</ol>
<p><a href="day21_SHELL4.html">day21 SHELL4</a></p>

<ol>
<li><a href="day21_SHELL4--文本处理：grep.html">文本处理：grep</a></li>
<li><a href="day21_SHELL4--文本处理：sed.html">文本处理：sed</a></li>
<ol>
<li><a href="day21_SHELL4--文本处理：sed--文本处理：sed（随堂笔记）.html">文本处理：sed（随堂笔记）</a></li>
</ol>
<li><a href="day21_SHELL4--文本处理：awk.html">文本处理：awk</a></li>
<ol>
<li><a href="day21_SHELL4--文本处理：awk--文件处理：awk（随堂笔记）.html">文件处理：awk（随堂笔记）</a></li>
</ol>
</ol>
<p><a href="day22_SHELL5.html">day22 SHELL5</a></p>

<ol>
<li><a href="day22_SHELL5--进程锁.html">进程锁</a></li>
<li><a href="day22_SHELL5--并行进程.html">并行进程</a></li>
<li><a href="day22_SHELL5--使用sleep.html">使用sleep</a></li>
<li><a href="day22_SHELL5--Shell案例.html">Shell案例</a></li>
</ol>
<p><a href="mysql_5.6(new).html">mysql 5.6(new)</a></p>

<ol>
<li><a href="mysql_5.6(new)--mysql_概述.html">mysql 概述</a></li>
<li><a href="mysql_5.6(new)--mysql_的安装.html">mysql 的安装</a></li>
<li><a href="mysql_5.6(new)--mysql_的并发处理.html">mysql 的并发处理</a></li>
<li><a href="mysql_5.6(new)--mysql_的引擎.html">mysql 的引擎</a></li>
<li><a href="mysql_5.6(new)--数据库范式.html">数据库范式</a></li>
</ol>
<p><a href="day23_MySQL1.html">day23 MySQL1</a></p>

<ol>
<li><a href="day23_MySQL1--MySQL基础.html">MySQL基础</a></li>
<li><a href="day23_MySQL1--MySQL安装.html">MySQL安装</a></li>
<li><a href="day23_MySQL1--MySQL数据库操作.html">MySQL数据库操作</a></li>
<li><a href="day23_MySQL1--MySQL存储引擎.html">MySQL存储引擎</a></li>
<li><a href="day23_MySQL1--MySQL数据类型.html">MySQL数据类型</a></li>
<ol>
<li><a href="day23_MySQL1--MySQL数据类型--MySQL_5.5.html">MySQL 5.5</a></li>
<li><a href="day23_MySQL1--MySQL数据类型--MySQL_5.6.html">MySQL 5.6</a></li>
</ol>
<li><a href="day23_MySQL1--MySQL表操作.html">MySQL表操作</a></li>
<li><a href="day23_MySQL1--mysql运算符.html">mysql运算符</a></li>
</ol>
<p><a href="day24_MySQL2.html">day24 MySQL2</a></p>

<ol>
<li><a href="day24_MySQL2--MySQL数据操作.html">MySQL数据操作</a></li>
<li><a href="day24_MySQL2--MySQL单表查询.html">MySQL单表查询</a></li>
<li><a href="day24_MySQL2--MySQL索引.html">MySQL索引</a></li>
<li><a href="day24_MySQL2--mysql触发器.html">mysql触发器</a></li>
<li><a href="day24_MySQL2--MySQL视图.html">MySQL视图</a></li>
<li><a href="day24_MySQL2--mysql_存储过程与函数.html">mysql 存储过程与函数</a></li>
<li><a href="day24_MySQL2--mysql_流程控制.html">mysql 流程控制</a></li>
</ol>
<p><a href="day25_MySQL3.html">day25 MySQL3</a></p>

<ol>
<li><a href="day25_MySQL3--MySQL多表查询.html">MySQL多表查询</a></li>
<li><a href="day25_MySQL3--MySQL数据库分区.html">MySQL数据库分区</a></li>
<li><a href="day25_MySQL3--MySQL安全机制.html">MySQL安全机制</a></li>
<li><a href="day25_MySQL3--MySQL日志管理.html">MySQL日志管理</a></li>
<li><a href="day25_MySQL3--MySQL事务与隔离级别.html">MySQL事务与隔离级别</a></li>
<li><a href="day25_MySQL3--MySQL数据备份.html">MySQL数据备份</a></li>
<ol>
<li><a href="day25_MySQL3--MySQL数据备份--mysqldump与mysqlhotcopy.html">mysqldump与mysqlhotcopy</a></li>
<li><a href="day25_MySQL3--MySQL数据备份--基于snapshot备份.html">基于snapshot备份</a></li>
<li><a href="day25_MySQL3--MySQL数据备份--xtrabackup.html">xtrabackup</a></li>
<li><a href="day25_MySQL3--MySQL数据备份--innobackupex.html">innobackupex</a></li>
<li><a href="day25_MySQL3--MySQL数据备份--mysqlbackup.html">mysqlbackup</a></li>
</ol>
</ol>
<p><a href="day26_MySQL4.html">day26 MySQL4</a></p>

<ol>
<li><a href="day26_MySQL4--MySQL复制技术.html">MySQL复制技术</a></li>
<li><a href="day26_MySQL4--MySQL读写分离.html">MySQL读写分离</a></li>
<ol>
<li><a href="day26_MySQL4--MySQL读写分离--MySQL_Proxy.html">MySQL Proxy</a></li>
<li><a href="day26_MySQL4--MySQL读写分离--Amoeba.html">Amoeba</a></li>
</ol>
</ol>
<p><a href="day27_MySQL5.html">day27 MySQL5</a></p>

<ol>
<li><a href="day27_MySQL5--LNMP环境搭建.html">LNMP环境搭建</a></li>
<li><a href="day27_MySQL5--MySQL集群技术.html">MySQL集群技术</a></li>
</ol>
<p><a href="memcached_(new).html">memcached (new)</a></p>

<ol>
<li><a href="memcached_(new)--memcache简介与工作原理.html">memcache简介与工作原理</a></li>
<li><a href="memcached_(new)--Memcache的应用.html">Memcache的应用</a></li>
<li><a href="memcached_(new)--memcache_session.html">memcache_session</a></li>
</ol>
<p><a href="day28_Project1.html">day28 Project1</a></p>

<ol>
<li><a href="day28_Project1--Nginx_基本配置.html">Nginx 基本配置</a></li>
<li><a href="day28_Project1--Nginx_虚拟主机.html">Nginx 虚拟主机</a></li>
<li><a href="day28_Project1--Nginx_访问控制.html">Nginx 访问控制</a></li>
<li><a href="day28_Project1--Nginx_查看状态.html">Nginx 查看状态</a></li>
<li><a href="day28_Project1--Nginx_LNMP.html">Nginx LNMP</a></li>
<li><a href="day28_Project1--Nginx_Upstream.html">Nginx Upstream</a></li>
<li><a href="day28_Project1--项目一：_Nginx实现基本LB.html">项目一： Nginx实现基本LB</a></li>
</ol>
<p><a href="day29_Project2.html">day29 Project2</a></p>

<ol>
<li><a href="day29_Project2--项目安排.html">项目安排</a></li>
<li><a href="day29_Project2--Nginx_Rewrite.html">Nginx Rewrite</a></li>
<li><a href="day29_Project2--Tomcat_JSP.html">Tomcat JSP</a></li>
<li><a href="day29_Project2--Tomcat_虚拟主机.html">Tomcat 虚拟主机</a></li>
<li><a href="day29_Project2--Nginx_模块.html">Nginx 模块</a></li>
<ol>
<li><a href="day29_Project2--Nginx_模块--限速模块.html">限速模块</a></li>
<li><a href="day29_Project2--Nginx_模块--限线程数.html">限线程数</a></li>
<li><a href="day29_Project2--Nginx_模块--隐藏版本号.html">隐藏版本号</a></li>
<li><a href="day29_Project2--Nginx_模块--访问控制模块.html">访问控制模块</a></li>
<li><a href="day29_Project2--Nginx_模块--增加第三方模块.html">增加第三方模块</a></li>
</ol>
</ol>
<p><a href="day30_Project3.html">day30 Project3</a></p>

<ol>
<li><a href="day30_Project3--网络安全：_iptables.html">网络安全： iptables</a></li>
<li><a href="day30_Project3--七层过滤(选讲).html">七层过滤(选讲)</a></li>
</ol>
<p><a href="day31_Project4.html">day31 Project4</a></p>

<ol>
<li><a href="day31_Project4--项目介绍.html">项目介绍</a></li>
<li><a href="day31_Project4--代理服务器：_Squid.html">代理服务器： Squid</a></li>
<li><a href="day31_Project4--代理服务器：_Nginx.html">代理服务器： Nginx</a></li>
</ol>
<p><a href="day32_Project5.html">day32 Project5</a></p>

<ol>
<li><a href="day32_Project5--智能DNS：view.html">智能DNS：view</a></li>
<li><a href="day32_Project5--内容分发网络：CDN.html">内容分发网络：CDN</a></li>
</ol>
<p><a href="day33_Project6.html">day33 Project6</a></p>

<ol>
<li><a href="day33_Project6--Puppet简介.html">Puppet简介</a></li>
<li><a href="day33_Project6--Puppet部署.html">Puppet部署</a></li>
<li><a href="day33_Project6--实例：File资源.html">实例：File资源</a></li>
<li><a href="day33_Project6--实例：创建模块test1.html">实例：创建模块test1</a></li>
<li><a href="day33_Project6--实例：创建模块httpd.html">实例：创建模块httpd</a></li>
<li><a href="day33_Project6--Puppet命名规范.html">Puppet命名规范</a></li>
<li><a href="day33_Project6--Puppet资源.html">Puppet资源</a></li>
<ol>
<li><a href="day33_Project6--Puppet资源--file.html">file</a></li>
<li><a href="day33_Project6--Puppet资源--group.html">group</a></li>
<li><a href="day33_Project6--Puppet资源--user.html">user</a></li>
<li><a href="day33_Project6--Puppet资源--exec.html">exec</a></li>
<li><a href="day33_Project6--Puppet资源--cron.html">cron</a></li>
<li><a href="day33_Project6--Puppet资源--yumrepo.html">yumrepo</a></li>
<li><a href="day33_Project6--Puppet资源--package.html">package</a></li>
<li><a href="day33_Project6--Puppet资源--service.html">service</a></li>
</ol>
<li><a href="day33_Project6--资源的依赖关系.html">资源的依赖关系</a></li>
<li><a href="day33_Project6--notify_subscribe.html">notify subscribe</a></li>
<li><a href="day33_Project6--Puppet部署Nginx.html">Puppet部署Nginx</a></li>
<li><a href="day33_Project6--Puppet部署MySQL.html">Puppet部署MySQL</a></li>
<li><a href="day33_Project6--Master自动签发证书.html">Master自动签发证书</a></li>
<li><a href="day33_Project6--Puppet_Dashboard.html">Puppet Dashboard</a></li>
<li><a href="day33_Project6--Puppet_Git.html">Puppet Git</a></li>
<li><a href="day33_Project6--Puppet_Cobbler.html">Puppet Cobbler</a></li>
</ol>
<p><a href="day34_Project7.html">day34 Project7</a></p>

<ol>
<li><a href="day34_Project7--项目介绍.html">项目介绍</a></li>
<li><a href="day34_Project7--MRTG.html">MRTG</a></li>
<li><a href="day34_Project7--nagios.html">nagios</a></li>
<ol>
<li><a href="day34_Project7--nagios--基本概念.html">基本概念</a></li>
<li><a href="day34_Project7--nagios--部署监控中心.html">部署监控中心</a></li>
<li><a href="day34_Project7--nagios--监控本地主机.html">监控本地主机</a></li>
<li><a href="day34_Project7--nagios--监控远程主机.html">监控远程主机</a></li>
<li><a href="day34_Project7--nagios--nagios配置文件.html">nagios配置文件</a></li>
<li><a href="day34_Project7--nagios--nagios_插件.html">nagios 插件</a></li>
<li><a href="day34_Project7--nagios--性能分析图表.html">性能分析图表</a></li>
<li><a href="day34_Project7--nagios--nagios报警机制.html">nagios报警机制</a></li>
<li><a href="day34_Project7--nagios--管理工具nagiosql.html">管理工具nagiosql</a></li>
<li><a href="day34_Project7--nagios--大型环境监控规划.html">大型环境监控规划</a></li>
</ol>
</ol>
<p><a href="day35_Project8.html">day35 Project8</a></p>

<ol>
<li><a href="day35_Project8--cacti.html">cacti</a></li>
<ol>
<li><a href="day35_Project8--cacti--cacti简介.html">cacti简介</a></li>
<li><a href="day35_Project8--cacti--安装cacti.html">安装cacti</a></li>
<li><a href="day35_Project8--cacti--监控本地Linux服务器.html">监控本地Linux服务器</a></li>
<li><a href="day35_Project8--cacti--监控远程Linux服务器.html">监控远程Linux服务器</a></li>
<li><a href="day35_Project8--cacti--添加模块监控应用.html">添加模块监控应用</a></li>
<li><a href="day35_Project8--cacti--添加插件增加功能.html">添加插件增加功能</a></li>
<li><a href="day35_Project8--cacti--整合nagios+cacti.html">整合nagios+cacti</a></li>
</ol>
<li><a href="day35_Project8--Ganglia部署.html">Ganglia部署</a></li>
<ol>
<li><a href="day35_Project8--Ganglia部署--Ganglia简介.html">Ganglia简介</a></li>
<li><a href="day35_Project8--Ganglia部署--Ganglia部署.html">Ganglia部署</a></li>
</ol>
</ol>
<p><a href="day36_Project9.html">day36 Project9</a></p>

<ol>
<li><a href="day36_Project9--Splunk简介.html">Splunk简介</a></li>
<li><a href="day36_Project9--Splunk安装.html">Splunk安装</a></li>
<li><a href="day36_Project9--Splunk本地日志导入.html">Splunk本地日志导入</a></li>
<li><a href="day36_Project9--Splunk远程Apache日志导入.html">Splunk远程Apache日志导入</a></li>
<li><a href="day36_Project9--Splunk生成报表与视图.html">Splunk生成报表与视图</a></li>
<li><a href="day36_Project9--Splunk应用扩展.html">Splunk应用扩展</a></li>
</ol>
<p><a href="day37_Project10.html">day37 Project10</a></p>

<ol>
<li><a href="day37_Project10--PXE批量部署Linux.html">PXE批量部署Linux</a></li>
<ol>
<li><a href="day37_Project10--PXE批量部署Linux--实现网络安装.html">实现网络安装</a></li>
<li><a href="day37_Project10--PXE批量部署Linux--Kickstart自动安装.html">Kickstart自动安装</a></li>
<li><a href="day37_Project10--PXE批量部署Linux--Kickstart配置详解.html">Kickstart配置详解</a></li>
</ol>
</ol>
<p><a href="day38_Project11.html">day38 Project11</a></p>

<ol>
<li><a href="day38_Project11--Mail基础.html">Mail基础</a></li>
<li><a href="day38_Project11--部署邮件系统.html">部署邮件系统</a></li>
<ol>
<li><a href="day38_Project11--部署邮件系统--基本环境.html">基本环境</a></li>
<li><a href="day38_Project11--部署邮件系统--MTA_Postfix.html">MTA Postfix</a></li>
<li><a href="day38_Project11--部署邮件系统--SMTP_Authentication.html">SMTP Authentication</a></li>
<ol>
<li><a href="day38_Project11--部署邮件系统--SMTP_Authentication--Courier-Authlib.html">Courier-Authlib </a></li>
<li><a href="day38_Project11--部署邮件系统--SMTP_Authentication--Cyrus-SASL.html">Cyrus-SASL</a></li>
</ol>
<li><a href="day38_Project11--部署邮件系统--MDA_Maildrop.html">MDA Maildrop</a></li>
<li><a href="day38_Project11--部署邮件系统--Webmail-ExtMail.html">Webmail-ExtMail</a></li>
<li><a href="day38_Project11--部署邮件系统--Management_ExtMan.html">Management ExtMan </a></li>
<li><a href="day38_Project11--部署邮件系统--MRA_Courier-IMAP.html">MRA Courier-IMAP</a></li>
<li><a href="day38_Project11--部署邮件系统--Apache.html">Apache</a></li>
<li><a href="day38_Project11--部署邮件系统--内容、病毒过滤.html">内容、病毒过滤</a></li>
<li><a href="day38_Project11--部署邮件系统--测试.html">测试</a></li>
<ol>
<li><a href="day38_Project11--部署邮件系统--测试--测试SMTP认证.html">测试SMTP认证</a></li>
<li><a href="day38_Project11--部署邮件系统--测试--测试Courier-authlib.html">测试Courier-authlib</a></li>
</ol>
<li><a href="day38_Project11--部署邮件系统--Mail_Error.html">Mail Error</a></li>
</ol>
</ol>
<p><a href="day39_Project12.html">day39 Project12</a></p>

<ol>
<li><a href="day39_Project12--Postfix队列.html">Postfix队列</a></li>
<li><a href="day39_Project12--Extmail模板修改.html">Extmail模板修改</a></li>
<li><a href="day39_Project12--客户端Outlook.html">客户端Outlook</a></li>
</ol>
<p><a href="day40_ULE_Exam.html">day40 ULE Exam</a></p>

</div>
<div class="page"><h1><b><u>网络安全： iptables</u></b></h1><br /><br /><strong><span style="color:#0000ff;">企业级网络安全构建之 Iptables</span></strong><br /><br /><span style="color:#ff0000;">主要针对网络访问</span><br />========================================================<br /><br /><br /><span style="background-color:#00ff00;">一、</span><span style="background-color:#00ff00;">安全体系概览</span><br /><span style="color:#0000ff;">Firewalls</span> --&gt; TCP Wrappers --&gt; Xinetd --&gt; <span style="color:#0000ff;">PAM</span> -- &gt; <span style="color:#0000ff;">SELinux</span> --&gt; <span style="color:#0000ff;">Server specific<br /></span><br /><br /><span style="background-color:#00ff00;">二、预备知识：OSI七层模型</span>																			<br />HOST_A firefox（封装） －－－－－－－－－－－－－－－ httpd server（解封装）HOST_B							<br /><span style="color:#ff0000;">应用层</span>			ftp <span style="color:#0000ff;">http</span> smtp pop3																      			<span style="color:#ff0000;">应用层</span><br /><span style="color:#ff0000;">表示层</span>      																													<span style="color:#ff0000;">表示层</span><br /><span style="color:#ff0000;">会话层																	</span>													<span style="color:#ff0000;">会话层</span><br />																		<br /><span style="color:#a020f0;">传输层  </span>    		<span style="color:#0000ff;">TCP</span>,UDP s_port: xxxx   					--&gt; d_port: 80     							<span style="color:#a020f0;">传输层</span>		<br /><span style="color:#a020f0;">网络层 </span>     		IP,ICMP   s_IP: 192.168.5.10  			--&gt; d_IP: 192.168.5.240 				<span style="color:#a020f0;">网络层</span>    		<br /><span style="color:#a020f0;">数据链路层</span>   	ARP		   s_mac: 00:50:fc:12:34:56 --&gt; d_mac: 00:50:fc:12:34:59		<span style="color:#a020f0;">数据链路层</span> 	<br /><span style="color:#a020f0;">物理层</span><span style="color:#ffa500;">																	</span>													<span style="color:#a020f0;">物理层</span><br /><br />TCP: 	面向连接，可靠的传输协议    类似于三次握手,四次挥手, window，确认, 重传...<br />UDP: 	非面向连接，不可靠的传输协议<span style="background-color:#90ee90;"><br /><br /><br /></span><span style="background-color:#00ff00;">三</span><span style="background-color:#00ff00;">、Firewalls: netfilter/iptables</span><br />netfilter组件		内核空间，是内核一部分 <br />iptables组件  	用户空间，提供管理防火墙的手段，通过iptables插入、删除、修改规则<br /><br /><br /><span style="background-color:#00ff00;">四</span><span style="background-color:#00ff00;">、四张表，五条链</span><br />raw---&gt;mangle---&gt;nat--&gt;filter<br />raw：		主要做连接追踪<br />mangle:	对数据包进行修改，例如给数据包打标记MARK<br />nat:			主要修改数据包的地址，例如源地址或目标地址<br />filter:		实现对数据包的<span style="color:#ff0000;">过滤</span><br /><br /><br /><span style="background-color:#00ff00;">五</span><span style="background-color:#00ff00;">、数据包的流向图</span><br /><br /><br /><span style="background-color:#00ff00;">六</span><span style="background-color:#00ff00;">、iptables语法</span><br />iptables [-t 要操作的表] &lt;操作命令&gt; [要操作的链] [规则号码] <span style="color:#ff0000;">[匹配条件]</span> [-j 匹配后的动作]<br />                  小写                大写             大写                           小写            大写<br /><br /><span style="color:#ff0000;">示例:</span><br />iptables -L			<br />iptables -t filter -L	<br />iptables -t nat -L<br />iptables -t raw -L<br />iptables -t mangle -L<br />========================================================<br /><br /><span style="color:#ff0000;">常见的操作命令：</span><br />-L								查看,v详细,n不反解   --line-number<br />-A								追加，放置最后一条<br />-I								插入，默认插入成第一条<br />-D								删除<br />-F								清空flush<br />-P     						设置默认策略policy<br /><br /><span style="color:#ff0000;">匹配的条件：</span><br />-s 192.168.2.0/24   	源地址<br />-d 192.168.2.1	    	目标地址<br />-p tcp|upd|icmp		协议<br />-i  lo		    				input 从lo接口进入的数据包<br />-o eth0             		output 从eth0出去的数据包<br />-p tcp --dport 80   	目标端口是80,必须和-p tcp|udp 连用<br />-p udp --dport 53   	目标端口是53/udp<br /><br /><span style="color:#ff0000;">处理动作：</span><br />filter:<br />-j ACCEPT					允许<br />-j DROP					丢弃<br />-j REJECT					拒绝<br /><br />nat:<br />-j SNAT						源地址转换<br />-j DNAT						目标地址转换<br /><br />-j LOG						写日志<br />-j MARK					打标记<br />...<br /><br /><span style="color:#ff0000;"># iptables -t filter -A INPUT -s 192.168.1.0/24 -j SNAT --to 1.1.1.1			错误</span><br />========================================================<br /><br /><span style="background-color:#00ff00;">七、Iptables匹配示例</span><br /><span style="color:#ff0000;">示例1：</span><br />iptables -F<br />iptables -A INPUT -j REJECT							<br />iptables -I INPUT -p tcp --dport 80 -j ACCEPT<br />iptables -I INPUT -p tcp --dport 20:21 -j ACCEPT<br />iptables -I INPUT -p tcp --dport 22 -j ACCEPT<br />iptables -I INPUT -p icmp -j ACCEPT<br />iptables -nL<br /><br /><span style="color:#a020f0;">示例1存在的问题：</span><br />1. 本机无法访问本机<br />解决方案：iptables -I INPUT 2 -i lo -j ACCEPT<br /><br />2. 本机无法访问其它主机<br />iptables -I INPUT <span style="color:#ff0000;">-m state</span> --state <span style="color:#ff0000;">ESTABLISHED,RELATED</span> -j ACCEPT<br /><br />3. FTP无法访问<br /><span style="color:#ff0000;">方法一：</span> <span style="color:#ff0000;">为vsftpd指定数据端口</span><br /># iptables -I INPUT -p tcp --dport 21 -j ACCEPT<br /># vim /etc/vsftpd/vsftpd.conf<br /><span style="color:#0000ff;">pasv_min_port=50000<br />pasv_max_port=60000</span><br /># iptables -I INPUT -p tcp --dport 50000:60000 -j ACCEPT<br /><span style="color:#ff0000;">方法二： 使用连接追踪模块</span><br />[root@tianyun ~]# iptables -I INPUT -m state --state <span style="color:#ff0000;">ESTABLISHED,</span><span style="color:#ff0000;">RELATED</span> -j ACCEPT<br />[root@tianyun ~]# iptables -I INPUT -p tcp --dport 21 -j ACCEPT  	<br />[root@tianyun ~]# modprobe <span style="color:#ff0000;">nf</span><span style="color:#ff0000;">_conntrack_ftp</span>								//加载连接追踪模块（临时）<br />[root@tianyun ~]# vim /etc/sysconfig/iptables-config						//开机自动加载<br />IPTABLES_MODULES="<span style="color:#ff0000;">nf</span><span style="color:#ff0000;">_conntrack_ftp</span>"<br /><br /><br /><span style="color:#ff0000;">示例2： iptables标准流程</span><br />========================================================<br />[root@tianyun ~]# iptables -F<br />[root@tianyun ~]# iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -i lo -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -s 192.168.2.0/24 -j ACCEPT    //允许公司内网任何访问<br />[root@tianyun ~]# iptables -A INPUT -s 192.168.3.0/24 -j ACCEPT    //允许公司内网任何访问<br />[root@tianyun ~]# iptables -A INPUT -p tcp --dport 80 -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -p tcp --dport 22 -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -p tcp --dport 21 -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -j REJECT<br />[root@tianyun ~]# service iptables save<br />[root@tianyun ~]# chkconfig iptables on<br />[root@tianyun ~]# iptables -vnL INPUT<br />[root@tianyun ~]# vim /etc/sysconfig/iptables-config<br />IPTABLES_MODULES="<span style="color:#ff0000;">nf</span><span style="color:#ff0000;">_conntrack_ftp</span>"<br />[root@tianyun ~]# service iptables restart<br /><br /><span style="color:#0000ff;">小知识：</span><br />常见协议的端口 /etc/services<br />[root@tianyun ~]# grep ^http /etc/services<br />服务		协议				端口/传输协议<br />ssh		ssh				22/tcp<br />http		http				80/tcp<br />			https			443/tcp<br />dns		domain		<span style="color:#ff0000;">53/udp</span>,53/tcp<br />mail		smtp			25/tcp				<br />			smtps       	465/tcp         	<br />			pop3			110/tcp			<br />			pop3s			995/tcp<br />			imap			143/tcp<br />			imaps			993/tcp<br />dhcp		bootps      	<span style="color:#ff0000;">67/udp</span>          <br />nfs		nfs				2049/tcp<br />samba						137,138,139/tcp<br />								445/tcp<br />ftp		ftp				21/tcp<br />			ftp-data		20/tcp<br />ntp       ntp				<span style="color:#ff0000;">123/udp</span>      <br />syslog	syslog			<span style="color:#ff0000;">514/udp</span><br />========================================================<br /><br /><br /><span style="color:#ff0000;">示例3： </span><span style="color:#ff0000;background-color:#00ff00;">真实环境配置实例</span><br /><span style="color:#0000ff;">一些常见允许外网访问的服务：</span><span style="color:#ff0000;">										</span><br />网站 www		<span style="color:#0000ff;">http		</span><span style="color:#ff0000;">80/tcp</span><span style="color:#0000ff;">									</span><br />					<span style="color:#0000ff;">https 	</span><span style="color:#ff0000;">443/tcp	</span><span style="color:#0000ff;">	</span>							<br />邮件 mail		<span style="color:#0000ff;">smtp</span>	<span style="color:#ff0000;">25/tcp</span>								<br />					smtps  	465/tcp    		<br />					<span style="color:#0000ff;">pop3	</span><span style="color:#ff0000;">110/tcp</span>						<br />					pop3s	<span style="color:#ff0000;">995/tcp</span>									<br />					imap	143/tcp									<br />											<br /><span style="color:#ff0000;">一些常见不允许外网访问的服务：</span>										<br />文件服务器：	NFS										<br />					SAMBA												<br />					FTP			20/tcp,21/tcp<br />远程管理： 	SSH 			22/tcp	<br />										<br />[root@tianyun ~]# iptables -F<br />[root@tianyun ~]# iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -i lo -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -s 192.168.2.0/24 -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -s 192.168.3.0/24 -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -p tcp --dport 80 -j ACCEPT<br />[root@tianyun ~]#<span style="color:#ff0000;"> </span><span style="color:#ff0000;text-decoration:line-through;">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br />[root@tianyun ~]# iptables -A INPUT -p tcp --dport 25 -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -p tcp --dport 110 -j ACCEPT<br />[root@tianyun ~]# iptables -A INPUT -j REJECT<br /><br /><span style="color:#0000ff;">配置该策略后：</span><br />1. 员工在公司内部（192.168.2.0/24,192.168.3.0/24）能访问服务器上的任何服务<br />2. 当员工出差例如在上海，通过VPN连接到公司<br />    外网 （员工） ===拨号到==&gt; <span style="color:#ff0000;">VPN服务器</span> =====&gt; 内网FTP，SAMBA，NFS，SSH<br />========================================================<br /><br /><br /><br /><span style="background-color:#00ff00;">八、</span><span style="background-color:#00ff00;">防火墙NAT功能</span><br />SNAT 	源地址转换   		出口POSTROUTING<br />DNAT 	目标地址转换		进口PREROUTING<br /><br /><span style="color:#ff0000;">==SNAT,源地址转换</span><br />作用：让内网用户可以通过NAT服务器访问外网<br /><br />       内网                                                            NAT服务器                                    外网<br />client(192.168.1.0/24)---&gt;<span style="color:#0000ff;">eth0(192.168.1.10) NAT Server (1.1.1.254)eth1 </span>---&gt; Web(1.1.1.1) <br /><br /><span style="color:#ff0000;">1. iptables</span><br /># iptables -t nat -F<br /># iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth1 -j SNAT --to 1.1.1.254<br /># service iptables save<br />当内网的数据包到达POSTROUTING链时，修改数据的源地址1.1.1.254<br /><br /><span style="color:#ff0000;">2. 打开内核的路由转发机制</span><br /># sysctl -a |grep ip_forward<br />net.ipv4.ip_forward = 0<br /># vim /etc/sysctl.conf<br />net.ipv4.ip_forward = 1<br /># sysctl -p   立即生效<br />=========================================<br />临时开启路由转发机制：<br />echo 1 &gt; /proc/sys/net/ipv4/ip_forward<br />=========================================<br /><br /><span style="color:#ff0000;">客户端测试：</span>所有内网将网关指定NAT服务器的内网地址：<br /># links  -dump 1.1.1.1<br />   welcome to china<br /><br /><span style="color:#ff0000;">3. 限制上网</span><br /># iptables -A FORWARD -s 192.168.1.168 -j REJECT   	//拒绝某个主机上网<br /><br /><br /><span style="color:#ff0000;">==DNAT，目标地址转换</span><br />作用：外网用户访问内网服务器<br /><span style="color:#ff0000;">注：内网用户必须已经以通过SNAT或其它方式访问外网</span><br />             内网                                                            NAT服务器                                    外网<br />Web Server(192.168.1.54)&lt;---eth0(192.168.1.10) NAT Server(1.1.1.254)eth1 &lt;--- client(1.1.1.1)<br /><br /># iptables -t nat -A <span style="color:#ff0000;">PREROUTING</span> <span style="color:#0000ff;">-d 1.1.1.254 -p tcp --dport 80</span> -j DNAT --to 192.168.1.54<br /># iptables -t nat -nL<br /># links -dump 1.1.1.254<br /><br />DNAT扩展：<br /># iptables -t nat -A PREROUTING -d 1.1.1.254 -p tcp --dport <span style="color:#ff0000;">80</span> -j DNAT --to 192.168.1.100<br /># iptables -t nat -A PREROUTING -d 1.1.1.254 -p tcp --dport <span style="color:#ff0000;">8080</span> -j DNAT --to 192.168.1.200:80<br /># iptables -t nat -A PREROUTING -d 1.1.1.254 -p tcp --dport <span style="color:#ff0000;">8081</span> -j DNAT --to 192.168.1.220:80<br /><br /><br /><span style="color:#ff0000;">作业：</span><br />1. 了解FTP主、被动模式的区别<br />2. 实现SNAT、DNAT<br />3. 了解TCP/IP协议中的TCP协议<br />4. 了解iptables的七层功能L7<br />5. 记一些常用协议的端口<br />========================================================<br /></div></div>
</body></html>